<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‰é”®åŠŸèƒ½è°ƒè¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
            max-width: 800px;
            margin: 0 auto;
        }
        .debug-section { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 8px; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button { 
            background: #3b82f6; 
            color: white; 
            padding: 12px 24px; 
            border: none; 
            border-radius: 6px; 
            margin: 5px; 
            cursor: pointer; 
            font-size: 14px; 
        }
        button:hover { background: #2563eb; }
        .log { 
            background: #f8f9fa; 
            padding: 10px; 
            margin: 5px 0; 
            border-radius: 4px; 
            border-left: 4px solid #28a745;
            font-family: monospace;
            font-size: 13px;
        }
        .error { border-left-color: #dc3545; background: #f8d7da; }
        .warning { border-left-color: #ffc107; background: #fff3cd; }
        .info { border-left-color: #17a2b8; background: #d1ecf1; }
        .console-output {
            background: #1e1e1e;
            color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>ğŸ” Artheraäº¤æ˜“ç³»ç»Ÿ - æŒ‰é”®åŠŸèƒ½è°ƒè¯•</h1>
    
    <div class="debug-section">
        <h3>1. å‡½æ•°å­˜åœ¨æ€§æ£€æŸ¥</h3>
        <button onclick="testFunctionExists()">æµ‹è¯•æ‰€æœ‰å‡½æ•°æ˜¯å¦å®šä¹‰</button>
        <div id="function-results"></div>
    </div>
    
    <div class="debug-section">
        <h3>2. å•ç‹¬åŠŸèƒ½æµ‹è¯•</h3>
        <button onclick="testSetCapitalDirect()">æµ‹è¯•setCapital()</button>
        <button onclick="testGenerateSignalsDirect()">æµ‹è¯•generateSignals()</button>
        <button onclick="testConfigureTushareDirect()">æµ‹è¯•configureTushare()</button>
        <button onclick="testAPIConnectionDirect()">æµ‹è¯•APIè¿æ¥</button>
        <div id="direct-test-results"></div>
    </div>
    
    <div class="debug-section">
        <h3>3. æ¨¡æ‹Ÿä¸»é¡µé¢æŒ‰é’®</h3>
        <button onclick="setCapital()">ğŸ’° è®¾ç½®èµ„é‡‘</button>
        <button onclick="generateSignals()">ğŸš€ ç”ŸæˆAIä¿¡å·</button>
        <button onclick="startAutoTrading()">ğŸ¤– å¼€å§‹è‡ªåŠ¨äº¤æ˜“</button>
        <button onclick="configureTushare()">ğŸ“Š é…ç½®æ•°æ®æº</button>
        <button onclick="executeOrder()">âš¡ æ‰§è¡Œè®¢å•</button>
        <button onclick="refreshAllData()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
    </div>

    <div class="debug-section">
        <h3>4. å®æ—¶æ§åˆ¶å°è¾“å‡º</h3>
        <button onclick="clearConsoleOutput()">æ¸…é™¤æ—¥å¿—</button>
        <div id="console-output" class="console-output">ç­‰å¾…æ—¥å¿—è¾“å‡º...</div>
    </div>
    
    <div class="debug-section">
        <h3>5. DOMå…ƒç´ æ£€æŸ¥</h3>
        <button onclick="testDOMElements()">æ£€æŸ¥å…³é”®å…ƒç´ æ˜¯å¦å­˜åœ¨</button>
        <div id="dom-results"></div>
    </div>

    <script>
        // APIé…ç½®
        const API_BASE_URL = 'http://localhost:8000';
        
        // æ—¥å¿—ç³»ç»Ÿ
        let logCount = 0;
        function log(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString();
            const consoleOutput = document.getElementById('console-output');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span style="color: #888;">[${timestamp}] #${logCount}</span> ${message}`;
            consoleOutput.appendChild(logEntry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
            
            // åŒæ—¶è¾“å‡ºåˆ°æµè§ˆå™¨æ§åˆ¶å°
            console.log(`[${timestamp}] ${message}`);
        }
        
        function clearConsoleOutput() {
            document.getElementById('console-output').innerHTML = 'æ—¥å¿—å·²æ¸…é™¤...<br>';
            logCount = 0;
        }
        
        // 1. æµ‹è¯•å‡½æ•°æ˜¯å¦å­˜åœ¨
        function testFunctionExists() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥å‡½æ•°å®šä¹‰...', 'info');
            const results = document.getElementById('function-results');
            
            const functions = [
                'setCapital', 'generateSignals', 'startAutoTrading', 
                'configureTushare', 'testRealStockData', 'executeOrder', 
                'refreshAllData', 'resetStrategy', 'switchTab', 'showToast'
            ];
            
            let html = '<div style="margin-top: 10px;">';
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                const status = exists ? 'âœ…' : 'âŒ';
                const color = exists ? 'green' : 'red';
                html += `<div style="color: ${color}; margin: 3px 0;">${status} ${funcName}() - ${exists ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}</div>`;
                log(`${status} ${funcName}() - ${exists ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}`);
            });
            html += '</div>';
            results.innerHTML = html;
        }
        
        // 2. ç›´æ¥æµ‹è¯•å•ä¸ªåŠŸèƒ½
        function testSetCapitalDirect() {
            log('ğŸ’° æµ‹è¯•setCapital()...', 'info');
            try {
                if (typeof setCapital === 'function') {
                    setCapital();
                    log('âœ… setCapital() è°ƒç”¨æˆåŠŸ', 'success');
                } else {
                    log('âŒ setCapital() å‡½æ•°ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                log(`âŒ setCapital() æ‰§è¡Œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        function testGenerateSignalsDirect() {
            log('ğŸš€ æµ‹è¯•generateSignals()...', 'info');
            try {
                if (typeof generateSignals === 'function') {
                    generateSignals();
                    log('âœ… generateSignals() è°ƒç”¨æˆåŠŸ', 'success');
                } else {
                    log('âŒ generateSignals() å‡½æ•°ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                log(`âŒ generateSignals() æ‰§è¡Œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        function testConfigureTushareDirect() {
            log('ğŸ“Š æµ‹è¯•configureTushare()...', 'info');
            try {
                if (typeof configureTushare === 'function') {
                    configureTushare();
                    log('âœ… configureTushare() è°ƒç”¨æˆåŠŸ', 'success');
                } else {
                    log('âŒ configureTushare() å‡½æ•°ä¸å­˜åœ¨', 'error');
                }
            } catch (error) {
                log(`âŒ configureTushare() æ‰§è¡Œé”™è¯¯: ${error.message}`, 'error');
            }
        }
        
        async function testAPIConnectionDirect() {
            log('ğŸŒ æµ‹è¯•APIè¿æ¥...', 'info');
            try {
                const response = await fetch(`${API_BASE_URL}/health`);
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… APIè¿æ¥æˆåŠŸ: ${data.status}`, 'success');
                    log(`ğŸ“Š æœåŠ¡çŠ¶æ€: ${JSON.stringify(data, null, 2)}`);
                } else {
                    log(`âš ï¸ APIå“åº”é”™è¯¯: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`âŒ APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // 3. æµ‹è¯•DOMå…ƒç´ 
        function testDOMElements() {
            log('ğŸ” æ£€æŸ¥DOMå…ƒç´ ...', 'info');
            const results = document.getElementById('dom-results');
            
            const elements = [
                'initial-capital', 'tushare-token', 'market-select', 'target-symbols',
                'risk-level', 'max-position', 'stop-loss', 'take-profit',
                'volume-chart', 'performance-chart', 'signals-generated'
            ];
            
            let html = '<div style="margin-top: 10px;">';
            elements.forEach(elementId => {
                const element = document.getElementById(elementId);
                const exists = !!element;
                const status = exists ? 'âœ…' : 'âŒ';
                const color = exists ? 'green' : 'red';
                html += `<div style="color: ${color}; margin: 3px 0;">${status} #${elementId} - ${exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}</div>`;
                log(`${status} å…ƒç´  #${elementId} - ${exists ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'}`);
            });
            html += '</div>';
            results.innerHTML = html;
        }
        
        // 4. æ¨¡æ‹Ÿä¸»é¡µé¢å‡½æ•°ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
        function setCapital() {
            log('ğŸ’° setCapital() è¢«è°ƒç”¨', 'success');
            alert('èµ„é‡‘è®¾ç½®åŠŸèƒ½å·²è§¦å‘ï¼å¦‚æœè¿™ä¸ªå¼¹çª—å‡ºç°ï¼Œè¯´æ˜å‡½æ•°è°ƒç”¨æ­£å¸¸ã€‚');
            return true;
        }
        
        function generateSignals() {
            log('ğŸš€ generateSignals() è¢«è°ƒç”¨', 'success');
            alert('AIä¿¡å·ç”ŸæˆåŠŸèƒ½å·²è§¦å‘ï¼');
            return true;
        }
        
        function startAutoTrading() {
            log('ğŸ¤– startAutoTrading() è¢«è°ƒç”¨', 'success');
            alert('è‡ªåŠ¨äº¤æ˜“åŠŸèƒ½å·²è§¦å‘ï¼');
            return true;
        }
        
        function configureTushare() {
            log('ğŸ“Š configureTushare() è¢«è°ƒç”¨', 'success');
            alert('æ•°æ®æºé…ç½®åŠŸèƒ½å·²è§¦å‘ï¼');
            return true;
        }
        
        function executeOrder() {
            log('âš¡ executeOrder() è¢«è°ƒç”¨', 'success');
            alert('è®¢å•æ‰§è¡ŒåŠŸèƒ½å·²è§¦å‘ï¼');
            return true;
        }
        
        function refreshAllData() {
            log('ğŸ”„ refreshAllData() è¢«è°ƒç”¨', 'success');
            alert('æ•°æ®åˆ·æ–°åŠŸèƒ½å·²è§¦å‘ï¼');
            return true;
        }
        
        function showToast(message, type = 'info') {
            log(`ğŸ“¢ Toast: ${message} (${type})`, 'info');
            return true;
        }
        
        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('ğŸ‘† ç‚¹å‡»æŒ‰é’®å¼€å§‹æµ‹è¯•å„é¡¹åŠŸèƒ½', 'info');
            log('ğŸ“ å¦‚æœæŒ‰é’®æ²¡ååº”ï¼Œè¯´æ˜ä¸»é¡µé¢çš„JavaScriptæœ‰é—®é¢˜', 'warning');
        });
        
        // é”™è¯¯æ•è·
        window.addEventListener('error', function(e) {
            log(`âŒ JavaScripté”™è¯¯: ${e.message}`, 'error');
            log(`ğŸ“ ä½ç½®: ${e.filename}:${e.lineno}`, 'error');
        });
        
    </script>
</body>
</html>