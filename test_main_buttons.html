<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¡µé¢æŒ‰é”®æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f0f2f5; 
        }
        .container { max-width: 1000px; margin: 0 auto; }
        .test-section { 
            background: white; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        button { 
            background: #3b82f6; 
            color: white; 
            padding: 15px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover { 
            background: #2563eb; 
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }
        .status-log { 
            background: #1e1e1e; 
            color: #ffffff; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Consolas', monospace; 
            font-size: 13px; 
            max-height: 400px; 
            overflow-y: auto; 
            margin: 15px 0;
            border: 2px solid #333;
        }
        .success { color: #4ade80; }
        .error { color: #f87171; }
        .warning { color: #facc15; }
        .info { color: #60a5fa; }
        .result-item {
            margin: 8px 0;
            padding: 8px 12px;
            border-radius: 5px;
            border-left: 4px solid #333;
        }
        .result-item.success { 
            background: rgba(34, 197, 94, 0.1); 
            border-left-color: #22c55e; 
        }
        .result-item.error { 
            background: rgba(239, 68, 68, 0.1); 
            border-left-color: #ef4444; 
        }
        .server-status {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
        }
        .status-indicator {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 12px;
        }
        .status-online { background: #dcfce7; color: #15803d; }
        .status-offline { background: #fee2e2; color: #dc2626; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Artheraäº¤æ˜“ç³»ç»Ÿ - æŒ‰é”®å“åº”æµ‹è¯•</h1>
        
        <div class="server-status">
            <div id="server-8000-status" class="status-indicator status-offline">8000ç«¯å£: æ£€æµ‹ä¸­...</div>
            <div id="server-8001-status" class="status-indicator status-offline">8001ç«¯å£: æ£€æµ‹ä¸­...</div>
            <button onclick="checkServers()" style="width: auto; padding: 8px 16px; font-size: 12px;">é‡æ–°æ£€æµ‹</button>
        </div>

        <div class="test-section">
            <h3>ğŸš€ ç¬¬ä¸€æ­¥: æœåŠ¡å™¨è¿é€šæ€§æµ‹è¯•</h3>
            <p>é¦–å…ˆç¡®è®¤åç«¯æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œï¼š</p>
            <div class="button-grid">
                <button onclick="testAPI(8000)">æµ‹è¯• 8000ç«¯å£</button>
                <button onclick="testAPI(8001)">æµ‹è¯• 8001ç«¯å£</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ” ç¬¬äºŒæ­¥: å‡½æ•°å®šä¹‰æ£€æŸ¥</h3>
            <p>æ£€æŸ¥ä¸»é¡µé¢JavaScriptå‡½æ•°æ˜¯å¦æ­£ç¡®å®šä¹‰ï¼š</p>
            <button onclick="checkFunctionDefinitions()">æ£€æŸ¥æ‰€æœ‰å‡½æ•°å®šä¹‰</button>
            <div id="function-check-results"></div>
        </div>

        <div class="test-section">
            <h3>ğŸ“± ç¬¬ä¸‰æ­¥: æŒ‰é”®åŠŸèƒ½æ¨¡æ‹Ÿæµ‹è¯•</h3>
            <p>æµ‹è¯•æ¯ä¸ªæŒ‰é”®çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰ï¼š</p>
            <div class="button-grid">
                <button onclick="simulateSetCapital()">ğŸ’° æ¨¡æ‹Ÿè®¾ç½®èµ„é‡‘</button>
                <button onclick="simulateGenerateSignals()">ğŸš€ æ¨¡æ‹Ÿç”Ÿæˆä¿¡å·</button>
                <button onclick="simulateStartTrading()">ğŸ¤– æ¨¡æ‹Ÿè‡ªåŠ¨äº¤æ˜“</button>
                <button onclick="simulateConfigData()">ğŸ“Š æ¨¡æ‹Ÿé…ç½®æ•°æ®</button>
                <button onclick="simulateExecuteOrder()">âš¡ æ¨¡æ‹Ÿæ‰§è¡Œè®¢å•</button>
                <button onclick="simulateRefreshData()">ğŸ”„ æ¨¡æ‹Ÿåˆ·æ–°æ•°æ®</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ¯ ç¬¬å››æ­¥: çœŸå®APIè°ƒç”¨æµ‹è¯•</h3>
            <p>ç›´æ¥è°ƒç”¨åç«¯APIæµ‹è¯•æ•°æ®æµï¼š</p>
            <div class="button-grid">
                <button onclick="testRealAPI('signals')">æµ‹è¯•ä¿¡å·ç”ŸæˆAPI</button>
                <button onclick="testRealAPI('dashboard')">æµ‹è¯•ä»ªè¡¨æ¿API</button>
                <button onclick="testRealAPI('strategies')">æµ‹è¯•ç­–ç•¥API</button>
                <button onclick="testRealAPI('market')">æµ‹è¯•å¸‚åœºæ•°æ®API</button>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ“Š å®æ—¶æµ‹è¯•æ—¥å¿—</h3>
            <button onclick="clearLog()">æ¸…é™¤æ—¥å¿—</button>
            <div id="test-log" class="status-log">
                <div class="info">ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
            </div>
        </div>
    </div>

    <script>
        let logCounter = 0;
        const API_PORTS = [8000, 8001];
        let workingPort = 8000;

        function log(message, type = 'info') {
            logCounter++;
            const timestamp = new Date().toLocaleTimeString();
            const logDiv = document.getElementById('test-log');
            const entry = document.createElement('div');
            entry.className = `result-item ${type}`;
            entry.innerHTML = `<span style="opacity: 0.7;">[${timestamp}] #${logCounter}</span> ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '<div class="info">æ—¥å¿—å·²æ¸…ç©º</div>';
            logCounter = 0;
        }

        async function checkServers() {
            log('ğŸ” å¼€å§‹æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...', 'info');
            
            for (const port of API_PORTS) {
                try {
                    const response = await fetch(`http://localhost:${port}/health`, { timeout: 3000 });
                    const statusEl = document.getElementById(`server-${port}-status`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        statusEl.textContent = `${port}ç«¯å£: âœ… åœ¨çº¿`;
                        statusEl.className = 'status-indicator status-online';
                        workingPort = port;
                        log(`âœ… ç«¯å£ ${port} æœåŠ¡å™¨æ­£å¸¸è¿è¡Œ`, 'success');
                        log(`ğŸ“Š æœåŠ¡ä¿¡æ¯: ${data.service} v${data.version}`, 'info');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    const statusEl = document.getElementById(`server-${port}-status`);
                    statusEl.textContent = `${port}ç«¯å£: âŒ ç¦»çº¿`;
                    statusEl.className = 'status-indicator status-offline';
                    log(`âŒ ç«¯å£ ${port} è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                }
            }
        }

        async function testAPI(port) {
            log(`ğŸŒ æµ‹è¯•ç«¯å£ ${port} APIè¿æ¥...`, 'info');
            try {
                const start = Date.now();
                const response = await fetch(`http://localhost:${port}/health`);
                const end = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ç«¯å£ ${port} APIå“åº”æˆåŠŸ (${end - start}ms)`, 'success');
                    log(`ğŸ“‹ å“åº”æ•°æ®: ${JSON.stringify(data, null, 2)}`, 'info');
                    workingPort = port;
                } else {
                    log(`âš ï¸ ç«¯å£ ${port} APIå“åº”é”™è¯¯: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`âŒ ç«¯å£ ${port} APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function checkFunctionDefinitions() {
            log('ğŸ” æ£€æŸ¥JavaScriptå‡½æ•°å®šä¹‰...', 'info');
            const results = document.getElementById('function-check-results');
            
            const functions = [
                'setCapital', 'generateSignals', 'startAutoTrading', 
                'configureTushare', 'testRealStockData', 'executeOrder', 
                'refreshAllData', 'resetStrategy', 'showToast', 'switchTab'
            ];

            let html = '<div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 8px;">';
            
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                const status = exists ? 'âœ…' : 'âŒ';
                const color = exists ? '#22c55e' : '#ef4444';
                const bgColor = exists ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)';
                
                html += `<div style="background: ${bgColor}; color: ${color}; padding: 8px 12px; border-radius: 6px; font-size: 13px; border-left: 3px solid ${color};">
                    ${status} ${funcName}()
                </div>`;
                
                log(`${status} ${funcName}() - ${exists ? 'å·²å®šä¹‰' : 'æœªå®šä¹‰'}`, exists ? 'success' : 'error');
            });
            
            html += '</div>';
            results.innerHTML = html;
        }

        // æ¨¡æ‹ŸåŠŸèƒ½æµ‹è¯•
        function simulateSetCapital() {
            log('ğŸ’° æ¨¡æ‹Ÿèµ„é‡‘è®¾ç½®åŠŸèƒ½...', 'info');
            const capital = 100000;
            log(`âœ… èµ„é‡‘è®¾ç½®ä¸º: $${capital.toLocaleString()}`, 'success');
            alert(`âœ… èµ„é‡‘è®¾ç½®åŠŸèƒ½æ­£å¸¸ï¼\nè®¾ç½®é‡‘é¢: $${capital.toLocaleString()}\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜JavaScriptæ‰§è¡Œæ­£å¸¸ã€‚`);
        }

        function simulateGenerateSignals() {
            log('ğŸš€ æ¨¡æ‹ŸAIä¿¡å·ç”Ÿæˆ...', 'info');
            const signals = ['AAPL: BUY ç½®ä¿¡åº¦85%', 'TSLA: SELL ç½®ä¿¡åº¦73%'];
            signals.forEach(signal => log(`ğŸ“Š ${signal}`, 'success'));
            alert(`âœ… AIä¿¡å·ç”ŸæˆåŠŸèƒ½æ­£å¸¸ï¼\n\nç”Ÿæˆä¿¡å·:\n${signals.join('\n')}\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜åŠŸèƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚`);
        }

        function simulateStartTrading() {
            log('ğŸ¤– æ¨¡æ‹Ÿè‡ªåŠ¨äº¤æ˜“å¯åŠ¨...', 'info');
            log('âœ… è‡ªåŠ¨äº¤æ˜“ç³»ç»Ÿå·²å¯åŠ¨', 'success');
            log('ğŸ“ˆ å¼€å§‹15ç§’äº¤æ˜“å¾ªç¯', 'info');
            alert('âœ… è‡ªåŠ¨äº¤æ˜“åŠŸèƒ½æ­£å¸¸ï¼\n\nç³»ç»Ÿå°†å¼€å§‹è‡ªåŠ¨äº¤æ˜“å¾ªç¯\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜åŠŸèƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚');
        }

        function simulateConfigData() {
            log('ğŸ“Š æ¨¡æ‹Ÿæ•°æ®æºé…ç½®...', 'info');
            log('âœ… Tushareæ•°æ®æºé…ç½®æˆåŠŸ', 'success');
            alert('âœ… æ•°æ®æºé…ç½®åŠŸèƒ½æ­£å¸¸ï¼\n\nå·²é…ç½®ä¸“ä¸šæ•°æ®æº\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜åŠŸèƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚');
        }

        function simulateExecuteOrder() {
            log('âš¡ æ¨¡æ‹Ÿè®¢å•æ‰§è¡Œ...', 'info');
            log('âœ… æ¨¡æ‹Ÿè®¢å•: AAPL ä¹°å…¥100è‚¡ $150.25', 'success');
            alert('âœ… è®¢å•æ‰§è¡ŒåŠŸèƒ½æ­£å¸¸ï¼\n\næ¨¡æ‹Ÿè®¢å•å·²æäº¤\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜åŠŸèƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚');
        }

        function simulateRefreshData() {
            log('ğŸ”„ æ¨¡æ‹Ÿæ•°æ®åˆ·æ–°...', 'info');
            log('âœ… ä»ªè¡¨æ¿æ•°æ®å·²æ›´æ–°', 'success');
            log('âœ… å›¾è¡¨æ•°æ®å·²åˆ·æ–°', 'success');
            alert('âœ… æ•°æ®åˆ·æ–°åŠŸèƒ½æ­£å¸¸ï¼\n\næ‰€æœ‰æ•°æ®å·²æ›´æ–°\n\nå¦‚æœæ‚¨çœ‹åˆ°è¿™ä¸ªå¼¹çª—ï¼Œè¯´æ˜åŠŸèƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚');
        }

        async function testRealAPI(type) {
            log(`ğŸ¯ æµ‹è¯•çœŸå®${type} API...`, 'info');
            
            const apiMap = {
                'signals': '/signals/generate',
                'dashboard': '/dashboard/system-status', 
                'strategies': '/strategies/list',
                'market': '/market-data/indices'
            };
            
            try {
                const endpoint = `http://localhost:${workingPort}${apiMap[type]}`;
                const start = Date.now();
                
                let response;
                if (type === 'signals') {
                    response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbols: ['AAPL'] })
                    });
                } else {
                    response = await fetch(endpoint);
                }
                
                const end = Date.now();
                
                if (response.ok) {
                    const data = await response.json();
                    log(`âœ… ${type} APIå“åº”æˆåŠŸ (${end - start}ms)`, 'success');
                    log(`ğŸ“‹ æ•°æ®æ¦‚è§ˆ: ${JSON.stringify(data).slice(0, 100)}...`, 'info');
                } else {
                    log(`âš ï¸ ${type} APIå“åº”é”™è¯¯: ${response.status}`, 'warning');
                }
            } catch (error) {
                log(`âŒ ${type} APIæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆè‡ªåŠ¨æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('ğŸ“ å¼€å§‹è‡ªåŠ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...', 'info');
            checkServers();
        });

        // å…¨å±€é”™è¯¯ç›‘å¬
        window.addEventListener('error', function(e) {
            log(`âŒ é¡µé¢JavaScripté”™è¯¯: ${e.message}`, 'error');
            log(`ğŸ“ é”™è¯¯ä½ç½®: ${e.filename}:${e.lineno}`, 'error');
        });
    </script>
</body>
</html>