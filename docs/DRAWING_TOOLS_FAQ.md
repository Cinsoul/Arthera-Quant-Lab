# 绘图工具常见问题解答 - FAQ

## 📚 目录
1. [基础操作](#基础操作)
2. [工具使用](#工具使用)
3. [故障排查](#故障排查)
4. [性能优化](#性能优化)
5. [高级技巧](#高级技巧)

---

## 基础操作

### Q1: 如何激活绘图工具？
**A**: 
点击图表左侧的工具栏按钮。工具栏分为5个类别：
- **SELECTOR**: 选择工具
- **LINES**: 线条工具（趋势线、水平线、垂直线、射线）
- **SHAPES**: 形状工具（矩形）
- **TECHNICAL**: 技术分析工具（斐波那契等）
- **ANNOTATIONS**: 标注工具（箭头、文本）

点击分类后会展开子菜单，再点击具体工具即可激活。

---

### Q2: 工具激活后如何在图表上绘图？
**A**:
不同工具需要的点击次数不同：
- **1次点击**: 水平线、垂直线、文本
- **2次点击**: 趋势线、射线、箭头、矩形、斐波那契

**绘制流程**:
```
1. 点击工具按钮激活
2. 在图表上点击第一个点
3. （如果需要）移动鼠标到第二个点再次点击
4. 图形自动完成
```

**提示**: 绘制时会看到半透明的临时图形跟随鼠标移动。

---

### Q3: 如何切换回普通模式（取消绘图工具）？
**A**:
有3种方法：
1. 按 **ESC** 键（最快）
2. 点击工具栏顶部的 **SELECTOR** 按钮
3. 完成一次绘图后，某些工具（如文本）会自动切回选择模式

---

### Q4: 如何选择已绘制的图形？
**A**:
1. 确保已切换到选择工具（按 ESC 或点击 SELECTOR）
2. 用鼠标点击图形
3. 选中后会出现：
   - 🔆 蓝色发光效果
   - ⚪ 白色控制点（在端点位置）

---

### Q5: 如何移动图形？
**A**:
1. 选中图形（参见 Q4）
2. 在图形上按住鼠标左键
3. 拖动到新位置
4. 松开鼠标完成移动

**注意**: 不要拖动控制点，那会调整大小而不是移动。

---

### Q6: 如何调整图形大小？
**A**:
1. 选中图形
2. 将鼠标移动到端点的白色控制点上
3. 按住鼠标左键拖动控制点
4. 松开鼠标完成调整

**适用工具**: 趋势线、射线、箭头、矩形、斐波那契

---

### Q7: 如何删除图形？
**A**:
方法一：
```
1. 选中图形
2. 按 Delete 或 Backspace 键
```

方法二（未来版本）:
```
右键点击图形 → 选择"删除"
```

---

### Q8: 误操作了怎么办？
**A**:
使用撤销/重做功能：
- **撤销**: Ctrl+Z (Windows) 或 Cmd+Z (Mac)
- **重做**: Ctrl+Y 或 Ctrl+Shift+Z (Windows) 或 Cmd+Shift+Z (Mac)

系统最多保存 **50 步**历史记录。

---

## 工具使用

### Q9: 趋势线如何绘制才准确？
**A**:
**专业技巧**:
1. **上升趋势**: 连接两个或更多波段低点
2. **下降趋势**: 连接两个或更多波段高点
3. **验证**: 至少3个点触及趋势线，才认为有效
4. **角度**: 趋势线角度不要太陡（一般 30-60 度）

**示例**:
```
上升趋势线：
  第一点：第一个低点（如价格 100）
  第二点：第二个低点（如价格 105，时间晚于第一点）
  验证：后续是否还有低点触及此线
```

---

### Q10: 水平线的价格标签能自定义吗？
**A**:
**当前版本**: 价格标签自动显示，格式为 `价格.toFixed(2)`

**未来计划**: 
- [ ] 自定义标签文字
- [ ] 选择标签位置（左/右/两侧）
- [ ] 隐藏/显示标签

**临时方案**: 如果需要自定义文字，使用 **TEXT 工具**在水平线旁边添加文本标注。

---

### Q11: 斐波那契回撤线如何使用？
**A**:
**绘制方法**:
```
上升趋势（寻找回调买入位）:
  第一点：波段低点
  第二点：波段高点
  观察价格在哪个回调位获得支撑

下降趋势（寻找反弹卖出位）:
  第一点：波段高点
  第二点：波段低点
  观察价格在哪个回调位遇到阻力
```

**关键回调位**:
- **61.8%**: 黄金分割点，最重要的支撑/阻力位
- **50%**: 心理关口，常见的折返位置
- **38.2%**: 次要支撑/阻力位
- **23.6%**: 弱支撑，一般用于短线

**颜色含义**:
```
0%     - 灰色
23.6%  - 红色
38.2%  - 橙色
50%    - 绿色
61.8%  - 蓝色 ⭐ 最重要
78.6%  - 紫色
100%   - 灰色
```

---

### Q12: 矩形工具有什么用途？
**A**:
**常见用途**:
1. **整合区间**: 框选价格震荡区间
2. **突破确认**: 标记关键价格区域，观察突破
3. **成交量分析**: 配合成交量图，框选放量区间
4. **时间框选**: 选择特定时间段进行分析

**绘制技巧**:
- 对角线绘制（左上→右下 或 右下→左上）
- 半透明填充不会遮挡K线（opacity: 0.1）
- 边框实线清晰可见

---

### Q13: 文本标注如何添加？
**A**:
**步骤**:
```
1. 点击 ANNOTATIONS → TEXT
2. 在图表上点击要添加文本的位置
3. 在弹出的对话框中输入文字
4. 点击确定
```

**当前限制**:
- 使用浏览器原生 `prompt()` 对话框（未来会改进）
- 不支持多行文本
- 不支持富文本格式

**技巧**:
- 简洁为主（不超过20字符）
- 使用缩写（如 "R" 表示阻力位，"S" 表示支撑位）

---

### Q14: 射线和趋势线有什么区别？
**A**:
| 特性 | 趋势线 | 射线 |
|------|--------|------|
| 长度 | 有限（两点之间） | 无限（延伸到边缘） |
| 用途 | 短期趋势 | 长期趋势 |
| 视觉 | 连接两点的直线 | 从起点延伸的射线 |

**使用场景**:
- **趋势线**: 标记历史趋势，连接已知的高点/低点
- **射线**: 预测未来趋势，从当前点延伸到未来

---

## 故障排查

### Q15: 点击工具按钮没有反应
**可能原因和解决方案**:

**原因 1**: 工具已经激活
- **检查**: 工具按钮是否已是蓝色高亮状态
- **解决**: 直接在图表上绘图即可

**原因 2**: JavaScript 错误
- **检查**: 按 F12 打开控制台，查看是否有红色错误
- **解决**: 刷新页面重试，如果持续出现请联系技术支持

**原因 3**: 图表未加载完成
- **检查**: 图表上是否显示K线数据
- **解决**: 等待数据加载完成再使用绘图工具

---

### Q16: 点击图表无法绘图
**排查步骤**:

1. **确认工具已激活**
   ```
   - 查看工具按钮是否为蓝色
   - 按 Ctrl+Shift+V 打开调试面板
   - 查看 "Drawing Tool" 是否显示正确的工具名称
   ```

2. **确认点击在图表内部**
   ```
   - 不要点击在坐标轴上
   - 不要点击在工具栏上
   - 确保点击在K线显示区域
   ```

3. **检查浏览器兼容性**
   ```
   推荐浏览器：
   ✅ Chrome 90+
   ✅ Edge 90+
   ✅ Firefox 88+
   ✅ Safari 14+
   
   不支持：
   ❌ IE 11
   ❌ 旧版 Safari (< 14)
   ```

4. **查看控制台日志**
   ```
   按 F12 → Console 标签页
   启用调试: toggleChartDebug()
   再次点击图表，查看日志输出
   ```

---

### Q17: 绘制的图形位置不准确
**可能原因**:

**原因 1**: 坐标转换问题
- **症状**: 图形不在点击的位置
- **解决**: 刷新页面重试，这通常是初始化时机问题

**原因 2**: 缩放后位置错误
- **症状**: 缩放图表后图形跑偏
- **检查**: 这不应该发生（世界坐标系统）
- **解决**: 如果出现请报告 Bug，提供复现步骤

**原因 3**: 时间轴对齐问题
- **症状**: 图形在X轴方向有偏移
- **解决**: 确保点击在K线实体或影线上，而不是空白处

---

### Q18: 图形绘制后立即消失
**排查步骤**:

1. **检查是否完成绘制**
   ```
   - 趋势线需要 2 次点击
   - 不要误以为 1 次点击就完成了
   ```

2. **检查是否按了 ESC**
   ```
   - 绘制过程中按 ESC 会取消操作
   - 完成绘制前不要按 ESC
   ```

3. **查看绘图数量**
   ```
   - 按 Ctrl+Shift+V 打开调试面板
   - 查看 "Drawing Count"
   - 如果数量增加了，说明绘制成功但可能在视野外
   ```

4. **检查图形颜色**
   ```
   - 可能图形颜色与背景接近
   - 当前默认颜色: #0ea5e9 (天蓝色)
   ```

---

### Q19: 无法选中图形
**可能原因**:

**原因 1**: 未切换到选择工具
- **解决**: 按 ESC 或点击 SELECTOR

**原因 2**: 点击位置不准确
- **解决**: 
  - 趋势线：点击在线条上（不是旁边）
  - 矩形：点击在边框或内部
  - 文本：点击在文字上

**原因 3**: 图形被锁定（未来功能）
- **当前版本**: 暂不支持锁定，所有图形都可选中

---

### Q20: 撤销/重做不工作
**检查项**:

1. **快捷键是否正确**
   ```
   Windows: Ctrl+Z / Ctrl+Y
   Mac: Cmd+Z / Cmd+Y
   ```

2. **是否有历史记录**
   ```
   - 撤销：需要之前有过操作
   - 重做：需要先撤销过
   ```

3. **历史记录是否被清空**
   ```
   以下操作会清空历史：
   - 刷新页面
   - 切换股票
   - 清空所有绘图
   ```

---

## 性能优化

### Q21: 绘图很多时图表变卡顿
**性能基准**:
- **流畅**: 1-50 个绘图对象，FPS > 60
- **可接受**: 51-100 个绘图对象，FPS > 30
- **卡顿**: 100+ 个绘图对象，FPS < 30

**优化建议**:

1. **定期清理**
   ```
   - 删除不再需要的绘图对象
   - 避免同一位置重复绘制
   ```

2. **合并相似图形**
   ```
   例如：多条水平线可以用矩形代替
   ```

3. **关闭调试面板**
   ```
   - 调试面板会增加渲染开销
   - 正常使用时保持关闭状态
   ```

4. **使用简单工具**
   ```
   性能排序（快→慢）:
   ✅ 水平线、垂直线
   ✅ 趋势线、射线、箭头
   ⚠️ 矩形
   ⚠️ 斐波那契（7条线）
   ```

---

### Q22: 如何查看当前性能指标？
**A**:
按 **Ctrl+Shift+V** 打开调试面板，查看：

```
PERFORMANCE METRICS:
├── FPS: 实时帧率（理想 > 60）
├── Render Time: 每帧渲染时间（理想 < 10ms）
└── Draw Calls: 绘制调用次数

当前状态:
- Drawing Count: 绘图对象数量
- Crosshair: 十字光标状态
```

**健康指标**:
- ✅ FPS > 60, Render Time < 10ms - 优秀
- ✅ FPS > 30, Render Time < 16ms - 良好
- ⚠️ FPS 30-20 - 可接受
- ❌ FPS < 20 - 需要优化

---

### Q23: 浏览器内存占用过高
**排查步骤**:

1. **检查绘图数量**
   ```
   如果 Drawing Count > 200，考虑清理
   ```

2. **检查浏览器缓存**
   ```
   Ctrl+Shift+Delete → 清除缓存
   ```

3. **关闭其他标签页**
   ```
   每个图表都有独立的绘图引擎实例
   ```

4. **重启浏览器**
   ```
   长时间运行可能导致内存泄漏
   定期重启可改善性能
   ```

---

## 高级技巧

### Q24: 如何绘制平行通道？
**A**:
虽然没有专门的平行通道工具，但可以手动绘制：

```
方法一：两条趋势线
1. 绘制第一条趋势线（连接低点）
2. 再绘制第二条趋势线（连接高点）
3. 目测保持平行

方法二：等待未来更新
- 计划中会添加 Parallel 工具
- 自动计算平行线
```

---

### Q25: 绘图可以保存吗？
**当前版本**: ❌ 不支持持久化存储
- 绘图对象仅保存在内存中
- 刷新页面会丢失所有绘图

**未来计划**: 
- [x] 导出/导入功能（JSON 格式） - 代码已实现，UI 待开发
- [ ] LocalStorage 自动保存
- [ ] 云端同步
- [ ] 模板系统

**临时方案**:
```javascript
// 在控制台手动导出（需要访问 drawingEngineRef）
const json = drawingEngineRef.current.exportObjects();
console.log(json);
// 复制 JSON 保存到文本文件

// 导入
const json = '...'; // 粘贴之前保存的 JSON
drawingEngineRef.current.importObjects(json);
```

---

### Q26: 如何改变绘图的颜色和样式？
**当前版本**: ❌ UI 未实现

**代码层支持的样式**:
```typescript
style: {
  color: '#0ea5e9',          // 线条颜色
  lineWidth: 2,              // 线条宽度 (1-5)
  lineStyle: 'solid',        // 线条样式: solid / dash / dot
  opacity: 1,                // 透明度 (0-1)
  fillColor: '#0ea5e9',      // 填充颜色（仅矩形）
  fontSize: 14,              // 字体大小（仅文本）
}
```

**未来计划**:
- [ ] 右侧样式编辑面板
- [ ] 拾色器
- [ ] 线宽滑块
- [ ] 虚线样式选择

**临时方案**: 修改 DrawingTools.ts 中的 DEFAULT_STYLE

---

### Q27: 能否在绘图上显示价格和时间信息？
**A**:
**当前实现**:
- ✅ 水平线：自动显示价格标签
- ✅ 斐波那契：显示价格和百分比
- ❌ 其他工具：暂不显示

**未来计划**:
- [ ] 趋势线显示起点/终点价格
- [ ] 趋势线显示斜率（角度）
- [ ] 矩形显示价格区间和时间跨度
- [ ] 自定义标签位置

**临时方案**: 使用 TEXT 工具手动添加标签

---

### Q28: 如何快速切换工具？
**A**:
**当前方法**:
1. 点击工具栏（2-3次点击）
2. 按 ESC 返回选择模式

**计划中的快捷键**:
```
T - Trendline
H - Horizontal Line
V - Vertical Line
R - Rectangle
F - Fibonacci
A - Arrow
X - Text
ESC - Select
```

**注意**: 快捷键功能已在代码中预留，但需要在 UI 层实现

---

### Q29: 绘图工具支持触摸屏吗？
**A**:
**理论支持**: ✅ 
- Canvas 的 mouse 事件在触摸设备上会自动转换为 touch 事件
- 单点触摸应该可以正常工作

**实际测试**: ⚠️ 未充分测试
- 移动端适配需要进一步优化
- 可能存在控制点太小、难以点击的问题

**建议**:
- 桌面端（鼠标）：完全支持 ✅
- 平板（触摸笔）：应该可用 ⚠️
- 手机（手指）：需要优化 ❌

---

### Q30: 可以复制粘贴绘图吗？
**A**:
**当前版本**: ❌ 不支持

**未来计划**:
```
Ctrl+C - 复制选中的绘图对象
Ctrl+V - 粘贴到鼠标位置
Ctrl+D - 快速复制（复制并偏移）
```

**临时方案**: 手动重新绘制

---

## 📞 获取帮助

### 在线资源
- 📖 [完整用户指南](./DRAWING_TOOLS_GUIDE.md)
- 🧪 [快速测试指南](./DRAWING_TOOLS_QUICK_TEST.md)
- 📊 [系统状态报告](./DRAWING_TOOLS_STATUS.md)
- 🎬 [演示脚本](./DRAWING_TOOLS_DEMO_SCRIPT.md)

### 调试技巧
1. **启用调试日志**: 在控制台输入 `toggleChartDebug()`
2. **查看调试面板**: 按 `Ctrl+Shift+V`
3. **检查控制台**: 按 `F12` 查看错误信息

### 报告问题
如果遇到无法解决的问题，请提供：
- 浏览器版本
- 操作系统
- 复现步骤
- 控制台错误截图
- 调试面板截图

---

## 🔄 常见需求实现状态

| 功能 | 状态 | 预计时间 |
|------|------|----------|
| 样式自定义 UI | 📋 计划中 | 2周 |
| 绘图列表管理 | 📋 计划中 | 2周 |
| 本地存储 | 📋 计划中 | 1周 |
| 快捷键 | 📋 计划中 | 1周 |
| 复制粘贴 | 📋 计划中 | 2周 |
| 更多工具 | 📋 计划中 | 1月 |
| 移动端优化 | 📋 计划中 | 1月 |
| 云端同步 | 💭 考虑中 | TBD |

---

**FAQ 版本**: v1.0
**最后更新**: 2024-12-10
**维护者**: 技术团队

**有其他问题？**
欢迎提交 Issue 或联系技术支持！
