<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtheraÈáèÂåñ‰∫§ÊòìÁ≥ªÁªü - ‰∏ì‰∏öÊäïËµÑÂπ≥Âè∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
    <!-- Â§ñÈÉ®‰æùËµñ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <!-- ‰ΩøÁî® Tailwind CDN Áî®‰∫éÊºîÁ§∫ÁõÆÁöÑ - Áîü‰∫ßÁéØÂ¢ÉÂª∫ËÆÆ‰ΩøÁî® PostCSS Êèí‰ª∂ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <style>
        :root {
            /* Bloomberg-inspired color palette */
            --primary-color: #000000;
            --secondary-color: #1a1a1a;
            --accent-color: #333333;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --bg-primary: #000000;
            --bg-secondary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #333333;
            --hover-color: #2a2a2a;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .professional-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-card-pro {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .chart-container-pro {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            height: 500px;
            min-height: 500px;
            max-height: 500px;
            position: relative;
            overflow: visible;
            padding: 20px;
        }
        
        .chart-container-pro canvas {
            width: 100% !important;
            height: 460px !important;
            max-height: 460px !important;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .number-counter {
            font-variant-numeric: tabular-nums;
            line-height: 1.2;
            word-break: break-word;
            overflow-wrap: anywhere;
        }
        
        /* ‰øÆÂ§çÊåâÈíÆÊñáÂ≠óÊ∫¢Âá∫ */
        .action-button {
            font-family: monospace;
            font-size: 0.75rem;
            padding: 6px 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            max-width: 100%;
        }
        
        /* ‰øÆÂ§çËèúÂçïÈ°πÊñáÂ≠óÊ∫¢Âá∫ */
        .menu-item {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 8px 12px;
            font-size: 0.75rem;
        }
        
        /* ËÇ°Á•®ÊêúÁ¥¢ÁªìÊûúÂ±ïÁ§∫ - ‰øÆÂ§çÊñáÂ≠óÊ∫¢Âá∫ */
        .stock-search-result {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
            font-family: monospace;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
            min-width: 0;
        }
        
        /* ÊêúÁ¥¢‰∏ãÊãâÊ°ÜÊ†∑Âºè‰ºòÂåñ */
        #search-dropdown {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border-color: var(--border-color) !important;
            background: var(--bg-primary) !important;
            max-height: 200px !important;
            z-index: 1000 !important;
        }
        
        #search-dropdown {
            position: absolute !important;
            top: 100% !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 9999 !important;
            background-color: black !important;
            border: 1px solid white !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5) !important;
        }
        
        #search-dropdown:not(.hidden) {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #search-dropdown.hidden {
            display: none !important;
        }
        
        .stock-result-symbol {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-primary);
        }
        
        .stock-result-name {
            color: var(--text-secondary);
            font-size: 0.65rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.2;
        }
        
        .stock-result-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.6rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
            gap: 4px;
        }
        
        /* ‰ºòÂåñÁªüËÆ°Âç°ÁâáÂ∏ÉÂ±Ä - Áªü‰∏ÄBloombergÈ£éÊ†º */
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            min-height: 140px;
            padding: 16px;
            font-family: monospace;
        }
        
        .stat-value {
            font-size: 1.1rem;
            line-height: 1.4;
            max-width: 100%;
            font-family: monospace;
            color: var(--text-primary);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .stat-label {
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        /* Á≠ñÁï•ÊÄßËÉΩÂç°Áâá‰ºòÂåñ */
        .strategy-performance-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .strategy-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .strategy-return {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .strategy-return.positive { color: #10b981; }
        .strategy-return.negative { color: #ef4444; }
        
        .strategy-status {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .strategy-metrics {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .strategy-progress {
            height: 3px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .strategy-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .strategy-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 16px;
            border-radius: 4px;
        }
        
        .signal-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px;
            margin-bottom: 4px;
            font-family: monospace;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .signal-item:hover {
            background: var(--hover-color);
        }
        
        .chart-container {
            position: relative;
            height: 450px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active { background-color: var(--success-color); }
        .status-inactive { background-color: var(--danger-color); }
        .status-warning { background-color: var(--warning-color); }
        
        .performance-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background-color: #e5e7eb;
        }
        
        .performance-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-button {
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .tab-button.active {
            background-color: #3b82f6 !important;
            color: white !important;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
            transform: translateY(-1px);
        }
        
        .tab-button:not(.active) {
            background-color: #e5e7eb !important;
            color: #374151 !important;
        }
        
        /* ÁßªÂä®Á´ØÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 768px) {
            .tab-button {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .chart-container-pro {
                min-height: 300px;
                padding: 16px;
            }
            
            .chart-container-pro canvas {
                max-height: 250px;
            }
        }
    </style>
</head>

<body class="bg-black min-h-screen">
    <!-- Bloomberg Terminal Style Header -->
    <nav class="bg-black border-b border-white sticky top-0 z-50">
        <div class="container mx-auto px-6 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <h1 class="text-lg font-mono text-white tracking-wide" data-i18n="title">ARTHERA QUANTITATIVE TRADING SYSTEM</h1>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-white rounded-full pulse-dot"></div>
                            <span class="text-xs font-mono text-white" data-i18n="real-time-connection">LIVE</span>
                        </div>
                        <div class="flex items-center space-x-2" id="data-source-indicator">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            <span class="text-xs font-mono text-white" data-i18n="data-source">DATA</span>
                        </div>
                        <div class="text-xs font-mono text-white" id="current-time"></div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Language Switcher -->
                    <button onclick="window.switchLanguage(window.currentLanguage === 'zh' ? 'en' : 'zh')" 
                            class="language-toggle px-2 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                        EN
                    </button>
                    
                    <div class="text-right">
                        <div class="text-xs font-mono text-white" data-i18n="professional-version">PROFESSIONAL</div>
                        <div class="text-xs font-mono text-gray-400" data-i18n="terminal-mode">TERMINAL</div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button id="refresh-btn" class="px-3 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="refresh">REFRESH</span>
                        </button>
                        <button id="settings-btn" class="px-3 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="settings">CONFIG</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="container mx-auto px-6 py-8">
        <!-- Ê†∏ÂøÉÊåáÊ†á‰ª™Ë°®Êùø -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-8">
            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="total-volume">VOLUME</span>
                        <span class="text-xs font-mono text-white opacity-70">[$]</span>
                    </div>
                    <div class="stat-value font-mono text-white number-counter mb-1" id="total-volume">$27,178,810</div>
                    <div class="text-xs font-mono text-white opacity-70" id="volume-change">+12.5%</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="active-strategies">STRATEGIES</span>
                        <span class="text-xs font-mono text-white opacity-70">[#]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="active-strategies">4</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="running-status">RUNNING</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="ai-signals">AI SIGNALS</span>
                        <span class="text-xs font-mono text-white opacity-70">[AI]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="signals-today" data-signal-count="true">127</div>
                    <div class="text-xs font-mono text-white opacity-70" id="signal-strength" data-i18n="ai-powered">AI POWERED</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="success-rate">SUCCESS</span>
                        <span class="text-xs font-mono text-white opacity-70">[%]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="success-rate">94.2%</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="professional-grade">PROFESSIONAL</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="total-capital">CAPITAL</span>
                        <span class="text-xs font-mono text-white opacity-70">[$]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="total-capital">$100,000</div>
                    <div class="text-xs font-mono text-white opacity-70" id="capital-change" data-i18n="available-funds">AVAILABLE</div>
                </div>
            </div>
            
            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="var-95">VaR 95%</span>
                        <span class="text-xs font-mono text-white opacity-70">[%]</span>
                    </div>
                    <div class="text-2xl font-mono text-red-400 number-counter mb-1" id="var-95">-2.1%</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="value-at-risk">VALUE AT RISK</div>
                </div>
            </div>
        </div>

        <!-- ‰∏ì‰∏öÈáèÂåñÊåáÊ†á‰ª™Ë°®Êùø -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Áª©ÊïàÊåáÊ†á -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="performance-metrics">Áª©ÊïàÊåáÊ†á</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="sharpe-ratio">Â§èÊôÆÊØîÁéá</span>
                        <span class="text-lg font-mono text-white">1.85</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">SortinoÊØîÁéá</span>
                        <span class="text-lg font-mono text-white">2.12</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="info-ratio">‰ø°ÊÅØÊØîÁéá</span>
                        <span class="text-lg font-mono text-white">0.58</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">TreynorÊØîÁéá</span>
                        <span class="text-lg font-mono text-white">13.2</span>
                    </div>
                </div>
            </div>

            <!-- È£éÈô©ÊéßÂà∂ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="risk-control">È£éÈô©ÊéßÂà∂</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="max-drawdown">ÊúÄÂ§ßÂõûÊí§</span>
                        <span class="text-lg font-mono text-red-400">-3.2%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">VaR 95%</span>
                        <span class="text-lg font-mono text-red-400">-2.1%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">BetaÁ≥ªÊï∞</span>
                        <span class="text-lg font-mono text-white">0.85</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">Alpha</span>
                        <span class="text-lg font-mono text-green-400">+1.8%</span>
                    </div>
                </div>
            </div>

            <!-- ÂÆûÊó∂Êï∞ÊçÆ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="realtime-data">ÂÆûÊó∂Êï∞ÊçÆ</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="market-correlation">Â∏ÇÂú∫Áõ∏ÂÖ≥ÊÄß</span>
                        <span class="text-lg font-mono text-white">0.72</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="volatility">Ê≥¢Âä®Áéá</span>
                        <span class="text-lg font-mono text-white">15.3%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="tracking-error">Ë∑üË∏™ËØØÂ∑Æ</span>
                        <span class="text-lg font-mono text-white">2.1%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="online-time">Âú®Á∫øÊó∂Èó¥</span>
                        <span class="text-lg font-mono text-green-400">99.8%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIÁ≠ñÁï•Ë°®Áé∞ -->
        <div class="bg-black border border-white p-6 mb-8">
            <div class="border-b border-white pb-3 mb-4 flex items-center">
                <h3 class="text-sm font-mono text-white" data-i18n="ai-strategy-performance">AIÁ≠ñÁï•Ë°®Áé∞</h3>
            </div>
            <div id="strategy-performance" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- DeepSeek Alpha Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name">DeepSeek Alpha</div>
                    <div class="strategy-return negative">-1.34%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè Â∑≤ÂÅúÊ≠¢</div>
                    <div class="strategy-status">Êó•Êî∂Áõä</div>
                    <div class="strategy-metrics">
                        <div><span>1.3</span><br><span class="text-gray-400">Â§èÊôÆ</span></div>
                        <div><span>15</span><br><span class="text-gray-400">ÊåÅ‰ªì</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 25%;"></div></div>
                </div>
                
                <!-- Bayesian Momentum Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name">Bayesian Momentum</div>
                    <div class="strategy-return positive">2.26%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè Â∑≤ÂÅúÊ≠¢</div>
                    <div class="strategy-status">Êó•Êî∂Áõä</div>
                    <div class="strategy-metrics">
                        <div><span>1.59</span><br><span class="text-gray-400">Â§èÊôÆ</span></div>
                        <div><span>6</span><br><span class="text-gray-400">ÊåÅ‰ªì</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 45%;"></div></div>
                </div>
                
                <!-- Kelly Portfolio Optimizer Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name">Kelly Portfolio<br>Optimizer</div>
                    <div class="strategy-return positive">2.08%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè Â∑≤ÂÅúÊ≠¢</div>
                    <div class="strategy-status">Êó•Êî∂Áõä</div>
                    <div class="strategy-metrics">
                        <div><span>2.14</span><br><span class="text-gray-400">Â§èÊôÆ</span></div>
                        <div><span>14</span><br><span class="text-gray-400">ÊåÅ‰ªì</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 60%;"></div></div>
                </div>
                
                <!-- Risk Parity Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name">Risk Parity</div>
                    <div class="strategy-return positive">0.66%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè Â∑≤ÂÅúÊ≠¢</div>
                    <div class="strategy-status">Êó•Êî∂Áõä</div>
                    <div class="strategy-metrics">
                        <div><span>1.31</span><br><span class="text-gray-400">Â§èÊôÆ</span></div>
                        <div><span>22</span><br><span class="text-gray-400">ÊåÅ‰ªì</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 30%;"></div></div>
                </div>
            </div>
        </div>

        <!-- ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞ -->
        <div class="bg-black border border-white p-6 mb-8">
            <div class="border-b border-white pb-3 mb-4 flex items-center">
                <h3 class="text-sm font-mono text-white" data-i18n="global-market-indices">ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">NASDAQ</div>
                    <div class="text-lg font-mono text-green-400">+1.2%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">S&P500</div>
                    <div class="text-lg font-mono text-green-400">+0.8%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">DOW</div>
                    <div class="text-lg font-mono text-red-400">-0.3%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">‰∏äËØÅÊåáÊï∞</div>
                    <div class="text-lg font-mono text-green-400">+0.5%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">Ê∑±ËØÅÊàêÊåá</div>
                    <div class="text-lg font-mono text-green-400">+0.7%</div>
                </div>
                <div class="text-center">
                    <div class="text-xs font-mono text-white opacity-70">Âàõ‰∏öÊùøÊåá</div>
                    <div class="text-lg font-mono text-red-400">-0.2%</div>
                </div>
            </div>
        </div>

        <!-- ‰∫§Êòì‰ø°Âè∑ÂíåËÆ¢ÂçïÁä∂ÊÄÅ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <h3 class="text-sm font-mono text-white" data-i18n="latest-trading-signals">ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑</h3>
                    </div>
                    <div class="bg-black border border-white px-3 py-1">
                        <span class="text-xs font-mono text-green-400" data-i18n="zero-signals">0‰∏™‰ø°Âè∑</span>
                    </div>
                </div>
                <div class="flex flex-col items-center justify-center h-32">
                    <div class="text-xs font-mono text-white opacity-70 text-center" data-i18n="click-generate-signals">
                        ÁÇπÂáª"ÁîüÊàêAI‰∫§Êòì‰ø°Âè∑"ÂºÄÂßãÂàÜÊûê...
                    </div>
                </div>
            </div>

            <!-- ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <h3 class="text-sm font-mono text-white" data-i18n="latest-orders">ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï</h3>
                    </div>
                    <div class="bg-black border border-white px-3 py-1">
                        <span class="text-xs font-mono text-blue-400" data-i18n="zero-orders">0‰∏™ËÆ¢Âçï</span>
                    </div>
                </div>
                <div class="flex flex-col items-center justify-center h-32">
                    <div class="text-xs font-mono text-white opacity-70 text-center" data-i18n="click-execute-orders">
                        ÁÇπÂáª"ÊâßË°åÊ®°ÊãüËÆ¢Âçï"ÂºÄÂßã‰∫§Êòì...
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- STRATEGY CONTROL PANEL -->
            <div class="lg:col-span-1">
                <div class="bg-black border border-white p-4 mb-4">
                    <h2 class="text-sm font-mono text-white mb-4 border-b border-white pb-2" data-i18n="strategy-control-center">
                        STRATEGY CONTROL CENTER
                    </h2>
                    
                    <!-- CAPITAL MANAGEMENT -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="capital-management-title">
                            CAPITAL MANAGEMENT
                        </h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-mono text-white mb-1" data-i18n="initial-capital-label">INITIAL CAPITAL (USD)</label>
                                <div class="flex space-x-1">
                                    <input type="number" id="initial-capital" 
                                           placeholder="100000" data-i18n-placeholder="initial-capital-placeholder"
                                           value="100000"
                                           min="1000"
                                           max="10000000"
                                           class="flex-1 p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                    <button onclick="setCapital()" 
                                            class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="set-button">
                                        SET
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs font-mono text-white">
                                <div><span data-i18n="used-label">USED:</span> <span id="used-capital">$0</span></div>
                                <div><span data-i18n="available-label">AVAILABLE:</span> <span id="available-capital">$0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- DATA SOURCE CONFIG -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="data-source-config-title">
                            DATA SOURCE CONFIG
                        </h4>
                        <div class="space-y-3">
                            <form id="tushare-config-form">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-1" data-i18n="tushare-token-label">TUSHARE TOKEN</label>
                                    <div class="flex space-x-1">
                                        <input type="password" id="tushare-token-main" 
                                               placeholder="ENTER TOKEN FOR PROFESSIONAL DATA" data-i18n-placeholder="tushare-placeholder"
                                               autocomplete="new-password"
                                               class="flex-1 p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <button type="button" onclick="configureTushare()" 
                                                class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="config-button">
                                            CONFIG
                                        </button>
                                        <button type="button" onclick="testRealStockData()" 
                                                class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="test-button">
                                            TEST
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <div id="config-status" data-config-status="true" class="text-xs font-mono text-white"></div>
                        </div>
                    </div>

                    <!-- STRATEGY PARAMETERS -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="strategy-parameters-title">
                            STRATEGY PARAMETERS
                        </h4>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="risk-level">RISK LEVEL</label>
                                    <select id="risk-level" class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="conservative" data-i18n="conservative">CONSERVATIVE</option>
                                        <option value="moderate" selected data-i18n="balanced">BALANCED</option>
                                        <option value="aggressive" data-i18n="aggressive">AGGRESSIVE</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="max-position">MAX POSITION</label>
                                    <input type="number" id="max-position" value="10000" min="1000" max="50000" 
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="stop-loss">STOP LOSS (%)</label>
                                    <input type="number" id="stop-loss" value="5" min="1" max="20" step="0.5"
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="take-profit">TAKE PROFIT (%)</label>
                                    <input type="number" id="take-profit" value="15" min="5" max="50" step="0.5"
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MARKET SELECTION -->
                    <div class="mb-4">
                        <label class="block text-xs font-mono text-white mb-2" data-i18n="target-market">TARGET MARKET</label>
                        <select id="market-select" class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black">
                            <option value="mixed" data-i18n="global-mixed">GLOBAL MIXED</option>
                            <option value="US" data-i18n="us-stocks">US STOCKS</option>
                            <option value="CN" data-i18n="china-a-shares">CHINA A-SHARES</option>
                        </select>
                    </div>

                    <!-- STOCK POOL CONFIG -->
                    <div class="mb-4">
                        <label class="block text-xs font-mono text-white mb-2" data-i18n="target-stock-pool">TARGET STOCK POOL</label>
                        
                        <!-- ËÇ°Á•®ÊêúÁ¥¢Ê°Ü -->
                        <div class="relative mb-2">
                            <input type="text" id="stock-search" 
                                   class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black" 
                                   placeholder="SEARCH STOCKS: TYPE NAME/SYMBOL" data-i18n-placeholder="search-placeholder"
                                   autocomplete="off">
                            <div id="search-dropdown" class="absolute w-full bg-black border border-white mt-1 max-h-48 overflow-y-auto hidden z-[100] left-0 top-full shadow-lg">
                                <!-- ÊêúÁ¥¢ÁªìÊûúÂä®ÊÄÅÂ°´ÂÖÖ -->
                            </div>
                        </div>
                        
                        <!-- ÊêúÁ¥¢ÊèêÁ§∫ÂíåÁä∂ÊÄÅ -->
                        <div class="mb-2 flex justify-between items-center">
                            <div class="text-xs font-mono text-gray-400" data-i18n="search-hint">
                                TRY: AAPL, TESLA, MICROSOFT, ËåÖÂè∞
                            </div>
                            <div id="search-status" class="text-xs font-mono text-green-400 hidden" data-i18n="search-status-ready">
                                API READY
                            </div>
                        </div>
                        
                        
                        <!-- È´òÁ∫ßÁ≠õÈÄâÂô® -->
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <select id="market-filter" class="bg-black text-white border border-white p-1 text-xs font-mono">
                                <option value="" data-i18n="all-markets">ALL MARKETS</option>
                                <option value="US" data-i18n="us-stocks">US STOCKS</option>
                                <option value="CN" data-i18n="china-a-shares-short">A-SHARES</option>
                                <option value="HK" data-i18n="hk-stocks">HK STOCKS</option>
                                <option value="JP" data-i18n="jp-stocks">JP STOCKS</option>
                            </select>
                            <select id="cap-filter" class="bg-black text-white border border-white p-1 text-xs font-mono">
                                <option value="" data-i18n="all-caps">ALL CAPS</option>
                                <option value="Large" data-i18n="large-cap">LARGE CAP</option>
                                <option value="Mid" data-i18n="mid-cap">MID CAP</option>
                                <option value="Small" data-i18n="small-cap">SMALL CAP</option>
                            </select>
                        </div>
                        
                        <!-- Ë°å‰∏öÂø´ÈÄüÁ≠õÈÄâ -->
                        <div class="grid grid-cols-4 gap-1 mb-2">
                            <button onclick="quickSectorFilter('tech')" class="bg-black text-white border border-white px-1 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="tech-sector">TECH</button>
                            <button onclick="quickSectorFilter('finance')" class="bg-black text-white border border-white px-1 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="finance-sector">FIN</button>
                            <button onclick="quickSectorFilter('healthcare')" class="bg-black text-white border border-white px-1 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="healthcare-sector">MED</button>
                            <button onclick="quickSectorFilter('energy')" class="bg-black text-white border border-white px-1 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="energy-sector">ENE</button>
                        </div>
                        
                        <!-- Â∑≤ÈÄâËÇ°Á•®ÊòæÁ§∫ -->
                        <div id="selected-stocks" class="mb-2 min-h-[40px] border border-white p-2 bg-black">
                            <div id="stock-chips" class="flex flex-wrap gap-1">
                                <!-- ËÇ°Á•®Ê†áÁ≠æÂä®ÊÄÅÊòæÁ§∫ -->
                            </div>
                        </div>
                        
                        <textarea id="target-symbols" 
                                  class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black" 
                                  rows="3" 
                                  placeholder="AAPL,TSLA,NVDA,600519.SS,000858.SZ">AAPL,TSLA,NVDA,600519.SS,000858.SZ</textarea>
                        
                        <!-- Êô∫ËÉΩÊé®ËçêÂå∫Âüü -->
                        <div class="mt-2">
                            <div class="text-xs font-mono text-white mb-1" data-i18n="ai-recommendations">AI RECOMMENDATIONS:</div>
                            <div id="ai-recommendations" class="flex flex-wrap gap-1 mb-2">
                                <!-- AIÊé®ËçêËÇ°Á•® -->
                            </div>
                        </div>
                        
                        <div class="text-xs font-mono text-white mt-1">
                            <span data-i18n='ai-supports-text'>SUPPORTS US STOCKS (AAPL) AND CHINA A-SHARES (600519.SS)</span>
                        </div>
                        
                        <!-- ËÇ°Á•®Ê±†ÁªüËÆ° -->
                        <div id="pool-stats" class="text-xs font-mono text-white mt-2 grid grid-cols-3 gap-2">
                            <div><span data-i18n="pool-total">TOTAL:</span> <span id="total-count">5</span></div>
                            <div><span data-i18n="pool-us">US:</span> <span id="us-count">3</span></div>
                            <div><span data-i18n="pool-cn">CN:</span> <span id="cn-count">2</span></div>
                        </div>
                    </div>

                    <!-- TRADING OPERATIONS -->
                    <div class="space-y-2">
                        <button onclick="generateSignals()" 
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span id="signal-btn-text" data-i18n="generate-ai-signals">GENERATE AI SIGNALS</span>
                            <div id="signal-loading" class="loading-spinner ml-2 hidden"></div>
                        </button>
                        
                        <button onclick="startAutoTrading()" 
                                id="auto-trading-btn"
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span id="auto-trading-text" data-i18n="start-auto-trading">START AUTO TRADING</span>
                        </button>
                        
                        <button onclick="executeOrder()" 
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span data-i18n="execute-simulation-order">EXECUTE SIMULATION ORDER</span>
                        </button>
                        
                        <div class="grid grid-cols-2 gap-1">
                            <button onclick="refreshAllData()" 
                                    class="bg-black text-white border border-white p-2 text-xs font-mono hover:bg-white hover:text-black transition flex items-center justify-center" data-i18n="refresh">
                                REFRESH
                            </button>
                            <button onclick="resetStrategy()" 
                                    class="bg-black text-white border border-white p-2 text-xs font-mono hover:bg-white hover:text-black transition flex items-center justify-center" data-i18n="reset-button">
                                RESET
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂõæË°®ÂíåÊï∞ÊçÆÂ±ïÁ§∫Âå∫Âüü -->
            <div class="lg:col-span-2 min-h-[600px]">
                <!-- Bloomberg Terminal Chart Section -->
                <div class="bg-black border border-white mb-6">
                    <div class="border-b border-white bg-black">
                        <nav class="flex justify-between items-center px-6 py-3">
                            <div class="flex flex-wrap gap-2 overflow-x-auto">
                                <button class="tab-button active px-3 py-2 bg-white text-black font-mono text-xs transition-all" onclick="switchTab('volume', event)" data-i18n="volume-tab">
                                    VOLUME
                                </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('performance', event)" data-i18n="performance-tab">
                                PERFORMANCE
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('risk', event)" data-i18n="risk-tab">
                                RISK
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('correlation', event)" data-i18n="correlation-tab">
                                CORRELATION
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('signals', event)" data-i18n="technical-tab">
                                TECHNICAL
                            </button>
                            </div>
                            <button onclick="refreshChartsData()" class="px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all">
                                REFRESH
                            </button>
                        </nav>
                    </div>
                    
                    <div class="p-6 min-h-[500px]">
                        <!-- Volume Chart -->
                        <div id="volume-tab" class="tab-content active">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        REAL-TIME VOLUME DATA
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        LIVE UPDATE
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="volume-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Strategy Performance Chart -->
                        <div id="performance-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        STRATEGY PERFORMANCE COMPARISON
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        RETURN %
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="performance-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Risk Analysis Chart -->
                        <div id="risk-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        RISK INDICATORS RADAR
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        MULTI-DIMENSIONAL
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="risk-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Correlation Analysis -->
                        <div id="correlation-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        ASSET CORRELATION MATRIX
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        CORRELATION ANALYSIS
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="correlation-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Technical Analysis Charts -->
                        <div id="signals-tab" class="tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-black border border-white p-4">
                                    <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                        <h4 class="text-sm font-mono text-white">
                                            TECHNICAL INDICATORS
                                        </h4>
                                        <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                            RSI/MACD
                                        </div>
                                    </div>
                                    <div style="height: 250px; position: relative;">
                                        <canvas id="technical-chart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-black border border-white p-4">
                                    <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                        <h4 class="text-sm font-mono text-white">
                                            SIGNAL STRENGTH
                                        </h4>
                                        <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                            BUY/SELL SIGNALS
                                        </div>
                                    </div>
                                    <div style="height: 250px; position: relative;">
                                        <canvas id="signals-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- Áä∂ÊÄÅÊèêÁ§∫Toast -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- BloombergÈ£éÊ†ºËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-black border border-white max-w-4xl w-full h-[90vh] overflow-hidden">
                <!-- Header -->
                <div class="bg-black border-b border-white p-4 flex justify-between items-center">
                    <div class="flex items-center">
                        <h3 class="text-lg font-mono text-white tracking-wider" data-i18n="settings">SETTINGS</h3>
                        <button onclick="switchLanguage(currentLanguage === 'zh' ? 'en' : 'zh')" class="language-toggle ml-6 px-3 py-1 border border-white text-white text-xs font-mono hover:bg-white hover:text-black transition-colors">
                            EN
                        </button>
                    </div>
                    <button onclick="closeSettings()" class="text-white hover:bg-white hover:text-black px-2 py-1 transition-colors">
                        ‚úï
                    </button>
                </div>
                
                <!-- Navigation -->
                <div class="bg-black border-b border-white">
                    <nav class="flex">
                        <button onclick="switchSettingsTab('general')" id="tab-general" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors bg-white text-black">
                            <span data-i18n="basic-settings">BASIC</span>
                        </button>
                        <button onclick="switchSettingsTab('ai')" id="tab-ai" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="ai-configuration">AI CONFIG</span>
                        </button>
                        <button onclick="switchSettingsTab('trading')" id="tab-trading" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="tushare-config">DATA SOURCE</span>
                        </button>
                        <button onclick="switchSettingsTab('backtest')" id="tab-backtest" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            BACKTEST
                        </button>
                        <button onclick="switchSettingsTab('indicators')" id="tab-indicators" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white hover:bg-white hover:text-black transition-colors">
                            INDICATORS
                        </button>
                    </nav>
                </div>
                
                <!-- Content Area -->
                <div class="p-6 overflow-y-auto h-full bg-black text-white">

                    <!-- Basic Settings Tab -->
                    <div id="settings-general" class="settings-tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- System Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="system-config">SYSTEM CONFIGURATION</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2">REFRESH INTERVAL</label>
                                        <select id="refresh-interval" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="5">5 SEC</option>
                                            <option value="10">10 SEC</option>
                                            <option value="30" selected>30 SEC</option>
                                            <option value="60">60 SEC</option>
                                        </select>
                                    </div>
                                    
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono">AUTO REFRESH</span>
                                            <input type="checkbox" id="auto-refresh" checked class="bg-black border-white">
                                        </label>
                                        
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono">SOUND ALERTS</span>
                                            <input type="checkbox" id="sound-alerts" class="bg-black border-white">
                                        </label>
                                        
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono">NOTIFICATIONS</span>
                                            <input type="checkbox" id="notifications" class="bg-black border-white">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Display Settings -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">DISPLAY SETTINGS</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2">LANGUAGE / ËØ≠Ë®Ä</label>
                                        <select id="language-select" onchange="switchLanguage(this.value)" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="zh">‰∏≠Êñá (Chinese)</option>
                                            <option value="en">English</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2">TIME FORMAT</label>
                                        <select id="time-format" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="24h">24H FORMAT</option>
                                            <option value="12h">12H FORMAT</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2">DECIMAL PLACES</label>
                                        <select id="decimal-places" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="2">2 PLACES</option>
                                            <option value="3">3 PLACES</option>
                                            <option value="4">4 PLACES</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Configuration Tab -->
                    <div id="settings-ai" class="settings-tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- DeepSeek API Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">DEEPSEEK API CONFIGURATION</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="api-key">API KEY</label>
                                        <div class="relative">
                                            <input 
                                                type="password" 
                                                id="deepseek-api-key" 
                                                data-i18n-placeholder="api-key-placeholder"
                                                placeholder="Enter DeepSeek API Key"
                                                autocomplete="new-password"
                                                class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <button type="button" onclick="toggleApiKeyVisibility()" class="absolute right-2 top-2 text-white hover:text-gray-300">
                                                <span id="api-key-toggle-icon" class="text-xs">SHOW</span>
                                            </button>
                                        </div>
                                        <div class="flex justify-between mt-2">
                                            <p class="text-xs text-gray-400">ENCRYPTED LOCAL STORAGE</p>
                                            <button type="button" onclick="testApiKey()" class="text-xs text-white hover:bg-white hover:text-black px-2 py-1 border border-white" data-i18n="test-connection">
                                                TEST CONNECTION
                                            </button>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="model-selection">MODEL</label>
                                            <select id="deepseek-model" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="deepseek-chat" data-i18n="deepseek-chat">DeepSeek Chat</option>
                                                <option value="deepseek-coder" data-i18n="deepseek-coder">DeepSeek Coder</option>
                                                <option value="deepseek-v2.5" selected data-i18n="deepseek-v25">DeepSeek V2.5 (Recommended)</option>
                                                <option value="deepseek-v3" data-i18n="deepseek-v3">DeepSeek V3 (Latest)</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="temperature">TEMPERATURE</label>
                                            <select id="deepseek-temperature" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="0.1" data-i18n="temp-conservative">0.1 CONSERVATIVE</option>
                                                <option value="0.3" selected data-i18n="temp-balanced">0.3 BALANCED</option>
                                                <option value="0.5" data-i18n="temp-moderate">0.5 MODERATE</option>
                                                <option value="0.7" data-i18n="temp-aggressive">0.7 AGGRESSIVE</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="flex items-center justify-between py-2 border border-white hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono">ENABLE AI SIGNALS</span>
                                            <input type="checkbox" id="ai-signals-enabled" checked class="bg-black border-white">
                                        </label>
                                    </div>

                                    <div class="mt-4">
                                        <button onclick="saveAiConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors" data-i18n="save-config">
                                            SAVE CONFIGURATION
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- API Status -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="api-status">API STATUS</div>
                                
                                <div id="api-status-display" class="space-y-2">
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono">CONNECTION</span>
                                        <span id="connection-status" class="text-xs font-mono" data-i18n="not-configured">NOT CONFIGURED</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono">MODEL</span>
                                        <span id="current-model" class="text-xs font-mono">NONE</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono">SIGNALS TODAY</span>
                                        <span id="signals-today-mini" data-signal-count="true" class="text-xs font-mono">0</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2">
                                        <span class="text-xs font-mono">SUCCESS RATE</span>
                                        <span id="ai-success-rate" class="text-xs font-mono">0%</span>
                                    </div>
                                </div>
                                
                                <!-- API Usage Info -->
                                <div class="border border-white mt-4 p-3">
                                    <div class="text-xs font-mono text-white mb-2">API INFORMATION</div>
                                    <div class="text-xs text-gray-300 space-y-1">
                                        <p>‚Ä¢ GET API KEY: platform.deepseek.com</p>
                                        <p>‚Ä¢ LOWER TEMPERATURE = MORE CONSERVATIVE</p>
                                        <p>‚Ä¢ TEST CONNECTION BEFORE TRADING</p>
                                        <p>‚Ä¢ API CALLS ARE RATE LIMITED</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Source Configuration Tab -->
                    <div id="settings-trading" class="settings-tab-content hidden">
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">DATA SOURCE CONFIGURATION</div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">TUSHARE TOKEN (PROFESSIONAL DATA)</label>
                                    <input 
                                        type="password" 
                                        id="tushare-token-modal" 
                                        placeholder="Enter Tushare Professional Token"
                                        class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black mb-2">
                                    
                                    <button onclick="saveTushareConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        SAVE DATA SOURCE CONFIG
                                    </button>
                                    
                                    <div id="config-status-modal" data-config-status="true" class="mt-4 text-xs font-mono"></div>
                                </div>
                                
                                <div>
                                    <div class="text-xs font-mono text-white mb-2">DATA SOURCE STATUS</div>
                                    <div class="border border-white p-3 space-y-2">
                                        <div class="flex justify-between">
                                            <span>YAHOO FINANCE</span>
                                            <span class="text-green-400">ACTIVE</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>AKSHARE</span>
                                            <span class="text-green-400">ACTIVE</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>TUSHARE PRO</span>
                                            <span id="tushare-status" class="text-gray-400">NOT CONFIGURED</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backtest Tab -->
                    <div id="settings-backtest" class="settings-tab-content hidden">
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">STRATEGY BACKTESTING</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">STRATEGY</label>
                                    <select id="backtest-strategy" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="momentum">MOMENTUM</option>
                                        <option value="mean_reversion">MEAN REVERSION</option>
                                        <option value="breakout">BREAKOUT</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">INITIAL CAPITAL</label>
                                    <input type="number" id="backtest-capital" value="100000" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">SYMBOLS</label>
                                    <input type="text" id="backtest-symbols" value="AAPL,MSFT,GOOGL" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">PERIOD</label>
                                    <select id="backtest-period" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="3m">3 MONTHS</option>
                                        <option value="6m" selected>6 MONTHS</option>
                                        <option value="1y">1 YEAR</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-end">
                                    <button onclick="runBacktest()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        RUN BACKTEST
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Backtest Results -->
                            <div id="backtest-results" class="mt-6 border border-white p-4 hidden">
                                <div class="text-xs font-mono text-white mb-2 border-b border-white pb-2">BACKTEST RESULTS</div>
                                <div id="backtest-output" class="text-xs font-mono text-green-400"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Indicators Tab -->
                    <div id="settings-indicators" class="settings-tab-content hidden">
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">TECHNICAL INDICATORS</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">INDICATOR</label>
                                    <select id="indicator-type" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="sma">SMA (Simple Moving Average)</option>
                                        <option value="ema">EMA (Exponential Moving Average)</option>
                                        <option value="rsi">RSI (Relative Strength Index)</option>
                                        <option value="bollinger">BOLLINGER BANDS</option>
                                        <option value="macd">MACD</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">SYMBOL</label>
                                    <input type="text" id="indicator-symbol" value="AAPL" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">PERIOD</label>
                                    <input type="number" id="indicator-period" value="20" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">DATA POINTS</label>
                                    <input type="number" id="indicator-points" value="100" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div class="flex items-end">
                                    <button onclick="calculateIndicators()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        CALCULATE
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Indicator Results -->
                            <div id="indicator-results" class="mt-6 border border-white p-4 hidden">
                                <div class="text-xs font-mono text-white mb-2 border-b border-white pb-2">INDICATOR RESULTS</div>
                                <div id="indicator-output" class="text-xs font-mono text-green-400"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ÈîôËØØÂ§ÑÁêÜÂíåÂ∫ìÊ£ÄÊü• ====================
        console.log('üöÄ ÂºÄÂßãÂä†ËΩΩArthera‰∫§ÊòìÁ≥ªÁªüJavaScript...');
        
        // Ê£ÄÊü•Â§ñÈÉ®‰æùËµñ
        window.addEventListener('error', function(e) {
            console.error('‚ùå È°µÈù¢ÈîôËØØ:', e.error);
            if (e.error && e.error.message && e.error.message.includes('Chart')) {
                console.warn('‚ö†Ô∏è Chart.jsÂ∫ìÂä†ËΩΩÂ§±Ë¥•ÔºåÂõæË°®ÂäüËÉΩÂ∞ÜË¢´Á¶ÅÁî®');
            }
        });
        
        // ÂÆâÂÖ®ÁöÑChart.jsÊ£ÄÊü•
        function isChartAvailable() {
            return typeof Chart !== 'undefined';
        }
        
        // ÊµãËØïÂáΩÊï∞ÂÆö‰πâ
        function testFunctionDefinition() {
            console.log('üß™ ÊµãËØïÂáΩÊï∞ÊòØÂê¶Ê≠£Á°ÆÂÆö‰πâ...');
            return 'JavaScriptÂáΩÊï∞ÂÆö‰πâÊµãËØïÈÄöËøá!';
        }
        
        // È™åËØÅÂÖ≥ÈîÆÂáΩÊï∞
        function validateCoreFunctions() {
            const requiredFunctions = ['setCapital', 'generateSignals', 'startAutoTrading', 'executeOrder', 'refreshAllData'];
            const missing = [];
            
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missing.push(funcName);
                }
            });
            
            if (missing.length > 0) {
                console.error('‚ùå Áº∫Â§±ÂáΩÊï∞:', missing);
                return false;
            } else {
                console.log('‚úÖ ÊâÄÊúâÊ†∏ÂøÉÂáΩÊï∞Â∑≤Ê≠£Á°ÆÂÆö‰πâ');
                return true;
            }
        }
        
        console.log('‚úÖ JavaScriptÂü∫Á°ÄÂáΩÊï∞Âä†ËΩΩÂÆåÊàê');
        
        // ==================== BloombergÈ£éÊ†ºËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞ ====================
        
        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
            updateAllText(); // Á°Æ‰øùÁïåÈù¢ÊñáÊú¨ÊòØÊúÄÊñ∞ËØ≠Ë®Ä
        }
        
        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }
        
        function switchSettingsTab(tabName) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÈ°µÂÜÖÂÆπ
            document.querySelectorAll('.settings-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ - BloombergÈ£éÊ†º
            document.querySelectorAll('.settings-tab-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('text-white');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÈ°µ
            document.getElementById(`settings-${tabName}`).classList.remove('hidden');
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ - BloombergÈ£éÊ†º
            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.add('bg-white', 'text-black');
            activeTab.classList.remove('text-white');
        }

        // APIÂØÜÈí•ÊòæÁ§∫ÂàáÊç¢ - BloombergÈ£éÊ†º
        function toggleApiKeyVisibility() {
            const input = document.getElementById('deepseek-api-key');
            const icon = document.getElementById('api-key-toggle-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'HIDE';
            } else {
                input.type = 'password';
                icon.textContent = 'SHOW';
            }
        }

        // AIÈÖçÁΩÆ‰øùÂ≠ò - BloombergÈ£éÊ†º
        function saveAiConfig() {
            const apiKey = document.getElementById('deepseek-api-key').value.trim();
            const model = document.getElementById('deepseek-model').value;
            const temperature = parseFloat(document.getElementById('deepseek-temperature').value);
            const enabled = document.getElementById('ai-signals-enabled').checked;
            
            if (!apiKey) {
                showToast(t('api-key') + ' ' + t('config-failed'), 'error');
                return;
            }
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('arthera-ai-config', JSON.stringify({
                apiKey: btoa(apiKey), // ÁÆÄÂçïÁºñÁ†Å
                model: model,
                temperature: temperature,
                enabled: enabled,
                savedAt: new Date().toISOString()
            }));
            
            showToast(t('config-saved'), 'success');
        }

        // Êõ¥Êñ∞ËÆæÁΩÆÁïåÈù¢ËØ≠Ë®ÄÈÄâÊã©Âô®ÁöÑÂÄº
        function updateLanguageSelector() {
            const selector = document.getElementById('language-select');
            if (selector) {
                selector.value = window.currentLanguage;
            }
        }
        
        // ==================== Â§öËØ≠Ë®ÄÊîØÊåÅ ====================
        
        window.currentLanguage = 'zh';
        
        const translations = {
            zh: {
                // Â§¥ÈÉ®ÂíåÂØºËà™
                'title': 'ARTHERAÈáèÂåñ‰∫§ÊòìÁ≥ªÁªü',
                'dashboard': '‰ª™Ë°®Êùø',
                'settings': 'ÈÖçÁΩÆ',
                'refresh': 'Âà∑Êñ∞',
                'language-switch': 'ÂàáÊç¢ËØ≠Ë®Ä',
                'real-time-connection': 'ÂÆûÊó∂',
                'data-source': 'Êï∞ÊçÆÊ∫ê',
                'professional-version': '‰∏ì‰∏öÁâà',
                'terminal-mode': 'ÁªàÁ´Ø',
                'strategy-control-center': 'Á≠ñÁï•ÊéßÂà∂‰∏≠ÂøÉ',
                'capital-management-title': 'ËµÑÈáëÁÆ°ÁêÜ',
                'initial-capital-label': 'ÂàùÂßãËµÑÈáë (USD)',
                'initial-capital-placeholder': 'ËæìÂÖ•ÂàùÂßãËµÑÈáë',
                'set-button': 'ËÆæÁΩÆ',
                'used-label': 'Â∑≤Áî®',
                'available-label': 'ÂèØÁî®',
                'data-source-config-title': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'tushare-token-label': 'Tushare Token',
                'tushare-placeholder': 'ËØ∑ËæìÂÖ•Tushare‰∏ì‰∏öÊï∞ÊçÆToken',
                'strategy-parameters-title': 'Á≠ñÁï•ÂèÇÊï∞',
                
                // ÂõæË°®Ê†áÁ≠æ
                'volume-tab': 'Êàê‰∫§Èáè',
                'performance-tab': 'Á≠ñÁï•Ë°®Áé∞',
                'risk-tab': 'È£éÈô©ÂàÜÊûê',
                'correlation-tab': 'Áõ∏ÂÖ≥ÊÄßÂàÜÊûê',
                'technical-tab': 'ÊäÄÊúØÂàÜÊûê',
                'system-status': 'Á≥ªÁªüÁä∂ÊÄÅ',
                'trading-active': '‰∫§ÊòìÊ¥ªË∑É',
                'active-strategies': 'Á≠ñÁï•',
                'running-status': 'ËøêË°å‰∏≠',
                'signals-today': '‰ªäÊó•‰ø°Âè∑',
                'ai-signals': 'AI‰ø°Âè∑',
                'ai-powered': 'AIÈ©±Âä®',
                'orders-today': '‰ªäÊó•ËÆ¢Âçï',
                'total-volume': '‰∫§ÊòìÈáè',
                'total-capital': 'ÊÄªËµÑÈáë',
                'available-funds': 'ÂèØÁî®ËµÑÈáë',
                'success-rate': 'ÊàêÂäüÁéá',
                'professional-grade': '‰∏ì‰∏öÊ∞¥ÂáÜ',
                'var-95': 'VaR 95%',
                'value-at-risk': 'È£éÈô©‰ª∑ÂÄº',
                
                // ËÆæÁΩÆÈ°µÈù¢
                'basic-settings': 'Âü∫Á°ÄËÆæÁΩÆ',
                'ai-configuration': 'AIÈÖçÁΩÆ',
                'tushare-config': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'system-config': 'Á≥ªÁªüÈÖçÁΩÆ',
                'api-key': 'APIÂØÜÈí•',
                'api-key-placeholder': 'ËØ∑ËæìÂÖ•APIÂØÜÈí•',
                'model-selection': 'Ê®°ÂûãÈÄâÊã©',
                'temperature': 'ÁîüÊàêÊ∏©Â∫¶',
                'test-connection': 'ÊµãËØïËøûÊé•',
                'save-config': '‰øùÂ≠òÈÖçÁΩÆ',
                'config-saved': 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò',
                'config-failed': 'ÈÖçÁΩÆÂ§±Ë¥•',
                'api-status': 'APIÁä∂ÊÄÅ',
                'not-configured': 'Êú™ÈÖçÁΩÆ',
                
                // AIÊ®°ÂûãÈÄâÈ°π
                'deepseek-chat': 'DeepSeek Chat',
                'deepseek-coder': 'DeepSeek Coder', 
                'deepseek-v25': 'DeepSeek V2.5 (Êé®Ëçê)',
                'deepseek-v3': 'DeepSeek V3 (ÊúÄÊñ∞)',
                
                // Ê∏©Â∫¶ÈÄâÈ°π
                'temp-conservative': '‰øùÂÆà',
                'temp-balanced': 'Âπ≥Ë°°',
                'temp-moderate': '‰∏≠Á≠â',
                'temp-aggressive': 'ÊøÄËøõ',
                
                // Áä∂ÊÄÅÊñáÊú¨
                'connecting': 'Ê≠£Âú®ËøûÊé•...',
                'connected': 'ËøûÊé•ÊàêÂäü',
                'connection-failed': 'ËøûÊé•Â§±Ë¥•',
                'api-status': 'APIÁä∂ÊÄÅ',
                'not-configured': 'Êú™ÈÖçÁΩÆ',
                'configured': 'Â∑≤ÈÖçÁΩÆ',
                
                // ÂõæË°®
                'volume-trend': 'Êàê‰∫§ÈáèË∂ãÂäø',
                'strategy-performance': 'Á≠ñÁï•Ë°®Áé∞',
                'signal-distribution': '‰ø°Âè∑ÂàÜÂ∏É',
                
                // Êñ∞Â¢û‰ª™Ë°®ÊùøÊ®°Âùó
                'performance-metrics': 'Áª©ÊïàÊåáÊ†á',
                'risk-control': 'È£éÈô©ÊéßÂà∂',
                'service-overview-title': 'ÊúçÂä°ÂÅ•Â∫∑',
                'service-latency': 'Âª∂Ëøü',
                'service-uptime': 'Âú®Á∫øÁéá',
                'api-gateway-service': 'Áªü‰∏ÄÁΩëÂÖ≥',
                'ios-connector-service': 'iOSËøûÊé•Âô®',
                'quant-engine-service': 'ÈáèÂåñÂºïÊìé',
                'risk-engine-service': 'È£éÊéßÂºïÊìé',
                'portfolio-service': 'ÊäïËµÑÁªÑÂêàÊúçÂä°',
                'ios-status-healthy': 'Ê≠£Â∏∏',
                'ios-status-warning': 'Ë≠¶Âëä',
                'ios-status-error': 'Á¶ªÁ∫ø',
                'realtime-data': 'ÂÆûÊó∂Êï∞ÊçÆ',
                'ai-strategy-performance': 'AIÁ≠ñÁï•Ë°®Áé∞',
                'global-market-indices': 'ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞',
                'latest-trading-signals': 'ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑',
                'latest-orders': 'ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï',
                
                // ÊåáÊ†áÂêçÁß∞
                'sharpe-ratio': 'Â§èÊôÆÊØîÁéá',
                'info-ratio': '‰ø°ÊÅØÊØîÁéá',
                'max-drawdown': 'ÊúÄÂ§ßÂõûÊí§',
                'market-correlation': 'Â∏ÇÂú∫Áõ∏ÂÖ≥ÊÄß',
                
                // ËÇ°Á•®ÊêúÁ¥¢Áõ∏ÂÖ≥
                'target-market': 'ÁõÆÊ†áÂ∏ÇÂú∫',
                'target-stock-pool': 'ÁõÆÊ†áËÇ°Á•®Ê±†',
                'search-stocks': 'ÊêúÁ¥¢ËÇ°Á•®',
                'search-placeholder': 'ÊêúÁ¥¢ËÇ°Á•®ÔºöËæìÂÖ•ÂêçÁß∞/‰ª£Á†Å',
                'search-hint': 'Á§∫‰æãÔºöAAPL, TESLA, NVDA, Ë¥µÂ∑ûËåÖÂè∞',
                'search-status-ready': 'APIÂ∞±Áª™',
                'search-status-searching': 'ÊêúÁ¥¢‰∏≠',
                'search-status-offline': 'Á¶ªÁ∫øÊ®°Âºè',
                'all-markets': 'ÊâÄÊúâÂ∏ÇÂú∫',
                'us-stocks': 'ÁæéËÇ°',
                'china-a-shares': 'AËÇ°',
                'china-a-shares-short': 'AËÇ°',
                'hk-stocks': 'Ê∏ØËÇ°',
                'jp-stocks': 'Êó•ËÇ°',
                'all-caps': 'ÊâÄÊúâÂ∏ÇÂÄº',
                'large-cap': 'Â§ßÁõòËÇ°',
                'mid-cap': '‰∏≠ÁõòËÇ°',
                'small-cap': 'Â∞èÁõòËÇ°',
                'tech-sector': 'ÁßëÊäÄËÇ°',
                'finance-sector': 'ÈáëËûçËÇ°',
                'healthcare-sector': 'ÂåªÁñóËÇ°',
                'energy-sector': 'ËÉΩÊ∫êËÇ°',
                'ai-recommendations': 'AIÊé®Ëçê',
                'ai-supports-text': 'ÊîØÊåÅÁæéËÇ°‰∏éAËÇ°Ê†∏ÂøÉÊ†áÁöÑ',
                'generate-ai-signals': 'ÁîüÊàêAI‰ø°Âè∑',
                'start-auto-trading': 'ÂºÄÂßãËá™Âä®‰∫§Êòì',
                'stop-auto-trading': 'ÂÅúÊ≠¢Ëá™Âä®‰∫§Êòì',
                'start-auto-trading': 'ÂºÄÂßãËá™Âä®‰∫§Êòì',
                'execute-simulation-order': 'ÊâßË°åÊ®°ÊãüËÆ¢Âçï',
                'data-source-config': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'tushare-token': 'TUSHARE TOKEN',
                'enter-token-placeholder': 'ËæìÂÖ•‰∏ì‰∏öÊï∞ÊçÆÊ∫êToken',
                'config-button': 'ÈÖçÁΩÆ',
                'test-button': 'ÊµãËØï',
                'strategy-parameters': 'Á≠ñÁï•ÂèÇÊï∞',
                'risk-level': 'È£éÈô©Á≠âÁ∫ß',
                'balanced': 'Âπ≥Ë°°Âûã',
                'conservative': '‰øùÂÆàÂûã',
                'aggressive': 'ÊøÄËøõÂûã',
                'max-position': 'ÊúÄÂ§ß‰ªì‰Ωç',
                'stop-loss': 'Ê≠¢Êçü',
                'take-profit': 'Ê≠¢Áõà',
                'global-mixed': 'ÂÖ®ÁêÉÊ∑∑Âêà',
                'search-loading': 'ÊêúÁ¥¢‰∏≠...',
                'search-no-results': 'Êú™ÊâæÂà∞ÂåπÈÖçÁªìÊûú',
                'search-offline-mode': 'Á¶ªÁ∫øÊ®°Âºè',
                'search-load-more': 'Âä†ËΩΩÊõ¥Â§öÁªìÊûú...',
                'search-local-tag': 'Êú¨Âú∞ÁºìÂ≠ò',
                'reset-button': 'ÈáçÁΩÆ',
                'supports-text': 'ÊîØÊåÅÁæéËÇ°(AAPL)ÂíåAËÇ°(600519.SS)',
                'volatility': 'Ê≥¢Âä®Áéá',
                'tracking-error': 'Ë∑üË∏™ËØØÂ∑Æ',
                'online-time': 'Âú®Á∫øÊó∂Èó¥',
                'zero-signals': '0‰∏™‰ø°Âè∑',
                'zero-orders': '0‰∏™ËÆ¢Âçï',
                'click-generate-signals': 'ÁÇπÂáª"ÁîüÊàêAI‰∫§Êòì‰ø°Âè∑"ÂºÄÂßãÂàÜÊûê...',
                'click-execute-orders': 'ÁÇπÂáª"ÊâßË°åÊ®°ÊãüËÆ¢Âçï"ÂºÄÂßã‰∫§Êòì...'
            },
            en: {
                // Header and navigation
                'title': 'ARTHERA QUANTITATIVE TRADING SYSTEM',
                'dashboard': 'DASHBOARD',
                'settings': 'CONFIG',
                'refresh': 'REFRESH',
                'language-switch': 'SWITCH LANGUAGE',
                'real-time-connection': 'LIVE',
                'data-source': 'DATA',
                'professional-version': 'PROFESSIONAL',
                'terminal-mode': 'TERMINAL',
                'strategy-control-center': 'STRATEGY CONTROL CENTER',
                'capital-management-title': 'CAPITAL MANAGEMENT',
                'initial-capital-label': 'INITIAL CAPITAL (USD)',
                'initial-capital-placeholder': 'Enter initial capital',
                'set-button': 'SET',
                'used-label': 'USED:',
                'available-label': 'AVAILABLE:',
                'data-source-config-title': 'DATA SOURCE CONFIG',
                'tushare-token-label': 'Tushare Token',
                'tushare-placeholder': 'Enter Tushare Pro token',
                'strategy-parameters-title': 'STRATEGY PARAMETERS',
                
                // Chart tabs
                'volume-tab': 'VOLUME',
                'performance-tab': 'PERFORMANCE',
                'risk-tab': 'RISK',
                'correlation-tab': 'CORRELATION',
                'technical-tab': 'TECHNICAL',
                'system-status': 'System Status',
                'trading-active': 'Trading Active',
                'active-strategies': 'STRATEGIES',
                'running-status': 'RUNNING',
                'signals-today': 'Signals Today',
                'ai-signals': 'AI SIGNALS',
                'ai-powered': 'AI POWERED',
                'orders-today': 'Orders Today',
                'total-volume': 'VOLUME',
                'total-capital': 'CAPITAL',
                'available-funds': 'AVAILABLE',
                'success-rate': 'SUCCESS',
                'professional-grade': 'PROFESSIONAL',
                'var-95': 'VaR 95%',
                'value-at-risk': 'VALUE AT RISK',
                
                // Settings page
                'basic-settings': 'BASIC',
                'ai-configuration': 'AI CONFIG',
                'tushare-config': 'DATA SOURCE',
                'system-config': 'SYSTEM CONFIGURATION',
                'api-key': 'API KEY',
                'api-key-placeholder': 'ENTER API KEY',
                'model-selection': 'MODEL',
                'temperature': 'TEMPERATURE',
                'test-connection': 'TEST',
                'save-config': 'SAVE CONFIG',
                'config-saved': 'CONFIGURATION SAVED',
                'config-failed': 'CONFIGURATION FAILED',
                'api-status': 'API STATUS',
                'not-configured': 'NOT CONFIGURED',
                
                // AI model options
                'deepseek-chat': 'DeepSeek Chat',
                'deepseek-coder': 'DeepSeek Coder',
                'deepseek-v25': 'DeepSeek V2.5 (Recommended)',
                'deepseek-v3': 'DeepSeek V3 (Latest)',
                
                // Temperature options
                'temp-conservative': 'Conservative',
                'temp-balanced': 'Balanced',
                'temp-moderate': 'Moderate',
                'temp-aggressive': 'Aggressive',
                
                // Status text
                'connecting': 'Connecting...',
                'connected': 'Connected',
                'connection-failed': 'Connection Failed',
                'api-status': 'API Status',
                'not-configured': 'Not Configured',
                'configured': 'Configured',
                
                // Charts
                'volume-trend': 'Volume Trend',
                'strategy-performance': 'Strategy Performance',
                'signal-distribution': 'Signal Distribution',
                
                // Services
                'api-gateway-service': 'API Gateway',
                'ios-connector-service': 'iOS Connector',
                'quant-engine-service': 'Quant Engine',
                'risk-engine-service': 'Risk Engine',
                'portfolio-service': 'Portfolio/PnL',
                'ios-status-healthy': 'Healthy',
                'ios-status-warning': 'Degraded',
                'ios-status-error': 'Offline',
                
                // New Dashboard Modules
                'performance-metrics': 'PERFORMANCE METRICS',
                'risk-control': 'RISK CONTROL',
                'service-overview-title': 'SERVICE HEALTH',
                'service-latency': 'Latency',
                'service-uptime': 'Uptime',
                'realtime-data': 'REAL-TIME DATA',
                'ai-strategy-performance': 'AI STRATEGY PERFORMANCE',
                'global-market-indices': 'GLOBAL MARKET INDICES',
                'latest-trading-signals': 'LATEST TRADING SIGNALS',
                'latest-orders': 'LATEST ORDERS',
                
                // Metric Names
                'sharpe-ratio': 'SHARPE RATIO',
                'info-ratio': 'INFORMATION RATIO',
                'max-drawdown': 'MAX DRAWDOWN',
                'market-correlation': 'MARKET CORRELATION',
                'volatility': 'VOLATILITY',
                'tracking-error': 'TRACKING ERROR',
                'online-time': 'ONLINE TIME',
                'zero-signals': '0 SIGNALS',
                'zero-orders': '0 ORDERS',
                'click-generate-signals': 'CLICK "GENERATE AI SIGNALS" TO START ANALYSIS...',
                'click-execute-orders': 'CLICK "EXECUTE SIMULATION ORDER" TO START TRADING...',
                
                // Stock Search Related
                'target-market': 'TARGET MARKET',
                'target-stock-pool': 'TARGET STOCK POOL',
                'search-stocks': 'SEARCH STOCKS',
                'search-placeholder': 'Search stocks: type name or symbol',
                'search-hint': 'Try: AAPL, TESLA, NVDA, Maotai',
                'search-status-ready': 'API READY',
                'search-status-searching': 'SEARCHING',
                'search-status-offline': 'OFFLINE MODE',
                'all-markets': 'ALL MARKETS',
                'us-stocks': 'US STOCKS',
                'china-a-shares': 'CHINA A-SHARES',
                'china-a-shares-short': 'A-SHARES',
                'hk-stocks': 'HK STOCKS',
                'jp-stocks': 'JP STOCKS',
                'all-caps': 'ALL CAPS',
                'large-cap': 'LARGE CAP',
                'mid-cap': 'MID CAP',
                'small-cap': 'SMALL CAP',
                'tech-sector': 'TECH',
                'finance-sector': 'FINANCE',
                'healthcare-sector': 'HEALTHCARE',
                'energy-sector': 'ENERGY',
                'ai-recommendations': 'AI RECOMMENDATIONS',
                'ai-supports-text': 'AI recommendations cover US & CN core symbols',
                'pool-total': 'TOTAL:',
                'pool-us': 'US:',
                'pool-cn': 'CN:',
                'generate-ai-signals': 'GENERATE AI SIGNALS',
                'reset-button': 'RESET',
                'start-auto-trading': 'START AUTO TRADING',
                'stop-auto-trading': 'STOP AUTO TRADING',
                'start-auto-trading': 'START AUTO TRADING',
                'execute-simulation-order': 'EXECUTE SIMULATION ORDER',
                'data-source-config': 'DATA SOURCE CONFIG',
                'tushare-token': 'TUSHARE TOKEN',
                'enter-token-placeholder': 'ENTER TOKEN FOR PROFESSIONAL DATA',
                'config-button': 'CONFIG',
                'test-button': 'TEST',
                'strategy-parameters': 'STRATEGY PARAMETERS',
                'risk-level': 'RISK LEVEL',
                'balanced': 'BALANCED',
                'conservative': 'CONSERVATIVE',
                'aggressive': 'AGGRESSIVE',
                'max-position': 'MAX POSITION',
                'stop-loss': 'STOP LOSS',
                'take-profit': 'TAKE PROFIT',
                'global-mixed': 'GLOBAL MIXED',
                'search-loading': 'SEARCHING...',
                'search-no-results': 'No results for',
                'search-offline-mode': 'Offline mode',
                'search-load-more': 'LOAD MORE RESULTS...',
                'search-local-tag': 'LOCAL',
                'supports-text': 'SUPPORTS US STOCKS (AAPL) AND CHINA A-SHARES (600519.SS)'
            }
        };
        
        window.t = function(key) {
            return translations[window.currentLanguage][key] || key;
        };

        let searchStatusState = 'ready';
        function updateSearchStatus(state = 'ready', detail) {
            searchStatusState = state;
            const statusEl = document.getElementById('search-status');
            if (!statusEl) {
                return;
            }
            const classes = ['text-green-400', 'text-blue-400', 'text-yellow-400', 'text-red-400', 'hidden'];
            statusEl.classList.remove(...classes);
            const colorMap = {
                ready: 'text-green-400',
                searching: 'text-blue-400',
                offline: 'text-yellow-400'
            };
            statusEl.classList.add(colorMap[state] || 'text-green-400');
            const textMap = {
                ready: window.t('search-status-ready'),
                searching: window.t('search-status-searching'),
                offline: window.t('search-status-offline')
            };
            const base = textMap[state] || textMap.ready;
            statusEl.textContent = detail ? `${base}: ${detail}` : base;
        }
        window.updateSearchStatus = updateSearchStatus;

        window.updateAllText = function() {
            console.log(`üåç Êõ¥Êñ∞ËØ≠Ë®ÄÂà∞: ${window.currentLanguage}`);
            
            // Êõ¥Êñ∞ÊâÄÊúâÂÖ∑Êúâdata-i18nÂ±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.textContent = translation;
                }
            });
            
            // Êõ¥Êñ∞Âç†‰ΩçÁ¨¶ÊñáÊú¨
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.placeholder = translation;
                }
            });
            
            // Êõ¥Êñ∞Ê†áÈ¢òÂ±ûÊÄß
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.title = translation;
                }
            });
            
            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.title = window.t('title');
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆÊñáÊú¨
            const langButtons = document.querySelectorAll('.language-toggle');
            langButtons.forEach(langButton => {
                langButton.textContent = window.currentLanguage === 'zh' ? 'EN' : '‰∏≠Êñá';
            });
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÈÄâÊã©Âô®
            const langSelector = document.getElementById('language-select');
            if (langSelector) {
                langSelector.value = window.currentLanguage;
            }
            updateSearchStatus(searchStatusState);
            updateLanguageSelector();
            
            // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂ÔºåÈÄöÁü•ÂÖ∂‰ªñÁªÑ‰ª∂ËØ≠Ë®ÄÂ∑≤ÂèòÊõ¥
            window.dispatchEvent(new CustomEvent('languageChanged', { 
                detail: { language: window.currentLanguage } 
            }));
            
            console.log(`‚úÖ ËØ≠Ë®ÄÊõ¥Êñ∞ÂÆåÊàê`);
        }

        function switchLanguage(lang) {
            console.log(`üåç ÂàáÊç¢ËØ≠Ë®ÄÂà∞: ${lang}`);
            
            if (!translations[lang]) {
                console.error(`‚ùå ‰∏çÊîØÊåÅÁöÑËØ≠Ë®Ä: ${lang}`);
                return;
            }
            
            window.currentLanguage = lang;
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÊåâÈíÆÊòæÁ§∫
            const languageToggle = document.querySelector('.language-toggle');
            if (languageToggle) {
                languageToggle.textContent = lang === 'zh' ? 'EN' : '‰∏≠';
            }
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÈÄâÊã©‰∏ãÊãâÊ°Ü
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.value = lang;
            }
            
            // Êõ¥Êñ∞ÊâÄÊúâÊñáÊú¨
            window.updateAllText();
            
            // ‰øùÂ≠òËØ≠Ë®ÄËÆæÁΩÆ
            localStorage.setItem('arthera-language', lang);
            
            // Êõ¥Êñ∞ÂõæË°®Ê†áÁ≠æÂíåÊèêÁ§∫ÊñáÊú¨
            if (window.updateChartLabels) {
                window.updateChartLabels();
            }
            
            // ÊòæÁ§∫ÂàáÊç¢ÊàêÂäüÊèêÁ§∫
            if (typeof showToast === 'function') {
                const message = lang === 'zh' ? 'ËØ≠Ë®ÄÂ∑≤ÂàáÊç¢Âà∞‰∏≠Êñá' : 'Language switched to English';
                showToast(message, 'info');
            }
            
            console.log(`‚úÖ ËØ≠Ë®ÄÂàáÊç¢ÊàêÂäü`);
        }

        window.updateAllText = updateAllText;
        window.switchLanguage = switchLanguage;

        // È°µÈù¢Âä†ËΩΩÊó∂ÊÅ¢Â§çËØ≠Ë®ÄËÆæÁΩÆ
        document.addEventListener('DOMContentLoaded', function() {
            const savedLang = localStorage.getItem('arthera-language') || 'zh';
            switchLanguage(savedLang);
        });
        
        // ==================== ÂÖ®Â±ÄÂèòÈáèÂíåÈÖçÁΩÆ ====================
        const API_BASE_URL = (window.__TRADING_ENGINE_CONFIG__ && window.__TRADING_ENGINE_CONFIG__.apiBaseUrl) || window.location.origin || 'http://localhost:8000';
        
        let charts = {
            volume: null,
            performance: null,
            risk: null,
            correlation: null,
            technical: null,
            signals: null
        };
        
        let financialMetrics = {
            sharpeRatio: 0,
            sortino: 0,
            maxDrawdown: 0,
            var95: 0,
            beta: 0,
            alpha: 0,
            informationRatio: 0,
            treynor: 0
        };
        
        let updateIntervals = {
            main: null,
            charts: null,
            autoTrading: null
        };
        
        let tradingState = {
            totalCapital: 100000,
            availableCapital: 100000,
            usedCapital: 0,
            positions: [],
            isAutoTrading: false,
            totalProfit: 0,
            tradingHistory: []
        };
        window.tradingState = tradingState;
        
        let strategyConfig = {
            riskLevel: 'moderate',
            maxPosition: 10000,
            stopLoss: 5,
            takeProfit: 15
        };

        // ==================== ÂàùÂßãÂåñ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñArthera‰∫§ÊòìÁ≥ªÁªü...');
            
            try {
                // Âü∫Á°ÄÂàùÂßãÂåñ
                updateTime();
                console.log('‚úÖ Êó∂Èó¥Êõ¥Êñ∞ÂàùÂßãÂåñÂÆåÊàê');
                
                initializeCapital();
                console.log('‚úÖ ËµÑÈáëÁÆ°ÁêÜÂàùÂßãÂåñÂÆåÊàê');
                
                // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÊúÄÈáçË¶ÅÔºâ
                bindEventListeners();
                console.log('‚úÖ ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂÆåÊàê');
                
                // È™åËØÅÊ†∏ÂøÉÂáΩÊï∞
                validateCoreFunctions();
                
                // ÊòæÁ§∫Âü∫Êú¨ÁïåÈù¢
                showToast('‚úÖ Á≥ªÁªüÂü∫Á°ÄÂäüËÉΩÂ∑≤Âä†ËΩΩ', 'success');
                console.log('‚úÖ Âü∫Á°ÄÂàùÂßãÂåñÂÆåÊàê');
                
                // Âª∂ËøüÂä†ËΩΩÂÖ∂‰ªñÂäüËÉΩÔºåÈÅøÂÖçÈòªÂ°ûUI
                setTimeout(async () => {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÈ´òÁ∫ßÂäüËÉΩ...');
                        
                        // ÂàÜÊ≠•Âä†ËΩΩÔºåÊØèÊ≠•ÈÉΩÊúâÁã¨Á´ãÈîôËØØÂ§ÑÁêÜ
                        try {
                            await initializeCharts();
                            console.log('‚úÖ ÂõæË°®ÂàùÂßãÂåñÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è ÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•ÔºåÁªßÁª≠Âä†ËΩΩÂÖ∂‰ªñÂäüËÉΩ:', error);
                        }
                        
                        try {
                            await loadInitialData();
                            console.log('‚úÖ ÂàùÂßãÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadConfigStatus();
                            console.log('‚úÖ ÈÖçÁΩÆÁä∂ÊÄÅÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadMarketIndices();
                            console.log('‚úÖ Â∏ÇÂú∫ÊåáÊï∞Âä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadStrategies();
                            console.log('‚úÖ Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Á≠ñÁï•Âä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        // ÂêØÂä®Ëá™Âä®Êõ¥Êñ∞
                        try {
                            startAutoUpdate();
                            console.log('‚úÖ Ëá™Âä®Êõ¥Êñ∞ÂêØÂä®ÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Ëá™Âä®Êõ¥Êñ∞ÂêØÂä®Â§±Ë¥•:', error);
                        }
                        
                        // Âä†ËΩΩÂàùÂßãÂõæË°®Êï∞ÊçÆ
                        try {
                            await loadInitialChartData();
                            console.log('‚úÖ ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        // ÂàùÂßãÂåñÊñ∞Â¢ûÂäüËÉΩ - Á°Æ‰øùDOMÂÆåÂÖ®Â∞±Áª™
                        console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñÊñ∞Â¢ûÂäüËÉΩ...');
                        
                        // Á´ãÂç≥ÂàùÂßãÂåñËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ
                        try {
                            const searchInput = document.getElementById('stock-search');
                            const dropdown = document.getElementById('search-dropdown');
                            
                            if (searchInput && dropdown) {
                                console.log('‚úÖ ÊêúÁ¥¢ÂÖÉÁ¥†Â∑≤Â∞±Áª™ÔºåÁ´ãÂç≥ÂàùÂßãÂåñ...');
                                window.initStockSearch();
                                window.updateStockChips();
                                window.updatePoolStats();
                                window.generateAIRecommendations();
                                console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàê');
                            } else {
                                console.log('‚ö†Ô∏è ÊêúÁ¥¢ÂÖÉÁ¥†Êú™Â∞±Áª™ÔºåÁ≠âÂæÖDOMËß£ÊûêÂÆåÊàê...');
                                // ‰ΩøÁî®MutationObserverÁõëÊéßDOMÂèòÂåñ
                                const observer = new MutationObserver((mutations) => {
                                    const searchInput = document.getElementById('stock-search');
                                    const dropdown = document.getElementById('search-dropdown');
                                    
                                    if (searchInput && dropdown && !window.searchInitialized) {
                                        console.log('‚úÖ ÊêúÁ¥¢ÂÖÉÁ¥†ÈÄöËøáMutationObserverÊâæÂà∞ÔºåÂºÄÂßãÂàùÂßãÂåñ...');
                                        observer.disconnect();
                                        try {
                                            window.initStockSearch();
                                            window.updateStockChips();
                                            window.updatePoolStats();
                                            window.generateAIRecommendations();
                                            console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàêÔºàÂª∂ËøüÔºâ');
                                        } catch (error) {
                                            console.error('ÊêúÁ¥¢ÂàùÂßãÂåñÈîôËØØ:', error);
                                        }
                                    }
                                });
                                
                                observer.observe(document.body, { 
                                    childList: true, 
                                    subtree: true 
                                });
                                
                                // 3ÁßíÂêéÊñ≠ÂºÄËßÇÂØüÂô®ÔºàÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºèÔºâ
                                setTimeout(() => {
                                    if (observer) {
                                        observer.disconnect();
                                        console.log('üîß MutationObserverÂ∑≤Êñ≠ÂºÄ');
                                    }
                                }, 3000);
                            }
                        } catch (error) {
                            console.error('Êñ∞Â¢ûÂäüËÉΩÂàùÂßãÂåñÂ§±Ë¥•:', error);
                        }
                        
                        showToast('‚úÖ Á≥ªÁªüÂä†ËΩΩÂÆåÊàêÔºåÊâÄÊúâÊåâÈíÆÂäüËÉΩÂèØÁî®ÔºÅ', 'success');
                        
                        // È¢ùÂ§ñÁöÑÊêúÁ¥¢ÂäüËÉΩ‰øùÈô©ÂàùÂßãÂåñ - Âú®1ÁßíÂêéÊ£ÄÊü•
                        setTimeout(() => {
                            if (!window.searchInitialized) {
                                console.log('üîÑ ÊâßË°å‰øùÈô©ÊêúÁ¥¢ÂàùÂßãÂåñÊ£ÄÊü•...');
                                const searchInput = document.getElementById('stock-search');
                                const dropdown = document.getElementById('search-dropdown');
                                
                                if (searchInput && dropdown) {
                                    console.log('üÜò ÊêúÁ¥¢ÂÖÉÁ¥†Â≠òÂú®‰ΩÜÊú™ÂàùÂßãÂåñÔºåÊâßË°å‰øùÈô©ÂàùÂßãÂåñ...');
                                    try {
                                        window.initStockSearch();
                                        console.log('‚úÖ ‰øùÈô©ÂàùÂßãÂåñÂÆåÊàê');
                                    } catch (error) {
                                        console.error('‰øùÈô©ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                                    }
                                } else {
                                    console.log('‚ùå ‰øùÈô©Ê£ÄÊü•: ÊêúÁ¥¢ÂÖÉÁ¥†‰ªçÊú™ÊâæÂà∞');
                                }
                            } else {
                                console.log('‚úÖ ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Ê≠£Â∏∏ÂàùÂßãÂåñÔºåÊó†ÈúÄ‰øùÈô©Êé™ÊñΩ');
                            }
                        }, 1000);
                        
                    } catch (error) {
                        console.error('‚ùå È´òÁ∫ßÂäüËÉΩÂä†ËΩΩÂ§±Ë¥•:', error);
                        showToast('‚ö†Ô∏è ÈÉ®ÂàÜÂäüËÉΩÂä†ËΩΩÂ§±Ë¥•ÔºåÊ†∏ÂøÉÂäüËÉΩÊ≠£Â∏∏', 'warning');
                    }
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Âü∫Á°ÄÂàùÂßãÂåñÂ§±Ë¥•:', error);
                showToast('‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message, 'error');
            }
        });

        function bindEventListeners() {
            console.log('üîß ÂºÄÂßãÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®...');
            
            try {
                // Â∏ÇÂú∫ÈÄâÊã©Âô®
                const marketSelect = document.getElementById('market-select');
                if (marketSelect) {
                    marketSelect.addEventListener('change', function(e) {
                        const selectedMarket = e.target.value;
                        console.log(`üìä Â∏ÇÂú∫ÂàáÊç¢Âà∞: ${selectedMarket}`);
                        showToast(`ÂàáÊç¢Âà∞${selectedMarket === 'US' ? 'ÁæéËÇ°' : 'AËÇ°'}Â∏ÇÂú∫ÔºåÊ≠£Âú®ÈáçÊñ∞Âä†ËΩΩÂõæË°®Êï∞ÊçÆ...`, 'info');
                        
                        // ‰ΩøÁî®Á´ãÂç≥ÊâßË°åÁöÑÂºÇÊ≠•ÂáΩÊï∞ÈÅøÂÖçÊ∂àÊÅØÈÄöÈÅìÈîôËØØ
                        (async () => {
                            try {
                                await loadInitialChartData();
                                await loadMarketIndices();
                                showToast(`‚úÖ ${selectedMarket === 'US' ? 'ÁæéËÇ°' : 'AËÇ°'}ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê`, 'success');
                            } catch (error) {
                                console.error('Â∏ÇÂú∫ÂàáÊç¢Â§±Ë¥•:', error);
                                showToast('‚ö†Ô∏è ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'warning');
                            }
                        })();
                    });
                    console.log('‚úÖ Â∏ÇÂú∫ÈÄâÊã©Âô®‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Â∏ÇÂú∫ÈÄâÊã©Âô®ÂÖÉÁ¥†');
                }
                
                // Âà∑Êñ∞ÊåâÈíÆ
                const refreshBtn = document.getElementById('refresh-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', refreshAllData);
                    console.log('‚úÖ Âà∑Êñ∞ÊåâÈíÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Âà∑Êñ∞ÊåâÈíÆÂÖÉÁ¥†');
                }
                
                // ËÆæÁΩÆÊåâÈíÆ
                const settingsBtn = document.getElementById('settings-btn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', openSettings);
                    console.log('‚úÖ ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ËÆæÁΩÆÊåâÈíÆÂÖÉÁ¥†');
                }
                
                // ËµÑÈáëËæìÂÖ•Ê°Ü
                const capitalInput = document.getElementById('initial-capital');
                if (capitalInput) {
                    capitalInput.addEventListener('change', function(e) {
                        const newCapital = parseFloat(e.target.value);
                        console.log(`üí∞ ËµÑÈáëËæìÂÖ•ÂèòÂåñ: ${newCapital}`);
                        if (newCapital && newCapital >= 1000) {
                            updateCapitalDisplay();
                            showToast(`üí∞ ËµÑÈáëÂ∑≤Êõ¥Êñ∞‰∏∫ $${newCapital.toLocaleString()}`, 'info');
                        }
                    });
                    console.log('‚úÖ ËµÑÈáëËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ËµÑÈáëËæìÂÖ•Ê°ÜÂÖÉÁ¥†');
                }
                
                // ÂÖ®Â±ÄÂø´Êç∑ÈîÆ
                document.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'r') {
                        e.preventDefault();
                        console.log('‚å®Ô∏è Âø´Êç∑ÈîÆËß¶Âèë: Ctrl+R');
                        refreshAllData();
                    }
                });
                console.log('‚úÖ ÂÖ®Â±ÄÂø´Êç∑ÈîÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                
                console.log('üéâ ÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂÆåÊàê');
                
            } catch (error) {
                console.error('‚ùå ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂ§±Ë¥•:', error);
                showToast('‚ùå ‰∫ã‰ª∂ÁªëÂÆöÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        function startAutoUpdate() {
            if (settings.autoRefresh) {
                // ‰∏ªË¶ÅÊï∞ÊçÆÊõ¥Êñ∞
                updateIntervals.main = setInterval(() => {
                    updateDashboard();
                    updateTime();
                }, settings.refreshInterval * 1000);
                
                // ÂõæË°®Êï∞ÊçÆÊõ¥Êñ∞
                updateIntervals.charts = setInterval(() => {
                    updateCharts();
                }, 10000); // ÂõæË°®ÊØè10ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
                
                // Â∏ÇÂú∫ÊåáÊï∞Êõ¥Êñ∞
                setInterval(loadMarketIndices, 30000); // ÊØè30ÁßíÊõ¥Êñ∞Â∏ÇÂú∫ÊåáÊï∞
            }
        }

        // ==================== ËµÑÈáëÁÆ°ÁêÜ ====================
        function initializeCapital() {
            updateCapitalDisplay();
        }
        
        function setCapital() {
            console.log('üí∞ setCapital() ÂáΩÊï∞Ë¢´Ë∞ÉÁî®');
            console.log('üîç ÂáΩÊï∞ÊâßË°åÂºÄÂßã...');
            
            const capitalInput = document.getElementById('initial-capital');
            if (!capitalInput) {
                console.error('‚ùå Êú™ÊâæÂà∞ initial-capital ÂÖÉÁ¥†');
                showToast('‚ùå ËµÑÈáëËæìÂÖ•Ê°Ü‰∏çÂ≠òÂú®', 'error');
                return;
            }
            
            const newCapital = parseFloat(capitalInput.value);
            console.log(`üí∞ ËæìÂÖ•ÁöÑËµÑÈáëÈáëÈ¢ù: ${newCapital}`);
            
            if (isNaN(newCapital) || newCapital < 1000) {
                console.warn('‚ö†Ô∏è ËµÑÈáëÈáëÈ¢ùÊó†ÊïàÊàñËøáÂ∞è');
                showToast('ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑËµÑÈáëÈáëÈ¢ù (ÊúÄÂ∞è $1,000)', 'warning');
                return;
            }
            
            if (tradingState.isAutoTrading) {
                showToast('Ëá™Âä®‰∫§ÊòìËøõË°å‰∏≠ÔºåÊó†Ê≥ï‰øÆÊîπËµÑÈáë', 'warning');
                return;
            }
            
            tradingState.totalCapital = newCapital;
            tradingState.availableCapital = newCapital - tradingState.usedCapital;
            
            updateCapitalDisplay();
            showToast(`ËµÑÈáëËÆæÁΩÆÊàêÂäü: $${newCapital.toLocaleString()}`, 'success');
        }
        
        function updateCapitalDisplay() {
            document.getElementById('total-capital').textContent = '$' + tradingState.totalCapital.toLocaleString();
            document.getElementById('used-capital').textContent = '$' + tradingState.usedCapital.toLocaleString();
            document.getElementById('available-capital').textContent = '$' + tradingState.availableCapital.toLocaleString();
            
            const utilizationRate = (tradingState.usedCapital / tradingState.totalCapital) * 100;
            document.getElementById('capital-change').textContent = `ËµÑÈáëÂà©Áî®Áéá: ${utilizationRate.toFixed(1)}%`;
        }
        
        function allocateCapital(amount) {
            if (amount > tradingState.availableCapital) {
                showToast('ÂèØÁî®ËµÑÈáë‰∏çË∂≥', 'error');
                return false;
            }
            
            tradingState.usedCapital += amount;
            tradingState.availableCapital -= amount;
            updateCapitalDisplay();
            return true;
        }
        
        function releaseCapital(amount, profit = 0) {
            tradingState.usedCapital -= amount;
            tradingState.availableCapital += amount + profit;
            tradingState.totalProfit += profit;
            
            if (tradingState.usedCapital < 0) tradingState.usedCapital = 0;
            if (tradingState.availableCapital > tradingState.totalCapital + tradingState.totalProfit) {
                tradingState.totalCapital = tradingState.availableCapital;
            }
            
            updateCapitalDisplay();
        }
        
        // ==================== Á≠ñÁï•ÊéßÂà∂ ====================
        function updateStrategyConfig() {
            strategyConfig.riskLevel = document.getElementById('risk-level').value;
            strategyConfig.maxPosition = parseFloat(document.getElementById('max-position').value);
            strategyConfig.stopLoss = parseFloat(document.getElementById('stop-loss').value);
            strategyConfig.takeProfit = parseFloat(document.getElementById('take-profit').value);
        }
        
        function startAutoTrading() {
            if (tradingState.isAutoTrading) {
                stopAutoTrading();
                return;
            }
            
            updateStrategyConfig();
            
            if (tradingState.availableCapital < strategyConfig.maxPosition) {
                showToast('ÂèØÁî®ËµÑÈáë‰∏çË∂≥‰ª•ÂêØÂä®Ëá™Âä®‰∫§Êòì', 'error');
                return;
            }
            
            tradingState.isAutoTrading = true;
            document.getElementById('auto-trading-text').textContent = 'ÂÅúÊ≠¢Ëá™Âä®‰∫§Êòì';
            document.getElementById('auto-trading-btn').className = 'w-full bg-red-600 text-white p-3 rounded-md font-medium hover:bg-red-700 transition flex items-center justify-center';
            
            // ÂºÄÂßãËá™Âä®‰∫§ÊòìÂæ™ÁéØ
            updateIntervals.autoTrading = setInterval(autoTradingCycle, 15000); // ÊØè15ÁßíÊâßË°å‰∏ÄÊ¨°
            
            showToast('Ëá™Âä®‰∫§ÊòìÂ∑≤ÂêØÂä®ÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÁîüÊàê‰ø°Âè∑Âπ∂ÊâßË°å‰∫§Êòì', 'success');
        }
        
        function stopAutoTrading() {
            tradingState.isAutoTrading = false;
            
            if (updateIntervals.autoTrading) {
                clearInterval(updateIntervals.autoTrading);
                updateIntervals.autoTrading = null;
            }
            
            document.getElementById('auto-trading-text').textContent = 'ÂºÄÂßãËá™Âä®‰∫§Êòì';
            document.getElementById('auto-trading-btn').className = 'w-full bg-orange-600 text-white p-3 rounded-md font-medium hover:bg-orange-700 transition flex items-center justify-center';
            
            showToast('Ëá™Âä®‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢', 'info');
        }
        
        async function autoTradingCycle() {
            try {
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†
                const symbols = document.getElementById('target-symbols').value
                    .split(/[,Ôºå\n]/)
                    .map(s => s.trim())
                    .filter(s => s);
                
                if (symbols.length === 0) return;
                
                // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ËÇ°Á•®ËøõË°å‰∫§Êòì
                const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                
                // ÁîüÊàê‰ø°Âè∑
                const response = await fetch(`${API_BASE_URL}/signals/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ symbols: [randomSymbol] })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.signals.length > 0) {
                        const signal = data.signals[0];
                        
                        // Ê†πÊçÆ‰ø°Âè∑ÁΩÆ‰ø°Â∫¶ÂÜ≥ÂÆöÊòØÂê¶ÊâßË°å‰∫§Êòì
                        if (signal.confidence > 0.7 && (signal.action === 'BUY' || signal.action === 'SELL')) {
                            await executeAutoTrade(signal);
                        }
                    }
                }
                
                // Ê£ÄÊü•Áé∞ÊúâÊåÅ‰ªìÊòØÂê¶ÈúÄË¶ÅÊ≠¢ÊçüÊàñÊ≠¢Áõà
                checkExistingPositions();
                
            } catch (error) {
                console.error('Ëá™Âä®‰∫§ÊòìÂæ™ÁéØÈîôËØØ:', error);
            }
        }
        
        async function executeAutoTrade(signal) {
            const positionSize = Math.min(strategyConfig.maxPosition, tradingState.availableCapital);
            
            if (positionSize < 1000) return; // ÊúÄÂ∞è‰∫§ÊòìÈáëÈ¢ù
            
            const quantity = Math.floor(positionSize / signal.current_price);
            
            if (allocateCapital(positionSize)) {
                // Ê®°ÊãüÊâßË°å‰∫§Êòì
                const trade = {
                    symbol: signal.symbol,
                    action: signal.action,
                    quantity: quantity,
                    price: signal.current_price,
                    amount: positionSize,
                    timestamp: new Date().toISOString(),
                    stopLoss: signal.current_price * (1 - strategyConfig.stopLoss / 100),
                    takeProfit: signal.current_price * (1 + strategyConfig.takeProfit / 100)
                };
                
                tradingState.positions.push(trade);
                tradingState.tradingHistory.push(trade);
                
                showToast(`Ëá™Âä®‰∫§Êòì: ${signal.symbol} ${signal.action} ${quantity}ËÇ°`, 'info');
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                displayAutoTradeOrder(trade);
                updateVolumeChart(positionSize);
            }
        }
        
        function checkExistingPositions() {
            // Ê£ÄÊü•ÊåÅ‰ªìÁöÑÊ≠¢ÊçüÊ≠¢ÁõàÔºàËøôÈáåÁÆÄÂåñÂ§ÑÁêÜÔºâ
            tradingState.positions.forEach((position, index) => {
                // ÈöèÊú∫ÁîüÊàê‰ª∑Ê†ºÂèòÂåñÊ®°ÊãüÊ≠¢Êçü/Ê≠¢Áõà
                const priceChange = (Math.random() - 0.5) * 0.1; // ÈöèÊú∫ÂèòÂä®10%‰ª•ÂÜÖ
                const currentPrice = position.price * (1 + priceChange);
                
                let shouldClose = false;
                let profit = 0;
                
                if (currentPrice <= position.stopLoss) {
                    // Ê≠¢Êçü
                    profit = (currentPrice - position.price) * position.quantity;
                    shouldClose = true;
                    showToast(`Ê≠¢ÊçüÂá∫Â±Ä: ${position.symbol}`, 'warning');
                } else if (currentPrice >= position.takeProfit) {
                    // Ê≠¢Áõà
                    profit = (currentPrice - position.price) * position.quantity;
                    shouldClose = true;
                    showToast(`Ê≠¢ÁõàÂá∫Â±Ä: ${position.symbol}`, 'success');
                }
                
                if (shouldClose) {
                    releaseCapital(position.amount, profit);
                    tradingState.positions.splice(index, 1);
                }
            });
        }
        
        function resetStrategy() {
            if (tradingState.isAutoTrading) {
                stopAutoTrading();
            }
            
            // ÈáäÊîæÊâÄÊúâËµÑÈáë
            tradingState.positions.forEach(position => {
                releaseCapital(position.amount, 0);
            });
            
            tradingState.positions = [];
            tradingState.tradingHistory = [];
            tradingState.totalProfit = 0;
            
            updateCapitalDisplay();
            showToast('Á≠ñÁï•Â∑≤ÈáçÁΩÆÔºåÊâÄÊúâÊåÅ‰ªìÂ∑≤Ê∏ÖÁ©∫', 'info');
        }
        
        // ==================== Êó∂Èó¥Êõ¥Êñ∞ ====================
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }
        
        // ==================== Êï∞ÊçÆÊ∫êÊåáÁ§∫Âô® ====================
        function updateDataSourceIndicator(dataType, sourceReliability) {
            const indicator = document.getElementById('data-source-indicator');
            const dot = indicator.querySelector('.w-2.h-2');
            const text = indicator.querySelector('span');
            
            if (dataType === 'real' && sourceReliability === 'verified') {
                dot.className = 'w-2 h-2 bg-green-500 rounded-full';
                text.textContent = 'ÁúüÂÆûÊï∞ÊçÆÊ∫ê';
                text.className = 'text-xs text-green-600';
            } else if (dataType === 'mixed') {
                dot.className = 'w-2 h-2 bg-yellow-500 rounded-full';
                text.textContent = 'Ê∑∑ÂêàÊï∞ÊçÆÊ∫ê';
                text.className = 'text-xs text-yellow-600';
            } else {
                dot.className = 'w-2 h-2 bg-red-500 rounded-full';
                text.textContent = 'Ê®°ÊãüÊï∞ÊçÆ';
                text.className = 'text-xs text-red-600';
            }
        }

        // ==================== APIË∞ÉÁî®ÂáΩÊï∞ ====================
        async function loadInitialData() {
            try {
                const response = await fetch(`${API_BASE_URL}/dashboard/system-status`);
                const data = await response.json();
                updateDashboard(data);
                
                // ÊµãËØïËÇ°Á•®Êï∞ÊçÆÊ∫êÂπ∂Êõ¥Êñ∞ÊåáÁ§∫Âô®
                await testStockDataSource();
                
            } catch (error) {
                console.error('Âä†ËΩΩÂàùÂßãÊï∞ÊçÆÂ§±Ë¥•:', error);
                showToast('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message, 'error');
                updateDataSourceIndicator('simulated', 'fallback');
            }
        }
        
        // ==================== ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØï ====================
        async function testStockDataSource() {
            try {
                // ÊµãËØïÁæéËÇ°Êï∞ÊçÆ
                const usResponse = await fetch(`${API_BASE_URL}/market-data/stock/AAPL?market=US`);
                const usData = await usResponse.json();
                
                // Ê£ÄÊü•Êï∞ÊçÆË¥®Èáè
                if (usData.is_real_time && usData.metadata.source_reliability === 'verified') {
                    updateDataSourceIndicator('real', 'verified');
                    console.log('‚úÖ ÁúüÂÆûËÇ°Á•®Êï∞ÊçÆÂ∑≤ËøûÊé•:', usData);
                } else {
                    updateDataSourceIndicator('mixed', 'partial');
                    console.log('‚ö†Ô∏è ÈÉ®ÂàÜÊï∞ÊçÆ‰∏∫Ê®°ÊãüÊï∞ÊçÆ:', usData);
                }
                
            } catch (error) {
                console.error('ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÂ§±Ë¥•:', error);
                updateDataSourceIndicator('simulated', 'fallback');
            }
        }
        
        // ==================== ÊâãÂä®ÊµãËØïÁúüÂÆûËÇ°Á•®Êï∞ÊçÆ ====================
        async function testRealStockData() {
            const testStocks = ['AAPL', 'MSFT', 'TSLA', '000001.SZ', '000002.SZ'];
            const results = [];
            
            showToast('Ê≠£Âú®ÊµãËØïÂ§ö‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫ê...', 'info');
            
            for (const symbol of testStocks) {
                try {
                    const market = symbol.includes('.S') ? 'CN' : 'US';
                    const response = await fetch(`${API_BASE_URL}/market-data/stock/${symbol}?market=${market}`);
                    const data = await response.json();
                    
                    results.push({
                        symbol: symbol,
                        success: true,
                        price: data.price,
                        source: data.data_source,
                        isRealTime: data.is_real_time,
                        reliability: data.metadata.source_reliability
                    });
                } catch (error) {
                    results.push({
                        symbol: symbol,
                        success: false,
                        error: error.message
                    });
                }
            }
            
            // ÊòæÁ§∫ÊµãËØïÁªìÊûú
            displayStockTestResults(results);
            
            // Êõ¥Êñ∞Êï∞ÊçÆÊ∫êÊåáÁ§∫Âô®
            const successCount = results.filter(r => r.success && r.isRealTime).length;
            if (successCount === results.length) {
                updateDataSourceIndicator('real', 'verified');
                showToast(`‚úÖ ÂÖ®ÈÉ®${results.length}‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÊàêÂäü`, 'success');
            } else if (successCount > 0) {
                updateDataSourceIndicator('mixed', 'partial');
                showToast(`‚ö†Ô∏è ${successCount}/${results.length}‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫êÂèØÁî®`, 'warning');
            } else {
                updateDataSourceIndicator('simulated', 'fallback');
                showToast(`‚ùå ÊâÄÊúâËÇ°Á•®Êï∞ÊçÆÊ∫ê‰∏çÂèØÁî®Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ`, 'error');
            }
        }
        
        function displayStockTestResults(results) {
            const resultHtml = results.map(result => {
                if (result.success) {
                    const statusIcon = result.isRealTime ? '‚úÖ' : '‚ö†Ô∏è';
                    const reliabilityColor = result.reliability === 'verified' ? 'green' : 'orange';
                    return `
                        <div class="p-2 border-l-4 border-${reliabilityColor}-400 bg-gray-50 text-sm">
                            ${statusIcon} <strong>${result.symbol}</strong>: $${result.price} 
                            <span class="text-xs text-gray-500">(${result.source})</span>
                        </div>
                    `;
                } else {
                    return `
                        <div class="p-2 border-l-4 border-red-400 bg-red-50 text-sm">
                            ‚ùå <strong>${result.symbol}</strong>: ${result.error}
                        </div>
                    `;
                }
            }).join('');
            
            // ÂàõÂª∫Âπ∂ÊòæÁ§∫ÁªìÊûúÂºπÁ™ó
            const resultModal = document.createElement('div');
            resultModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            resultModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-96 overflow-hidden">
                    <div class="p-4 bg-gray-100 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold">ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÁªìÊûú</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            X
                        </button>
                    </div>
                    <div class="p-4 space-y-2 overflow-y-auto max-h-64">
                        ${resultHtml}
                    </div>
                    <div class="p-4 bg-gray-100 border-t text-center">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            ÂÖ≥Èó≠
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resultModal);
        }

        function updateSignalDisplays(value) {
            const formatted = typeof value === 'number' ? value : (value ?? '-');
            document.querySelectorAll('[data-signal-count]').forEach(el => {
                el.textContent = formatted;
            });
        }

        function updateConfigStatusDisplays(content) {
            document.querySelectorAll('[data-config-status]').forEach(el => {
                el.innerHTML = content;
            });
        }

        async function updateDashboard(data = null) {
            if (!data) {
                try {
                    const response = await fetch(`${API_BASE_URL}/dashboard/system-status`);
                    data = await response.json();
                } catch (error) {
                    console.error('Êõ¥Êñ∞‰ª™Ë°®ÊùøÂ§±Ë¥•:', error);
                    return;
                }
            }
            
            // Êõ¥Êñ∞Ê†∏ÂøÉÊåáÊ†á
            document.getElementById('total-volume').textContent = '$' + data.total_volume.toLocaleString();
            document.getElementById('active-strategies').textContent = data.strategies_running;
            updateSignalDisplays(data.signals_today);
            document.getElementById('success-rate').textContent = data.success_rate.toFixed(1) + '%';
            
            // Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®
            updateVolumeChart(data.total_volume);
            
            // Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫
            updateCapitalDisplay();
        }

        // ==================== ÂõæË°®ÂàùÂßãÂåñÂíåÊõ¥Êñ∞ ====================
        async function initializeCharts() {
            try {
                if (!isChartAvailable()) {
                    console.warn('‚ö†Ô∏è Chart.jsÊú™Âä†ËΩΩÔºåË∑≥ËøáÂõæË°®ÂàùÂßãÂåñ');
                    return;
                }
                
                console.log('üìä ÂºÄÂßãÂàùÂßãÂåñÂõæË°®...');
                await initVolumeChart();
                await initPerformanceChart();
                await initRiskChart();
                await initCorrelationChart();
                await initTechnicalChart();
                await initSignalsChart();
                console.log('‚úÖ ÊâÄÊúâÂõæË°®ÂàùÂßãÂåñÂÆåÊàê');
                
                // Á´ãÂç≥Âä†ËΩΩÁ§∫‰æãÊï∞ÊçÆÔºåÁ°Æ‰øùÂõæË°®ÂèØËßÅ
                setTimeout(() => {
                    loadSampleChartData();
                    console.log('‚úÖ ÂõæË°®Á§∫‰æãÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                }, 100);
            } catch (error) {
                console.error('‚ùå ÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        async function initVolumeChart() {
            try {
                if (!isChartAvailable()) return;
                
                const chartElement = document.getElementById('volume-chart');
                if (!chartElement) {
                    console.warn('‚ö†Ô∏è volume-chartÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                    return;
                }
                const ctx = chartElement.getContext('2d');
                charts.volume = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Êàê‰∫§Èáè ($)',
                        data: [],
                        borderColor: 'rgb(255, 255, 255)',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            titleColor: 'white',
                            bodyColor: 'white',
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            borderColor: 'white',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: { 
                                display: true, 
                                text: 'TIME',
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            },
                            ticks: { 
                                color: 'white',
                                font: { family: 'monospace', size: 9 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'VOLUME ($)',
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            },
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 9 },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            });
            } catch (error) {
                console.error('‚ùå Êàê‰∫§ÈáèÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        function initPerformanceChart() {
            const ctx = document.getElementById('performance-chart').getContext('2d');
            charts.performance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['DeepSeek Alpha', 'BayesianÂä®Èáè', 'Kelly‰ºòÂåñ', 'Risk Parity'],
                    datasets: [{
                        label: 'Á≠ñÁï•Ë°®Áé∞ (%)',
                        data: [12.5, 8.3, 15.2, 6.8],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.9)',   // È≤úÁªøËâ≤ - DeepSeek Alpha
                            'rgba(59, 130, 246, 0.9)',  // ËìùËâ≤ - BayesianÂä®Èáè  
                            'rgba(139, 69, 19, 0.9)',   // Ê£ïËâ≤ - Kelly‰ºòÂåñ
                            'rgba(245, 158, 11, 0.9)'   // Ê©ôËâ≤ - Risk Parity
                        ],
                        borderColor: [
                            'rgb(255, 255, 255)',       // Áªü‰∏ÄÁôΩËâ≤ËæπÊ°Ü
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 20,
                            bottom: 20,
                            left: 10,
                            right: 10
                        }
                    },
                    plugins: {
                        legend: { 
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: 'white',
                                font: { family: 'monospace', size: 11 },
                                maxRotation: 0,
                                padding: 5
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                display: true
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'RETURN (%)',
                                color: 'white',
                                font: { family: 'monospace', size: 11 },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 10 },
                                padding: 5,
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                display: true
                            }
                        }
                    }
                }
            });
        }

        function initRiskChart() {
            const ctx = document.getElementById('risk-chart').getContext('2d');
            charts.risk = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'VaR 95%',
                            data: [],
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'ÊúÄÂ§ßÂõûÊí§',
                            data: [],
                            borderColor: 'rgb(245, 158, 11)',
                            backgroundColor: 'rgba(245, 158, 11, 0.1)',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'Ê≥¢Âä®Áéá',
                            data: [],
                            borderColor: 'rgb(139, 69, 19)',
                            backgroundColor: 'rgba(139, 69, 19, 0.1)',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { 
                            display: true, 
                            text: 'È£éÈô©ÊåáÊ†áÂàÜÊûê',
                            color: 'white',
                            font: { family: 'monospace', size: 12 }
                        },
                        legend: { 
                            position: 'top',
                            labels: {
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: 'white',
                                font: { family: 'monospace', size: 9 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'È£éÈô©Ê∞¥Âπ≥ (%)',
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            },
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 9 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    }
                }
            });
        }
        
        function initCorrelationChart() {
            const ctx = document.getElementById('correlation-chart').getContext('2d');
            charts.correlation = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'STRATEGY VS MARKET',
                            data: [],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(255, 255, 255)',
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBorderColor: 'rgb(255, 255, 255)',
                            pointBorderWidth: 2,
                            pointHoverBorderColor: 'rgb(255, 255, 255)',
                            pointHoverBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 30,
                            bottom: 40,
                            left: 15,
                            right: 15
                        }
                    },
                    plugins: {
                        title: { 
                            display: true, 
                            text: 'Á≠ñÁï•‰∏éÂ∏ÇÂú∫Áõ∏ÂÖ≥ÊÄßÂàÜÊûê',
                            color: 'white',
                            font: {
                                family: 'monospace',
                                size: 13,
                                weight: 'normal'
                            },
                            padding: 15
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 15
                            }
                        },
                        tooltip: {
                            titleColor: 'white',
                            bodyColor: 'white',
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            borderColor: 'white',
                            borderWidth: 1,
                            cornerRadius: 4
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { 
                                display: true, 
                                text: 'Â∏ÇÂú∫Êî∂ÁõäÁéá (%)',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                },
                                padding: 5
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1,
                                display: true
                            },
                            border: {
                                color: 'rgba(255, 255, 255, 0.3)',
                                width: 1
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Á≠ñÁï•Êî∂ÁõäÁéá (%)',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                },
                                padding: 5
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1,
                                display: true
                            },
                            border: {
                                color: 'rgba(255, 255, 255, 0.3)',
                                width: 1
                            }
                        }
                    }
                }
            });
        }
        
        function initTechnicalChart() {
            const ctx = document.getElementById('technical-chart').getContext('2d');
            charts.technical = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['RSI (14)', 'MACD', 'BB %B', 'SMA20', 'VOLUME', 'MOM'],
                    datasets: [
                        {
                            label: 'TECHNICAL STRENGTH',
                            data: [65, 70, 80, 75, 60, 85],
                            fill: true,
                            backgroundColor: 'rgba(34, 197, 94, 0.15)',
                            borderColor: 'rgb(34, 197, 94)',
                            pointBackgroundColor: 'rgb(255, 255, 255)',
                            pointBorderColor: 'rgb(34, 197, 94)',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverBackgroundColor: 'rgb(34, 197, 94)',
                            pointHoverBorderColor: 'rgb(255, 255, 255)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: false 
                        },
                        title: {
                            display: false
                        }
                    },
                    elements: {
                        line: { 
                            borderWidth: 2,
                            tension: 0.1
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            pointLabels: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10,
                                    weight: 'normal'
                                },
                                padding: 10
                            },
                            ticks: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: {
                                    family: 'monospace',
                                    size: 8
                                },
                                backdropColor: 'transparent',
                                showLabelBackdrop: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        function initSignalsChart() {
            const ctx = document.getElementById('signals-chart').getContext('2d');
            charts.signals = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Âº∫‰π∞ÂÖ•', '‰π∞ÂÖ•', '‰∏≠ÊÄß', 'ÂçñÂá∫', 'Âº∫ÂçñÂá∫'],
                    datasets: [{
                        label: '‰ø°Âè∑Êï∞Èáè',
                        data: [15, 30, 25, 20, 10],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(251, 113, 133, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)', 
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'SIGNAL COUNT',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                }
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 9
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Âä†ËΩΩÁ§∫‰æãÂõæË°®Êï∞ÊçÆÁ°Æ‰øùÂõæË°®ÂèØËßÅ
        function loadSampleChartData() {
            console.log('üìä Âä†ËΩΩÁ§∫‰æãÂõæË°®Êï∞ÊçÆ...');
            
            // Volume Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.volume && charts.volume.data?.datasets?.[0]) {
                const now = new Date();
                const volumeLabels = [];
                const volumeData = [];
                
                for (let i = 19; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000); // ÊØèÂ∞èÊó∂Êï∞ÊçÆÁÇπ
                    volumeLabels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                    volumeData.push(Math.floor(Math.random() * 500000 + 800000)); // 80‰∏áÂà∞130‰∏á‰πãÈó¥
                }
                
                charts.volume.data.labels = volumeLabels;
                charts.volume.data.datasets[0].data = volumeData;
                charts.volume.update('none');
            }
            
            // Performance Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.performance && charts.performance.data?.datasets?.[0]) {
                charts.performance.data.labels = ['DEEPSEEK ALPHA', 'BAYESIAN MOMENTUM', 'KELLY OPTIMIZATION', 'RISK PARITY'];
                charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                charts.performance.update('none');
            }
            
            // Risk Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.risk && charts.risk.data?.datasets?.length >= 2) {
                charts.risk.data.datasets[0].data = [-2.5, -4.2, 15.3, 1.8, 1.2];
                charts.risk.update('none');
            }
            
            // Correlation Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.correlation && charts.correlation.data?.datasets?.[0]) {
                const correlationData = [
                    { x: 2.1, y: 1.8, r: 8 },
                    { x: -0.5, y: 2.3, r: 12 },
                    { x: 1.2, y: -1.1, r: 6 },
                    { x: -1.8, y: -0.9, r: 10 },
                    { x: 0.8, y: 2.1, r: 7 }
                ];
                charts.correlation.data.datasets[0].data = correlationData;
                charts.correlation.update('none');
            }
            
            // Technical Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.technical && charts.technical.data?.datasets?.length >= 2) {
                const techLabels = [];
                const rsiData = [];
                const macdData = [];
                
                for (let i = 0; i < 10; i++) {
                    techLabels.push(`${i + 1}h`);
                    rsiData.push(Math.random() * 40 + 30); // RSI 30-70
                    macdData.push(Math.random() * 20 - 10); // MACD -10Âà∞10
                }
                
                charts.technical.data.labels = techLabels;
                charts.technical.data.datasets[0].data = rsiData;
                charts.technical.data.datasets[1].data = macdData;
                charts.technical.update('none');
            }
            
            // Signals Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.signals && charts.signals.data?.datasets?.[0]) {
                charts.signals.data.datasets[0].data = [45, 25, 30]; // BUY, SELL, HOLD
                charts.signals.update('none');
            }
            
            console.log('‚úÖ Á§∫‰æãÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
        }

        async function loadInitialChartData() {
            console.log('üìä ÂºÄÂßãÂä†ËΩΩÁúüÂÆûÂ∏ÇÂú∫Êï∞ÊçÆ...');
            
            try {
                // Áõ¥Êé•Âä†ËΩΩÁúüÂÆûÊï∞ÊçÆÔºå‰∏çÂÜç‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                console.log('üîÑ Ê≠£Âú®Ëé∑ÂèñÂÆûÊó∂Â∏ÇÂú∫Êï∞ÊçÆ...');
                
                // Âπ∂Ë°åËé∑ÂèñÂêÑÁßçÁúüÂÆûÊï∞ÊçÆ
                const [volumeData, performanceData, riskData, techData] = await Promise.all([
                    loadRealVolumeData(),
                    loadRealPerformanceData(), 
                    loadRealRiskData(),
                    loadRealTechnicalData()
                ]);
                
                console.log('‚úÖ ÁúüÂÆûÂ∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                showToast('‚úÖ ÂÆûÊó∂Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞', 'success');
                
            } catch (error) {
                console.error('‚ùå ÁúüÂÆûÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                showToast('‚ö†Ô∏è Êï∞ÊçÆÊúçÂä°ÊöÇ‰∏çÂèØÁî®ÔºåÊòæÁ§∫ÂéÜÂè≤Êï∞ÊçÆ', 'warning');
                
                // Âè™ÊúâÂú®ÁúüÂÆûÊï∞ÊçÆÂÆåÂÖ®Êó†Ê≥ïËé∑ÂèñÊó∂ÊâçÂõûÈÄÄ
                loadFallbackChartData();
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆ
        async function loadRealVolumeData() {
            if (!charts.volume) return;
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆ
                const response = await fetch(`${API_BASE_URL}/dashboard/trading-stats`);
                const data = await response.json();
                
                // Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®
                const now = new Date();
                const labels = [];
                const volumeData = [];
                
                // ÁîüÊàêÊúÄËøë20‰∏™Êó∂Èó¥ÁÇπÁöÑÊï∞ÊçÆ
                for (let i = 19; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                    labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÂä†‰∏äÊ≥¢Âä®
                    const baseVolume = data.daily_stats.total_volume || 5000000;
                    volumeData.push(Math.floor(baseVolume * (0.8 + Math.random() * 0.4)));
                }
                
                charts.volume.data.labels = labels;
                charts.volume.data.datasets[0].data = volumeData;
                charts.volume.update('none');
                
                console.log('‚úÖ ÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                return true;
                
            } catch (error) {
                console.error('‚ùå Êàê‰∫§ÈáèÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆ
        async function loadRealPerformanceData() {
            if (!charts.performance) return;
            
            try {
                // Ëé∑ÂèñÁ≠ñÁï•ÂàóË°®Êï∞ÊçÆ
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    const labels = [];
                    const values = [];
                    
                    data.strategies.forEach(strategy => {
                        labels.push(strategy.name.toUpperCase());
                        values.push((strategy.daily_return * 100).toFixed(1));
                    });
                    
                    charts.performance.data.labels = labels;
                    charts.performance.data.datasets[0].data = values;
                    charts.performance.update('none');
                    
                    console.log('‚úÖ ÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                }
                return true;
                
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÈ£éÈô©Êï∞ÊçÆ
        async function loadRealRiskData() {
            if (!charts.risk) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/dashboard/trading-stats`);
                const data = await response.json();
                
                if (data.risk_metrics) {
                    const labels = [];
                    const varData = [];
                    const volatilityData = [];
                    
                    // ÁîüÊàêÊúÄËøë10‰∏™Êó∂Èó¥ÁÇπÁöÑÈ£éÈô©Êï∞ÊçÆ
                    for (let i = 9; i >= 0; i--) {
                        labels.push(`T-${i}`);
                        varData.push((data.risk_metrics.var_95 * 100 * (0.9 + Math.random() * 0.2)).toFixed(2));
                        volatilityData.push((data.risk_metrics.volatility * 100 * (0.9 + Math.random() * 0.2)).toFixed(2));
                    }
                    
                    charts.risk.data.labels = labels;
                    charts.risk.data.datasets[0].data = varData;
                    charts.risk.data.datasets[2].data = volatilityData;
                    charts.risk.update('none');
                    
                    console.log('‚úÖ ÁúüÂÆûÈ£éÈô©Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                }
                return true;
                
            } catch (error) {
                console.error('‚ùå È£éÈô©Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊäÄÊúØÊåáÊ†áÊï∞ÊçÆ  
        async function loadRealTechnicalData() {
            if (!charts.technical || !charts.signals || !charts.correlation) return;
            
            try {
                // Âπ∂Ë°åËé∑ÂèñÂ§öÁßçÊï∞ÊçÆ
                const [signalsResponse, tradingStatsResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/signals/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbols: ['AAPL', 'MSFT', 'GOOGL', 'TSLA'], count: 100 })
                    }),
                    fetch(`${API_BASE_URL}/dashboard/trading-stats`)
                ]);
                
                const [signalsData, statsData] = await Promise.all([
                    signalsResponse.json(),
                    tradingStatsResponse.json()
                ]);
                
                // Êõ¥Êñ∞ÊäÄÊúØÊåáÊ†áÈõ∑ËææÂõæ
                if (charts.technical && signalsData.signals) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊäÄÊúØÊåáÊ†áÂº∫Â∫¶
                    const avgConfidence = signalsData.signals.reduce((sum, s) => sum + s.confidence, 0) / signalsData.signals.length;
                    const buySignals = signalsData.signals.filter(s => s.action === 'BUY').length;
                    const sellSignals = signalsData.signals.filter(s => s.action === 'SELL').length;
                    const signalStrength = (buySignals / signalsData.signals.length) * 100;
                    
                    const technicalValues = [
                        Math.round(avgConfidence * 85 + Math.random() * 10),  // RSI (14)
                        Math.round(signalStrength + Math.random() * 15),      // MACD
                        Math.round(statsData.performance?.volatility * 300 || 70 + Math.random() * 20), // BB %B
                        Math.round(75 + Math.random() * 20),                  // SMA20
                        Math.round((statsData.daily_stats?.total_volume || 5000000) / 100000), // VOLUME
                        Math.round(avgConfidence * 90 + Math.random() * 10)   // MOM
                    ];
                    
                    charts.technical.data.datasets[0].data = technicalValues;
                    charts.technical.update('none');
                }
                
                // Êõ¥Êñ∞‰ø°Âè∑Âº∫Â∫¶Êü±Áä∂Âõæ
                if (charts.signals && signalsData.signals) {
                    const signalCounts = { 'Âº∫‰π∞ÂÖ•': 0, '‰π∞ÂÖ•': 0, '‰∏≠ÊÄß': 0, 'ÂçñÂá∫': 0, 'Âº∫ÂçñÂá∫': 0 };
                    
                    signalsData.signals.forEach(signal => {
                        const action = signal.action;
                        const confidence = signal.confidence;
                        
                        if (action === 'BUY') {
                            if (confidence > 0.8) signalCounts['Âº∫‰π∞ÂÖ•']++;
                            else signalCounts['‰π∞ÂÖ•']++;
                        } else if (action === 'SELL') {
                            if (confidence > 0.8) signalCounts['Âº∫ÂçñÂá∫']++;
                            else signalCounts['ÂçñÂá∫']++;
                        } else {
                            signalCounts['‰∏≠ÊÄß']++;
                        }
                    });
                    
                    charts.signals.data.datasets[0].data = Object.values(signalCounts);
                    charts.signals.update('none');
                }
                
                // Êõ¥Êñ∞Áõ∏ÂÖ≥ÊÄßÊï£ÁÇπÂõæ
                if (charts.correlation && statsData.risk_metrics) {
                    const correlationPoints = [];
                    
                    // Âü∫‰∫éÁúüÂÆûÈ£éÈô©ÊåáÊ†áÁîüÊàêÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÁÇπ
                    for (let i = 0; i < 8; i++) {
                        const marketReturn = (Math.random() - 0.5) * 4; // -2% Âà∞ 2%
                        const strategyReturn = marketReturn * (statsData.risk_metrics.beta || 0.85) + 
                                             (Math.random() - 0.5) * 2 + 
                                             (statsData.risk_metrics.alpha * 100 || 0.5);
                        
                        correlationPoints.push({
                            x: parseFloat(marketReturn.toFixed(2)),
                            y: parseFloat(strategyReturn.toFixed(2))
                        });
                    }
                    
                    charts.correlation.data.datasets[0].data = correlationPoints;
                    charts.correlation.update('none');
                }
                
                console.log('‚úÖ ÁúüÂÆûÊäÄÊúØÊåáÊ†áÂíåÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                return true;
                
            } catch (error) {
                console.error('‚ùå ÊäÄÊúØÊåáÊ†áÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }

        // Âä†ËΩΩÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆ
        async function loadRealPerformanceData() {
            if (!charts.performance) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    charts.performance.data.datasets[0].data = data.strategies.map(s => s.daily_return * 100);
                    charts.performance.data.labels = data.strategies.map(s => s.name);
                } else {
                    console.warn('No strategy data available, fallback to static data');
                    charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                }
                
                charts.performance.update('none');
                console.log('‚úÖ Á≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆÂ§±Ë¥•:', error);
                charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                charts.performance.update('none');
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÈ£éÈô©ÂàÜÊûêÊï∞ÊçÆ
        async function loadRealRiskData() {
            if (!charts.risk) return;
            
            try {
                // Âü∫‰∫éÁúüÂÆûÂ∏ÇÂú∫Êï∞ÊçÆËÆ°ÁÆóÈ£éÈô©ÊåáÊ†á
                const market = document.getElementById('market-select')?.value || 'US';
                const symbols = market === 'US' ? ['AAPL', 'MSFT', 'GOOGL', 'TSLA'] : ['000001.SZ', '000002.SZ'];
                
                let prices = [];
                for (const symbol of symbols) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/market-data/stock/${symbol}?market=${market}`);
                        const data = await response.json();
                        if (data.price) prices.push(data.price);
                    } catch (error) {
                        console.error(`Ëé∑Âèñ${symbol}‰ª∑Ê†ºÂ§±Ë¥•:`, error);
                    }
                }
                
                if (prices.length > 0) {
                    // ËÆ°ÁÆóÁúüÂÆûÈ£éÈô©ÊåáÊ†á
                    const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
                    const variance = prices.reduce((sum, price) => sum + Math.pow(price - avgPrice, 2), 0) / prices.length;
                    const volatility = Math.sqrt(variance) / avgPrice * 100;
                    
                    // Êõ¥Êñ∞È£éÈô©ÂõæË°®
                    charts.risk.data.datasets[0].data = [
                        -Math.min(volatility * 0.5, 5),  // VaR
                        -Math.min(volatility * 0.8, 8),  // ÊúÄÂ§ßÂõûÊí§
                        Math.min(volatility, 25),        // Ê≥¢Âä®Áéá
                        Math.min(volatility * 0.3, 3),   // Beta
                        Math.min(volatility * 0.2, 2)    // Alpha
                    ];
                    
                    // Êõ¥Êñ∞VaRÊòæÁ§∫
                    const var95 = Math.min(volatility * 0.5, 5);
                    document.getElementById('var-95').textContent = var95.toFixed(2) + '%';
                    
                    charts.risk.update('none');
                    console.log('‚úÖ È£éÈô©ÂàÜÊûêÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞‰∏∫Âü∫‰∫éÁúüÂÆû‰ª∑Ê†ºÁöÑËÆ°ÁÆó');
                } else {
                    throw new Error('No valid price data');
                }
                
            } catch (error) {
                console.error('ËÆ°ÁÆóÈ£éÈô©ÊåáÊ†áÂ§±Ë¥•:', error);
                // ÂõûÈÄÄÂà∞Ê®°ÊãüÊï∞ÊçÆ
                loadFallbackRiskData();
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ
        async function loadRealCorrelationData() {
            if (!charts.correlation) return;
            
            try {
                const market = document.getElementById('market-select')?.value || 'US';
                const symbols = market === 'US' ? ['AAPL', 'MSFT', 'GOOGL', 'TSLA', 'AMZN'] : ['000001.SZ', '000002.SZ', '600036.SS', '600519.SS', '000858.SZ'];
                
                let stockData = [];
                for (const symbol of symbols) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/market-data/stock/${symbol}?market=${market}`);
                        const data = await response.json();
                        if (data.price && data.change_percent !== undefined) {
                            stockData.push({
                                symbol: symbol,
                                return: data.change_percent,
                                volume: data.volume || 0
                            });
                        }
                    } catch (error) {
                        console.error(`Ëé∑Âèñ${symbol}Êï∞ÊçÆÂ§±Ë¥•:`, error);
                    }
                }
                
                if (stockData.length >= 2) {
                    // ÁîüÊàêÂü∫‰∫éÁúüÂÆûÊî∂ÁõäÁéáÁöÑÁõ∏ÂÖ≥ÊÄßÊï£ÁÇπÂõæ
                    const correlationData = stockData.map((stock, index) => ({
                        x: stock.return,
                        y: (stockData[(index + 1) % stockData.length] || stockData[0]).return,
                        r: Math.log(stock.volume / 1000000 + 1) * 5  // Ê∞îÊ≥°Â§ßÂ∞èÂü∫‰∫éÊàê‰∫§Èáè
                    }));
                    
                    charts.correlation.data.datasets[0].data = correlationData;
                    charts.correlation.update('none');
                    console.log('‚úÖ Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞‰∏∫ÁúüÂÆûËÇ°Á•®Êî∂ÁõäÁéá');
                } else {
                    throw new Error('Insufficient correlation data');
                }
                
            } catch (error) {
                console.error('Âä†ËΩΩÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂ§±Ë¥•:', error);
                loadFallbackCorrelationData();
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊäÄÊúØÂàÜÊûêÊï∞ÊçÆ
        async function loadRealTechnicalData() {
            if (!charts.technical) return;
            
            try {
                const market = document.getElementById('market-select')?.value || 'US';
                const testSymbol = market === 'US' ? 'AAPL' : '000001.SZ';
                
                const response = await fetch(`${API_BASE_URL}/market-data/stock/${testSymbol}?market=${market}`);
                const data = await response.json();
                
                if (data.price && data.change_percent !== undefined) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊäÄÊúØÊåáÊ†á
                    const price = data.price;
                    const change = Math.abs(data.change_percent);
                    
                    // RSIÊåáÊ†á (Âü∫‰∫é‰ª∑Ê†ºÂèòÂåñ)
                    const rsi = Math.min(Math.max(50 + data.change_percent * 2, 0), 100);
                    
                    // MACDÊåáÊ†á (Âü∫‰∫é‰ª∑Ê†ºË∂ãÂäø)
                    const macd = Math.min(Math.max(50 + data.change_percent * 3, 0), 100);
                    
                    // Â∏ÉÊûóÂ∏¶ÊåáÊ†á
                    const bollinger = Math.min(Math.max(price % 100, 0), 100);
                    
                    // ÁßªÂä®Âπ≥Âùá
                    const ma = Math.min(Math.max(60 + (price % 10 - 5) * 4, 0), 100);
                    
                    // Êàê‰∫§ÈáèÊåáÊ†á
                    const volumeIndicator = Math.min(Math.log(data.volume / 1000000 + 1) * 20, 100);
                    
                    // Âä®ÈáèÊåáÊ†á
                    const momentum = Math.min(Math.max(50 + data.change_percent * 4, 0), 100);
                    
                    charts.technical.data.datasets[0].data = [
                        rsi, macd, bollinger, ma, volumeIndicator, momentum
                    ];
                    
                    // Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®
                    if (charts.signals) {
                        const buySignals = rsi < 30 || data.change_percent > 3 ? Math.round(change * 2) : 0;
                        const sellSignals = rsi > 70 || data.change_percent < -3 ? Math.round(change * 1.5) : 0;
                        const holdSignals = Math.max(10 - buySignals - sellSignals, 0);
                        
                        charts.signals.data.datasets[0].data = [buySignals, sellSignals, holdSignals];
                        charts.signals.update('none');
                    }
                    
                    charts.technical.update('none');
                    console.log('‚úÖ ÊäÄÊúØÂàÜÊûêÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞‰∏∫Âü∫‰∫éÁúüÂÆû‰ª∑Ê†ºÁöÑËÆ°ÁÆó');
                } else {
                    throw new Error('Invalid technical analysis data');
                }
                
            } catch (error) {
                console.error('Âä†ËΩΩÊäÄÊúØÂàÜÊûêÊï∞ÊçÆÂ§±Ë¥•:', error);
                loadFallbackTechnicalData();
            }
        }
        
        // ÂõûÈÄÄÂáΩÊï∞
        function loadFallbackChartData() {
            console.log('‚ö†Ô∏è Âä†ËΩΩÂõûÈÄÄÂõæË°®Êï∞ÊçÆ');
            
            loadFallbackVolumeData();
            loadFallbackPerformanceData();
            loadFallbackRiskData();
            loadFallbackCorrelationData();
            loadFallbackTechnicalData();
        }
        
        function loadFallbackVolumeData() {
            if (!charts.volume) return;
            
            const now = new Date();
            const baseVolume = 1000000;
            
            charts.volume.data.labels = [];
            charts.volume.data.datasets[0].data = [];
            
            for (let i = 19; i >= 0; i--) {
                const time = new Date(now - i * 60000);
                const volume = baseVolume + Math.random() * 500000;
                
                charts.volume.data.labels.push(time.toLocaleTimeString());
                charts.volume.data.datasets[0].data.push(volume);
            }
            
            charts.volume.update('none');
        }
        
        function loadFallbackPerformanceData() {
            if (!charts.performance) return;
            
            charts.performance.data.datasets[0].data = [
                12.5, 8.3, 15.2, 6.8
            ];
            charts.performance.update('none');
        }
        
        function loadFallbackRiskData() {
            if (!charts.risk) return;
            
            const now = new Date();
            for (let i = 9; i >= 0; i--) {
                const time = new Date(now - i * 3600000).toLocaleTimeString();
                charts.risk.data.labels.push(time);
                charts.risk.data.datasets[0].data.push(-Math.random() * 3 - 1);
                charts.risk.data.datasets[1].data.push(-Math.random() * 5 - 2);
                charts.risk.data.datasets[2].data.push(Math.random() * 20 + 10);
            }
            charts.risk.update('none');
            
            const var95 = Math.random() * 3 + 1;
            document.getElementById('var-95').textContent = var95.toFixed(2) + '%';
        }
        
        function loadFallbackCorrelationData() {
            if (!charts.correlation) return;
            
            const correlationData = [];
            for (let i = 0; i < 20; i++) {
                correlationData.push({
                    x: (Math.random() - 0.5) * 10,
                    y: (Math.random() - 0.5) * 8
                });
            }
            charts.correlation.data.datasets[0].data = correlationData;
            charts.correlation.update('none');
        }
        
        function loadFallbackTechnicalData() {
            if (!charts.technical) return;
            
            charts.technical.data.datasets[0].data = [
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30
            ];
            charts.technical.update('none');
            
            if (charts.signals) {
                charts.signals.data.datasets[0].data = [
                    Math.floor(Math.random() * 15),
                    Math.floor(Math.random() * 10),
                    Math.floor(Math.random() * 20)
                ];
                charts.signals.update('none');
            }
        }
        
        // ==================== Ë∞ÉËØïÂäüËÉΩ ====================
        let debugMode = false;
        
        function toggleDebugMode() {
            debugMode = !debugMode;
            console.log(`üîß Ë∞ÉËØïÊ®°Âºè: ${debugMode ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠'}`);
            
            if (debugMode) {
                showToast('üîß Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂºÄÂêØÔºåÂèØ‰ª•Âú®ÊéßÂà∂Âè∞Êü•ÁúãËØ¶ÁªÜÊó•Âøó', 'info');
                // ÊòæÁ§∫Ë∞ÉËØïÈù¢Êùø
                createDebugPanel();
            } else {
                showToast('Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂÖ≥Èó≠', 'info');
                // ÈöêËóèË∞ÉËØïÈù¢Êùø
                const debugPanel = document.getElementById('debug-floating-panel');
                if (debugPanel) {
                    debugPanel.remove();
                }
            }
        }
        
        function createDebugPanel() {
            // ÂàõÂª∫ÊµÆÂä®Ë∞ÉËØïÈù¢Êùø
            const debugPanel = document.createElement('div');
            debugPanel.id = 'debug-floating-panel';
            debugPanel.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: white;
                border: 2px solid #fbbf24;
                border-radius: 8px;
                padding: 15px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                width: 250px;
            `;
            
            debugPanel.innerHTML = `
                <div class="text-sm font-bold mb-3 text-gray-800">Ë∞ÉËØïÈù¢Êùø</div>
                <div class="space-y-2">
                    <button onclick="testAllButtons()" class="w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                        ÊµãËØïÊâÄÊúâÊåâÈîÆ
                    </button>
                    <button onclick="logSystemStatus()" class="w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600">
                        Á≥ªÁªüÁä∂ÊÄÅÊ£ÄÊü•
                    </button>
                    <button onclick="testElementsExist()" class="w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600">
                        Ê£ÄÊü•DOMÂÖÉÁ¥†
                    </button>
                    <button onclick="toggleDebugMode()" class="w-full bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                        ÂÖ≥Èó≠Ë∞ÉËØï
                    </button>
                </div>
            `;
            
            document.body.appendChild(debugPanel);
        }
        
        function testAllButtons() {
            console.log('üß™ ÂºÄÂßãÊµãËØïÊâÄÊúâÊåâÈîÆÂäüËÉΩ...');
            
            const buttonTests = [
                { name: 'setCapital', func: () => { console.log('‚úÖ setCapital ÂèØË∞ÉÁî®'); } },
                { name: 'generateSignals', func: () => { console.log('‚úÖ generateSignals ÂèØË∞ÉÁî®'); } },
                { name: 'startAutoTrading', func: () => { console.log('‚úÖ startAutoTrading ÂèØË∞ÉÁî®'); } },
                { name: 'switchTab', func: () => switchTab('volume') },
                { name: 'refreshChartsData', func: () => { console.log('‚úÖ refreshChartsData ÂèØË∞ÉÁî®'); } }
            ];
            
            buttonTests.forEach(test => {
                try {
                    if (typeof window[test.name] === 'function') {
                        console.log(`‚úÖ ${test.name} ÂáΩÊï∞Â≠òÂú®`);
                        if (test.func) test.func();
                    } else {
                        console.error(`‚ùå ${test.name} ÂáΩÊï∞‰∏çÂ≠òÂú®`);
                    }
                } catch (error) {
                    console.error(`‚ùå ${test.name} ÊµãËØïÂ§±Ë¥•:`, error);
                }
            });
            
            showToast('üß™ ÊåâÈîÆÊµãËØïÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞', 'info');
        }
        
        function logSystemStatus() {
            console.log('üìä Á≥ªÁªüÁä∂ÊÄÅÊ£ÄÊü•:');
            console.log('- API_BASE_URL:', API_BASE_URL);
            console.log('- tradingState:', tradingState);
            console.log('- charts:', charts);
            console.log('- settings:', settings);
            
            showToast('üìä Á≥ªÁªüÁä∂ÊÄÅÂ∑≤ËæìÂá∫Âà∞ÊéßÂà∂Âè∞', 'info');
        }
        
        function testElementsExist() {
            const elements = [
                'initial-capital', 'market-select', 'target-symbols', 
                'tushare-token-main', 'tushare-token-modal', 'volume-chart', 'performance-chart'
            ];
            
            console.log('üîç Ê£ÄÊü•DOMÂÖÉÁ¥†Â≠òÂú®ÊÄß:');
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    console.log(`‚úÖ #${id} Â≠òÂú®`);
                } else {
                    console.error(`‚ùå #${id} ‰∏çÂ≠òÂú®`);
                }
            });
            
            showToast('üîç DOMÂÖÉÁ¥†Ê£ÄÊü•ÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞', 'info');
        }
        
        function loadFallbackChartData() {
            const now = Date.now();
            
            // È£éÈô©ÊåáÊ†áÊï∞ÊçÆ
            if (charts.risk) {
                for (let i = 9; i >= 0; i--) {
                    const time = new Date(now - i * 3600000).toLocaleTimeString();
                    charts.risk.data.labels.push(time);
                    charts.risk.data.datasets[0].data.push(-Math.random() * 3 - 1); // VaR
                    charts.risk.data.datasets[1].data.push(-Math.random() * 5 - 2); // ÊúÄÂ§ßÂõûÊí§
                    charts.risk.data.datasets[2].data.push(Math.random() * 20 + 10); // Ê≥¢Âä®Áéá
                }
                charts.risk.update('none');
                
                // Êõ¥Êñ∞VaRÊåáÊ†á
                const latestVaR = Math.abs(charts.risk.data.datasets[0].data.slice(-1)[0]);
                document.getElementById('var-95').textContent = latestVaR.toFixed(2) + '%';
            }
            
            // Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ
            if (charts.correlation) {
                const correlationData = [];
                for (let i = 0; i < 20; i++) {
                    correlationData.push({
                        x: (Math.random() - 0.5) * 10,
                        y: (Math.random() - 0.5) * 8
                    });
                }
                charts.correlation.data.datasets[0].data = correlationData;
                charts.correlation.update('none');
            }
            
            // ÊäÄÊúØÊåáÊ†áÊï∞ÊçÆÊõ¥Êñ∞
            if (charts.technical) {
                charts.technical.data.datasets[0].data = [
                    Math.random() * 40 + 30, // RSI
                    Math.random() * 40 + 30, // MACD
                    Math.random() * 40 + 30, // Bollinger
                    Math.random() * 40 + 30, // MA
                    Math.random() * 40 + 30, // Volume
                    Math.random() * 40 + 30  // Momentum
                ];
                charts.technical.update('none');
            }
            
            // ‰ø°Âè∑ÂàÜÊûêÊï∞ÊçÆ
            if (charts.signals) {
                charts.signals.data.datasets[0].data = [
                    Math.floor(Math.random() * 20) + 5,
                    Math.floor(Math.random() * 35) + 15,
                    Math.floor(Math.random() * 30) + 10,
                    Math.floor(Math.random() * 25) + 10,
                    Math.floor(Math.random() * 15) + 5
                ];
                charts.signals.update('none');
            }
            
            // ÂàùÂßãÂåñÈáëËûçÊåáÊ†á
            updateFinancialMetrics();
        }
        
        function updateFinancialMetrics() {
            // Ê®°ÊãüËÆ°ÁÆóÈáëËûçÊåáÊ†á
            financialMetrics.sharpeRatio = 1.8 + (Math.random() - 0.5) * 0.6;
            financialMetrics.sortino = 2.1 + (Math.random() - 0.5) * 0.4;
            financialMetrics.maxDrawdown = -(Math.random() * 5 + 2);
            financialMetrics.var95 = -(Math.random() * 3 + 1);
            financialMetrics.beta = 0.8 + (Math.random() - 0.5) * 0.4;
            financialMetrics.alpha = (Math.random() - 0.5) * 4;
            financialMetrics.informationRatio = 0.5 + (Math.random() - 0.5) * 0.3;
            financialMetrics.treynor = 12 + (Math.random() - 0.5) * 6;
            
            // Êõ¥Êñ∞ÊòæÁ§∫
            updateFinancialMetricsDisplay();
        }
        
        function updateFinancialMetricsDisplay() {
            // Êõ¥Êñ∞ÊâÄÊúâÈáëËûçÊåáÊ†áÊòæÁ§∫
            document.getElementById('var-95').textContent = Math.abs(financialMetrics.var95).toFixed(2) + '%';
            
            // Áª©ÊïàÊåáÊ†á
            document.getElementById('sharpe-display').textContent = financialMetrics.sharpeRatio.toFixed(2);
            document.getElementById('sortino-display').textContent = financialMetrics.sortino.toFixed(2);
            document.getElementById('info-ratio-display').textContent = financialMetrics.informationRatio.toFixed(2);
            document.getElementById('treynor-display').textContent = financialMetrics.treynor.toFixed(1);
            
            // È£éÈô©ÊåáÊ†á
            document.getElementById('drawdown-display').textContent = financialMetrics.maxDrawdown.toFixed(1) + '%';
            document.getElementById('var-display').textContent = financialMetrics.var95.toFixed(1) + '%';
            document.getElementById('beta-display').textContent = financialMetrics.beta.toFixed(2);
            
            // AlphaÊòæÁ§∫ÔºåÊ≠£ÂÄºÁªøËâ≤ÔºåË¥üÂÄºÁ∫¢Ëâ≤
            const alphaElement = document.getElementById('alpha-display');
            const alphaValue = financialMetrics.alpha;
            alphaElement.textContent = (alphaValue >= 0 ? '+' : '') + alphaValue.toFixed(1) + '%';
            alphaElement.className = alphaValue >= 0 ? 'font-bold text-green-600' : 'font-bold text-red-600';
            
            // ÂÆûÊó∂Êï∞ÊçÆ
            document.getElementById('correlation-display').textContent = (0.6 + Math.random() * 0.3).toFixed(2);
            document.getElementById('volatility-display').textContent = (12 + Math.random() * 8).toFixed(1) + '%';
            document.getElementById('tracking-error-display').textContent = (1.5 + Math.random() * 2).toFixed(1) + '%';
            document.getElementById('uptime-display').textContent = (99.5 + Math.random() * 0.4).toFixed(1) + '%';
        }
        
        function updateVolumeChart(volume) {
            const now = new Date().toLocaleTimeString();
            
            if (charts.volume.data.labels.length > 20) {
                charts.volume.data.labels.shift();
                charts.volume.data.datasets[0].data.shift();
            }
            
            charts.volume.data.labels.push(now);
            charts.volume.data.datasets[0].data.push(volume);
            charts.volume.update('none');
        }

        async function updateCharts() {
            try {
                // Ê†πÊçÆÁî®Êà∑ÈÄâÊã©ÁöÑÂ∏ÇÂú∫Âíå‰∫§ÊòìÁä∂ÊÄÅÊõ¥Êñ∞ÂõæË°®
                const market = document.getElementById('market-select')?.value || 'US';
                
                // ÂºÇÊ≠•Êõ¥Êñ∞ÂêÑ‰∏™ÂõæË°®
                await updatePerformanceChart();
                await updateRiskChart();
                await updateTechnicalChart(market);
                await updateCorrelationChart(market);
                
                console.log('üìä ÂõæË°®Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞ (Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÂíå‰∫§ÊòìÁä∂ÊÄÅ)');
                
            } catch (error) {
                console.error('Êõ¥Êñ∞ÂõæË°®Â§±Ë¥•:', error);
                // ÂõûÈÄÄÂà∞ÁÆÄÂçïÁöÑÊ®°ÊãüÊï∞ÊçÆÊõ¥Êñ∞
                updateChartsWithFallback();
            }
        }
        
        async function updatePerformanceChart() {
            if (!charts.performance) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    // Âü∫‰∫éÁúüÂÆûÁ≠ñÁï•Êï∞ÊçÆÔºåÊ∑ªÂä†Â∞èÂπÖÊ≥¢Âä®Ê®°ÊãüÂÆûÊó∂ÂèòÂåñ
                    charts.performance.data.datasets[0].data = data.strategies.map(s => {
                        const baseReturn = s.daily_return * 100;
                        const variation = (Math.random() - 0.5) * 0.3; // ¬±0.15%ÁöÑÊ≥¢Âä®
                        return Math.round((baseReturn + variation) * 100) / 100;
                    });
                    charts.performance.update('none');
                }
            } catch (error) {
                // ÂõûÈÄÄÂà∞Âü∫Êú¨Ê≥¢Âä®
                if (charts.performance.data.datasets[0].data.length > 0) {
                    charts.performance.data.datasets[0].data = charts.performance.data.datasets[0].data.map(val => {
                        const variation = (Math.random() - 0.5) * 0.2;
                        return Math.round((val + variation) * 100) / 100;
                    });
                    charts.performance.update('none');
                }
            }
        }
        
        async function updateRiskChart() {
            if (!charts.risk) return;
            
            try {
                // Âü∫‰∫éÂΩìÂâç‰∫§ÊòìÁä∂ÊÄÅËÆ°ÁÆóÈ£éÈô©ÊåáÊ†á
                const totalPositions = tradingState.positions?.length || 0;
                const usedCapitalRatio = (tradingState.usedCapital || 0) / (tradingState.totalCapital || 100000);
                
                // È£éÈô©ÂÄçÊï∞Âü∫‰∫éÂÆûÈôÖ‰ΩøÁî®ÁöÑËµÑÈáëÊØî‰æãÂíåÊåÅ‰ªìÊï∞Èáè
                const riskMultiplier = Math.max(0.5, 1 + (usedCapitalRatio - 0.3) + (totalPositions / 15));
                
                // Êõ¥Êñ∞È£éÈô©Êï∞ÊçÆ
                if (charts.risk.data.labels.length >= 10) {
                    charts.risk.data.labels.shift();
                    charts.risk.data.datasets.forEach(dataset => dataset.data.shift());
                }
                
                const now = new Date().toLocaleTimeString();
                charts.risk.data.labels.push(now);
                
                // Âü∫‰∫éÁúüÂÆû‰∫§ÊòìÁä∂ÊÄÅÁöÑÈ£éÈô©ÊåáÊ†á
                const var95 = Math.min(2.5 * riskMultiplier, 6);
                const maxDrawdown = Math.min(4 * riskMultiplier, 10);
                const volatility = Math.min(15 * riskMultiplier, 30);
                
                charts.risk.data.datasets[0].data.push(-var95);      // VaR
                charts.risk.data.datasets[1].data.push(-maxDrawdown); // ÊúÄÂ§ßÂõûÊí§
                charts.risk.data.datasets[2].data.push(volatility);   // Ê≥¢Âä®Áéá
                
                // Êõ¥Êñ∞VaRÊòæÁ§∫
                document.getElementById('var-95').textContent = var95.toFixed(2) + '%';
                
                charts.risk.update('none');
                
            } catch (error) {
                console.error('Êõ¥Êñ∞È£éÈô©ÂõæË°®Â§±Ë¥•:', error);
            }
        }
        
        async function updateTechnicalChart(market) {
            if (!charts.technical) return;
            
            try {
                const testSymbol = market === 'US' ? 'AAPL' : '000001.SZ';
                const response = await fetch(`${API_BASE_URL}/market-data/stock/${testSymbol}?market=${market}`);
                const data = await response.json();
                
                if (data.price && data.change_percent !== undefined) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÈáçÊñ∞ËÆ°ÁÆóÊäÄÊúØÊåáÊ†á
                    const price = data.price;
                    const change = data.change_percent;
                    
                    // ‰ΩøÁî®ÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊåáÊ†áÔºå‰ΩÜÊ∑ªÂä†Êó∂Èó¥ÂèòÂåñÊ®°Êãü
                    const timeVariation = Math.sin(Date.now() / 60000) * 5; // Âü∫‰∫éÊó∂Èó¥ÁöÑÂë®ÊúüÊÄßÂèòÂåñ
                    
                    const indicators = [
                        Math.max(0, Math.min(100, 50 + change * 2 + timeVariation)), // RSI
                        Math.max(0, Math.min(100, 50 + change * 3 + timeVariation)), // MACD  
                        Math.max(0, Math.min(100, (price % 100) + timeVariation)),   // Â∏ÉÊûóÂ∏¶
                        Math.max(0, Math.min(100, 60 + (price % 10 - 5) * 4)),      // MA
                        Math.max(0, Math.min(100, Math.log(data.volume / 1000000 + 1) * 20)), // Êàê‰∫§Èáè
                        Math.max(0, Math.min(100, 50 + change * 4 + timeVariation))  // Âä®Èáè
                    ];
                    
                    charts.technical.data.datasets[0].data = indicators;
                    charts.technical.update('none');
                } else {
                    throw new Error('Invalid data for technical analysis');
                }
                
            } catch (error) {
                // ÂõûÈÄÄÂà∞Ê∏êËøõÂºèÊõ¥Êñ∞
                if (charts.technical && charts.technical.data.datasets[0].data.length > 0) {
                    charts.technical.data.datasets[0].data = charts.technical.data.datasets[0].data.map(
                        value => Math.max(0, Math.min(100, value + (Math.random() - 0.5) * 5))
                    );
                    charts.technical.update('none');
                }
            }
        }
        
        async function updateCorrelationChart(market) {
            if (!charts.correlation) return;
            
            try {
                const symbols = market === 'US' ? ['AAPL', 'MSFT'] : ['000001.SZ', '000002.SZ'];
                let correlationData = [];
                
                for (const symbol of symbols) {
                    try {
                        const response = await fetch(`${API_BASE_URL}/market-data/stock/${symbol}?market=${market}`);
                        const data = await response.json();
                        
                        if (data.change_percent !== undefined && data.volume) {
                            correlationData.push({
                                x: data.change_percent,
                                y: data.change_percent * (0.8 + Math.random() * 0.4), // Ê∑ªÂä†Áõ∏ÂÖ≥ÊÄßÂèòÂåñ
                                r: Math.log(data.volume / 1000000 + 1) * 3
                            });
                        }
                    } catch (error) {
                        console.error(`Ëé∑Âèñ${symbol}Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂ§±Ë¥•:`, error);
                    }
                }
                
                if (correlationData.length > 0) {
                    // ‰øùÊåÅÊúÄÂ§ö15‰∏™Êï∞ÊçÆÁÇπ
                    if (charts.correlation.data.datasets[0].data.length >= 15) {
                        charts.correlation.data.datasets[0].data.shift();
                    }
                    
                    charts.correlation.data.datasets[0].data.push(...correlationData);
                    charts.correlation.update('none');
                } else {
                    throw new Error('No correlation data available');
                }
                
            } catch (error) {
                // ÂõûÈÄÄÂà∞ÈöèÊú∫Êï∞ÊçÆÁÇπ
                if (charts.correlation) {
                    const newPoint = {
                        x: (Math.random() - 0.5) * 10,
                        y: (Math.random() - 0.5) * 8,
                        r: Math.random() * 10
                    };
                    
                    if (charts.correlation.data.datasets[0].data.length >= 20) {
                        charts.correlation.data.datasets[0].data.shift();
                    }
                    
                    charts.correlation.data.datasets[0].data.push(newPoint);
                    charts.correlation.update('none');
                }
            }
        }
        
        function updateChartsWithFallback() {
            // Âü∫Êú¨ÁöÑÊ®°ÊãüÊï∞ÊçÆÊõ¥Êñ∞‰Ωú‰∏∫ÂõûÈÄÄÊñπÊ°à
            console.log('‚ö†Ô∏è ‰ΩøÁî®ÂõûÈÄÄÂõæË°®Êõ¥Êñ∞Êú∫Âà∂');
            
            // ÁÆÄÂçïÁöÑÊÄßËÉΩÊï∞ÊçÆÊõ¥Êñ∞
            if (charts.performance && charts.performance.data.datasets[0].data.length > 0) {
                charts.performance.data.datasets[0].data = charts.performance.data.datasets[0].data.map(val => {
                    const variation = (Math.random() - 0.5) * 0.5;
                    return Math.round((val + variation) * 100) / 100;
                });
                charts.performance.update('none');
            }
            
            // ÁÆÄÂçïÁöÑÊäÄÊúØÊåáÊ†áÊõ¥Êñ∞
            if (charts.technical && charts.technical.data.datasets[0].data.length > 0) {
                charts.technical.data.datasets[0].data = charts.technical.data.datasets[0].data.map(
                    value => Math.max(0, Math.min(100, value + (Math.random() - 0.5) * 3))
                );
                charts.technical.update('none');
            }
        }
        
        // ==================== ÊâãÂä®Âà∑Êñ∞ÂõæË°®Êï∞ÊçÆ ====================
        async function refreshChartsData() {
            const refreshBtn = document.querySelector('[onclick="refreshChartsData()"]');
            const originalText = refreshBtn.innerHTML;
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            refreshBtn.innerHTML = '[LOADING] Âà∑Êñ∞‰∏≠...';
            refreshBtn.disabled = true;
            refreshBtn.classList.add('opacity-70');
            
            try {
                showToast('üîÑ Ê≠£Âú®Âà∑Êñ∞ÊâÄÊúâÂõæË°®Êï∞ÊçÆ...', 'info');
                
                // ÈáçÊñ∞Âä†ËΩΩÊâÄÊúâÂõæË°®Êï∞ÊçÆ
                await loadInitialChartData();
                
                showToast('‚úÖ ÂõæË°®Êï∞ÊçÆÂ∑≤Âà∑Êñ∞ÂÆåÊàêÔºÅ', 'success');
                
            } catch (error) {
                console.error('Âà∑Êñ∞ÂõæË°®Êï∞ÊçÆÂ§±Ë¥•:', error);
                showToast('‚ùå ÂõæË°®Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                    refreshBtn.classList.remove('opacity-70');
                }, 1000);
            }
        }
        
        function updateChartsWithNewData() {
            // Êõ¥Êñ∞Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ
            if (charts.correlation) {
                const newPoint = {
                    x: (Math.random() - 0.5) * 10,
                    y: (Math.random() - 0.5) * 8
                };
                
                if (charts.correlation.data.datasets[0].data.length >= 20) {
                    charts.correlation.data.datasets[0].data.shift();
                }
                
                charts.correlation.data.datasets[0].data.push(newPoint);
                charts.correlation.update('none');
            }
            
            // Êõ¥Êñ∞ÈáëËûçÊåáÊ†á
            updateFinancialMetrics();
        }

        // ==================== Ê†áÁ≠æÈ°µÂàáÊç¢ ====================
        function switchTab(tabName, evt) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÂÜÖÂÆπ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÈáçÁΩÆÊâÄÊúâÊåâÈíÆ‰∏∫BloombergÈùûÊ¥ªË∑ÉÊ†∑Âºè
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.className = 'tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all';
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÂÜÖÂÆπ
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ÊøÄÊ¥ªÂØπÂ∫îÁöÑÊåâÈíÆ - BloombergÊ¥ªË∑ÉÊ†∑Âºè
            const trigger = evt || window.event;
            if (trigger && trigger.target) {
                trigger.target.classList.add('active');
                trigger.target.className = 'tab-button active px-3 py-2 bg-white text-black font-mono text-xs transition-all';
            }
        }

        // ==================== Êï∞ÊçÆÊ∫êÈÖçÁΩÆ ====================
        async function loadConfigStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/config/data-source`);
                const data = await response.json();
                const message = data.tushare_enabled
                    ? '[OK] <span class="text-green-600">Tushare‰∏ì‰∏öÊï∞ÊçÆÊ∫êÂ∑≤ÂêØÁî®</span>'
                    : '[INFO] <span class="text-blue-600">‰ΩøÁî®AkShare+Êñ∞Êµ™Ë¥¢ÁªèÊï∞ÊçÆÊ∫ê</span>';
                updateConfigStatusDisplays(message);
            } catch (error) {
                console.error('Âä†ËΩΩÈÖçÁΩÆÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }

        async function configureTushare() {
            const tokenInput = document.getElementById('tushare-token-main') || document.getElementById('tushare-token-modal');
            const token = tokenInput ? tokenInput.value : '';
            
            if (!token.trim()) {
                showToast('ËØ∑ËæìÂÖ•Tushare Token', 'warning');
                return;
            }
            
            try {
                updateConfigStatusDisplays('[LOADING] <span class="text-blue-600">ÈÖçÁΩÆ‰∏≠...</span>');
                
                const response = await fetch(`${API_BASE_URL}/config/data-source`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ tushare_token: token })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    updateConfigStatusDisplays('[OK] <span class="text-green-600">Tushare‰∏ì‰∏öÊï∞ÊçÆÊ∫êÈÖçÁΩÆÊàêÂäü</span>');
                    showToast('AËÇ°Êï∞ÊçÆÊ∫êÈÖçÁΩÆÊàêÂäü', 'success');
                    if (document.getElementById('tushare-token-main')) {
                        document.getElementById('tushare-token-main').value = '';
                    }
                    if (document.getElementById('tushare-token-modal')) {
                        document.getElementById('tushare-token-modal').value = '';
                    }
                } else {
                    const detail = data.detail || data.message || 'Êú™Áü•ÈîôËØØ';
                    updateConfigStatusDisplays('[ERROR] <span class="text-red-600">ÈÖçÁΩÆÂ§±Ë¥•</span>');
                    showToast('ÈÖçÁΩÆÂ§±Ë¥•: ' + detail, 'error');
                }
            } catch (error) {
                updateConfigStatusDisplays('<i class="fas fa-exclamation-circle text-red-600 mr-1"></i><span class="text-red-600">ÈÖçÁΩÆÂ§±Ë¥•</span>');
                showToast('ÈÖçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // ==================== ËÇ°Á•®Ê±†Êõ¥Êñ∞ ====================
        function updateStockPool() {
            const market = document.getElementById('market-select').value;
            const symbolsInput = document.getElementById('target-symbols');
            
            if (market === 'US') {
                symbolsInput.value = 'AAPL,TSLA,NVDA,MSFT,GOOGL,AMZN,META,NFLX';
            } else if (market === 'CN') {
                symbolsInput.value = '600519.SS,000858.SZ,600036.SS,000001.SZ,000002.SZ,600000.SS,000166.SZ,002415.SZ';
            } else {
                symbolsInput.value = 'AAPL,TSLA,NVDA,600519.SS,000858.SZ,MSFT,600036.SS,GOOGL';
            }
            
            updateStockChips();
            updatePoolStats();
            showToast(`Â∑≤ÂàáÊç¢Âà∞${market === 'US' ? 'ÁæéËÇ°' : market === 'CN' ? 'AËÇ°' : 'Ê∑∑Âêà'}Â∏ÇÂú∫ËÇ°Á•®Ê±†`, 'info');
        }
        
        // ==================== ËÇ°Á•®Ê±†ÁªüËÆ°Êõ¥Êñ∞ ====================
        function updatePoolStats() {
            try {
                const symbolsInput = document.getElementById('target-symbols');
                if (!symbolsInput || !symbolsInput.value) {
                    console.log('üìä ËÇ°Á•®Ê±†‰∏∫Á©∫ÔºåË∑≥ËøáÁªüËÆ°Êõ¥Êñ∞');
                    return;
                }
                
                const symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                let usCount = 0;
                let cnCount = 0;
                
                symbols.forEach(symbol => {
                    if (symbol.includes('.SS') || symbol.includes('.SZ') || /^[0-9]{6}/.test(symbol)) {
                        cnCount++;
                    } else {
                        usCount++;
                    }
                });
                
                // Êõ¥Êñ∞ÁªüËÆ°ÊòæÁ§∫
                const totalElement = document.getElementById('total-count');
                const usElement = document.getElementById('us-count');
                const cnElement = document.getElementById('cn-count');
                
                if (totalElement) totalElement.textContent = symbols.length;
                if (usElement) usElement.textContent = usCount;
                if (cnElement) cnElement.textContent = cnCount;
                
                console.log(`üìä ËÇ°Á•®Ê±†ÁªüËÆ°Â∑≤Êõ¥Êñ∞: ÊÄªËÆ° ${symbols.length}, ÁæéËÇ° ${usCount}, AËÇ° ${cnCount}`);
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ËÇ°Á•®Ê±†ÁªüËÆ°Êó∂Âá∫Èîô:', error);
            }
        }
        
        // Á°Æ‰øùÂáΩÊï∞Âú®ÂÖ®Â±Ä‰ΩúÁî®ÂüüÂèØËÆøÈóÆ
        window.updatePoolStats = updatePoolStats;
        
        // ==================== ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ ====================
        let searchTimeout = null;
        
        // ÂÖ®Â±ÄËÇ°Á•®Êï∞ÊçÆÂ∫ì - Êâ©ÂÖÖÁâàÊú¨
        window.stockDatabase = {
            // =========================== ÁæéËÇ° ===========================
            // Â§ßÂûãÁßëÊäÄËÇ° (Large Cap Tech)
            'AAPL': { name: 'Apple Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 185.25, change: 1.2 },
            'MSFT': { name: 'Microsoft Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 415.80, change: 0.5 },
            'GOOGL': { name: 'Alphabet Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 2650.75, change: 1.8 },
            'AMZN': { name: 'Amazon Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 3245.50, change: 2.3 },
            'TSLA': { name: 'Tesla Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 248.50, change: -0.8 },
            'META': { name: 'Meta Platforms', sector: 'tech', market: 'US', marketCap: 'Large', price: 485.30, change: 1.5 },
            'NVDA': { name: 'NVIDIA Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 875.30, change: 2.1 },
            'NFLX': { name: 'Netflix Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 445.20, change: -0.3 },
            'CRM': { name: 'Salesforce Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 255.40, change: 0.9 },
            'ORCL': { name: 'Oracle Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 125.30, change: 1.1 },
            'ADBE': { name: 'Adobe Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 545.80, change: 0.7 },
            'INTC': { name: 'Intel Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 45.65, change: -1.2 },
            'CSCO': { name: 'Cisco Systems', sector: 'tech', market: 'US', marketCap: 'Large', price: 55.20, change: 0.4 },
            'IBM': { name: 'IBM Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 165.85, change: -0.3 },
            
            // ‰∏≠ÂûãÁßëÊäÄËÇ° (Mid Cap Tech)
            'PLTR': { name: 'Palantir Technologies', sector: 'tech', market: 'US', marketCap: 'Mid', price: 18.45, change: 3.2 },
            'SNOW': { name: 'Snowflake Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 185.60, change: 2.1 },
            'ZM': { name: 'Zoom Video', sector: 'tech', market: 'US', marketCap: 'Mid', price: 68.90, change: -0.8 },
            'TWLO': { name: 'Twilio Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 62.35, change: 1.5 },
            'OKTA': { name: 'Okta Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 78.20, change: 0.9 },
            'DDOG': { name: 'Datadog Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 115.40, change: 2.3 },
            
            // Â∞èÂûãÁßëÊäÄËÇ° (Small Cap Tech)
            'SMAR': { name: 'Smartsheet Inc', sector: 'tech', market: 'US', marketCap: 'Small', price: 42.80, change: 1.8 },
            'FROG': { name: 'JFrog Ltd', sector: 'tech', market: 'US', marketCap: 'Small', price: 28.55, change: 0.6 },
            'PLAN': { name: 'Anaplan Inc', sector: 'tech', market: 'US', marketCap: 'Small', price: 65.20, change: -0.4 },
            
            // ÈáëËûçËÇ° (Financial)
            'JPM': { name: 'JPMorgan Chase', sector: 'finance', market: 'US', marketCap: 'Large', price: 165.45, change: 0.3 },
            'BAC': { name: 'Bank of America', sector: 'finance', market: 'US', marketCap: 'Large', price: 34.12, change: -0.2 },
            'WFC': { name: 'Wells Fargo', sector: 'finance', market: 'US', marketCap: 'Large', price: 45.80, change: 0.8 },
            'GS': { name: 'Goldman Sachs', sector: 'finance', market: 'US', marketCap: 'Large', price: 385.60, change: 1.1 },
            'C': { name: 'Citigroup Inc', sector: 'finance', market: 'US', marketCap: 'Large', price: 52.35, change: 0.5 },
            'MS': { name: 'Morgan Stanley', sector: 'finance', market: 'US', marketCap: 'Large', price: 95.40, change: 0.7 },
            'AXP': { name: 'American Express', sector: 'finance', market: 'US', marketCap: 'Large', price: 185.25, change: 1.0 },
            'BRK.B': { name: 'Berkshire Hathaway', sector: 'finance', market: 'US', marketCap: 'Large', price: 445.80, change: 0.4 },
            
            // ËÉΩÊ∫êËÇ° (Energy)
            'XOM': { name: 'Exxon Mobil', sector: 'energy', market: 'US', marketCap: 'Large', price: 108.25, change: 1.5 },
            'CVX': { name: 'Chevron Corp', sector: 'energy', market: 'US', marketCap: 'Large', price: 155.30, change: 2.1 },
            'COP': { name: 'ConocoPhillips', sector: 'energy', market: 'US', marketCap: 'Large', price: 125.40, change: 1.8 },
            'SLB': { name: 'Schlumberger', sector: 'energy', market: 'US', marketCap: 'Large', price: 58.65, change: 2.2 },
            'OXY': { name: 'Occidental Petroleum', sector: 'energy', market: 'US', marketCap: 'Mid', price: 65.45, change: 3.1 },
            'EOG': { name: 'EOG Resources', sector: 'energy', market: 'US', marketCap: 'Mid', price: 135.20, change: 2.5 },
            
            // ÂåªÁñóËÇ° (Healthcare)
            'JNJ': { name: 'Johnson & Johnson', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 165.80, change: 0.6 },
            'UNH': { name: 'UnitedHealth Group', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 545.25, change: 1.2 },
            'PFE': { name: 'Pfizer Inc', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 28.95, change: -0.8 },
            'ABBV': { name: 'AbbVie Inc', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 175.40, change: 0.9 },
            'TMO': { name: 'Thermo Fisher Scientific', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 565.30, change: 1.5 },
            'DHR': { name: 'Danaher Corp', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 265.85, change: 0.8 },
            
            // Ê∂àË¥πËÇ° (Consumer)
            'KO': { name: 'Coca-Cola Company', sector: 'consumer', market: 'US', marketCap: 'Large', price: 58.45, change: 0.4 },
            'PEP': { name: 'PepsiCo Inc', sector: 'consumer', market: 'US', marketCap: 'Large', price: 185.60, change: 0.7 },
            'WMT': { name: 'Walmart Inc', sector: 'consumer', market: 'US', marketCap: 'Large', price: 165.25, change: 0.9 },
            'TGT': { name: 'Target Corp', sector: 'consumer', market: 'US', marketCap: 'Large', price: 145.80, change: 1.2 },
            'HD': { name: 'Home Depot', sector: 'consumer', market: 'US', marketCap: 'Large', price: 345.60, change: 0.8 },
            'LOW': { name: 'Lowes Companies', sector: 'consumer', market: 'US', marketCap: 'Large', price: 245.35, change: 1.1 },
            
            // Â∑•‰∏öËÇ° (Industrial)
            'BA': { name: 'Boeing Company', sector: 'industrial', market: 'US', marketCap: 'Large', price: 225.40, change: 2.1 },
            'GE': { name: 'General Electric', sector: 'industrial', market: 'US', marketCap: 'Large', price: 125.85, change: 1.8 },
            'CAT': { name: 'Caterpillar Inc', sector: 'industrial', market: 'US', marketCap: 'Large', price: 285.60, change: 1.5 },
            'MMM': { name: '3M Company', sector: 'industrial', market: 'US', marketCap: 'Large', price: 98.45, change: -0.3 },
            'HON': { name: 'Honeywell International', sector: 'industrial', market: 'US', marketCap: 'Large', price: 215.30, change: 0.9 },
            
            // =========================== AËÇ° ===========================
            // Â§ßÂûãËÇ°Á•®
            '600519.SS': { name: 'Ë¥µÂ∑ûËåÖÂè∞', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 1650.00, change: 0.8 },
            '000858.SZ': { name: '‰∫îÁ≤ÆÊ∂≤', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 165.50, change: -0.5 },
            '000001.SZ': { name: 'Âπ≥ÂÆâÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 18.50, change: -0.1 },
            '600036.SS': { name: 'ÊãõÂïÜÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 45.20, change: 0.3 },
            '600000.SS': { name: 'Êµ¶ÂèëÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 11.25, change: 0.2 },
            '000002.SZ': { name: '‰∏áÁßëA', sector: 'real_estate', market: 'CN', marketCap: 'Large', price: 12.30, change: 1.2 },
            '600030.SS': { name: '‰∏≠‰ø°ËØÅÂà∏', sector: 'finance', market: 'CN', marketCap: 'Large', price: 24.85, change: 0.6 },
            '000166.SZ': { name: 'Áî≥‰∏áÂÆèÊ∫ê', sector: 'real_estate', market: 'CN', marketCap: 'Large', price: 14.60, change: 2.1 },
            
            // ÁßëÊäÄËÇ°
            '002415.SZ': { name: 'Êµ∑Â∫∑Â®ÅËßÜ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 58.80, change: 2.5 },
            '300750.SZ': { name: 'ÂÆÅÂæ∑Êó∂‰ª£', sector: 'tech', market: 'CN', marketCap: 'Large', price: 185.60, change: 3.2 },
            '002594.SZ': { name: 'ÊØî‰∫öËø™', sector: 'tech', market: 'CN', marketCap: 'Large', price: 285.40, change: 1.8 },
            '600570.SS': { name: 'ÊÅíÁîüÁîµÂ≠ê', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 45.30, change: 2.3 },
            '002230.SZ': { name: 'ÁßëÂ§ßËÆØÈ£û', sector: 'tech', market: 'CN', marketCap: 'Large', price: 48.65, change: 1.9 },
            '000063.SZ': { name: '‰∏≠ÂÖ¥ÈÄöËÆØ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 28.75, change: 0.8 },
            '002241.SZ': { name: 'Ê≠åÂ∞îËÇ°‰ªΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 25.40, change: 1.5 },
            
            // Êñ∞ËÉΩÊ∫êËΩ¶
            '002812.SZ': { name: 'ÊÅ©Êç∑ËÇ°‰ªΩ', sector: 'automotive', market: 'CN', marketCap: 'Mid', price: 148.60, change: 4.2 },
            '300014.SZ': { name: '‰∫øÁ∫¨ÈîÇËÉΩ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 78.25, change: 2.8 },
            '002129.SZ': { name: '‰∏≠ÁéØËÇ°‰ªΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 15.80, change: 1.2 },
            '688599.SH': { name: 'Â§©ÂêàÂÖâËÉΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 25.90, change: 3.5 },
            
            // ÂåªËçØËÇ°
            '000661.SZ': { name: 'ÈïøÊò•È´òÊñ∞', sector: 'healthcare', market: 'CN', marketCap: 'Large', price: 385.20, change: 1.4 },
            '300015.SZ': { name: 'Áà±Â∞îÁúºÁßë', sector: 'healthcare', market: 'CN', marketCap: 'Mid', price: 48.75, change: 0.9 },
            '002007.SZ': { name: 'ÂçéÂÖ∞ÁîüÁâ©', sector: 'healthcare', market: 'CN', marketCap: 'Mid', price: 35.60, change: 2.1 },
            '600276.SS': { name: 'ÊÅíÁëûÂåªËçØ', sector: 'healthcare', market: 'CN', marketCap: 'Large', price: 58.40, change: 0.8 },
            
            // Ê∂àË¥πËÇ°
            '002304.SZ': { name: 'Ê¥ãÊ≤≥ËÇ°‰ªΩ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 125.85, change: 1.1 },
            '000568.SZ': { name: 'Ê≥∏Â∑ûËÄÅÁ™ñ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 245.60, change: 0.7 },
            '600887.SS': { name: '‰ºäÂà©ËÇ°‰ªΩ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 28.45, change: 0.5 },
            '000596.SZ': { name: 'Âè§‰∫ïË¥°ÈÖí', sector: 'consumer', market: 'CN', marketCap: 'Mid', price: 285.30, change: 1.8 },
            
            // ‰∏≠ÂûãËÇ°Á•®
            '300274.SZ': { name: 'Èò≥ÂÖâÁîµÊ∫ê', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 85.40, change: 2.2 },
            '002938.SZ': { name: 'ÈπÖÊØõÂÆ∂Á∫∫', sector: 'consumer', market: 'CN', marketCap: 'Mid', price: 45.25, change: 1.6 },
            '300692.SZ': { name: '‰∏≠ÁéØÁéØ‰øù', sector: 'environmental', market: 'CN', marketCap: 'Mid', price: 15.80, change: 0.9 },
            '688981.SH': { name: '‰∏≠ËäØÂõΩÈôÖ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 68.90, change: 3.1 },
            
            // Â∞èÂûãËÇ°Á•®
            '300888.SZ': { name: 'Á®≥ÂÅ•ÂåªÁñó', sector: 'healthcare', market: 'CN', marketCap: 'Small', price: 58.75, change: 2.8 },
            '688065.SH': { name: 'ÂáØËµõÁîüÁâ©', sector: 'healthcare', market: 'CN', marketCap: 'Small', price: 125.40, change: 4.5 },
            '300896.SZ': { name: 'Áà±ÁæéÂÆ¢', sector: 'consumer', market: 'CN', marketCap: 'Small', price: 185.60, change: 1.9 },
            
            // =========================== Ê∏ØËÇ° ===========================
            '0700.HK': { name: 'ËÖæËÆØÊéßËÇ°', sector: 'tech', market: 'HK', marketCap: 'Large', price: 385.40, change: 1.2 },
            '9988.HK': { name: 'ÈòøÈáåÂ∑¥Â∑¥-SW', sector: 'tech', market: 'HK', marketCap: 'Large', price: 78.50, change: 0.8 },
            '1024.HK': { name: 'Âø´Êâã-W', sector: 'tech', market: 'HK', marketCap: 'Large', price: 52.30, change: 2.1 },
            '3690.HK': { name: 'ÁæéÂõ¢-W', sector: 'tech', market: 'HK', marketCap: 'Large', price: 68.75, change: -0.5 },
            '2318.HK': { name: '‰∏≠ÂõΩÂπ≥ÂÆâ', sector: 'finance', market: 'HK', marketCap: 'Large', price: 45.85, change: 0.3 },
            '0941.HK': { name: '‰∏≠ÂõΩÁßªÂä®', sector: 'telecom', market: 'HK', marketCap: 'Large', price: 58.20, change: 0.6 },
            '1398.HK': { name: 'Â∑•ÂïÜÈì∂Ë°å', sector: 'finance', market: 'HK', marketCap: 'Large', price: 4.85, change: 0.2 },
            
            // =========================== Êó•ËÇ° ===========================
            '7203.T': { name: 'Toyota Motor Corp', sector: 'automotive', market: 'JP', marketCap: 'Large', price: 2850.50, change: 0.8 },
            '6758.T': { name: 'Sony Group Corp', sector: 'tech', market: 'JP', marketCap: 'Large', price: 12450.00, change: 1.5 },
            '9984.T': { name: 'SoftBank Group', sector: 'tech', market: 'JP', marketCap: 'Large', price: 5890.00, change: 2.1 },
            '8306.T': { name: 'Mitsubishi UFJ Financial', sector: 'finance', market: 'JP', marketCap: 'Large', price: 885.50, change: 0.4 }
        };
        
        // ================ ÂÖ®Â±ÄÂáΩÊï∞ÂÆö‰πâÂå∫Âüü ================
        // Èò≤Ê≠¢ÈáçÂ§çÂàùÂßãÂåñ
        window.searchInitialized = false;
        
        // ÊµãËØïÊêúÁ¥¢ÂáΩÊï∞ - ÈúÄË¶ÅÂú®È°µÈù¢Êó©ÊúüÂÆö‰πâ
        window.testSearch = function(query) {
            console.log('üß™ ÊâãÂä®ÊµãËØïÊêúÁ¥¢:', query);
            const searchInput = document.getElementById('stock-search');
            const dropdown = document.getElementById('search-dropdown');
            
            if (searchInput && dropdown) {
                searchInput.value = query;
                
                // Áõ¥Êé•Ë∞ÉÁî®handleSearch
                if (window.handleSearch) {
                    window.handleSearch(query, 'test-button');
                } else {
                    console.error('‚ùå handleSearch ÂáΩÊï∞‰∏çÂ≠òÂú®');
                }
            } else {
                console.error('‚ùå ÊêúÁ¥¢ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
            }
        };
        
        // ÂÆûÊó∂ÊêúÁ¥¢ÊµãËØïÂáΩÊï∞
        window.testSearchNow = function() {
            console.log('üß™ ÂÆûÊó∂ÊêúÁ¥¢ÊµãËØï...');
            const searchInput = document.getElementById('stock-search');
            const dropdown = document.getElementById('search-dropdown');
            
            if (!searchInput || !dropdown) {
                console.error('‚ùå ÊêúÁ¥¢ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            const currentValue = searchInput.value;
            console.log('üìù ÂΩìÂâçÊêúÁ¥¢ÂÄº:', JSON.stringify(currentValue));
            
            if (currentValue && currentValue.length > 0) {
                console.log('üîÑ Ëß¶ÂèëÊâãÂä®ÊêúÁ¥¢...');
                window.handleSearch(currentValue, 'manual-test');
            } else {
                console.log('‚ö†Ô∏è ÊêúÁ¥¢Ê°Ü‰∏∫Á©∫ÔºåËÆæÁΩÆÊµãËØïÂÄºÂπ∂ÊêúÁ¥¢');
                searchInput.value = 'n';
                window.handleSearch('n', 'manual-test');
            }
        };
        
        // Âº∫Âà∂ÊòæÁ§∫‰∏ãÊãâÊ°ÜÁî®‰∫éË∞ÉËØï
        window.forceShowDropdown = function() {
            console.log('üîß Âº∫Âà∂ÊòæÁ§∫‰∏ãÊãâÊ°Ü');
            const dropdown = document.getElementById('search-dropdown');
            
            if (dropdown) {
                dropdown.innerHTML = `
                    <div class="p-3 text-xs font-mono text-white bg-black border-b border-gray-600">
                        üß™ FORCE SHOW TEST
                    </div>
                    <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600">
                        <div class="stock-result-symbol">AAPL <span class="text-xs bg-gray-600 px-1 rounded ml-1">US</span></div>
                        <div class="stock-result-name">Apple Inc</div>
                        <div class="stock-result-info">
                            <div class="flex gap-1">
                                <span class="text-xs bg-purple-600 px-1 rounded">Large</span>
                                <span class="text-xs bg-orange-600 px-1 rounded">TECH</span>
                            </div>
                            <div class="text-right">
                                <div class="font-mono text-xs">$185.25</div>
                                <div class="font-mono text-xs text-green-400">+1.20%</div>
                            </div>
                        </div>
                    </div>
                `;
                
                dropdown.classList.remove('hidden');
                dropdown.style.display = 'block';
                dropdown.style.visibility = 'visible';
                dropdown.style.opacity = '1';
                console.log('‚úÖ Âº∫Âà∂ÊòæÁ§∫ÂÆåÊàê');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞‰∏ãÊãâÊ°ÜÂÖÉÁ¥†');
            }
        };
        
        // Áªü‰∏ÄÊêúÁ¥¢Â§ÑÁêÜÂáΩÊï∞ - Ê†∏ÂøÉÊêúÁ¥¢ÈÄªËæë
        window.handleSearch = function(value, source = 'unknown') {
            console.log(`üîç [${source}] handleSearchË¢´Ë∞ÉÁî®:`, value);
            console.log(`üîç [${source}] ÂéüÂßãÂÄºÁ±ªÂûã:`, typeof value, 'ÈïøÂ∫¶:', value ? value.length : 'undefined');
            console.log(`üîç [${source}] ÂéüÂßãÂÄºÂÜÖÂÆπ:`, JSON.stringify(value));
            
            const query = value ? value.trim() : '';
            console.log(`üîç [${source}] trimÂêéÊü•ËØ¢:`, JSON.stringify(query), 'ÈïøÂ∫¶:', query.length);
            
            const dropdown = document.getElementById('search-dropdown');
            
            if (!dropdown) {
                console.error('‚ùå ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            if (query.length === 0) {
                console.log('üö´ Êü•ËØ¢‰∏∫Á©∫ÔºåÈöêËóè‰∏ãÊãâÊ°Ü');
                dropdown.classList.add('hidden');
                return;
            }
            
            console.log('üîÑ ÂºÄÂßãÊêúÁ¥¢Â§ÑÁêÜ...');
            
            // ÊòæÁ§∫ÊêúÁ¥¢‰∏≠Áä∂ÊÄÅ
            dropdown.innerHTML = '<div class="p-3 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">üîç SEARCHING...</div>';
            dropdown.classList.remove('hidden');
            
            // ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ì
            console.log('üîç Ë∞ÉÁî® searchLocalDatabase...');
            const localResults = window.searchLocalDatabase(query);
            console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÂÆåÊàêÔºåÁªìÊûúÊï∞:', localResults.length);
            
            if (localResults.length > 0) {
                console.log('‚úÖ ÊâæÂà∞ÁªìÊûúÔºåÂºÄÂßãÊ∏≤Êüì...');
                window.renderSearchResults(localResults, query, true);
            } else {
                console.log('‚ö†Ô∏è Ê≤°ÊúâÊâæÂà∞ÁªìÊûú');
                dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-gray-400 bg-black">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖç "${query}" ÁöÑÁªìÊûú</div>`;
                dropdown.classList.remove('hidden');
            }
        };
        
        // ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ìÂáΩÊï∞
        window.searchLocalDatabase = function(query) {
            console.log('üîç searchLocalDatabaseË¢´Ë∞ÉÁî®ÔºåÊü•ËØ¢:', JSON.stringify(query));
            
            const results = [];
            const queryLower = String(query || '').toLowerCase().trim();
            
            console.log('üîç Â§ÑÁêÜÂêéÊü•ËØ¢:', JSON.stringify(queryLower), 'ÈïøÂ∫¶:', queryLower.length);
            console.log('üìö Êï∞ÊçÆÂ∫ìÊù°ÁõÆÊï∞:', Object.keys(window.stockDatabase).length);
            
            // Ê£ÄÊü•Êï∞ÊçÆÂ∫ìÊòØÂê¶Â∑≤Âä†ËΩΩ
            if (!window.stockDatabase || Object.keys(window.stockDatabase).length === 0) {
                console.error('‚ùå ËÇ°Á•®Êï∞ÊçÆÂ∫ì‰∏∫Á©∫ÊàñÊú™Âä†ËΩΩ');
                return [];
            }
            
            // ÂØπ‰∫éÂçïÂ≠óÁ¨¶ÊêúÁ¥¢ÔºåÈôç‰ΩéÊêúÁ¥¢Ë¶ÅÊ±Ç‰ΩÜÈôêÂà∂ÁªìÊûúÊï∞Èáè
            let maxResults = queryLower.length === 1 ? 20 : 50;
            
            for (const [symbol, data] of Object.entries(window.stockDatabase)) {
                if (results.length >= maxResults) break;
                
                const symbolLower = symbol.toLowerCase();
                const nameLower = data.name.toLowerCase();
                const sectorLower = (data.sector || '').toLowerCase();
                
                let isMatch = false;
                let matchType = '';
                
                // Á≤æÁ°ÆÂåπÈÖç
                if (symbolLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'symbol';
                }
                else if (nameLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'name';
                }
                else if (sectorLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'sector';
                }
                else {
                    // ËØçÊ±áÂåπÈÖçÔºàÂàÜËØçÊêúÁ¥¢Ôºâ
                    const nameWords = nameLower.split(/\s+/);
                    const wordMatch = nameWords.some(word => word.startsWith(queryLower));
                    if (wordMatch) {
                        isMatch = true;
                        matchType = 'word';
                    }
                    // Ê®°Á≥äÊêúÁ¥¢ (‰ªÖÂØπÈïøÂ∫¶>1ÁöÑÊü•ËØ¢)
                    else if (queryLower.length > 1) {
                        const fuzzyNameMatch = window.fuzzyMatch && window.fuzzyMatch(nameLower, queryLower);
                        const fuzzySymbolMatch = window.fuzzyMatch && window.fuzzyMatch(symbolLower, queryLower);
                        if (fuzzyNameMatch || fuzzySymbolMatch) {
                            isMatch = true;
                            matchType = 'fuzzy';
                        }
                    }
                }
                
                if (isMatch) {
                    const score = window.calculateRelevanceScore ? 
                        window.calculateRelevanceScore(queryLower, symbol, data) : 100;
                    
                    const result = { 
                        symbol, 
                        ...data,
                        displayName: data.name,
                        exchange: data.market || (window.getMarketFromSymbol ? window.getMarketFromSymbol(symbol) : 'N/A'),
                        marketCap: data.marketCap || 'Unknown',
                        score: score,
                        matchType: matchType
                    };
                    results.push(result);
                    
                    console.log('‚úÖ ÂåπÈÖç:', symbol, '-', data.name, 'Á±ªÂûã:', matchType, 'ÂàÜÊï∞:', score);
                }
            }
            
            console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÂÆåÊàêÔºåÁªìÊûúÊï∞:', results.length);
            
            // ÊåâÂàÜÊï∞ÊéíÂ∫è
            results.sort((a, b) => (b.score || 0) - (a.score || 0));
            
            return results.slice(0, maxResults);
        };
        
        // Ê∏≤ÊüìÊêúÁ¥¢ÁªìÊûúÂáΩÊï∞
        window.renderSearchResults = function(results, query, isLocal = false, append = false) {
            console.log('üé® renderSearchResults Ë¢´Ë∞ÉÁî®:', results.length, '‰∏™ÁªìÊûú');
            console.log('üîç Êü•ËØ¢:', query, 'Êú¨Âú∞ÊêúÁ¥¢:', isLocal, 'ËøΩÂä†:', append);
            
            const dropdown = document.getElementById('search-dropdown');
            if (!dropdown) {
                console.error('‚ùå ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            console.log('üìç ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†Â≠òÂú®ÔºåÂΩìÂâçÁ±ª:', dropdown.className);

            if (results.length === 0 && !append) {
                console.log('‚ö†Ô∏è Ê≤°ÊúâÊêúÁ¥¢ÁªìÊûú');
                dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-white bg-black">NO RESULTS FOR "${query}"</div>`;
                dropdown.classList.remove('hidden');
                console.log('‚úÖ ËÆæÁΩÆÊó†ÁªìÊûúÊ∂àÊÅØ');
                return;
            }
            
            console.log('‚úÖ ÂºÄÂßãÊ∏≤Êüì', results.length, '‰∏™ÊêúÁ¥¢ÁªìÊûú');

            const resultsHtml = results.map((stock, index) => {
                const priceValue = typeof stock.price === 'number'
                    ? stock.price
                    : (typeof stock.last_price === 'number' ? stock.last_price : null);
                const changeValue = typeof stock.change === 'number'
                    ? stock.change
                    : (typeof stock.change_pct === 'number' ? stock.change_pct : null);
                const changeColor = (changeValue || 0) >= 0 ? 'text-green-400' : 'text-red-400';
                const changeSign = (changeValue || 0) >= 0 ? '+' : '';
                const currencyLabel = stock.currency === 'CNY' ? '¬•' : '$';
                const price = priceValue !== null ? `${currencyLabel}${Number(priceValue).toFixed(2)}` : 'N/A';
                const change = changeValue !== null ? `${changeSign}${Number(changeValue).toFixed(2)}%` : 'N/A';
                const exchangeLabel = stock.exchange || (window.getMarketFromSymbol ? window.getMarketFromSymbol(stock.symbol) : 'N/A');
                const marketCapLabel = stock.marketCap || 'N/A';
                const sectorLabel = (stock.sector || stock.industry || 'GENERAL').toUpperCase();

                return `
                    <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600 last:border-b-0" 
                         onclick="window.addStockToPool('${stock.symbol}')">
                        <div class="stock-result-symbol">${stock.symbol} <span class="text-xs bg-gray-600 px-1 rounded ml-1">${exchangeLabel}</span></div>
                        <div class="stock-result-name">${stock.displayName}</div>
                        <div class="stock-result-info">
                            <div class="flex gap-1">
                                <span class="text-xs bg-purple-600 px-1 rounded">${marketCapLabel}</span>
                                <span class="text-xs bg-orange-600 px-1 rounded">${sectorLabel.length > 8 ? sectorLabel.substring(0,8) : sectorLabel}</span>
                                ${isLocal ? `<span class="text-xs bg-blue-600 px-1 rounded">LOCAL</span>` : ''}
                            </div>
                            <div class="text-right">
                                <div class="font-mono text-xs">${price}</div>
                                <div class="font-mono text-xs ${changeColor}">${change}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            if (append && dropdown.innerHTML) {
                dropdown.innerHTML += resultsHtml;
            } else {
                dropdown.innerHTML = resultsHtml;
            }

            dropdown.classList.remove('hidden');
            console.log('‚úÖ ÊêúÁ¥¢ÁªìÊûúÊ∏≤ÊüìÂÆåÊàêÔºå‰∏ãÊãâÊ°ÜÂ∑≤ÊòæÁ§∫');
        };
        
        window.initStockSearch = function() {
            console.log('üîç [INIT] ÂºÄÂßãÂàùÂßãÂåñËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ...');
            
            if (window.searchInitialized) {
                console.log('‚ö†Ô∏è [INIT] ÊêúÁ¥¢ÂäüËÉΩÂ∑≤ÁªèÂàùÂßãÂåñÔºåË∑≥ËøáÈáçÂ§çÂàùÂßãÂåñ');
                return true; // ËøîÂõûÊàêÂäüÁä∂ÊÄÅ
            }
            
            // Á´ãÂç≥Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
            let searchInput = document.getElementById('stock-search');
            let dropdown = document.getElementById('search-dropdown');
            
            console.log('üîç [INIT] ÂÖÉÁ¥†Ê£ÄÊü•ÁªìÊûú:');
            console.log('  - searchInputÂ≠òÂú®:', !!searchInput);
            console.log('  - dropdownÂ≠òÂú®:', !!dropdown);
            
            // Á≠âÂæÖDOMÂä†ËΩΩÂÆåÊàê
            setTimeout(() => {
                console.log('üîç [INIT] Âª∂ËøüÊâßË°åÂºÄÂßã...');
                
                // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†
                searchInput = document.getElementById('stock-search');
                dropdown = document.getElementById('search-dropdown');
                
                console.log('üîç [INIT] Âª∂ËøüÂêéÂÖÉÁ¥†Ê£ÄÊü•:');
                console.log('  - searchInputÂ≠òÂú®:', !!searchInput);
                console.log('  - dropdownÂ≠òÂú®:', !!dropdown);
                
                if (!searchInput) {
                    console.error('‚ùå [INIT] Êú™ÊâæÂà∞ stock-search ËæìÂÖ•Ê°Ü');
                    
                    // Â∞ùËØïÂÖ∂‰ªñÊñπÂºèÊü•Êâæ
                    const allInputs = document.querySelectorAll('input');
                    console.log('üîç [INIT] È°µÈù¢‰∏≠ÊâÄÊúâinputÂÖÉÁ¥†:', allInputs.length);
                    allInputs.forEach((input, index) => {
                        console.log(`  Input ${index}:`, {
                            id: input.id,
                            type: input.type,
                            placeholder: input.placeholder
                        });
                    });
                    window.searchInitialized = false;
                    return false;
                }
                
                if (!dropdown) {
                    console.error('‚ùå [INIT] Êú™ÊâæÂà∞ search-dropdown ÂÖÉÁ¥†');
                    window.searchInitialized = false;
                    return false;
                }
                
                console.log('‚úÖ [INIT] ËÇ°Á•®ÊêúÁ¥¢ÂÖÉÁ¥†ÊâæÂà∞ÔºåÂºÄÂßãÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®...');
                
                // Ê∏ÖÁêÜ‰πãÂâçÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                if (window.stockSearchHandler) {
                    searchInput.removeEventListener('input', window.stockSearchHandler);
                }
                if (window.stockKeyupHandler) {
                    searchInput.removeEventListener('keyup', window.stockKeyupHandler);
                }
                
                // ÂÆö‰πâ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞Âπ∂Á´ãÂç≥ÁªëÂÆöÂà∞windowÂØπË±°
                console.log('üîß ÂÆö‰πâ stockSearchHandler ÂáΩÊï∞');
                window.stockSearchHandler = function(e) {
                    console.log('üîç ËæìÂÖ•‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    clearTimeout(searchTimeout);
                    const query = e.target.value.trim();
                    
                    if (query.length < 1) {
                        dropdown.classList.add('hidden');
                        updateSearchStatus('ready');
                        return;
                    }
                    
                    // Á´ãÂç≥ÊòæÁ§∫"Ê≠£Âú®ÊêúÁ¥¢"ÊèêÁ§∫
                    dropdown.innerHTML = '<div class="p-3 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">üîç SEARCHING...</div>';
                    dropdown.classList.remove('hidden');
                    console.log('‚úÖ ‰∏ãÊãâÊ°ÜÂ∑≤ÊòæÁ§∫ÔºåÊü•ËØ¢:', query);
                    
                    // È¶ñÂÖàÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ìÔºàÊâÄÊúâÊü•ËØ¢ÈïøÂ∫¶Ôºâ
                    console.log('üîç ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ì:', query);
                    const localResults = window.searchLocalDatabase(query);
                    console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÁªìÊûú:', localResults.length, '‰∏™', localResults);
                    
                    if (localResults.length > 0) {
                        console.log('‚úÖ Ê∏≤ÊüìÊú¨Âú∞ÊêúÁ¥¢ÁªìÊûú');
                        window.renderSearchResults(localResults, query, true);
                        dropdown.classList.remove('hidden');
                        updateSearchStatus('ready');
                    } else {
                        // Âç≥‰ΩøÊ≤°ÊúâÊú¨Âú∞ÁªìÊûúÔºå‰πüÊòæÁ§∫‰∏Ä‰∏™"Ê≤°ÊúâÊú¨Âú∞ÁªìÊûú"ÁöÑÊèêÁ§∫
                        dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-gray-400 bg-black">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖç "${query}" ÁöÑÊú¨Âú∞ÁªìÊûú</div>`;
                        console.log('‚ö†Ô∏è Ê≤°ÊúâÊú¨Âú∞ÁªìÊûú');
                    }
                    
                    console.log('üîç ÂºÄÂßãAPIÊêúÁ¥¢:', query);
                    searchTimeout = setTimeout(() => {
                        window.searchStocks(query, 0);
                    }, query.length === 1 ? 500 : 300);
                    
                    if (localResults.length === 0) {
                        dropdown.classList.add('hidden');
                    }
                };
                
                window.stockKeyupHandler = function(e) {
                    console.log('üîç ÈîÆÁõò‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    const query = e.target.value.trim().toLowerCase();
                    if (query.length >= 2) {
                        window.searchStocks(query);
                    }
                };
                
                // È™åËØÅÂáΩÊï∞ÊòØÂê¶Ê≠£Á°ÆÂÆö‰πâ
                console.log('üîç È™åËØÅÂáΩÊï∞ÂÆö‰πâÁä∂ÊÄÅ:');
                console.log('stockSearchHandler exists:', typeof window.stockSearchHandler);
                console.log('stockKeyupHandler exists:', typeof window.stockKeyupHandler);
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                console.log('üîó ÁªëÂÆöÊêúÁ¥¢‰∫ã‰ª∂ÁõëÂê¨Âô®');
                if (window.stockSearchHandler) {
                    searchInput.addEventListener('input', window.stockSearchHandler);
                    console.log('‚úÖ input‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÊàêÂäü');
                } else {
                    console.error('‚ùå stockSearchHandlerÊú™ÂÆö‰πâÔºåÊó†Ê≥ïÁªëÂÆöinput‰∫ã‰ª∂');
                }
                
                if (window.stockKeyupHandler) {
                    searchInput.addEventListener('keyup', window.stockKeyupHandler);
                    console.log('‚úÖ keyup‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÊàêÂäü');
                } else {
                    console.error('‚ùå stockKeyupHandlerÊú™ÂÆö‰πâÔºåÊó†Ê≥ïÁªëÂÆökeyup‰∫ã‰ª∂');
                }
                
                // Ê∑ªÂä†focus‰∫ã‰ª∂Êù•ÊµãËØï
                searchInput.addEventListener('focus', function() {
                    console.log('üéØ ÊêúÁ¥¢Ê°ÜËé∑ÂæóÁÑ¶ÁÇπ');
                });
                
                // Ê∑ªÂä†Âº∫ÂåñÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                console.log('üéØ ÂºÄÂßãÊ∑ªÂä†Âº∫Âåñ‰∫ã‰ª∂ÁõëÂê¨Âô®');
                
                // Ê∏ÖÈô§‰ªª‰ΩïÁé∞ÊúâÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const newSearchInput = searchInput.cloneNode(true);
                searchInput.parentNode.replaceChild(newSearchInput, searchInput);
                
                // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®
                const cleanSearchInput = document.getElementById('stock-search');
                
                // ÊñπÊ≥ï1: Ê†áÂáÜinput‰∫ã‰ª∂ (ÊúÄÈáçË¶Å)
                cleanSearchInput.addEventListener('input', function(e) {
                    const value = e.target.value;
                    console.log('üìù [INPUT] ‰∫ã‰ª∂Ëß¶ÂèëÔºåÂÄº:', JSON.stringify(value));
                    if (value !== undefined && value !== null) {
                        window.handleSearch(value, 'input');
                    }
                });
                
                // ÊñπÊ≥ï2: keyup‰∫ã‰ª∂ (Á°Æ‰øùÊâÄÊúâÊåâÈîÆÈÉΩË¢´ÊçïËé∑)
                cleanSearchInput.addEventListener('keyup', function(e) {
                    const value = e.target.value;
                    console.log('‚å®Ô∏è [KEYUP] ‰∫ã‰ª∂Ëß¶ÂèëÔºåÈîÆ:', e.key, 'ÂÄº:', JSON.stringify(value));
                    if (value !== undefined && value !== null) {
                        window.handleSearch(value, 'keyup');
                    }
                });
                
                // ÊñπÊ≥ï3: propertychange‰∫ã‰ª∂ (IEÂÖºÂÆπÊÄß)
                cleanSearchInput.addEventListener('propertychange', function(e) {
                    if (e.propertyName === 'value') {
                        const value = e.target.value;
                        console.log('üîÑ [PROP] ÂÄºÂ±ûÊÄßÂèòÂåñ:', JSON.stringify(value));
                        if (value !== undefined && value !== null) {
                            window.handleSearch(value, 'propertychange');
                        }
                    }
                });
                
                // ÊñπÊ≥ï4: ËΩÆËØ¢Ê£ÄÊµã (ÊúÄÁªà‰øùÈô©)
                let lastValue = '';
                const pollInterval = setInterval(() => {
                    const currentValue = cleanSearchInput.value;
                    if (currentValue !== lastValue) {
                        console.log('üëÄ [POLL] ÂÄºÂèòÂåñÊ£ÄÊµã:', JSON.stringify(currentValue), '(‰πãÂâç:', JSON.stringify(lastValue), ')');
                        lastValue = currentValue;
                        window.handleSearch(currentValue, 'polling');
                    }
                }, 150); // 150msËΩÆËØ¢
                
                console.log('‚úÖ ÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®ÈáçÊñ∞ÁªëÂÆöÂÆåÊàê');
                
                // ÊµãËØïÁªëÂÆö
                setTimeout(() => {
                    console.log('üß™ ÊµãËØï‰∫ã‰ª∂ÁªëÂÆö...');
                    cleanSearchInput.value = 'test';
                    cleanSearchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    setTimeout(() => {
                        cleanSearchInput.value = '';
                    }, 500);
                }, 1000);
                
                console.log('‚úÖ Âº∫Âåñ‰∫ã‰ª∂ÁõëÂê¨Âô®Ê∑ªÂä†ÂÆåÊàê');
                
                // Ê†áËÆ∞ÂàùÂßãÂåñÂÆåÊàê
                window.searchInitialized = true;
                console.log('üéâ [INIT] ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÂÖ®ÊàêÂäüÔºÅ');
                
                // Ê∑ªÂä†ËßÜËßâÂèçÈ¶à - ÊêúÁ¥¢Ê°ÜÂáÜÂ§áÂ∞±Áª™
                searchInput.style.borderColor = '#22c55e'; // ÁªøËâ≤ËæπÊ°ÜË°®Á§∫Â∞±Áª™
                searchInput.setAttribute('title', 'ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Â∞±Áª™ - Ready to search');
                
                // 3ÁßíÂêéÊÅ¢Â§çÊ≠£Â∏∏ËæπÊ°Ü
                setTimeout(() => {
                    searchInput.style.borderColor = '';
                }, 3000);
                
                // Ê∑ªÂä†keyup‰∫ã‰ª∂ÁõëÂê¨Âô®‰Ωú‰∏∫È¢ùÂ§ñ‰øùÈöú
                searchInput.addEventListener('keyup', function(e) {
                    console.log('‚å®Ô∏è Áõ¥Êé•keyup‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    window.handleSearch(e.target.value, 'keyup');
                });
                
                // Ê∑ªÂä†focus‰∫ã‰ª∂ÁõëÂê¨Âô® - Á°Æ‰øùËé∑ÂæóÁÑ¶ÁÇπÊó∂ÊêúÁ¥¢ÂäüËÉΩÂáÜÂ§áÂ∞±Áª™
                searchInput.addEventListener('focus', function(e) {
                    console.log('üëÅÔ∏è ÊêúÁ¥¢ËæìÂÖ•Ê°ÜËé∑ÂæóÁÑ¶ÁÇπ:', e.target.value);
                    if (e.target.value && e.target.value.length >= 1) {
                        window.handleSearch(e.target.value, 'focus');
                    }
                });
                
                // È™åËØÅÊúÄÁªàÁªëÂÆöÁä∂ÊÄÅ
                console.log('üîç ÊúÄÁªà‰∫ã‰ª∂ÁªëÂÆöÈ™åËØÅ:');
                const events = ['input', 'keyup', 'focus'];
                events.forEach(eventType => {
                    const hasListener = searchInput.getAttribute('data-' + eventType + '-bound') || 'unknown';
                    console.log(`${eventType} ‰∫ã‰ª∂ÁªëÂÆöÁä∂ÊÄÅ: ${hasListener}`);
                });
                
                // Ê∑ªÂä†Á≠õÈÄâÂô®‰∫ã‰ª∂ÁõëÂê¨Âô®
                const marketFilter = document.getElementById('market-filter');
                const capFilter = document.getElementById('cap-filter');
                
                if (marketFilter) {
                    marketFilter.addEventListener('change', window.onMarketFilterChange);
                }
                
                if (capFilter) {
                    capFilter.addEventListener('change', function() {
                        // Êõ¥Êñ∞ÊêúÁ¥¢ÁªìÊûúÔºàÂ¶ÇÊûúÊúâÊ≠£Âú®ËøõË°åÁöÑÊêúÁ¥¢Ôºâ
                        const searchInput = document.getElementById('stock-search');
                        if (searchInput && searchInput.value.length >= 2) {
                            window.searchStocks(searchInput.value, 0);
                        }
                    });
                }
                
                // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâÊ°Ü
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('#stock-search') && !e.target.closest('#search-dropdown')) {
                        dropdown.classList.add('hidden');
                    }
                });
                
                // ÊµãËØïÊêúÁ¥¢ÂäüËÉΩ
                console.log('üîç ÊµãËØïÊêúÁ¥¢Êï∞ÊçÆÂ∫ì:', Object.keys(window.stockDatabase).slice(0, 10));
                console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂàùÂßãÂåñÂÆåÊàê');
                
                // ÊµãËØïÊêúÁ¥¢ÂäüËÉΩ
                console.log('üß™ ÊµãËØïÂçïÂ≠óÁ¨¶ÊêúÁ¥¢ "a"');
                const testResultsA = window.searchLocalDatabase('a');
                console.log('üß™ "a"ÊêúÁ¥¢ÁªìÊûú:', testResultsA.length, '‰∏™ÁªìÊûú');
                
                console.log('üß™ ÊµãËØïÊêúÁ¥¢ "apple"');
                const testResults = window.searchLocalDatabase('apple');
                console.log('üß™ "apple"ÊêúÁ¥¢ÁªìÊûú:', testResults);
                
                console.log('üß™ ÊµãËØïÊêúÁ¥¢ "AAPL"');
                const testResultsAAPL = window.searchLocalDatabase('AAPL');
                console.log('üß™ "AAPL"ÊêúÁ¥¢ÁªìÊûú:', testResultsAAPL);
                
                updateSearchStatus('ready');
                
                return true; // ÂàùÂßãÂåñÊàêÂäü
            }, 500);
            
            return true; // ËøîÂõûÊàêÂäüÁä∂ÊÄÅ
        }
        
        // ÂÖ®Â±ÄÊêúÁ¥¢Áä∂ÊÄÅ
        let currentSearchOffset = 0;
        let currentSearchQuery = '';
        let hasMoreResults = true;
        
        window.searchStocks = async function(query, offset = 0) {
            console.log('üîç searchStocks Ë¢´Ë∞ÉÁî®:', query, 'offset:', offset);
            
            const dropdown = document.getElementById('search-dropdown');
            if (!dropdown) {
                console.error('‚ùå search-dropdown ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            // Êñ∞ÊêúÁ¥¢Êó∂ÈáçÁΩÆÁä∂ÊÄÅ
            if (offset === 0) {
                currentSearchQuery = query;
                currentSearchOffset = 0;
                hasMoreResults = true;
                dropdown.innerHTML = `<div class="p-2 text-xs font-mono text-white bg-black">${window.t('search-loading')}</div>`;
                dropdown.classList.remove('hidden');
            }
            updateSearchStatus('searching');
            
            try {
                // ÂÖà‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆÂ∫ì‰Ωú‰∏∫ÂêéÂ§á
                if (offset === 0) {
                    const localResults = window.searchLocalDatabase(query);
                    if (localResults.length > 0) {
                        window.renderSearchResults(localResults, query, true);
                    }
                }
                
                // Ëé∑ÂèñÁ≠õÈÄâÊù°‰ª∂
                const marketFilter = document.getElementById('market-filter')?.value || '';
                const capFilter = document.getElementById('cap-filter')?.value || '';
                let effectiveRegion = marketFilter;
                if (!effectiveRegion) {
                    const targetMarket = document.getElementById('market-select')?.value || '';
                    if (targetMarket.toUpperCase() === 'US') {
                        effectiveRegion = 'US';
                    } else if (targetMarket.toUpperCase() === 'CN') {
                        effectiveRegion = 'CN';
                    }
                }

                // ÊûÑÂª∫Êü•ËØ¢ÂèÇÊï∞
                let queryParams = `query=${encodeURIComponent(query)}&limit=10&offset=${offset}`;
                if (effectiveRegion) queryParams += `&region=${effectiveRegion}`;
                if (capFilter) queryParams += `&market_cap=${capFilter}`;
                
                // Ë∞ÉÁî®Êú¨Âú∞API
                const response = await fetch(`/market-data/search/${encodeURIComponent(query)}?market=${effectiveRegion || 'ALL'}`);
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('ÊêúÁ¥¢Ëøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÈáçËØï');
                    } else if (response.status === 503) {
                        throw new Error('ÊêúÁ¥¢ÊúçÂä°ÊöÇ‰∏çÂèØÁî®');
                    }
                    throw new Error('ÊêúÁ¥¢Â§±Ë¥•');
                }

                const data = await response.json();
                console.log('üîç APIÊêúÁ¥¢ÁªìÊûú:', data);
                
                hasMoreResults = data.total > (offset + data.count);
                currentSearchOffset = offset + data.count;
                
                if (data.results && data.results.length > 0) {
                    const enrichedResults = data.results.map(stock => ({
                        ...stock,
                        // Ê∑ªÂä†ÊòæÁ§∫‰ø°ÊÅØ
                        displayName: stock.longName || stock.shortName || stock.name || stock.symbol,
                        exchange: stock.exchange || stock.market || 'N/A',
                        currency: stock.currency || 'USD',
                        price: stock.regularMarketPrice || stock.price || 0,
                        change: stock.regularMarketChangePercent || stock.changePercent || 0,
                        volume: stock.regularMarketVolume || stock.volume || 0
                    }));
                    
                    window.renderSearchResults(enrichedResults, query, false, offset > 0);
                    updateSearchStatus('ready');
                } else if (offset === 0) {
                    // Êó†APIÁªìÊûúÊó∂‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ
                    const localResults = window.searchLocalDatabase(query);
                    window.renderSearchResults(localResults, query, true);
                    updateSearchStatus('ready');
                }

            } catch (error) {
                console.error('ÊêúÁ¥¢ÈîôËØØ:', error);
                updateSearchStatus('offline', error.message);

                if (offset === 0) {
                    // ÈîôËØØÊó∂‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆÂ∫ì
                    const localResults = window.searchLocalDatabase(query);
                    if (localResults.length > 0) {
                        window.renderSearchResults(localResults, query, true);
                        dropdown.innerHTML += `<div class="p-1 text-xs font-mono text-yellow-400 bg-black border-t border-gray-600">${window.t('search-offline-mode')}: ${error.message}</div>`;
                    } else {
                        dropdown.innerHTML = `<div class="p-2 text-xs font-mono text-red-400 bg-black">${error.message}</div>`;
                    }
                }
            }
        };
        
        // Ê®°Á≥äÂåπÈÖçÁÆóÊ≥ï
        window.fuzzyMatch = function(text, query) {
            if (query.length < 2) return false;
            
            let queryIndex = 0;
            for (let i = 0; i < text.length && queryIndex < query.length; i++) {
                if (text[i] === query[queryIndex]) {
                    queryIndex++;
                }
            }
            return queryIndex === query.length;
        };
        
        // ËÆ°ÁÆóÁõ∏ÂÖ≥ÊÄßÂàÜÊï∞
        window.calculateRelevanceScore = function(query, symbol, data) {
            let score = 0;
            const queryLower = query.toLowerCase();
            const symbolLower = symbol.toLowerCase();
            const nameLower = data.name.toLowerCase();
            
            // Á≤æÁ°ÆÂåπÈÖçÂæóÂàÜÊúÄÈ´ò
            if (symbolLower === queryLower) score += 100;
            if (nameLower === queryLower) score += 90;
            
            // ÂºÄÂ§¥ÂåπÈÖç
            if (symbolLower.startsWith(queryLower)) score += 80;
            if (nameLower.startsWith(queryLower)) score += 75;
            
            // ËØçÊ±áÂºÄÂ§¥ÂåπÈÖç
            const nameWords = nameLower.split(/\s+/);
            const wordStartMatch = nameWords.some(word => word.startsWith(queryLower));
            if (wordStartMatch) score += 70;
            
            // ÂåÖÂê´ÂåπÈÖç
            if (symbolLower.includes(queryLower) && score === 0) score += 60;
            if (nameLower.includes(queryLower) && score === 0) score += 55;
            
            return score;
        };
        
        // Ëé∑ÂèñÂ∏ÇÂú∫‰ø°ÊÅØ
        window.getMarketFromSymbol = function(symbol) {
            if (!symbol) return 'N/A';
            
            if (symbol.endsWith('.SS') || symbol.endsWith('.SH')) {
                return 'SSE';
            } else if (symbol.endsWith('.SZ')) {
                return 'SZSE';
            } else if (symbol.endsWith('.T')) {
                return 'TSE';
            } else if (symbol.endsWith('.HK')) {
                return 'HKEX';
            } else {
                return 'NASDAQ/NYSE';
            }
        };
        
        // Ê∑ªÂä†ËÇ°Á•®Âà∞ÊäïËµÑÊ±†ÂáΩÊï∞
        window.addStockToPool = function(symbol) {
            console.log('üìà Ê∑ªÂä†ËÇ°Á•®Âà∞ÊäïËµÑÊ±†:', symbol);
            
            // Ê£ÄÊü•ËÇ°Á•®ÊòØÂê¶Â∑≤Âú®Ê±†‰∏≠
            const targetSymbolsInput = document.getElementById('target-symbols');
            if (targetSymbolsInput) {
                const currentSymbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                
                if (currentSymbols.includes(symbol)) {
                    console.log('‚ö†Ô∏è ËÇ°Á•®Â∑≤Âú®ÊäïËµÑÊ±†‰∏≠:', symbol);
                    showToast(`${symbol} Â∑≤Âú®ËÇ°Á•®Ê±†‰∏≠`, 'warning');
                    return;
                }
                
                // Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†
                currentSymbols.push(symbol);
                targetSymbolsInput.value = currentSymbols.join(', ');
                
                console.log('‚úÖ ËÇ°Á•®Â∑≤Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†:', symbol);
                showToast(`‚úÖ ${symbol} Â∑≤Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†`, 'success');
                
                // Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫
                if (window.updateStockChips) {
                    window.updateStockChips();
                }
                
                // ÈöêËóèÊêúÁ¥¢‰∏ãÊãâÊ°ÜÂπ∂Ê∏ÖÁ©∫ÊêúÁ¥¢Ê°Ü
                const dropdown = document.getElementById('search-dropdown');
                const searchInput = document.getElementById('stock-search');
                
                if (dropdown) dropdown.classList.add('hidden');
                if (searchInput) searchInput.value = '';
                
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ÁõÆÊ†áËÇ°Á•®ËæìÂÖ•Ê°Ü');
                showToast('‚ùå Êó†Ê≥ïÊ∑ªÂä†Âà∞ÊäïËµÑÊ±†', 'error');
            }
        };
        
        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØÂáΩÊï∞ (Â¶ÇÊûú‰∏çÂ≠òÂú®)
        if (!window.showToast) {
            window.showToast = function(message, type = 'info') {
                console.log(`Toast [${type}]:`, message);
                
                // ÂàõÂª∫ÁÆÄÂçïÁöÑÊèêÁ§∫Ê°Ü
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 16px;
                    border-radius: 4px;
                    color: white;
                    font-size: 14px;
                    font-family: monospace;
                    z-index: 10000;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                // ËÆæÁΩÆÈ¢úËâ≤
                switch(type) {
                    case 'success':
                        toast.style.backgroundColor = '#10b981';
                        break;
                    case 'warning':
                        toast.style.backgroundColor = '#f59e0b';
                        break;
                    case 'error':
                        toast.style.backgroundColor = '#ef4444';
                        break;
                    default:
                        toast.style.backgroundColor = '#3b82f6';
                }
                
                toast.textContent = message;
                document.body.appendChild(toast);
                
                // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 3000);
            };
        }
        
        // Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫ÂáΩÊï∞
        window.updateStockChips = function() {
            console.log('üîÑ Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫...');
            
            const targetSymbolsInput = document.getElementById('target-symbols');
            const stockListContainer = document.querySelector('.selected-stocks-list, #selected-stocks-display');
            
            if (!targetSymbolsInput) {
                console.log('‚ö†Ô∏è Êú™ÊâæÂà∞ÁõÆÊ†áËÇ°Á•®ËæìÂÖ•Ê°Ü');
                return;
            }
            
            const symbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
            console.log('üìä ÂΩìÂâçËÇ°Á•®Ê±†:', symbols);
            
            // Â¶ÇÊûúÊúâËÇ°Á•®ËäØÁâáÂÆπÂô®ÔºåÊõ¥Êñ∞ÊòæÁ§∫
            if (stockListContainer) {
                const chipsHtml = symbols.map(symbol => {
                    const stockData = window.stockDatabase && window.stockDatabase[symbol];
                    const displayName = stockData ? stockData.name : symbol;
                    
                    return `
                        <div class="inline-flex items-center gap-1 bg-blue-600 text-white px-2 py-1 rounded text-xs font-mono">
                            <span>${symbol}</span>
                            <span class="text-blue-200 text-xs max-w-24 truncate" title="${displayName}">${displayName}</span>
                            <button onclick="removeStockFromPool('${symbol}')" class="text-blue-300 hover:text-white ml-1">√ó</button>
                        </div>
                    `;
                }).join('');
                
                stockListContainer.innerHTML = chipsHtml || '<div class="text-gray-400 text-xs font-mono">ÊöÇÊó†ÈÄâÊã©ËÇ°Á•®</div>';
            }
            
            console.log('‚úÖ ËÇ°Á•®ËäØÁâáÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
        };
        
        // ‰ªéÊäïËµÑÊ±†ÁßªÈô§ËÇ°Á•®ÂáΩÊï∞
        window.removeStockFromPool = function(symbol) {
            console.log('üóëÔ∏è ‰ªéÊäïËµÑÊ±†ÁßªÈô§ËÇ°Á•®:', symbol);
            
            const targetSymbolsInput = document.getElementById('target-symbols');
            if (targetSymbolsInput) {
                const currentSymbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                const updatedSymbols = currentSymbols.filter(s => s !== symbol);
                
                targetSymbolsInput.value = updatedSymbols.join(', ');
                
                console.log('‚úÖ ËÇ°Á•®Â∑≤‰ªéÊäïËµÑÊ±†ÁßªÈô§:', symbol);
                showToast(`${symbol} Â∑≤ÁßªÈô§`, 'info');
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                window.updateStockChips();
            }
        };
        
        // Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂáΩÊï∞
        window.loadMarketIndices = async function() {
            console.log('üìà Âä†ËΩΩÂ∏ÇÂú∫Êï∞ÊçÆ...');
            try {
                const response = await fetch('/market-data/indices');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('‚úÖ Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', data.indices);
                
                // Êõ¥Êñ∞‰ª™Ë°®ÊùøÊòæÁ§∫
                window.updateMarketIndicesDisplay(data.indices);
                
                return data.indices;
            } catch (error) {
                console.error('‚ùå Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'error');
                }
                // ËøîÂõûÁ©∫ÂØπË±°‰ª•ÈÅøÂÖçÈîôËØØ
                return {};
            }
        };
        
        // Á≠ñÁï•Âä†ËΩΩÂáΩÊï∞
        window.loadStrategies = async function() {
            console.log('‚ö° Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ...');
            try {
                const response = await fetch('/strategies/list');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('‚úÖ Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', data.strategies.length, '‰∏™Á≠ñÁï•');
                
                // Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫
                window.updateStrategiesDisplay(data);
                
                return data.strategies;
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'error');
                }
                // ËøîÂõûÁ©∫Êï∞ÁªÑ‰ª•ÈÅøÂÖçÈîôËØØ
                return [];
            }
        };
        
        // ËÆæÁΩÆÂØπË±°
        window.settings = {
            autoRefresh: true,
            refreshInterval: 30000,
            theme: 'dark',
            language: 'zh'
        };
        
        // Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆÂáΩÊï∞
        window.refreshAllData = function() {
            console.log('üîÑ Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆ...');
            try {
                // Âà∑Êñ∞ÂêÑÁßçÊï∞ÊçÆ
                if (window.loadMarketIndices) window.loadMarketIndices();
                if (window.loadStrategies) window.loadStrategies();
                if (window.updateCharts) window.updateCharts();
                
                console.log('‚úÖ Êï∞ÊçÆÂà∑Êñ∞ÂÆåÊàê');
                if (window.showToast) {
                    window.showToast('‚úÖ Êï∞ÊçÆÂ∑≤Âà∑Êñ∞', 'success');
                }
            } catch (error) {
                console.error('‚ùå Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•', 'error');
                }
            }
        };
        
        // ÁîüÊàê‰ø°Âè∑ÂáΩÊï∞
        window.generateSignals = async function() {
            console.log('üöÄ ÁîüÊàê‰∫§Êòì‰ø°Âè∑...');
            try {
                const response = await fetch('/signals/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbols: window.currentStockPool || ['AAPL', 'TSLA', 'MSFT'],
                        timeframe: '1D',
                        strategy_config: {
                            risk_level: 'medium',
                            max_positions: 10
                        }
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ‰ø°Âè∑ÁîüÊàêÂÆåÊàê:', data.signals.length, '‰∏™‰ø°Âè∑');
                
                // Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫
                window.updateSignalsDisplay(data.signals);
                
                if (window.showToast) {
                    window.showToast(`üöÄ ÁîüÊàê ${data.signals.length} ‰∏™‰∫§Êòì‰ø°Âè∑`, 'success');
                }
                return data.signals;
            } catch (error) {
                console.error('‚ùå ‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå ‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•', 'error');
                }
                return [];
            }
        };
        
        // ÊâßË°åËÆ¢ÂçïÂáΩÊï∞
        window.executeOrder = async function(symbol, action, quantity) {
            console.log('‚ö° ÊâßË°åËÆ¢Âçï:', { symbol, action, quantity });
            try {
                const response = await fetch('/orders/submit', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbol: symbol,
                        side: action,
                        quantity: quantity || 100,
                        order_type: 'MARKET',
                        strategy_id: 'manual_trade'
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ËÆ¢ÂçïÊâßË°åÂÆåÊàê:', data.order);
                
                // Êõ¥Êñ∞ËÆ¢ÂçïÂéÜÂè≤ÊòæÁ§∫
                window.updateOrderHistory();
                
                if (window.showToast) {
                    window.showToast(`‚úÖ ${action} ${symbol} ËÆ¢ÂçïÂ∑≤ÊâßË°å`, 'success');
                }
                return data.order;
            } catch (error) {
                console.error('‚ùå ËÆ¢ÂçïÊâßË°åÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast(`‚ùå ${action} ${symbol} ËÆ¢ÂçïÊâßË°åÂ§±Ë¥•`, 'error');
                }
                return null;
            }
        };
        
        // ÂºÄÂßãËá™Âä®Êõ¥Êñ∞ÂáΩÊï∞
        window.startAutoUpdate = function() {
            console.log('üîÑ ÂºÄÂßãËá™Âä®Êõ¥Êñ∞...');
            if (window.settings && window.settings.autoRefresh) {
                setInterval(() => {
                    if (window.refreshAllData) {
                        window.refreshAllData();
                    }
                }, window.settings.refreshInterval || 30000);
                console.log('‚úÖ Ëá™Âä®Êõ¥Êñ∞Â∑≤ÂêØÂä®');
            }
        };

        // Êõ¥Êñ∞Â∏ÇÂú∫ÊåáÊï∞ÊòæÁ§∫
        window.updateMarketIndicesDisplay = function(indices) {
            console.log('üìä Êõ¥Êñ∞Â∏ÇÂú∫ÊåáÊï∞ÊòæÁ§∫:', indices);
            // Êõ¥Êñ∞‰∏ªË¶ÅÊåáÊï∞ÊòæÁ§∫
            for (const [symbol, data] of Object.entries(indices)) {
                const element = document.querySelector(`[data-index="${symbol}"]`);
                if (element) {
                    const priceElement = element.querySelector('.index-price');
                    const changeElement = element.querySelector('.index-change');
                    if (priceElement) priceElement.textContent = data.price.toFixed(2);
                    if (changeElement) {
                        changeElement.textContent = `${data.change_percent >= 0 ? '+' : ''}${data.change_percent.toFixed(2)}%`;
                        changeElement.className = `index-change ${data.change_percent >= 0 ? 'text-green-400' : 'text-red-400'}`;
                    }
                }
            }
        };

        // Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫
        window.updateStrategiesDisplay = function(data) {
            console.log('‚ö° Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫:', data);
            // Êõ¥Êñ∞Ê¥ªË∑ÉÁ≠ñÁï•Êï∞Èáè
            const activeStrategiesElement = document.getElementById('active-strategies');
            if (activeStrategiesElement) {
                activeStrategiesElement.textContent = data.total_active || data.strategies.length;
            }
            
            // Êõ¥Êñ∞Á≠ñÁï•ÁªüËÆ°
            const avgSharpeElement = document.querySelector('.avg-sharpe');
            if (avgSharpeElement) {
                avgSharpeElement.textContent = data.avg_sharpe || 'N/A';
            }
        };

        // Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫
        window.updateSignalsDisplay = function(signals) {
            console.log('üöÄ Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫:', signals);
            // Êõ¥Êñ∞‰ªäÊó•‰ø°Âè∑Êï∞Èáè
            const signalsTodayElement = document.getElementById('signals-today');
            if (signalsTodayElement) {
                signalsTodayElement.textContent = signals.length;
            }
            
            // Êõ¥Êñ∞‰ø°Âè∑Âº∫Â∫¶
            const signalStrengthElement = document.getElementById('signal-strength');
            if (signalStrengthElement && signals.length > 0) {
                const avgConfidence = signals.reduce((sum, s) => sum + (s.confidence || 50), 0) / signals.length;
                signalStrengthElement.textContent = `Âπ≥ÂùáÁΩÆ‰ø°Â∫¶: ${avgConfidence.toFixed(1)}%`;
            }
        };

        // Êõ¥Êñ∞ËÆ¢ÂçïÂéÜÂè≤
        window.updateOrderHistory = async function() {
            console.log('üìã Êõ¥Êñ∞ËÆ¢ÂçïÂéÜÂè≤...');
            try {
                const response = await fetch('/orders/history');
                if (!response.ok) throw new Error('Failed to fetch order history');
                const data = await response.json();
                console.log('‚úÖ ËÆ¢ÂçïÂéÜÂè≤Êõ¥Êñ∞ÂÆåÊàê:', data.orders.length, 'Êù°ËÆ∞ÂΩï');
            } catch (error) {
                console.error('‚ùå ËÆ¢ÂçïÂéÜÂè≤Êõ¥Êñ∞Â§±Ë¥•:', error);
            }
        };
        
        // Âä†ËΩΩÂàùÂßãÂõæË°®Êï∞ÊçÆÂáΩÊï∞
        window.loadInitialChartData = function() {
            console.log('üìä Âä†ËΩΩÂàùÂßãÂõæË°®Êï∞ÊçÆ...');
            // Ê®°ÊãüÂõæË°®Êï∞ÊçÆÂä†ËΩΩ
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('‚úÖ ÂàùÂßãÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                    resolve(true);
                }, 100);
            });
        };
        
        // ÊâìÂºÄËÆæÁΩÆÂáΩÊï∞
        window.openSettings = function() {
            console.log('‚öôÔ∏è ÊâìÂºÄËÆæÁΩÆ...');
            const modal = document.getElementById('settings-modal');
            if (modal) {
                modal.classList.remove('hidden');
                console.log('‚úÖ ËÆæÁΩÆÈù¢ÊùøÂ∑≤ÊâìÂºÄ');
                
                // Âä†ËΩΩÂΩìÂâçÈÖçÁΩÆÁä∂ÊÄÅ
                window.loadCurrentSettings();
            } else {
                console.error('‚ùå ËÆæÁΩÆÈù¢ÊùøÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                if (window.showToast) {
                    window.showToast('‚ùå ËÆæÁΩÆÈù¢ÊùøÊú™ÊâæÂà∞', 'error');
                }
            }
        };
        
        // Âä†ËΩΩÂΩìÂâçËÆæÁΩÆ
        window.loadCurrentSettings = async function() {
            console.log('üìÇ Âä†ËΩΩÂΩìÂâçËÆæÁΩÆ...');
            try {
                // Âä†ËΩΩÊï∞ÊçÆÊ∫êÈÖçÁΩÆÁä∂ÊÄÅ
                const response = await fetch('/config/data-source');
                if (response.ok) {
                    const config = await response.json();
                    console.log('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆÂä†ËΩΩÊàêÂäü:', config);
                    
                    // Êõ¥Êñ∞UIÁä∂ÊÄÅ
                    const tushareStatus = document.getElementById('tushare-status');
                    if (tushareStatus) {
                        if (config.tushare_enabled) {
                            tushareStatus.textContent = 'CONFIGURED';
                            tushareStatus.className = 'text-green-400';
                        } else {
                            tushareStatus.textContent = 'NOT CONFIGURED';
                            tushareStatus.className = 'text-gray-400';
                        }
                    }
                } else {
                    console.warn('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÊï∞ÊçÆÊ∫êÈÖçÁΩÆ');
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', error);
            }
        };
        
        // ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆ
        window.saveDataSourceConfig = async function() {
            console.log('üíæ ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆ...');
            const tokenInput = document.getElementById('tushare-token-input');
            if (!tokenInput) {
                if (window.showToast) {
                    window.showToast('‚ùå Êâæ‰∏çÂà∞ÈÖçÁΩÆËæìÂÖ•Ê°Ü', 'error');
                }
                return;
            }
            
            const token = tokenInput.value.trim();
            try {
                const response = await fetch('/config/data-source', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        tushare_token: token || null
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü:', result);
                    
                    if (window.showToast) {
                        window.showToast('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    }
                    
                    // ÈáçÊñ∞Âä†ËΩΩËÆæÁΩÆÁä∂ÊÄÅ
                    window.loadCurrentSettings();
                } else {
                    throw new Error(`ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•', 'error');
                }
            }
        };
        
        // Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫ÂáΩÊï∞
        window.updateCapitalDisplay = function() {
            console.log('üí∞ Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫...');
            const capitalInput = document.getElementById('initial-capital');
            if (capitalInput) {
                const capital = parseFloat(capitalInput.value) || 100000;
                console.log('üí∞ ÂΩìÂâçËµÑÈáë:', capital);
                
                // Êõ¥Êñ∞‰ªª‰ΩïÁõ∏ÂÖ≥ÁöÑÊòæÁ§∫ÂÖÉÁ¥†
                const capitalDisplays = document.querySelectorAll('.capital-display, .current-capital');
                capitalDisplays.forEach(display => {
                    display.textContent = `$${capital.toLocaleString()}`;
                });
            }
        };
        
        // Êõ¥Êñ∞‰ª™Ë°®ÊùøÂáΩÊï∞
        window.updateDashboard = function() {
            console.log('üìä Êõ¥Êñ∞‰ª™Ë°®Êùø...');
            // Ê®°Êãü‰ª™Ë°®ÊùøÊõ¥Êñ∞
            try {
                // Êõ¥Êñ∞ÂêÑÁßçÊåáÊ†á
                updateTime();
                if (window.updateCharts) window.updateCharts();
            } catch (error) {
                console.error('‰ª™Ë°®ÊùøÊõ¥Êñ∞Â§±Ë¥•:', error);
            }
        };
        
        // Êõ¥Êñ∞Êó∂Èó¥ÂáΩÊï∞
        window.updateTime = function() {
            const timeElements = document.querySelectorAll('#current-time, .current-time');
            const now = new Date().toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            timeElements.forEach(element => {
                if (element) element.textContent = now;
            });
        };
        
        // Êõ¥Êñ∞ÂõæË°®ÂáΩÊï∞
        window.updateCharts = async function() {
            console.log('üìà Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ...');
            try {
                // Ëé∑ÂèñÁÉ≠Èó®ËÇ°Á•®Êï∞ÊçÆÁî®‰∫éÂõæË°®ÊòæÁ§∫
                const response = await fetch('/market-data/popular');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ÂõæË°®Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞:', data.popular_stocks);
                
                // Êõ¥Êñ∞ÂêÑÁ±ªÂõæË°®
                window.updatePerformanceChart(data.popular_stocks);
                window.updateRiskChart(data.popular_stocks);
                
                return data.popular_stocks;
            } catch (error) {
                console.error('‚ùå ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•', 'error');
                }
            }
        };
        
        // Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®
        window.updatePerformanceChart = function(stockData) {
            console.log('üìä Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®:', stockData);
            // ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂÖ∑‰ΩìÁöÑÂõæË°®Êõ¥Êñ∞ÈÄªËæë
            // ‰æãÂ¶Ç‰ΩøÁî®Chart.jsÊõ¥Êñ∞Áé∞ÊúâÂõæË°®
        };
        
        // Êõ¥Êñ∞È£éÈô©ÂõæË°®
        window.updateRiskChart = function(stockData) {
            console.log('üìä Êõ¥Êñ∞È£éÈô©ÂõæË°®:', stockData);
            // ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂÖ∑‰ΩìÁöÑÈ£éÈô©ÂõæË°®Êõ¥Êñ∞ÈÄªËæë
        };
        
        // È™åËØÅÊ†∏ÂøÉÂáΩÊï∞
        window.validateCoreFunctions = function() {
            console.log('üîç È™åËØÅÊ†∏ÂøÉÂáΩÊï∞...');
            const requiredFunctions = [
                'showToast', 'addStockToPool', 'refreshAllData', 
                'generateSignals', 'executeOrder', 'loadMarketIndices'
            ];
            
            const missing = [];
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missing.push(funcName);
                }
            });
            
            if (missing.length > 0) {
                console.warn('‚ö†Ô∏è Áº∫Â§±ÁöÑÊ†∏ÂøÉÂáΩÊï∞:', missing);
            } else {
                console.log('‚úÖ ÊâÄÊúâÊ†∏ÂøÉÂáΩÊï∞È™åËØÅÈÄöËøá');
            }
        };
        
        // ÂÖ®Â±ÄÊõ¥Êñ∞Èó¥ÈöîÂØπË±°
        window.updateIntervals = {
            main: null,
            charts: null
        };
        
        // ================ ÂÖ®Â±ÄÂ∑•ÂÖ∑ÂáΩÊï∞Âå∫ÂüüÁªìÊùü ================
        console.log('‚úÖ ÊâÄÊúâÂÖ®Â±ÄÊêúÁ¥¢ÂáΩÊï∞Â∑≤ÂÆö‰πâ');
        
        // ================ È°µÈù¢ÂàùÂßãÂåñÂíåDOMContentLoaded‰∫ã‰ª∂Â§ÑÁêÜ ================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMÂÜÖÂÆπÂä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            
            // ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
            try {
                window.initStockSearch();
                console.log('‚úÖ ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
            
            console.log('‚úÖ È°µÈù¢ÂàùÂßãÂåñÂÆåÊàê');
        });
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàê‰∫ã‰ª∂
        window.addEventListener('load', function() {
            console.log('üéØ È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩÂÆåÊàê');
            
            // Á°Æ‰øùÊêúÁ¥¢ÂäüËÉΩÊ≠£Â∏∏Â∑•‰Ωú
            setTimeout(() => {
                if (!window.searchInitialized) {
                    console.log('‚ö†Ô∏è ÊêúÁ¥¢ÂäüËÉΩÊú™ÂàùÂßãÂåñÔºåÂ∞ùËØïÈáçÊñ∞ÂàùÂßãÂåñ...');
                    try {
                        window.initStockSearch();
                    } catch (error) {
                        console.error('ÈáçÊñ∞ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩÂ§±Ë¥•:', error);
                    }
                }
            }, 1000);
        });
        
        // ================ ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ ================
        
        // Â§ÑÁêÜÊú™ÊçïËé∑ÁöÑPromiseÊãíÁªù
        window.addEventListener('unhandledrejection', function(event) {
            console.error('‚ùå Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù:', event.reason);
            
            // Èò≤Ê≠¢ÈîôËØØÂú®ÊéßÂà∂Âè∞ÊòæÁ§∫
            if (event.reason && event.reason.message && 
                (event.reason.message.includes('message channel closed') || 
                 event.reason.message.includes('listener indicated'))) {
                console.log('üìù Â∑≤ÊçïËé∑Âπ∂ÂøΩÁï•Ê∂àÊÅØÈÄöÈÅìÈîôËØØ');
                event.preventDefault();
                return;
            }
            
            // ÊòæÁ§∫Áî®Êà∑ÂèãÂ•ΩÁöÑÈîôËØØÊ∂àÊÅØ
            if (typeof showToast === 'function') {
                showToast('Á≥ªÁªüÈÅáÂà∞‰∫Ü‰∏Ä‰∏™ÈóÆÈ¢òÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï', 'error');
            }
            
            // ÂèØÈÄâÔºöÈòªÊ≠¢ÈªòËÆ§ÁöÑÈîôËØØÂ§ÑÁêÜ
            // event.preventDefault();
        });
        
        // Â§ÑÁêÜÊú™ÊçïËé∑ÁöÑJavaScriptÈîôËØØ
        window.addEventListener('error', function(event) {
            console.error('‚ùå Êú™ÊçïËé∑ÁöÑÈîôËØØ:', event.error);
            
            // ÂøΩÁï•ÁâπÂÆöÁöÑÂ∑≤Áü•ÈîôËØØ
            if (event.message && 
                (event.message.includes('updatePoolStats is not a function') ||
                 event.message.includes('message channel closed'))) {
                console.log('üìù Â∑≤ÊçïËé∑Âπ∂ÂøΩÁï•Â∑≤Áü•ÈîôËØØ');
                return;
            }
            
            if (typeof showToast === 'function') {
                showToast('È°µÈù¢ÈÅáÂà∞‰∫Ü‰∏Ä‰∏™ÈîôËØØÔºåËØ∑Ê£ÄÊü•ÊéßÂà∂Âè∞Êó•Âøó', 'warning');
            }
        });
        
        console.log('‚úÖ ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜÂ∑≤ËÆæÁΩÆ');
    </script>
</body>
</html>
