<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArtheraÈáèÂåñ‰∫§ÊòìÁ≥ªÁªü - ‰∏ì‰∏öÊäïËµÑÂπ≥Âè∞</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìä</text></svg>">
    
    <!-- Â§ñÈÉ®‰æùËµñ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation"></script>
    <!-- Tailwind CDN for development - production should use PostCSS build -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Ëá™ÂÆö‰πâÊ†∑Âºè -->
    <style>
        :root {
            /* Bloomberg-inspired color palette */
            --primary-color: #000000;
            --secondary-color: #1a1a1a;
            --accent-color: #333333;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --bg-primary: #000000;
            --bg-secondary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --border-color: #333333;
            --hover-color: #2a2a2a;
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        }
        
        .professional-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-card-pro {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .chart-container-pro {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            height: 500px;
            min-height: 500px;
            max-height: 500px;
            position: relative;
            overflow: visible;
            padding: 20px;
        }
        
        .chart-container-pro canvas {
            width: 100% !important;
            height: 460px !important;
            max-height: 460px !important;
        }
        
        .card-hover {
            transition: all 0.3s ease;
        }
        
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .number-counter {
            font-variant-numeric: tabular-nums;
            line-height: 1.2;
            word-break: break-word;
            overflow-wrap: anywhere;
        }
        
        /* ‰øÆÂ§çÊåâÈíÆÊñáÂ≠óÊ∫¢Âá∫ */
        .action-button {
            font-family: monospace;
            font-size: 0.75rem;
            padding: 6px 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            max-width: 100%;
        }
        
        /* ‰øÆÂ§çËèúÂçïÈ°πÊñáÂ≠óÊ∫¢Âá∫ */
        .menu-item {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 8px 12px;
            font-size: 0.75rem;
        }
        
        /* ËÇ°Á•®ÊêúÁ¥¢ÁªìÊûúÂ±ïÁ§∫ - ‰øÆÂ§çÊñáÂ≠óÊ∫¢Âá∫ */
        .stock-search-result {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            margin-bottom: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-primary);
            font-family: monospace;
            font-size: 0.75rem;
            display: flex;
            flex-direction: column;
            gap: 2px;
            overflow: hidden;
            min-width: 0;
        }
        
        /* ÊêúÁ¥¢‰∏ãÊãâÊ°ÜÊ†∑Âºè‰ºòÂåñ */
        #search-dropdown {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
            border-color: var(--border-color) !important;
            background: var(--bg-primary) !important;
            max-height: 200px !important;
            z-index: 1000 !important;
        }
        
        #search-dropdown {
            position: absolute !important;
            top: 100% !important;
            left: 0 !important;
            width: 100% !important;
            z-index: 9999 !important;
            background-color: black !important;
            border: 1px solid white !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5) !important;
        }
        
        #search-dropdown:not(.hidden) {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        #search-dropdown.hidden {
            display: none !important;
        }
        
        .stock-result-symbol {
            font-weight: bold;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            color: var(--text-primary);
        }
        
        .stock-result-name {
            color: var(--text-secondary);
            font-size: 0.65rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
            line-height: 1.2;
        }
        
        .stock-result-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.6rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
            gap: 4px;
        }
        
        /* ‰ºòÂåñÁªüËÆ°Âç°ÁâáÂ∏ÉÂ±Ä - Áªü‰∏ÄBloombergÈ£éÊ†º */
        .stat-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            min-height: 140px;
            padding: 16px;
            font-family: monospace;
        }
        
        .stat-value {
            font-size: 1.1rem;
            line-height: 1.4;
            max-width: 100%;
            font-family: monospace;
            color: var(--text-primary);
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        .stat-label {
            font-family: monospace;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
        }
        
        /* Á≠ñÁï•ÊÄßËÉΩÂç°Áâá‰ºòÂåñ */
        .strategy-performance-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            padding: 12px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .strategy-name {
            font-size: 0.85rem;
            font-weight: bold;
            color: var(--text-primary);
            margin-bottom: 8px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .strategy-return {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .strategy-return.positive { color: #10b981; }
        .strategy-return.negative { color: #ef4444; }
        
        .strategy-status {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        
        .strategy-metrics {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }
        
        .strategy-progress {
            height: 3px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
        }
        
        .strategy-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .strategy-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 16px;
            border-radius: 4px;
        }
        
        .signal-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px;
            margin-bottom: 4px;
            font-family: monospace;
            font-size: 0.75rem;
            transition: all 0.3s ease;
        }
        
        .signal-item:hover {
            background: var(--hover-color);
        }
        
        .chart-container {
            position: relative;
            height: 450px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .metric-card {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #ffffff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active { background-color: var(--success-color); }
        .status-inactive { background-color: var(--danger-color); }
        .status-warning { background-color: var(--warning-color); }
        
        .performance-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background-color: #e5e7eb;
        }
        
        .performance-fill {
            height: 100%;
            transition: width 0.5s ease;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-button {
            transition: all 0.3s ease;
            border-radius: 8px;
        }
        
        .tab-button.active {
            background-color: #3b82f6 !important;
            color: white !important;
            box-shadow: 0 4px 6px rgba(59, 130, 246, 0.3);
            transform: translateY(-1px);
        }
        
        .tab-button:not(.active) {
            background-color: #e5e7eb !important;
            color: #374151 !important;
        }
        
        /* ÁßªÂä®Á´ØÂìçÂ∫îÂºè‰ºòÂåñ */
        @media (max-width: 768px) {
            .tab-button {
                padding: 8px 12px;
                font-size: 12px;
            }
            
            .chart-container-pro {
                min-height: 300px;
                padding: 16px;
            }
            
            .chart-container-pro canvas {
                max-height: 250px;
            }
        }
    </style>
</head>

<body class="bg-black min-h-screen">
    <!-- Bloomberg Terminal Style Header -->
    <nav class="bg-black border-b border-white sticky top-0 z-50">
        <div class="container mx-auto px-6 py-3">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-6">
                    <h1 class="text-lg font-mono text-white tracking-wide" data-i18n="title">ARTHERA QUANTITATIVE TRADING SYSTEM</h1>
                    <div class="flex items-center space-x-4">
                        <div class="flex items-center space-x-2">
                            <div class="w-2 h-2 bg-white rounded-full pulse-dot"></div>
                            <span class="text-xs font-mono text-white" data-i18n="real-time-connection">LIVE</span>
                        </div>
                        <div class="flex items-center space-x-2" id="data-source-indicator">
                            <div class="w-2 h-2 bg-white rounded-full"></div>
                            <span class="text-xs font-mono text-white" data-i18n="data-source">DATA</span>
                        </div>
                        <div class="text-xs font-mono text-white" id="current-time"></div>
                    </div>
                </div>
                
                <div class="flex items-center space-x-4">
                    <!-- Language Switcher -->
                    <button onclick="window.switchLanguage(window.currentLanguage === 'zh' ? 'en' : 'zh')" 
                            class="language-toggle px-2 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                        EN
                    </button>
                    
                    <div class="text-right">
                        <div class="text-xs font-mono text-white" data-i18n="professional-version">PROFESSIONAL</div>
                        <div class="text-xs font-mono text-gray-400" data-i18n="terminal-mode">TERMINAL</div>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button id="refresh-btn" class="px-3 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="refresh">REFRESH</span>
                        </button>
                        <button id="settings-btn" class="px-3 py-1 text-xs font-mono text-white border border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="settings">CONFIG</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
    <div class="container mx-auto px-6 py-8">
        <!-- Ê†∏ÂøÉÊåáÊ†á‰ª™Ë°®Êùø -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-8">
            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="total-volume">VOLUME</span>
                        <span class="text-xs font-mono text-white opacity-70">[$]</span>
                    </div>
                    <div class="stat-value font-mono text-white number-counter mb-1" id="total-volume">$27,178,810</div>
                    <div class="text-xs font-mono text-white opacity-70" id="volume-change">+12.5%</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="active-strategies">STRATEGIES</span>
                        <span class="text-xs font-mono text-white opacity-70">[#]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="active-strategies">4</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="running-status">RUNNING</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="ai-signals">AI SIGNALS</span>
                        <span class="text-xs font-mono text-white opacity-70">[AI]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="signals-today" data-signal-count="true">127</div>
                    <div class="text-xs font-mono text-white opacity-70" id="signal-strength" data-i18n="ai-powered">AI POWERED</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="success-rate">SUCCESS</span>
                        <span class="text-xs font-mono text-white opacity-70">[%]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="success-rate">94.2%</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="professional-grade">PROFESSIONAL</div>
                </div>
            </div>

            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="total-capital">CAPITAL</span>
                        <span class="text-xs font-mono text-white opacity-70">[$]</span>
                    </div>
                    <div class="text-2xl font-mono text-white number-counter mb-1" id="total-capital">$100,000</div>
                    <div class="text-xs font-mono text-white opacity-70" id="capital-change" data-i18n="available-funds">AVAILABLE</div>
                </div>
            </div>
            
            <div class="bg-black border border-white p-4 card-hover min-h-[120px] flex flex-col justify-between">
                <div class="space-y-2">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-mono text-white" data-i18n="var-95">VaR 95%</span>
                        <span class="text-xs font-mono text-white opacity-70">[%]</span>
                    </div>
                    <div class="text-2xl font-mono text-red-400 number-counter mb-1" id="var-95">-2.1%</div>
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="value-at-risk">VALUE AT RISK</div>
                </div>
            </div>
        </div>

        <!-- ‰∏ì‰∏öÈáèÂåñÊåáÊ†á‰ª™Ë°®Êùø -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Áª©ÊïàÊåáÊ†á -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="performance-metrics">Áª©ÊïàÊåáÊ†á</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="sharpe-ratio">Â§èÊôÆÊØîÁéá</span>
                        <span class="text-lg font-mono text-white" data-metric="sharpe-ratio">1.85</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">SortinoÊØîÁéá</span>
                        <span class="text-lg font-mono text-white" data-metric="sortino-ratio">2.12</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="info-ratio">‰ø°ÊÅØÊØîÁéá</span>
                        <span class="text-lg font-mono text-white" data-metric="information-ratio">0.58</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">TreynorÊØîÁéá</span>
                        <span class="text-lg font-mono text-white" data-metric="treynor-ratio">13.2</span>
                    </div>
                </div>
            </div>

            <!-- È£éÈô©ÊéßÂà∂ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="risk-control">È£éÈô©ÊéßÂà∂</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="max-drawdown">ÊúÄÂ§ßÂõûÊí§</span>
                        <span class="text-lg font-mono text-red-400">-3.2%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">VaR 95%</span>
                        <span class="text-lg font-mono text-red-400">-2.1%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">BetaÁ≥ªÊï∞</span>
                        <span class="text-lg font-mono text-white">0.85</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70">Alpha</span>
                        <span class="text-lg font-mono text-green-400">+1.8%</span>
                    </div>
                </div>
            </div>

            <!-- ÂÆûÊó∂Êï∞ÊçÆ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4">
                    <h3 class="text-sm font-mono text-white" data-i18n="realtime-data">ÂÆûÊó∂Êï∞ÊçÆ</h3>
                </div>
                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="market-correlation">Â∏ÇÂú∫Áõ∏ÂÖ≥ÊÄß</span>
                        <span class="text-lg font-mono text-white" data-metric="market-correlation">0.72</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="volatility">Ê≥¢Âä®Áéá</span>
                        <span class="text-lg font-mono text-white" data-metric="volatility">15.3%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="tracking-error">Ë∑üË∏™ËØØÂ∑Æ</span>
                        <span class="text-lg font-mono text-white" data-metric="tracking-error">2.1%</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-xs font-mono text-white opacity-70" data-i18n="online-time">Âú®Á∫øÊó∂Èó¥</span>
                        <span class="text-lg font-mono text-green-400" data-metric="uptime">99.8%</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- AIÁ≠ñÁï•Ë°®Áé∞ -->
        <div class="bg-black border border-white p-6 mb-8">
            <div class="border-b border-white pb-3 mb-4 flex items-center">
                <h3 class="text-sm font-mono text-white" data-i18n="ai-strategy-performance">AIÁ≠ñÁï•Ë°®Áé∞</h3>
            </div>
            <div id="strategy-performance" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                <!-- DeepSeek Alpha Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name" data-i18n="strategy-deepseek-alpha">DeepSeek Alpha</div>
                    <div class="strategy-return negative">-1.34%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè <span data-i18n="strategy-stopped">Stopped</span></div>
                    <div class="strategy-status" data-i18n="daily-return">Daily Return</div>
                    <div class="strategy-metrics">
                        <div><span>1.3</span><br><span class="text-gray-400" data-i18n="sharpe-short">Sharpe</span></div>
                        <div><span>15</span><br><span class="text-gray-400" data-i18n="positions-short">Pos</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 25%;"></div></div>
                </div>
                
                <!-- Bayesian Momentum Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name" data-i18n="strategy-bayesian-momentum">Bayesian Momentum</div>
                    <div class="strategy-return positive">2.26%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè <span data-i18n="strategy-stopped">Stopped</span></div>
                    <div class="strategy-status" data-i18n="daily-return">Daily Return</div>
                    <div class="strategy-metrics">
                        <div><span>1.59</span><br><span class="text-gray-400" data-i18n="sharpe-short">Sharpe</span></div>
                        <div><span>6</span><br><span class="text-gray-400" data-i18n="positions-short">Pos</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 45%;"></div></div>
                </div>
                
                <!-- Kelly Portfolio Optimizer Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name" data-i18n="strategy-kelly-optimizer">Kelly Portfolio<br>Optimizer</div>
                    <div class="strategy-return positive">2.08%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè <span data-i18n="strategy-stopped">Stopped</span></div>
                    <div class="strategy-status" data-i18n="daily-return">Daily Return</div>
                    <div class="strategy-metrics">
                        <div><span>2.14</span><br><span class="text-gray-400" data-i18n="sharpe-short">Sharpe</span></div>
                        <div><span>14</span><br><span class="text-gray-400" data-i18n="positions-short">Pos</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 60%;"></div></div>
                </div>
                
                <!-- Risk Parity Á≠ñÁï• -->
                <div class="strategy-performance-card">
                    <div class="strategy-name" data-i18n="strategy-risk-parity">Risk Parity</div>
                    <div class="strategy-return positive">0.66%</div>
                    <div class="text-xs text-red-400 mb-2">‚óè <span data-i18n="strategy-stopped">Stopped</span></div>
                    <div class="strategy-status" data-i18n="daily-return">Daily Return</div>
                    <div class="strategy-metrics">
                        <div><span>1.31</span><br><span class="text-gray-400" data-i18n="sharpe-short">Sharpe</span></div>
                        <div><span>22</span><br><span class="text-gray-400" data-i18n="positions-short">Pos</span></div>
                        <div><span class="text-red-400">$0</span><br><span class="text-gray-400">P&L</span></div>
                    </div>
                    <div class="strategy-progress"><div class="strategy-progress-fill" style="width: 30%;"></div></div>
                </div>
            </div>
        </div>

        <!-- ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞ -->
        <div class="bg-black border border-white p-6 mb-8">
            <div class="border-b border-white pb-3 mb-4 flex items-center">
                <h3 class="text-sm font-mono text-white" data-i18n="global-market-indices">ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞</h3>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                <div class="text-center" data-index="NASDAQ">
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="nasdaq">NASDAQ</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
                <div class="text-center" data-index="S&P 500">
                    <div class="text-xs font-mono text-white opacity-70">S&P 500</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
                <div class="text-center" data-index="DOW">
                    <div class="text-xs font-mono text-white opacity-70" data-i18n="dow">DOW</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
                <div class="text-center" data-index="‰∏äËØÅÊåáÊï∞">
                    <div class="text-xs font-mono text-white opacity-70">‰∏äËØÅÊåáÊï∞</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
                <div class="text-center" data-index="Ê∑±ËØÅÊàêÊåá">
                    <div class="text-xs font-mono text-white opacity-70">Ê∑±ËØÅÊàêÊåá</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
                <div class="text-center" data-index="ÊÅíÁîüÊåáÊï∞">
                    <div class="text-xs font-mono text-white opacity-70">ÊÅíÁîüÊåáÊï∞</div>
                    <div class="text-lg font-mono text-white index-price">--</div>
                    <div class="text-sm font-mono text-gray-400 index-change">--</div>
                </div>
            </div>
        </div>

        <!-- ‰∫§Êòì‰ø°Âè∑ÂíåËÆ¢ÂçïÁä∂ÊÄÅ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑ -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <h3 class="text-sm font-mono text-white" data-i18n="latest-trading-signals">ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑</h3>
                    </div>
                    <div class="bg-black border border-white px-3 py-1">
                        <span class="text-xs font-mono text-green-400" data-i18n="zero-signals">0‰∏™‰ø°Âè∑</span>
                    </div>
                </div>
                <div id="signals-container" class="space-y-2 h-32 overflow-y-auto">
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <div class="text-xs font-mono text-white opacity-70" data-i18n="click-generate-signals">
                            ÁÇπÂáª"ÁîüÊàêAI‰∫§Êòì‰ø°Âè∑"ÂºÄÂßãÂàÜÊûê...
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï -->
            <div class="bg-black border border-white p-6">
                <div class="border-b border-white pb-3 mb-4 flex items-center justify-between">
                    <div class="flex items-center">
                        <h3 class="text-sm font-mono text-white" data-i18n="latest-orders">ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï</h3>
                    </div>
                    <div class="bg-black border border-white px-3 py-1">
                        <span class="text-xs font-mono text-blue-400" data-i18n="zero-orders">0‰∏™ËÆ¢Âçï</span>
                    </div>
                </div>
                <div id="orders-container" class="space-y-2 h-32 overflow-y-auto">
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <div class="text-xs font-mono text-white opacity-70" data-i18n="click-execute-orders">
                            ÁÇπÂáª"ÊâßË°åÊ®°ÊãüËÆ¢Âçï"ÂºÄÂßã‰∫§Êòì...
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ‰∏ªË¶ÅÂÜÖÂÆπÂå∫Âüü -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- STRATEGY CONTROL PANEL -->
            <div class="lg:col-span-1">
                <div class="bg-black border border-white p-4 mb-4">
                    <h2 class="text-sm font-mono text-white mb-4 border-b border-white pb-2" data-i18n="strategy-control-center">
                        STRATEGY CONTROL CENTER
                    </h2>
                    
                    <!-- CAPITAL MANAGEMENT -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="capital-management-title">
                            CAPITAL MANAGEMENT
                        </h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-xs font-mono text-white mb-1" data-i18n="initial-capital-label">INITIAL CAPITAL (USD)</label>
                                <div class="flex space-x-1">
                                    <input type="number" id="initial-capital" 
                                           placeholder="100000" data-i18n-placeholder="initial-capital-placeholder"
                                           value="100000"
                                           min="1000"
                                           max="10000000"
                                           class="flex-1 p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                    <button onclick="if(typeof setCapital === 'function') setCapital(); else console.error('setCapital function not defined yet');" 
                                            class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="set-button">
                                        SET
                                    </button>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2 text-xs font-mono text-white">
                                <div><span data-i18n="used-label">USED:</span> <span id="used-capital">$0</span></div>
                                <div><span data-i18n="available-label">AVAILABLE:</span> <span id="available-capital">$0</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- PORTFOLIO ALLOCATION -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="portfolio-allocation-title">
                            PORTFOLIO ALLOCATION
                        </h4>
                        <div class="space-y-3">
                            <!-- Current Holdings Display -->
                            <div id="current-holdings" class="mb-3">
                                <div class="text-xs font-mono text-white mb-2" data-i18n="current-holdings">CURRENT HOLDINGS:</div>
                                <div id="holdings-list" class="space-y-1">
                                    <div class="text-xs text-gray-400" data-i18n="no-holdings">No positions yet</div>
                                </div>
                            </div>
                            
                            <!-- Position Size Controls -->
                            <div>
                                <label class="block text-xs font-mono text-white mb-1" data-i18n="max-position-per-stock">MAX POSITION PER STOCK (%)</label>
                                <input type="range" id="max-position-percent" min="1" max="50" value="10" 
                                       class="w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer">
                                <div class="flex justify-between text-xs font-mono text-white mt-1">
                                    <span>1%</span>
                                    <span id="max-position-display" class="text-green-400">10%</span>
                                    <span>50%</span>
                                </div>
                            </div>
                            
                            <!-- Rebalance Controls -->
                            <div class="grid grid-cols-2 gap-2">
                                <button onclick="rebalancePortfolio()" 
                                        class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="rebalance-button">
                                    REBALANCE
                                </button>
                                <button onclick="showPositionManager()" 
                                        class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="manage-positions">
                                    MANAGE
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- DATA SOURCE CONFIG -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="data-source-config-title">
                            DATA SOURCE CONFIG
                        </h4>
                        <div class="space-y-3">
                            <form id="tushare-config-form">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-1" data-i18n="tushare-token-label">TUSHARE TOKEN</label>
                                    <div class="flex space-x-1">
                                        <input type="password" id="tushare-token-main" 
                                               placeholder="ENTER TOKEN FOR PROFESSIONAL DATA" data-i18n-placeholder="tushare-placeholder"
                                               autocomplete="new-password"
                                               class="flex-1 p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <button type="button" onclick="configureTushare()" 
                                                class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="config-button">
                                            CONFIG
                                        </button>
                                        <button type="button" onclick="testTushareConnection()" 
                                                class="bg-black text-white border border-white px-2 py-1 text-xs font-mono hover:bg-white hover:text-black transition" data-i18n="test-button">
                                            TEST
                                        </button>
                                    </div>
                                </div>
                            </form>
                            <div id="config-status" data-config-status="true" class="text-xs font-mono text-white"></div>
                        </div>
                    </div>

                    <!-- STRATEGY PARAMETERS -->
                    <div class="bg-black border border-white p-3 mb-4">
                        <h4 class="font-mono text-white text-xs mb-3 border-b border-white pb-2" data-i18n="strategy-parameters-title">
                            STRATEGY PARAMETERS
                        </h4>
                        <div class="space-y-3">
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="risk-level">RISK LEVEL</label>
                                    <select id="risk-level" class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="conservative" data-i18n="conservative">CONSERVATIVE</option>
                                        <option value="moderate" selected data-i18n="balanced">BALANCED</option>
                                        <option value="aggressive" data-i18n="aggressive">AGGRESSIVE</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="max-position">MAX POSITION</label>
                                    <input type="number" id="max-position" value="10000" min="1000" max="50000" 
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-2">
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="stop-loss">STOP LOSS (%)</label>
                                    <input type="number" id="stop-loss" value="5" min="1" max="20" step="0.5"
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white" data-i18n="take-profit">TAKE PROFIT (%)</label>
                                    <input type="number" id="take-profit" value="15" min="5" max="50" step="0.5"
                                           class="w-full p-1 text-xs bg-black text-white border border-white font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- MARKET SELECTION -->
                    <div class="mb-4">
                        <label class="block text-xs font-mono text-white mb-2" data-i18n="target-market">TARGET MARKET</label>
                        <select id="market-select" class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black">
                            <option value="mixed" data-i18n="global-mixed">GLOBAL MIXED</option>
                            <option value="US" data-i18n="us-stocks">US STOCKS</option>
                            <option value="CN" data-i18n="china-a-shares">CHINA A-SHARES</option>
                        </select>
                    </div>

                    <!-- STOCK POOL CONFIG -->
                    <div class="mb-4">
                        <label class="block text-xs font-mono text-white mb-2" data-i18n="target-stock-pool">TARGET STOCK POOL</label>
                        
                        <!-- ËÇ°Á•®ÊêúÁ¥¢Ê°Ü -->
                        <div class="relative mb-2">
                            <input type="text" id="stock-search" 
                                   class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black" 
                                   placeholder="SEARCH STOCKS: TYPE NAME/SYMBOL" data-i18n-placeholder="search-placeholder"
                                   autocomplete="off">
                            <div id="search-dropdown" class="absolute w-full bg-black border border-white mt-1 max-h-48 overflow-y-auto hidden z-[100] left-0 top-full shadow-lg">
                                <!-- ÊêúÁ¥¢ÁªìÊûúÂä®ÊÄÅÂ°´ÂÖÖ -->
                            </div>
                        </div>
                        
                        <!-- ÊêúÁ¥¢ÊèêÁ§∫ÂíåÁä∂ÊÄÅ -->
                        <div class="mb-2 flex justify-between items-center">
                            <div class="text-xs font-mono text-gray-400" data-i18n="search-hint">
                                TRY: AAPL, TESLA, MICROSOFT, ËåÖÂè∞
                            </div>
                            <div id="search-status" class="text-xs font-mono text-green-400 hidden" data-i18n="search-status-ready">
                                API READY
                            </div>
                        </div>
                        
                        
                        <!-- È´òÁ∫ßÁ≠õÈÄâÂô® -->
                        <div class="grid grid-cols-2 gap-2 mb-2">
                            <select id="market-filter" class="bg-black text-white border border-white p-1 text-xs font-mono">
                                <option value="" data-i18n="all-markets">ALL MARKETS</option>
                                <option value="US" data-i18n="us-stocks">US STOCKS</option>
                                <option value="CN" data-i18n="china-a-shares-short">A-SHARES</option>
                                <option value="HK" data-i18n="hk-stocks">HK STOCKS</option>
                                <option value="JP" data-i18n="jp-stocks">JP STOCKS</option>
                            </select>
                            <select id="cap-filter" class="bg-black text-white border border-white p-1 text-xs font-mono">
                                <option value="" data-i18n="all-caps">ALL CAPS</option>
                                <option value="Large" data-i18n="large-cap">LARGE CAP</option>
                                <option value="Mid" data-i18n="mid-cap">MID CAP</option>
                                <option value="Small" data-i18n="small-cap">SMALL CAP</option>
                            </select>
                        </div>
                        
                        <!-- Áªü‰∏ÄÊô∫ËÉΩÊêúÁ¥¢ÁªÑ‰ª∂ -->
                        <div class="mb-2 p-2 bg-gray-900 border border-blue-500 rounded">
                            <div class="flex items-center justify-between mb-2">
                                <span class="text-xs font-mono text-blue-400" data-i18n="intelligent-stock-search">Êô∫ËÉΩËÇ°Á•®ÊêúÁ¥¢</span>
                                <span class="text-xs font-mono text-green-400" id="search-status" data-i18n="multi-source-ready">Â§öÊ∫êÂ∞±Áª™</span>
                            </div>
                            
                            <!-- Ë°å‰∏öÂø´ÈÄüÁ≠õÈÄâ - Áªü‰∏ÄÊ†∑Âºè -->
                            <div class="mb-2">
                                <div class="text-xs text-gray-400 mb-1" data-i18n="sector-filter">Ë°å‰∏öÁ≠õÈÄâ:</div>
                                <div class="grid grid-cols-4 gap-1">
                                    <button onclick="unifiedSectorSearch('tech')" class="bg-blue-800 text-white border border-blue-400 px-2 py-1 text-xs font-mono hover:bg-blue-600 transition" data-i18n="tech-sector">ÁßëÊäÄ</button>
                                    <button onclick="unifiedSectorSearch('finance')" class="bg-green-800 text-white border border-green-400 px-2 py-1 text-xs font-mono hover:bg-green-600 transition" data-i18n="finance-sector">ÈáëËûç</button>
                                    <button onclick="unifiedSectorSearch('healthcare')" class="bg-purple-800 text-white border border-purple-400 px-2 py-1 text-xs font-mono hover:bg-purple-600 transition" data-i18n="healthcare-sector">ÂåªÁñó</button>
                                    <button onclick="unifiedSectorSearch('energy')" class="bg-orange-800 text-white border border-orange-400 px-2 py-1 text-xs font-mono hover:bg-orange-600 transition" data-i18n="energy-sector">ËÉΩÊ∫ê</button>
                                </div>
                            </div>
                            
                            <!-- Âø´ÈÄüÈÄâËÇ°Â∑•ÂÖ∑ -->
                            <div class="mb-2">
                                <div class="text-xs text-gray-400 mb-1" data-i18n="quick-stock-selection">Âø´ÈÄüÈÄâËÇ°:</div>
                                <div class="grid grid-cols-3 gap-1">
                                    <button onclick="getRandomStocks(30)" class="bg-gray-700 text-white border border-gray-500 px-2 py-1 text-xs font-mono hover:bg-gray-600 transition" data-i18n="random-30">ÈöèÊú∫30</button>
                                    <button onclick="getRandomStocks(50)" class="bg-gray-700 text-white border border-gray-500 px-2 py-1 text-xs font-mono hover:bg-gray-600 transition" data-i18n="random-50">ÈöèÊú∫50</button>
                                    <button onclick="getTopStocks()" class="bg-yellow-800 text-white border border-yellow-500 px-2 py-1 text-xs font-mono hover:bg-yellow-600 transition" data-i18n="hot-stocks">ÁÉ≠Èó®ËÇ°</button>
                                </div>
                            </div>
                            
                            <!-- Êï∞ÊçÆÊ∫êÁÆ°ÁêÜ -->
                            <div class="grid grid-cols-2 gap-1">
                                <button onclick="checkAllDataSources()" class="bg-indigo-800 text-white border border-indigo-500 px-2 py-1 text-xs font-mono hover:bg-indigo-600 transition" data-i18n="source-status">Ê∫êÁä∂ÊÄÅ</button>
                                <button onclick="refreshSearchCache()" class="bg-teal-800 text-white border border-teal-500 px-2 py-1 text-xs font-mono hover:bg-teal-600 transition" data-i18n="refresh-cache">Âà∑Êñ∞ÁºìÂ≠ò</button>
                            </div>
                        </div>
                        
                        <!-- Â∑≤ÈÄâËÇ°Á•®ÊòæÁ§∫ -->
                        <div id="selected-stocks" class="mb-2 min-h-[40px] border border-white p-2 bg-black">
                            <div id="stock-chips" class="flex flex-wrap gap-1">
                                <!-- ËÇ°Á•®Ê†áÁ≠æÂä®ÊÄÅÊòæÁ§∫ -->
                            </div>
                        </div>
                        
                        <textarea id="target-symbols" 
                                  class="w-full p-2 bg-black text-white border border-white font-mono text-xs focus:outline-none focus:bg-white focus:text-black" 
                                  rows="3" 
                                  placeholder="AAPL,TSLA,NVDA,600519.SS,000858.SZ">AAPL,TSLA,NVDA,600519.SS,000858.SZ</textarea>
                        
                        <!-- Êô∫ËÉΩÊé®ËçêÂå∫Âüü -->
                        <div class="mt-2">
                            <div class="text-xs font-mono text-white mb-1" data-i18n="ai-recommendations">AI RECOMMENDATIONS:</div>
                            <div id="ai-recommendations" class="flex flex-wrap gap-1 mb-2">
                                <!-- AIÊé®ËçêËÇ°Á•® -->
                            </div>
                        </div>
                        
                        <div class="text-xs font-mono text-white mt-1">
                            <span data-i18n='ai-supports-text'>SUPPORTS US STOCKS (AAPL) AND CHINA A-SHARES (600519.SS)</span>
                        </div>
                        
                        <!-- ËÇ°Á•®Ê±†ÁªüËÆ° -->
                        <div id="pool-stats" class="text-xs font-mono text-white mt-2 grid grid-cols-3 gap-2">
                            <div><span data-i18n="pool-total">TOTAL:</span> <span id="total-count">5</span></div>
                            <div><span data-i18n="pool-us">US:</span> <span id="us-count">3</span></div>
                            <div><span data-i18n="pool-cn">CN:</span> <span id="cn-count">2</span></div>
                        </div>
                    </div>

                    <!-- TRADING OPERATIONS -->
                    <div class="space-y-2">
                        <button onclick="generateSignals()" 
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span id="signal-btn-text" data-i18n="generate-ai-signals">GENERATE AI SIGNALS</span>
                            <div id="signal-loading" class="loading-spinner ml-2 hidden"></div>
                        </button>
                        
                        <button onclick="startAutoTrading()" 
                                id="auto-trading-btn"
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span id="auto-trading-text" data-i18n="start-auto-trading">START AUTO TRADING</span>
                        </button>
                        
                        <button onclick="executeSimulationOrder()" 
                                class="w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center">
                            <span data-i18n="execute-simulation-order">EXECUTE SIMULATION ORDER</span>
                        </button>
                        
                        <div class="grid grid-cols-2 gap-1">
                            <button onclick="refreshAllData()" 
                                    class="bg-black text-white border border-white p-2 text-xs font-mono hover:bg-white hover:text-black transition flex items-center justify-center" data-i18n="refresh">
                                REFRESH
                            </button>
                            <button onclick="resetStrategy()" 
                                    class="bg-black text-white border border-white p-2 text-xs font-mono hover:bg-white hover:text-black transition flex items-center justify-center" data-i18n="reset-button">
                                RESET
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ÂõæË°®ÂíåÊï∞ÊçÆÂ±ïÁ§∫Âå∫Âüü -->
            <div class="lg:col-span-2 min-h-[600px]">
                <!-- Bloomberg Terminal Chart Section -->
                <div class="bg-black border border-white mb-6">
                    <div class="border-b border-white bg-black">
                        <nav class="flex justify-between items-center px-6 py-3">
                            <div class="flex flex-wrap gap-2 overflow-x-auto">
                                <button class="tab-button active px-3 py-2 bg-white text-black font-mono text-xs transition-all" onclick="switchTab('volume', event)" data-i18n="volume-tab">
                                    VOLUME
                                </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('performance', event)" data-i18n="performance-tab">
                                PERFORMANCE
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('risk', event)" data-i18n="risk-tab">
                                RISK
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('correlation', event)" data-i18n="correlation-tab">
                                CORRELATION
                            </button>
                            <button class="tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all" onclick="switchTab('signals', event)" data-i18n="technical-tab">
                                TECHNICAL
                            </button>
                            </div>
                            <button onclick="refreshChartsData()" class="px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all">
                                REFRESH
                            </button>
                        </nav>
                    </div>
                    
                    <div class="p-6 min-h-[500px]">
                        <!-- Volume Chart -->
                        <div id="volume-tab" class="tab-content active">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        REAL-TIME VOLUME DATA
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        LIVE UPDATE
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="volume-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Strategy Performance Chart -->
                        <div id="performance-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        STRATEGY PERFORMANCE COMPARISON
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        RETURN %
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="performance-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Risk Analysis Chart -->
                        <div id="risk-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        RISK INDICATORS RADAR
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        MULTI-DIMENSIONAL
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="risk-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Correlation Analysis -->
                        <div id="correlation-tab" class="tab-content">
                            <div class="bg-black border border-white p-4 chart-container-pro">
                                <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                    <h3 class="text-sm font-mono text-white">
                                        ASSET CORRELATION MATRIX
                                    </h3>
                                    <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                        CORRELATION ANALYSIS
                                    </div>
                                </div>
                                <div style="height: 350px; position: relative;">
                                    <canvas id="correlation-chart"></canvas>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Technical Analysis Charts -->
                        <div id="signals-tab" class="tab-content">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-black border border-white p-4">
                                    <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                        <h4 class="text-sm font-mono text-white">
                                            TECHNICAL INDICATORS
                                        </h4>
                                        <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                            RSI/MACD
                                        </div>
                                    </div>
                                    <div style="height: 250px; position: relative;">
                                        <canvas id="technical-chart"></canvas>
                                    </div>
                                </div>
                                <div class="bg-black border border-white p-4">
                                    <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                        <h4 class="text-sm font-mono text-white">
                                            SIGNAL STRENGTH
                                        </h4>
                                        <div class="text-xs font-mono text-white border border-white px-2 py-1">
                                            BUY/SELL SIGNALS
                                        </div>
                                    </div>
                                    <div style="height: 250px; position: relative;">
                                        <canvas id="signals-chart"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

    <!-- Áä∂ÊÄÅÊèêÁ§∫Toast -->
    <div id="toast-container" class="fixed bottom-4 right-4 z-50 space-y-2"></div>

    <!-- BloombergÈ£éÊ†ºËÆæÁΩÆÊ®°ÊÄÅÊ°Ü -->
    <div id="settings-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-black border border-white max-w-4xl w-full max-h-[90vh] flex flex-col">
                <!-- Header -->
                <div class="bg-black border-b border-white p-4 flex justify-between items-center flex-shrink-0">
                    <div class="flex items-center">
                        <h3 class="text-lg font-mono text-white tracking-wider" data-i18n="settings">SETTINGS</h3>
                        <button onclick="window.switchLanguage(window.currentLanguage === 'zh' ? 'en' : 'zh')" class="language-toggle ml-6 px-3 py-1 border border-white text-white text-xs font-mono hover:bg-white hover:text-black transition-colors">
                            EN
                        </button>
                    </div>
                    <button onclick="closeSettings()" class="text-white hover:bg-white hover:text-black px-2 py-1 transition-colors">
                        ‚úï
                    </button>
                </div>
                
                <!-- Navigation -->
                <div class="bg-black border-b border-white flex-shrink-0">
                    <nav class="flex">
                        <button onclick="switchSettingsTab('general')" id="tab-general" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors bg-white text-black">
                            <span data-i18n="basic-settings">BASIC</span>
                        </button>
                        <button onclick="switchSettingsTab('ai')" id="tab-ai" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="ai-configuration">AI CONFIG</span>
                        </button>
                        <button onclick="switchSettingsTab('trading')" id="tab-trading" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="tushare-config">DATA SOURCE</span>
                        </button>
                        <button onclick="switchSettingsTab('backtest')" id="tab-backtest" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white border-r border-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="backtest-tab">BACKTEST</span>
                        </button>
                        <button onclick="switchSettingsTab('services')" id="tab-services" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="services-config">SERVICES</span>
                        </button>
                        <button onclick="switchSettingsTab('indicators')" id="tab-indicators" class="settings-tab-btn flex-1 py-3 px-4 text-xs font-mono text-white hover:bg-white hover:text-black transition-colors">
                            <span data-i18n="indicators-tab">INDICATORS</span>
                        </button>
                    </nav>
                </div>
                
                <!-- Content Area -->
                <div class="p-6 overflow-y-auto flex-1 bg-black text-white">

                    <!-- Basic Settings Tab -->
                    <div id="settings-general" class="settings-tab-content">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                            <!-- System Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="system-config">SYSTEM CONFIGURATION</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="refresh-interval">REFRESH INTERVAL</label>
                                        <select id="refresh-interval" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="5" data-i18n="5-sec">5 SEC</option>
                                            <option value="10" data-i18n="10-sec">10 SEC</option>
                                            <option value="30" selected data-i18n="30-sec">30 SEC</option>
                                            <option value="60" data-i18n="60-sec">60 SEC</option>
                                        </select>
                                    </div>
                                    
                                    <div class="space-y-2">
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono" data-i18n="auto-refresh">AUTO REFRESH</span>
                                            <input type="checkbox" id="auto-refresh" checked class="bg-black border-white">
                                        </label>
                                        
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono" data-i18n="sound-alerts">SOUND ALERTS</span>
                                            <input type="checkbox" id="sound-alerts" class="bg-black border-white">
                                        </label>
                                        
                                        <label class="flex items-center justify-between py-2 border-b border-gray-600 hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono" data-i18n="notifications">NOTIFICATIONS</span>
                                            <input type="checkbox" id="notifications" class="bg-black border-white">
                                        </label>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Display Settings -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="display-settings">DISPLAY SETTINGS</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="language-setting">LANGUAGE / ËØ≠Ë®Ä</label>
                                        <select id="language-select" onchange="window.switchLanguage(this.value)" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="zh">‰∏≠Êñá (Chinese)</option>
                                            <option value="en" data-i18n="english">English</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="time-format">TIME FORMAT</label>
                                        <select id="time-format" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="24h" data-i18n="24h-format">24H FORMAT</option>
                                            <option value="12h" data-i18n="12h-format">12H FORMAT</option>
                                        </select>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="decimal-places">DECIMAL PLACES</label>
                                        <select id="decimal-places" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="2" data-i18n="2-places">2 PLACES</option>
                                            <option value="3" data-i18n="3-places">3 PLACES</option>
                                            <option value="4" data-i18n="4-places">4 PLACES</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="service-endpoints">SERVICE ENDPOINTS</div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="api-gateway-service">API GATEWAY</label>
                                    <input type="text" id="service-api-gateway" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="quant-engine-service">QUANT ENGINE</label>
                                    <input type="text" id="service-quant-engine" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="ai-agents-service">AI AGENTS</label>
                                    <input type="text" id="service-ai-agents" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="risk-management-service">RISK MANAGEMENT</label>
                                    <input type="text" id="service-risk-management" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="crypto-connectors-service">CRYPTO CONNECTORS</label>
                                    <input type="text" id="service-crypto-connectors" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="backtesting-engine-service">BACKTESTING ENGINE</label>
                                    <input type="text" id="service-backtesting-engine" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="ios-connector-service">iOS CONNECTOR</label>
                                    <input type="text" id="service-ios-connector" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="portfolio-service">PORTFOLIO SERVICE</label>
                                    <input type="text" id="service-portfolio" placeholder="http://localhost:8001" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>

                            <div class="mt-4 flex flex-col md:flex-row gap-3">
                                <button onclick="saveServiceConfig()" class="flex-1 bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors" data-i18n="save-endpoints">SAVE ENDPOINTS</button>
                                <button onclick="testServiceEndpoints()" class="flex-1 bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors" data-i18n="test-connections">TEST CONNECTIONS</button>
                            </div>

                            <div id="service-config-status" class="mt-3 text-xs font-mono text-gray-400"></div>

                            <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-3 text-xs font-mono">
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="api-gateway-service">API Gateway</span><span id="service-status-api" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="quant-engine-service">Quant Engine</span><span id="service-status-quant" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="ai-agents-service">AI Agents</span><span id="service-status-ai-agents" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="risk-management-service">Risk Management</span><span id="service-status-risk-management" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="crypto-connectors-service">Crypto Connectors</span><span id="service-status-crypto-connectors" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="backtesting-engine-service">Backtesting Engine</span><span id="service-status-backtesting-engine" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="ios-connector-service">iOS Connector</span><span id="service-status-ios-connector" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                                <div class="flex justify-between border border-white px-2 py-1"><span data-i18n="portfolio-service">Portfolio</span><span id="service-status-portfolio" class="text-gray-400" data-i18n="service-status-unknown">UNKNOWN</span></div>
                            </div>
                        </div>
                    </div>

                    <!-- AI Configuration Tab -->
                    <div id="settings-ai" class="settings-tab-content hidden">
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                            <!-- DeepSeek API Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">DEEPSEEK API CONFIGURATION</div>
                                
                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="api-key">API KEY</label>
                                        <div class="relative">
                                            <input 
                                                type="password" 
                                                id="deepseek-api-key" 
                                                data-i18n-placeholder="api-key-placeholder"
                                                placeholder="Enter DeepSeek API Key"
                                                autocomplete="new-password"
                                                class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <button type="button" onclick="toggleApiKeyVisibility()" class="absolute right-2 top-2 text-white hover:text-gray-300">
                                                <span id="api-key-toggle-icon" class="text-xs" data-i18n="show">SHOW</span>
                                            </button>
                                        </div>
                                        <div class="flex justify-between mt-2">
                                            <p class="text-xs text-gray-400" data-i18n="encrypted-local-storage">ENCRYPTED LOCAL STORAGE</p>
                                            <button type="button" onclick="testApiKey()" class="text-xs text-white hover:bg-white hover:text-black px-2 py-1 border border-white" data-i18n="test-connection">
                                                <span data-i18n="test-connection">TEST CONNECTION</span>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="model-selection">MODEL</label>
                                            <select id="deepseek-model" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="deepseek-chat" selected data-i18n="deepseek-chat">DeepSeek Chat (Recommended)</option>
                                                <option value="deepseek-coder" data-i18n="deepseek-coder">DeepSeek Coder</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="temperature">TEMPERATURE</label>
                                            <select id="deepseek-temperature" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="0.1" data-i18n="temp-conservative">0.1 CONSERVATIVE</option>
                                                <option value="0.3" selected data-i18n="temp-balanced">0.3 BALANCED</option>
                                                <option value="0.5" data-i18n="temp-moderate">0.5 MODERATE</option>
                                                <option value="0.7" data-i18n="temp-aggressive">0.7 AGGRESSIVE</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div>
                                        <label class="flex items-center justify-between py-2 border border-white hover:bg-white hover:text-black px-2 cursor-pointer">
                                            <span class="text-xs font-mono" data-i18n="enable-ai-signals">ENABLE AI SIGNALS</span>
                                            <input type="checkbox" id="ai-signals-enabled" checked class="bg-black border-white">
                                        </label>
                                    </div>

                                    <div class="mt-4">
                                        <button onclick="saveAiConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors" data-i18n="save-config">
                                            SAVE CONFIGURATION
                                        </button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- API Status -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="api-status">API STATUS</div>
                                
                                <div id="api-status-display" class="space-y-2">
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono">CONNECTION</span>
                                        <span id="connection-status" class="text-xs font-mono" data-i18n="not-configured">NOT CONFIGURED</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono" data-i18n="model">MODEL</span>
                                        <span id="current-model" class="text-xs font-mono">NONE</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2 border-b border-gray-600">
                                        <span class="text-xs font-mono">AI RESPONSES</span>
                                        <span id="signals-today-mini" data-signal-count="true" class="text-xs font-mono">0</span>
                                    </div>
                                    
                                    <div class="flex justify-between py-2">
                                        <span class="text-xs font-mono" data-i18n="success-rate-label">SUCCESS RATE</span>
                                        <span id="ai-success-rate" class="text-xs font-mono">0%</span>
                                    </div>
                                </div>
                                
                                <!-- API Usage Info -->
                                <div class="border border-white mt-4 p-3">
                                    <div class="text-xs font-mono text-white mb-2">API INFORMATION</div>
                                    <div class="text-xs text-gray-300 space-y-1">
                                        <p>‚Ä¢ GET API KEY: platform.deepseek.com</p>
                                        <p>‚Ä¢ LOWER TEMPERATURE = MORE CONSERVATIVE</p>
                                        <p>‚Ä¢ TEST CONNECTION BEFORE TRADING</p>
                                        <p>‚Ä¢ API CALLS ARE RATE LIMITED</p>
                                    </div>
                                </div>

                                <!-- ÈÖçÁΩÆÊèêÁ§∫ -->
                                <div id="ai-config-warning" class="border border-yellow-500 bg-yellow-900/20 mt-4 p-3" style="display: none;">
                                    <div class="text-xs font-mono text-yellow-300 mb-2">‚ö†Ô∏è AIÊú™ÈÖçÁΩÆ</div>
                                    <div class="text-xs text-yellow-200 space-y-1">
                                        <p>ËØ∑ÈÖçÁΩÆËá≥Â∞ë‰∏Ä‰∏™AI Provider:</p>
                                        <p>‚Ä¢ DeepSeek (Êé®Ëçê)</p>
                                        <p>‚Ä¢ OpenAI (GPT-4)</p>
                                        <p>‚Ä¢ Claude (Sonnet)</p>
                                    </div>
                                </div>
                            </div>

                            <!-- OpenAI API Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">OPENAI API CONFIGURATION</div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="api-key">API KEY</label>
                                        <div class="relative">
                                            <input
                                                type="password"
                                                id="openai-api-key"
                                                placeholder="Enter OpenAI API Key (sk-...)"
                                                autocomplete="new-password"
                                                class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <button type="button" onclick="toggleOpenAIKeyVisibility()" class="absolute right-2 top-2 text-white hover:text-gray-300">
                                                <span id="openai-key-toggle-icon" class="text-xs" data-i18n="show">SHOW</span>
                                            </button>
                                        </div>
                                        <div class="flex justify-between mt-2">
                                            <p class="text-xs text-gray-400" data-i18n="encrypted-local-storage">ENCRYPTED LOCAL STORAGE</p>
                                            <button type="button" onclick="testOpenAIConnection()" class="text-xs text-white hover:bg-white hover:text-black px-2 py-1 border border-white" data-i18n="test-connection">
                                                TEST CONNECTION
                                            </button>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="model-selection">MODEL</label>
                                            <select id="openai-model" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="gpt-4o">GPT-4o (Latest)</option>
                                                <option value="gpt-4o-mini" selected>GPT-4o Mini (Recommended)</option>
                                                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="temperature">TEMPERATURE</label>
                                            <select id="openai-temperature" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="0.1">0.1 CONSERVATIVE</option>
                                                <option value="0.3" selected>0.3 BALANCED</option>
                                                <option value="0.5">0.5 MODERATE</option>
                                                <option value="0.7">0.7 AGGRESSIVE</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <button onclick="saveOpenAIConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                            SAVE OPENAI CONFIG
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Claude API Configuration -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">CLAUDE API CONFIGURATION</div>

                                <div class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-mono text-white mb-2" data-i18n="api-key">API KEY</label>
                                        <div class="relative">
                                            <input
                                                type="password"
                                                id="claude-api-key"
                                                placeholder="Enter Claude API Key (sk-ant-...)"
                                                autocomplete="new-password"
                                                class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <button type="button" onclick="toggleClaudeKeyVisibility()" class="absolute right-2 top-2 text-white hover:text-gray-300">
                                                <span id="claude-key-toggle-icon" class="text-xs" data-i18n="show">SHOW</span>
                                            </button>
                                        </div>
                                        <div class="flex justify-between mt-2">
                                            <p class="text-xs text-gray-400" data-i18n="encrypted-local-storage">ENCRYPTED LOCAL STORAGE</p>
                                            <button type="button" onclick="testClaudeConnection()" class="text-xs text-white hover:bg-white hover:text-black px-2 py-1 border border-white" data-i18n="test-connection">
                                                TEST CONNECTION
                                            </button>
                                        </div>
                                    </div>

                                    <div class="grid grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="model-selection">MODEL</label>
                                            <select id="claude-model" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="claude-3-5-sonnet-20241022" selected>Claude 3.5 Sonnet (Recommended)</option>
                                                <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                                                <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
                                                <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                                            </select>
                                        </div>

                                        <div>
                                            <label class="block text-xs font-mono text-white mb-2" data-i18n="temperature">TEMPERATURE</label>
                                            <select id="claude-temperature" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                                <option value="0.1">0.1 CONSERVATIVE</option>
                                                <option value="0.3" selected>0.3 BALANCED</option>
                                                <option value="0.5">0.5 MODERATE</option>
                                                <option value="0.7">0.7 AGGRESSIVE</option>
                                            </select>
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <button onclick="saveClaudeConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                            SAVE CLAUDE CONFIG
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- AI Providers Status Overview -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">ALL PROVIDERS STATUS</div>

                                <div class="space-y-3">
                                    <!-- DeepSeek Status -->
                                    <div class="border border-white p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-xs font-mono font-bold">DEEPSEEK</span>
                                            <span id="deepseek-connection-status" class="text-xs font-mono text-gray-400">NOT CONFIGURED</span>
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            <div class="flex justify-between"><span>Model:</span><span id="deepseek-current-model">NONE</span></div>
                                            <div class="flex justify-between"><span>Temperature:</span><span id="deepseek-current-temp">0.3</span></div>
                                        </div>
                                    </div>

                                    <!-- OpenAI Status -->
                                    <div class="border border-white p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-xs font-mono font-bold">OPENAI</span>
                                            <span id="openai-connection-status" class="text-xs font-mono text-gray-400">NOT CONFIGURED</span>
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            <div class="flex justify-between"><span>Model:</span><span id="openai-current-model">NONE</span></div>
                                            <div class="flex justify-between"><span>Temperature:</span><span id="openai-current-temp">0.3</span></div>
                                        </div>
                                    </div>

                                    <!-- Claude Status -->
                                    <div class="border border-white p-3">
                                        <div class="flex justify-between items-center mb-2">
                                            <span class="text-xs font-mono font-bold">CLAUDE</span>
                                            <span id="claude-connection-status" class="text-xs font-mono text-gray-400">NOT CONFIGURED</span>
                                        </div>
                                        <div class="text-xs text-gray-400">
                                            <div class="flex justify-between"><span>Model:</span><span id="claude-current-model">NONE</span></div>
                                            <div class="flex justify-between"><span>Temperature:</span><span id="claude-current-temp">0.3</span></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- API Information -->
                                <div class="border border-white mt-4 p-3">
                                    <div class="text-xs font-mono text-white mb-2">API INFORMATION</div>
                                    <div class="text-xs text-gray-300 space-y-1">
                                        <p>‚Ä¢ DEEPSEEK: platform.deepseek.com</p>
                                        <p>‚Ä¢ OPENAI: platform.openai.com</p>
                                        <p>‚Ä¢ CLAUDE: console.anthropic.com</p>
                                        <p>‚Ä¢ TEST CONNECTION BEFORE TRADING</p>
                                        <p>‚Ä¢ API CALLS ARE RATE LIMITED</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Data Source Configuration Tab -->
                    <div id="settings-trading" class="settings-tab-content hidden">
                        <!-- Trading Platform Configuration -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                            <!-- Trading Platforms -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="trading-platforms">TRADING PLATFORMS</div>
                                
                                <!-- Binance Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2" data-i18n="binance">BINANCE</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="binance-api-key" 
                                            placeholder="Binance API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="binance-secret-key" 
                                            placeholder="Binance Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex gap-2">
                                            <button onclick="testBinanceConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveBinanceConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- OKX Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2" data-i18n="okx">OKX</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="okx-api-key" 
                                            placeholder="OKX API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="okx-secret-key" 
                                            placeholder="OKX Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="okx-passphrase" 
                                            placeholder="OKX Passphrase"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex gap-2">
                                            <button onclick="testOKXConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveOKXConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Alpaca Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2">ALPACA (US STOCKS)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="alpaca-api-key" 
                                            placeholder="Alpaca API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="alpaca-secret-key" 
                                            placeholder="Alpaca Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <select id="alpaca-environment" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="paper" data-i18n="paper-trading">PAPER TRADING</option>
                                            <option value="live" data-i18n="live-trading">LIVE TRADING</option>
                                        </select>
                                        <div class="flex gap-2">
                                            <button onclick="testAlpacaConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveAlpacaConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Interactive Brokers Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2" data-i18n="interactive-brokers-global">INTERACTIVE BROKERS (GLOBAL)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="text" 
                                            id="ib-host" 
                                            placeholder="TWS/Gateway Host (127.0.0.1)"
                                            value="127.0.0.1"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="number" 
                                            id="ib-port" 
                                            placeholder="Port (7497 for TWS, 4002 for Gateway)"
                                            value="7497"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="number" 
                                            id="ib-client-id" 
                                            placeholder="Client ID"
                                            value="1"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex gap-2">
                                            <button onclick="testIBConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveIBConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Coinbase Pro Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2">COINBASE PRO (CRYPTO)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="coinbase-api-key" 
                                            placeholder="Coinbase Pro API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="coinbase-secret-key" 
                                            placeholder="Coinbase Pro Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="coinbase-passphrase" 
                                            placeholder="Coinbase Pro Passphrase"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <select id="coinbase-environment" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                            <option value="sandbox" data-i18n="sandbox">SANDBOX</option>
                                            <option value="live" data-i18n="live-trading">LIVE TRADING</option>
                                        </select>
                                        <div class="flex gap-2">
                                            <button onclick="testCoinbaseConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveCoinbaseConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Kraken Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2">KRAKEN (CRYPTO)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="kraken-api-key" 
                                            placeholder="Kraken API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="kraken-secret-key" 
                                            placeholder="Kraken Private Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex gap-2">
                                            <button onclick="testKrakenConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveKrakenConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Tushare Pro Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2">TUSHARE PRO (AËÇ°Êï∞ÊçÆ)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="tushare-token" 
                                            placeholder="Tushare Token"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="text-xs text-gray-400 mb-2">
                                            Ëé∑ÂèñToken: tushare.pro ‚Üí Ê≥®ÂÜå ‚Üí Áî®Êà∑‰∏≠ÂøÉ ‚Üí Êé•Âè£Token
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="testTushareConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveTushareConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- CoinMarketCap Configuration -->
                                <div class="mb-6">
                                    <div class="text-xs font-mono text-white mb-2">COINMARKETCAP (Êï∞ÊçÆÊ∫ê)</div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="cmc-api-key" 
                                            placeholder="CoinMarketCap API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="text-xs text-gray-400 mb-2">
                                            Ëé∑ÂèñÂÖçË¥πAPI: coinmarketcap.com/api ‚Üí Âü∫Á°ÄËÆ°ÂàíÊØèÊúà10KËØ∑Ê±Ç
                                        </div>
                                        <div class="flex gap-2">
                                            <button onclick="testCMCConnection()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                            <button onclick="saveCMCConfig()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                SAVE
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Platform Status and Data Sources -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="platform-status">PLATFORM STATUS</div>
                                
                                <div class="space-y-4">
                                    <!-- Trading Platform Status -->
                                    <div>
                                        <div class="text-xs font-mono text-white mb-2">TRADING PLATFORMS</div>
                                        <div class="border border-white p-3 space-y-2">
                                            <div class="flex justify-between">
                                                <span>BINANCE</span>
                                                <span id="binance-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>OKX</span>
                                                <span id="okx-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>ALPACA</span>
                                                <span id="alpaca-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>INTERACTIVE BROKERS</span>
                                                <span id="ib-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>COINBASE PRO</span>
                                                <span id="coinbase-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>KRAKEN</span>
                                                <span id="kraken-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Data Sources Status -->
                                    <div>
                                        <div class="text-xs font-mono text-white mb-2" data-i18n="data-source-status">DATA SOURCES</div>
                                        <div class="border border-white p-3 space-y-2">
                                            <div class="flex justify-between">
                                                <span>YAHOO FINANCE</span>
                                                <span class="text-green-400">ACTIVE</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>AKSHARE</span>
                                                <span class="text-green-400">ACTIVE</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>TUSHARE PRO</span>
                                                <span id="tushare-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                            <div class="flex justify-between">
                                                <span>COINMARKETCAP</span>
                                                <span id="cmc-status" class="text-gray-400">NOT CONFIGURED</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- API Information -->
                                    <div class="border border-white p-3">
                                        <div class="text-xs font-mono text-white mb-2">API INFORMATION</div>
                                        <div class="text-xs text-gray-300 space-y-1">
                                            <p>‚Ä¢ BINANCE: binance.com ‚Üí API Management</p>
                                            <p>‚Ä¢ OKX: okx.com ‚Üí API Keys</p>
                                            <p>‚Ä¢ ALPACA: alpaca.markets ‚Üí Paper/Live</p>
                                            <p>‚Ä¢ ALL KEYS STORED ENCRYPTED</p>
                                            <p>‚Ä¢ TEST CONNECTIONS BEFORE USE</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Data Source Configuration (Tushare) -->
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="data-source-configuration">DATA SOURCE CONFIGURATION</div>
                            
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="tushare-token-label-extended">TUSHARE TOKEN (PROFESSIONAL DATA)</label>
                                    <input 
                                        type="password" 
                                        id="tushare-token-modal" 
                                        placeholder="Enter Tushare Professional Token"
                                        class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black mb-2">
                                    
                                    <button onclick="saveTushareConfig()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors" data-i18n="save-data-source">
                                        SAVE DATA SOURCE CONFIG
                                    </button>
                                    
                                    <div id="config-status-modal" data-config-status="true" class="mt-4 text-xs font-mono"></div>
                                </div>
                                
                                <div>
                                    <div class="text-xs font-mono text-white mb-2">ADDITIONAL DATA PROVIDERS</div>
                                    <div class="border border-white p-3 space-y-2">
                                        <div class="flex justify-between">
                                            <span>QUANDL</span>
                                            <span class="text-gray-400">AVAILABLE</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>ALPHA VANTAGE</span>
                                            <span class="text-gray-400">AVAILABLE</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>IEX CLOUD</span>
                                            <span class="text-gray-400">AVAILABLE</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Backtest Tab -->
                    <div id="settings-backtest" class="settings-tab-content hidden">
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="strategy-backtesting">STRATEGY BACKTESTING</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2" data-i18n="strategy">STRATEGY</label>
                                    <select id="backtest-strategy" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="momentum" data-i18n="momentum">MOMENTUM</option>
                                        <option value="mean_reversion" data-i18n="mean-reversion">MEAN REVERSION</option>
                                        <option value="breakout" data-i18n="breakout">BREAKOUT</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">INITIAL CAPITAL</label>
                                    <input type="number" id="backtest-capital" value="100000" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">SYMBOLS</label>
                                    <input type="text" id="backtest-symbols" value="AAPL,MSFT,GOOGL" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">PERIOD</label>
                                    <select id="backtest-period" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="3m">3 MONTHS</option>
                                        <option value="6m" selected>6 MONTHS</option>
                                        <option value="1y">1 YEAR</option>
                                    </select>
                                </div>
                                
                                <div class="flex items-end">
                                    <button onclick="runBacktest()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        RUN BACKTEST
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Backtest Results -->
                            <div id="backtest-results" class="mt-6 border border-white p-4 hidden">
                                <div class="text-xs font-mono text-white mb-2 border-b border-white pb-2">BACKTEST RESULTS</div>
                                <div id="backtest-output" class="text-xs font-mono text-green-400"></div>
                            </div>
                        </div>
                    </div>

                    <!-- Services Configuration Tab -->
                    <div id="settings-services" class="settings-tab-content hidden">
                        <!-- Services Health Overview -->
                        <div class="border border-white p-4 mb-6">
                            <div class="flex items-center justify-between mb-4 border-b border-white pb-2">
                                <div class="text-xs font-mono text-white" data-i18n="services-health">SERVICES HEALTH</div>
                                <div class="flex items-center space-x-4">
                                    <div id="overall-health" class="text-xs font-mono text-green-400">95.2%</div>
                                    <button onclick="performFullHealthCheck()" class="px-2 py-1 border border-white text-white text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        <span data-i18n="check-all">CHECK ALL</span>
                                    </button>
                                </div>
                            </div>
                            <div id="services-status-grid" class="grid grid-cols-2 md:grid-cols-4 gap-2">
                                <!-- Services status will be populated here -->
                            </div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Data Sources -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="data-sources">DATA SOURCES</div>
                                
                                <!-- Yahoo Finance -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">YAHOO FINANCE</span>
                                        <span id="yahoo-status" class="text-xs font-mono text-green-400">CONNECTED</span>
                                    </div>
                                    <button onclick="testDataSourceConnection('yahoo_finance')" class="w-full bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        <span data-i18n="test-connection">TEST CONNECTION</span>
                                    </button>
                                </div>

                                <!-- Tushare -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">TUSHARE</span>
                                        <span id="tushare-status" class="text-xs font-mono text-red-400">NOT CONFIGURED</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input
                                            type="password"
                                            id="tushare-service-token"
                                            placeholder="Enter Tushare Token"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex space-x-2">
                                            <button onclick="configureTushare()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                <span data-i18n="configure">CONFIGURE</span>
                                            </button>
                                            <button onclick="testDataSourceConnection('tushare')" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- AkShare -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">AKSHARE</span>
                                        <span id="akshare-status" class="text-xs font-mono text-green-400">ENABLED</span>
                                    </div>
                                    <button onclick="testDataSourceConnection('akshare')" class="w-full bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        <span data-i18n="test-connection">TEST CONNECTION</span>
                                    </button>
                                </div>
                            </div>

                            <!-- Trading Platforms -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="trading-platforms">TRADING PLATFORMS</div>
                                
                                <!-- Alpaca -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">ALPACA</span>
                                        <span id="alpaca-status" class="text-xs font-mono text-red-400">NOT CONFIGURED</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input
                                            type="password"
                                            id="alpaca-api-key-platform"
                                            placeholder="Alpaca API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input
                                            type="password"
                                            id="alpaca-secret-key-platform"
                                            placeholder="Alpaca Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex space-x-2">
                                            <button onclick="configureAlpaca()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                <span data-i18n="configure">CONFIGURE</span>
                                            </button>
                                            <button onclick="testTradingPlatformConnection('alpaca')" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Binance -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">BINANCE</span>
                                        <span id="binance-status" class="text-xs font-mono text-yellow-400">TESTNET</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input 
                                            type="password" 
                                            id="binance-api-key-new" 
                                            placeholder="Binance API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <input 
                                            type="password" 
                                            id="binance-secret-key-new" 
                                            placeholder="Binance Secret Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex space-x-2">
                                            <button onclick="configureBinanceNew()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                <span data-i18n="configure">CONFIGURE</span>
                                            </button>
                                            <button onclick="testCryptoExchangeConnection('binance')" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- AI Services -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="ai-services">AI SERVICES</div>
                                
                                <!-- OpenAI -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">OPENAI</span>
                                        <span id="openai-status" class="text-xs font-mono text-red-400">NOT CONFIGURED</span>
                                    </div>
                                    <div class="space-y-2">
                                        <input
                                            type="password"
                                            id="openai-service-key"
                                            placeholder="OpenAI API Key"
                                            class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <div class="flex space-x-2">
                                            <button onclick="configureOpenAI()" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                <span data-i18n="configure">CONFIGURE</span>
                                            </button>
                                            <button onclick="testAIServiceConnection('openai')" class="flex-1 bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                                TEST
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Database Services -->
                            <div class="border border-white p-4">
                                <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2" data-i18n="database-services">DATABASE SERVICES</div>
                                
                                <!-- Redis -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">REDIS</span>
                                        <span id="redis-status" class="text-xs font-mono text-green-400">CONNECTED</span>
                                    </div>
                                    <button onclick="testDatabaseConnection('redis')" class="w-full bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        <span data-i18n="test-connection">TEST CONNECTION</span>
                                    </button>
                                </div>

                                <!-- PostgreSQL -->
                                <div class="mb-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-xs font-mono text-white">POSTGRESQL</span>
                                        <span id="postgresql-status" class="text-xs font-mono text-green-400">CONNECTED</span>
                                    </div>
                                    <button onclick="testDatabaseConnection('postgresql')" class="w-full bg-black text-white border border-white py-1 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        <span data-i18n="test-connection">TEST CONNECTION</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Indicators Tab -->
                    <div id="settings-indicators" class="settings-tab-content hidden">
                        <div class="border border-white p-4">
                            <div class="text-xs font-mono text-white mb-4 border-b border-white pb-2">TECHNICAL INDICATORS</div>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">INDICATOR</label>
                                    <select id="indicator-type" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                        <option value="sma">SMA (Simple Moving Average)</option>
                                        <option value="ema">EMA (Exponential Moving Average)</option>
                                        <option value="rsi">RSI (Relative Strength Index)</option>
                                        <option value="bollinger">BOLLINGER BANDS</option>
                                        <option value="macd">MACD</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">SYMBOL</label>
                                    <input type="text" id="indicator-symbol" value="AAPL" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                            </div>
                            
                            <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">PERIOD</label>
                                    <input type="number" id="indicator-period" value="20" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div>
                                    <label class="block text-xs font-mono text-white mb-2">DATA POINTS</label>
                                    <input type="number" id="indicator-points" value="100" class="w-full bg-black text-white border border-white p-2 text-xs font-mono focus:outline-none focus:bg-white focus:text-black">
                                </div>
                                
                                <div class="flex items-end">
                                    <button onclick="calculateIndicators()" class="w-full bg-black text-white border border-white py-2 text-xs font-mono hover:bg-white hover:text-black transition-colors">
                                        CALCULATE
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Indicator Results -->
                            <div id="indicator-results" class="mt-6 border border-white p-4 hidden">
                                <div class="text-xs font-mono text-white mb-2 border-b border-white pb-2">INDICATOR RESULTS</div>
                                <div id="indicator-output" class="text-xs font-mono text-green-400"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜÂô® ====================

        // üî• ÊçïËé∑Êú™Â§ÑÁêÜÁöÑPromiseÈîôËØØÔºàÈÄöÂ∏∏Êù•Ëá™ÊµèËßàÂô®Êâ©Â±ïÔºâ
        window.addEventListener('unhandledrejection', function(event) {
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÊµèËßàÂô®Êâ©Â±ïÂºïËµ∑ÁöÑÈîôËØØ
            const errorMessage = event.reason?.message || event.reason || '';
            const isExtensionError = errorMessage.includes('message channel closed') ||
                                   errorMessage.includes('Extension context') ||
                                   errorMessage.includes('chrome.runtime');

            if (isExtensionError) {
                // ÈùôÈªòÂ§ÑÁêÜÊâ©Â±ïÈîôËØØÔºå‰∏çÂΩ±ÂìçÁî®Êà∑‰ΩìÈ™å
                event.preventDefault();
                console.debug('üîá Â∑≤ÊçïËé∑ÊµèËßàÂô®Êâ©Â±ïÈîôËØØÔºàÂ∑≤ÂøΩÁï•Ôºâ:', errorMessage.substring(0, 100));
            } else {
                // Â∫îÁî®Áõ∏ÂÖ≥ÈîôËØØÔºåËÆ∞ÂΩï‰ΩÜ‰∏ç‰∏≠Êñ≠
                console.error('‚ö†Ô∏è Êú™Â§ÑÁêÜÁöÑPromiseÈîôËØØ:', event.reason);
                event.preventDefault(); // Èò≤Ê≠¢ÊéßÂà∂Âè∞ÊòæÁ§∫Á∫¢Ëâ≤ÈîôËØØ
            }
        });

        // üî• ÊçïËé∑ÂÖ®Â±ÄÈîôËØØ
        window.addEventListener('error', function(event) {
            const errorMessage = event.message || '';
            const isExtensionError = errorMessage.includes('Extension') ||
                                   errorMessage.includes('chrome-extension');

            if (isExtensionError) {
                event.preventDefault();
                console.debug('üîá Â∑≤ÊçïËé∑ÊµèËßàÂô®Êâ©Â±ïÈîôËØØÔºàÂ∑≤ÂøΩÁï•Ôºâ');
                return false;
            }
        });

        // ==================== ÈîôËØØÂ§ÑÁêÜÂíåÂ∫ìÊ£ÄÊü• ====================
        console.log('üöÄ ÂºÄÂßãÂä†ËΩΩArthera‰∫§ÊòìÁ≥ªÁªüJavaScript...');

        // Ê∏ÖÈô§ÊóßÁöÑÊúçÂä°ÈÖçÁΩÆÁºìÂ≠òÔºåÁ°Æ‰øù‰ΩøÁî®ÊúÄÊñ∞ÈÖçÁΩÆ
        try {
            localStorage.removeItem('arthera-service-config');
            console.log('‚úÖ Â∑≤Ê∏ÖÈô§ÊóßÁöÑÊúçÂä°ÈÖçÁΩÆÁºìÂ≠ò');
        } catch (error) {
            console.warn('‚ö†Ô∏è Ê∏ÖÈô§ÊúçÂä°ÈÖçÁΩÆÁºìÂ≠òÂ§±Ë¥•:', error);
        }
        
        // Âº∫Âà∂Âà∑Êñ∞È°µÈù¢ÈÖçÁΩÆ‰ª•‰ΩøÁî®Ê≠£Á°ÆÁöÑÁ´ØÂè£
        window.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (typeof populateServiceConfigForm === 'function') {
                    populateServiceConfigForm();
                    console.log('‚úÖ Â∑≤ÈáçÊñ∞Âä†ËΩΩÊúçÂä°ÈÖçÁΩÆË°®Âçï');
                }
            }, 100);
        });

        // ==================== ÈîôËØØÂ§ÑÁêÜ ====================
        
        // ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ - Èò≤Ê≠¢Êâ©Â±ï‰∏ä‰∏ãÊñáÈîôËØØÂΩ±ÂìçÈ°µÈù¢ÂäüËÉΩ
        window.addEventListener('error', function(event) {
            const errorMsg = event.error?.message || event.message || '';
            const fileName = event.filename || '';

            // Ê£ÄÊü•ÊòØÂê¶‰∏∫Êâ©Â±ïÁõ∏ÂÖ≥ÈîôËØØÊàñÊµèËßàÂô®Êâ©Â±ïÁº∫Â§±Êñá‰ª∂
            if (errorMsg.includes('Extension context invalidated') ||
                errorMsg.includes('message port closed') ||
                errorMsg.includes('Extension context') ||
                errorMsg.includes('chrome-extension://') ||
                errorMsg.includes('moz-extension://') ||
                errorMsg.includes('Invalid response received') ||
                fileName.includes('content.js') ||
                fileName.includes('extension://') ||
                fileName.includes('chrome-extension://') ||
                fileName.includes('moz-extension://') ||
                fileName.includes('utils.js') ||
                fileName.includes('extensionState.js') ||
                fileName.includes('heuristicsRedefinitions.js') ||
                errorMsg.includes('utils.js') ||
                errorMsg.includes('extensionState.js') ||
                errorMsg.includes('heuristicsRedefinitions.js')) {
                // ÈùôÈªòÂ§ÑÁêÜÊâ©Â±ïÁõ∏ÂÖ≥ÈîôËØØÔºå‰∏çÂΩ±ÂìçÈ°µÈù¢ÂäüËÉΩ
                event.preventDefault();
                event.stopPropagation();
                event.stopImmediatePropagation();
                console.debug('üîá ÊµèËßàÂô®Êâ©Â±ïÁõ∏ÂÖ≥ÈîôËØØÂ∑≤ÈùôÈªòÂ§ÑÁêÜ');
                return false;
            }
        }, true);
        
        // ÊçïËé∑Êú™Â§ÑÁêÜÁöÑPromiseÊãíÁªù
        window.addEventListener('unhandledrejection', function(event) {
            const reason = event.reason?.message || event.reason || '';
            const stack = event.reason?.stack || '';

            if (typeof reason === 'string' &&
                (reason.includes('Extension context invalidated') ||
                 reason.includes('message port closed') ||
                 reason.includes('Extension context') ||
                 reason.includes('chrome-extension://') ||
                 reason.includes('moz-extension://') ||
                 reason.includes('Invalid response received') ||
                 reason.includes('A listener indicated an asynchronous response') ||
                 reason.includes('message channel closed') ||
                 reason.includes('Could not establish connection') ||
                 reason.includes('Receiving end does not exist') ||
                 reason.includes('runtime.lastError') ||
                 stack.includes('content.js') ||
                 stack.includes('extension://') ||
                 stack.includes('chrome-extension://') ||
                 stack.includes('moz-extension://') ||
                 stack.includes('utils.js') ||
                 stack.includes('extensionState.js') ||
                 stack.includes('heuristicsRedefinitions.js'))) {
                // ÈùôÈªòÂ§ÑÁêÜÊâ©Â±ïÁõ∏ÂÖ≥PromiseÈîôËØØ
                event.preventDefault();
                console.debug('üîá ÊµèËßàÂô®Êâ©Â±ïPromiseÈîôËØØÂ∑≤ÈùôÈªòÂ§ÑÁêÜ');
                return;
            }
        }, true);

        // Êã¶Êà™console.errorÔºåËøáÊª§ÊéâÊµèËßàÂô®Êâ©Â±ïÁõ∏ÂÖ≥ÈîôËØØ
        const originalConsoleError = console.error;
        console.error = function(...args) {
            const errorMsg = args.join(' ');

            // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÊµèËßàÂô®Êâ©Â±ïÁõ∏ÂÖ≥ÈîôËØØ
            if (errorMsg.includes('runtime.lastError') ||
                errorMsg.includes('Could not establish connection') ||
                errorMsg.includes('Receiving end does not exist') ||
                errorMsg.includes('Extension context invalidated') ||
                errorMsg.includes('message port closed') ||
                errorMsg.includes('message channel closed') ||
                errorMsg.includes('chrome-extension://') ||
                errorMsg.includes('moz-extension://') ||
                errorMsg.includes('utils.js') ||
                errorMsg.includes('extensionState.js') ||
                errorMsg.includes('heuristicsRedefinitions.js')) {
                // ÈùôÈªòÂ§ÑÁêÜÔºå‰∏çËæìÂá∫Âà∞ÊéßÂà∂Âè∞
                console.debug('üîá Â∑≤ËøáÊª§ÊµèËßàÂô®Êâ©Â±ïÈîôËØØ:', errorMsg.substring(0, 100));
                return;
            }

            // ÂÖ∂‰ªñÈîôËØØÊ≠£Â∏∏ËæìÂá∫
            originalConsoleError.apply(console, args);
        };

        const SERVICE_CONFIG_STORAGE_KEY = 'arthera-service-config';

        const DEFAULT_SERVICE_CONFIG = {
            apiGateway: 'http://localhost:8001',
            quantEngine: 'http://localhost:8001',
            aiAgents: 'http://localhost:8001',
            riskManagement: 'http://localhost:8001',
            cryptoConnectors: 'http://localhost:8001',
            backtestingEngine: 'http://localhost:8001',
            iosConnector: 'http://localhost:8001',
            portfolioService: 'http://localhost:8001'
        };

        function readPersistedServiceConfig() {
            const merged = { ...DEFAULT_SERVICE_CONFIG };
            try {
                const stored = JSON.parse(localStorage.getItem(SERVICE_CONFIG_STORAGE_KEY)) || {};
                Object.keys(stored).forEach(key => {
                    if (merged[key] !== undefined) {
                        merged[key] = normalizeEndpointUrl(stored[key], merged[key]);
                    }
                });
            } catch (error) {
                console.warn('Êó†Ê≥ïËß£ÊûêÊú¨Âú∞ÊúçÂä°ÈÖçÁΩÆ:', error);
            }
            return merged;
        }

        if (!window.__TRADING_ENGINE_CONFIG__) {
            window.__TRADING_ENGINE_CONFIG__ = {};
        }
        Object.assign(window.__TRADING_ENGINE_CONFIG__, readPersistedServiceConfig());
        
        // ÂàùÂßãÂåñÂêéÁ´ØÂèØÁî®ÊÄßÁä∂ÊÄÅ
        if (typeof window.backendAvailable === 'undefined') {
            window.backendAvailable = true; // ÈªòËÆ§ÂÅáËÆæÂêéÁ´ØÂèØÁî®
        }

        // Ê£ÄÊü•Â§ñÈÉ®‰æùËµñ
        window.addEventListener('error', function(e) {
            console.error('‚ùå È°µÈù¢ÈîôËØØ:', e.error);
            if (e.error && e.error.message && e.error.message.includes('Chart')) {
                console.warn('‚ö†Ô∏è Chart.jsÂ∫ìÂä†ËΩΩÂ§±Ë¥•ÔºåÂõæË°®ÂäüËÉΩÂ∞ÜË¢´Á¶ÅÁî®');
            }
        });
        
        // ÂÆâÂÖ®ÁöÑChart.jsÊ£ÄÊü•
        function isChartAvailable() {
            return typeof Chart !== 'undefined';
        }
        
        // ÈÄöÁî®ÁöÑÂÆâÂÖ®ÂõæË°®ÂàõÂª∫ÂáΩÊï∞
        function safeCreateChart(chartId, chartType, config, chartName = 'ÂõæË°®') {
            try {
                if (!isChartAvailable()) {
                    console.warn(`‚ö†Ô∏è Chart.jsÊú™Âä†ËΩΩÔºåË∑≥Ëøá${chartName}ÂàùÂßãÂåñ`);
                    return null;
                }
                
                const chartElement = document.getElementById(chartId);
                if (!chartElement) {
                    console.warn(`‚ö†Ô∏è ${chartId}ÂÖÉÁ¥†‰∏çÂ≠òÂú®`);
                    return null;
                }
                
                // ÈîÄÊØÅÁé∞ÊúâÂõæË°®ÈÅøÂÖçÈáçÂ§çÂàùÂßãÂåñ
                if (charts[chartType]) {
                    try {
                        charts[chartType].destroy();
                    } catch (e) {
                        console.warn(`‚ö†Ô∏è ÈîÄÊØÅÊóß${chartName}Êó∂Âá∫Èîô:`, e);
                    }
                    charts[chartType] = null;
                }
                
                const ctx = chartElement.getContext('2d');
                
                try {
                    const chart = new Chart(ctx, config);
                    charts[chartType] = chart;
                    console.log(`‚úÖ ${chartName}ÂàùÂßãÂåñÊàêÂäü`);
                    return chart;
                } catch (chartError) {
                    console.error(`‚ùå Chart.jsÂàõÂª∫${chartName}Â§±Ë¥•:`, chartError);
                    // ÊòæÁ§∫Â§±Ë¥•ÊèêÁ§∫
                    chartElement.innerHTML = `<div class="flex items-center justify-center h-full text-white text-xs opacity-70">${chartName}Âä†ËΩΩÂ§±Ë¥•</div>`;
                    return null;
                }
                
            } catch (error) {
                console.error(`‚ùå ${chartName}ÂàùÂßãÂåñÂ§±Ë¥•:`, error);
                return null;
            }
        }
        
        // ÊµãËØïÂáΩÊï∞ÂÆö‰πâ
        function testFunctionDefinition() {
            console.log('üß™ ÊµãËØïÂáΩÊï∞ÊòØÂê¶Ê≠£Á°ÆÂÆö‰πâ...');
            return 'JavaScriptÂáΩÊï∞ÂÆö‰πâÊµãËØïÈÄöËøá!';
        }
        
        // È™åËØÅÂÖ≥ÈîÆÂáΩÊï∞
        function validateCoreFunctions() {
            const requiredFunctions = ['setCapital', 'generateSignals', 'startAutoTrading', 'executeOrder', 'refreshAllData'];
            const missing = [];
            
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missing.push(funcName);
                }
            });
            
            if (missing.length > 0) {
                console.error('‚ùå Áº∫Â§±ÂáΩÊï∞:', missing);
                return false;
            } else {
                console.log('‚úÖ ÊâÄÊúâÊ†∏ÂøÉÂáΩÊï∞Â∑≤Ê≠£Á°ÆÂÆö‰πâ');
                return true;
            }
        }
        
        console.log('‚úÖ JavaScriptÂü∫Á°ÄÂáΩÊï∞Âä†ËΩΩÂÆåÊàê');
        
        // ==================== BloombergÈ£éÊ†ºËÆæÁΩÆÁõ∏ÂÖ≥ÂáΩÊï∞ ====================
        
        function openSettings() {
            document.getElementById('settings-modal').classList.remove('hidden');
            updateAllText(); // Á°Æ‰øùÁïåÈù¢ÊñáÊú¨ÊòØÊúÄÊñ∞ËØ≠Ë®Ä
        }
        
        function closeSettings() {
            document.getElementById('settings-modal').classList.add('hidden');
        }
        
        function switchSettingsTab(tabName) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÈ°µÂÜÖÂÆπ
            document.querySelectorAll('.settings-tab-content').forEach(tab => {
                tab.classList.add('hidden');
            });
            
            // ÁßªÈô§ÊâÄÊúâÊ†áÁ≠æÁöÑÊøÄÊ¥ªÁä∂ÊÄÅ - BloombergÈ£éÊ†º
            document.querySelectorAll('.settings-tab-btn').forEach(btn => {
                btn.classList.remove('bg-white', 'text-black');
                btn.classList.add('text-white');
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÈ°µ
            document.getElementById(`settings-${tabName}`).classList.remove('hidden');
            
            // ÊøÄÊ¥ªÈÄâ‰∏≠ÁöÑÊ†áÁ≠æ - BloombergÈ£éÊ†º
            const activeTab = document.getElementById(`tab-${tabName}`);
            activeTab.classList.add('bg-white', 'text-black');
            activeTab.classList.remove('text-white');
        }

        // APIÂØÜÈí•ÊòæÁ§∫ÂàáÊç¢ - BloombergÈ£éÊ†º
        function toggleApiKeyVisibility() {
            const input = document.getElementById('deepseek-api-key');
            const icon = document.getElementById('api-key-toggle-icon');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = window.t('hide');
            } else {
                input.type = 'password';
                icon.textContent = window.t('show');
            }
        }

        // ÊµãËØïDeepSeek APIËøûÊé•
        async function testApiKey() {
            const apiKey = document.getElementById('deepseek-api-key').value.trim();
            const model = document.getElementById('deepseek-model').value;
            
            if (!apiKey) {
                showToast(window.t('please-enter-api-key'), 'error');
                return;
            }
            
            if (!apiKey.startsWith('sk-')) {
                showToast(window.t('invalid-api-key-format'), 'error');
                return;
            }
            
            try {
                showToast(window.t('testing-connection'), 'info');
                
                const response = await fetch(`${API_BASE_URL}/api/ai/test-connection`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showToast(`‚úÖ ËøûÊé•ÊàêÂäü! Âª∂Ëøü: ${result.latency_ms}ms`, 'success');
                    
                    // Ëá™Âä®‰øùÂ≠òÈÖçÁΩÆ
                    await saveAiConfig();
                } else {
                    showToast(`‚ùå ËøûÊé•Â§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå APIÊµãËØïÂ§±Ë¥•:', error);
                showToast(`‚ùå ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // AIÈÖçÁΩÆ‰øùÂ≠ò - BloombergÈ£éÊ†º
        async function saveAiConfig() {
            const apiKey = document.getElementById('deepseek-api-key').value.trim();
            const model = document.getElementById('deepseek-model').value;
            const temperature = parseFloat(document.getElementById('deepseek-temperature').value);
            const enabled = document.getElementById('ai-signals-enabled')?.checked || true;

            if (!apiKey) {
                showToast('ËØ∑ËæìÂÖ•API Key', 'error');
                return;
            }

            try {
                // ‰øùÂ≠òÂà∞ÂêéÁ´Ø
                const response = await fetch(`${API_BASE_URL}/api/ai/configure`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model,
                        temperature: temperature,
                        max_tokens: 8192  // DeepSeekÊúÄÂ§ßÊîØÊåÅ8192 tokens
                    })
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    // ÂêåÊó∂‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®ÔºàÂä†ÂØÜÔºâ
                    localStorage.setItem('arthera-ai-config', JSON.stringify({
                        apiKey: btoa(apiKey), // ÁÆÄÂçïÁºñÁ†Å
                        model: model,
                        temperature: temperature,
                        enabled: enabled,
                        savedAt: new Date().toISOString()
                    }));
                    
                    showToast(window.t('ai-config-saved'), 'success');
                    
                    // Âà∑Êñ∞AIÁä∂ÊÄÅ
                    await updateAIStatus();
                } else {
                    showToast(`‚ùå ÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òAIÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast(`‚ùå ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }
        
        // Êõ¥Êñ∞AIÁä∂ÊÄÅÊòæÁ§∫
        async function updateAIStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/ai/status`);
                const status = await response.json();

                console.log('ü§ñ AIÁä∂ÊÄÅÊõ¥Êñ∞:', status);

                // Êõ¥Êñ∞Áä∂ÊÄÅÊåáÁ§∫Âô®
                const statusElements = document.querySelectorAll('.ai-status-indicator');
                statusElements.forEach(el => {
                    if (status.configured) {
                        el.classList.remove('text-red-400');
                        el.classList.add('text-green-400');
                        el.textContent = '‚úÖ AIÂ∑≤ËøûÊé•';
                    } else {
                        el.classList.remove('text-green-400');
                        el.classList.add('text-red-400');
                        el.textContent = '‚ö†Ô∏è AIÊú™ÈÖçÁΩÆ';
                    }
                });

                // Êõ¥Êñ∞Âè≥‰æßAPIÁä∂ÊÄÅÊ°Ü
                const connectionStatusEl = document.getElementById('connection-status');
                if (connectionStatusEl) {
                    if (status.configured) {
                        connectionStatusEl.textContent = 'CONNECTED';
                        connectionStatusEl.classList.remove('text-gray-400', 'text-red-400');
                        connectionStatusEl.classList.add('text-green-400');
                    } else {
                        connectionStatusEl.textContent = window.t('not-configured') || 'NOT CONFIGURED';
                        connectionStatusEl.classList.remove('text-green-400');
                        connectionStatusEl.classList.add('text-gray-400');
                    }
                }

                // Êõ¥Êñ∞ÂΩìÂâçÊ®°Âûã
                const currentModelEl = document.getElementById('current-model');
                if (currentModelEl && status.current_config) {
                    currentModelEl.textContent = status.current_config.model || 'NONE';
                }

                // Êõ¥Êñ∞‰ªäÊó•‰ø°Âè∑Êï∞
                const signalsTodayEl = document.getElementById('signals-today-mini');
                if (signalsTodayEl) {
                    signalsTodayEl.textContent = status.signals_generated_today || 0;
                }

                // Êõ¥Êñ∞ÊàêÂäüÁéá
                const successRateEl = document.getElementById('ai-success-rate');
                if (successRateEl && status.success_rate !== undefined) {
                    successRateEl.textContent = `${Math.round(status.success_rate * 100)}%`;
                }

                // ÊòæÁ§∫/ÈöêËóèÈÖçÁΩÆË≠¶Âëä
                const warningElement = document.getElementById('ai-config-warning');
                if (warningElement) {
                    if (status.configured) {
                        warningElement.style.display = 'none';
                    } else {
                        warningElement.style.display = 'block';
                    }
                }

                // Êõ¥Êñ∞ÂêÑproviderÁä∂ÊÄÅ
                await updateAllProvidersStatus();

                return status;
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñAIÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }

        // ==================== OpenAIÈÖçÁΩÆÂáΩÊï∞ ====================

        function toggleOpenAIKeyVisibility() {
            const input = document.getElementById('openai-api-key');
            const icon = document.getElementById('openai-key-toggle-icon');

            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'HIDE';
            } else {
                input.type = 'password';
                icon.textContent = 'SHOW';
            }
        }

        async function testOpenAIConnection() {
            const apiKey = document.getElementById('openai-api-key').value.trim();
            const model = document.getElementById('openai-model').value;

            if (!apiKey) {
                showToast('ËØ∑ËæìÂÖ•OpenAI API Key', 'error');
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                showToast('APIÂØÜÈí•Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂ∫î‰ª•sk-ÂºÄÂ§¥', 'error');
                return;
            }

            try {
                showToast('Ê≠£Âú®ÊµãËØïOpenAIËøûÊé•...', 'info');

                const response = await fetch(`${API_BASE_URL}/api/ai/openai/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`‚úÖ OpenAIËøûÊé•ÊàêÂäü! Âª∂Ëøü: ${result.latency_ms}ms`, 'success');
                    await saveOpenAIConfig();
                } else {
                    showToast(`‚ùå OpenAIËøûÊé•Â§±Ë¥•: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('‚ùå OpenAIÊµãËØïÂ§±Ë¥•:', error);
                let errorMessage = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÊàñAPIÊúçÂä°‰∏çÂèØËææ';
                if (error.message && error.message.includes('timeout')) {
                    errorMessage = 'ËøûÊé•Ë∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•';
                } else if (error.message && error.message.includes('fetch')) {
                    errorMessage = 'Êó†Ê≥ïËøûÊé•Âà∞OpenAIÊúçÂä°ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú';
                }
                showToast(`‚ùå ${errorMessage}`, 'error');
            }
        }

        async function saveOpenAIConfig() {
            const apiKey = document.getElementById('openai-api-key').value.trim();
            const model = document.getElementById('openai-model').value;
            const temperature = parseFloat(document.getElementById('openai-temperature').value);

            if (!apiKey) {
                showToast('ËØ∑ËæìÂÖ•OpenAI API Key', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/ai/openai/configure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model,
                        temperature: temperature,
                        max_tokens: 16000  // OpenAIÊîØÊåÅÈïøËæìÂá∫
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    localStorage.setItem('arthera-openai-config', JSON.stringify({
                        apiKey: btoa(apiKey),
                        model: model,
                        temperature: temperature,
                        savedAt: new Date().toISOString()
                    }));

                    showToast('‚úÖ OpenAIÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    await updateAllProvidersStatus();
                } else {
                    showToast(`‚ùå OpenAIÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òOpenAIÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast(`‚ùå ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ==================== ClaudeÈÖçÁΩÆÂáΩÊï∞ ====================

        function toggleClaudeKeyVisibility() {
            const input = document.getElementById('claude-api-key');
            const icon = document.getElementById('claude-key-toggle-icon');

            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'HIDE';
            } else {
                input.type = 'password';
                icon.textContent = 'SHOW';
            }
        }

        async function testClaudeConnection() {
            const apiKey = document.getElementById('claude-api-key').value.trim();
            const model = document.getElementById('claude-model').value;

            if (!apiKey) {
                showToast('ËØ∑ËæìÂÖ•Claude API Key', 'error');
                return;
            }

            if (!apiKey.startsWith('sk-ant-')) {
                showToast('APIÂØÜÈí•Ê†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂ∫î‰ª•sk-ant-ÂºÄÂ§¥', 'error');
                return;
            }

            try {
                showToast('Ê≠£Âú®ÊµãËØïClaudeËøûÊé•...', 'info');

                const response = await fetch(`${API_BASE_URL}/api/ai/claude/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast(`‚úÖ ClaudeËøûÊé•ÊàêÂäü! Âª∂Ëøü: ${result.latency_ms}ms`, 'success');
                    await saveClaudeConfig();
                } else {
                    showToast(`‚ùå ClaudeËøûÊé•Â§±Ë¥•: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('‚ùå ClaudeÊµãËØïÂ§±Ë¥•:', error);
                let errorMessage = 'ÁΩëÁªúËøûÊé•Â§±Ë¥•ÊàñAPIÊúçÂä°‰∏çÂèØËææ';
                if (error.message && error.message.includes('timeout')) {
                    errorMessage = 'ËøûÊé•Ë∂ÖÊó∂ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•';
                } else if (error.message && error.message.includes('fetch')) {
                    errorMessage = 'Êó†Ê≥ïËøûÊé•Âà∞ClaudeÊúçÂä°ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªú';
                }
                showToast(`‚ùå ${errorMessage}`, 'error');
            }
        }

        async function saveClaudeConfig() {
            const apiKey = document.getElementById('claude-api-key').value.trim();
            const model = document.getElementById('claude-model').value;
            const temperature = parseFloat(document.getElementById('claude-temperature').value);

            if (!apiKey) {
                showToast('ËØ∑ËæìÂÖ•Claude API Key', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/api/ai/claude/configure`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        api_key: apiKey,
                        model: model,
                        temperature: temperature,
                        max_tokens: 8000  // ClaudeÈôêÂà∂‰∏∫8192
                    })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    localStorage.setItem('arthera-claude-config', JSON.stringify({
                        apiKey: btoa(apiKey),
                        model: model,
                        temperature: temperature,
                        savedAt: new Date().toISOString()
                    }));

                    showToast('‚úÖ ClaudeÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    await updateAllProvidersStatus();
                } else {
                    showToast(`‚ùå ClaudeÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }

            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òClaudeÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast(`‚ùå ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ==================== Êõ¥Êñ∞ÊâÄÊúâProviderÁä∂ÊÄÅ ====================

        async function updateAllProvidersStatus() {
            try {
                // Ëé∑ÂèñÊâÄÊúâproviderÁä∂ÊÄÅ
                const response = await fetch(`${API_BASE_URL}/api/ai/providers`);
                const data = await response.json();

                console.log('ü§ñ ÊâÄÊúâProviderÁä∂ÊÄÅ:', data);

                // Êõ¥Êñ∞DeepSeekÁä∂ÊÄÅ
                const deepseekStatus = data.providers?.deepseek;
                if (deepseekStatus) {
                    updateProviderStatus('deepseek', deepseekStatus);
                }

                // Êõ¥Êñ∞OpenAIÁä∂ÊÄÅ
                const openaiStatus = data.providers?.openai;
                if (openaiStatus) {
                    updateProviderStatus('openai', openaiStatus);
                }

                // Êõ¥Êñ∞ClaudeÁä∂ÊÄÅ
                const claudeStatus = data.providers?.claude;
                if (claudeStatus) {
                    updateProviderStatus('claude', claudeStatus);
                }

            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñProviderÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }

        function updateProviderStatus(provider, status) {
            const statusElement = document.getElementById(`${provider}-connection-status`);
            const modelElement = document.getElementById(`${provider}-current-model`);
            const tempElement = document.getElementById(`${provider}-current-temp`);

            if (statusElement) {
                if (status.configured) {
                    statusElement.textContent = 'CONNECTED';
                    statusElement.classList.remove('text-gray-400');
                    statusElement.classList.add('text-green-400');
                } else {
                    statusElement.textContent = 'NOT CONFIGURED';
                    statusElement.classList.remove('text-green-400');
                    statusElement.classList.add('text-gray-400');
                }
            }

            if (modelElement) {
                modelElement.textContent = status.status?.model || 'NONE';
            }

            if (tempElement) {
                tempElement.textContent = status.status?.temperature || '0.3';
            }
        }

        // È°µÈù¢Âä†ËΩΩÊó∂Êõ¥Êñ∞Áä∂ÊÄÅ
        document.addEventListener('DOMContentLoaded', () => {
            updateAllProvidersStatus();
        });

        // Êõ¥Êñ∞ËÆæÁΩÆÁïåÈù¢ËØ≠Ë®ÄÈÄâÊã©Âô®ÁöÑÂÄº
        function updateLanguageSelector() {
            const selector = document.getElementById('language-select');
            if (selector) {
                selector.value = window.currentLanguage;
            }
        }
        
        // ==================== Â§öËØ≠Ë®ÄÊîØÊåÅ ====================
        
        window.currentLanguage = 'zh';
        
        const translations = {
            zh: {
                // Â§¥ÈÉ®ÂíåÂØºËà™
                'title': 'ARTHERAÈáèÂåñ‰∫§ÊòìÁ≥ªÁªü',
                'dashboard': '‰ª™Ë°®Êùø',
                'settings': 'ÈÖçÁΩÆ',
                'refresh': 'Âà∑Êñ∞',
                'language-switch': 'ÂàáÊç¢ËØ≠Ë®Ä',
                'real-time-connection': 'ÂÆûÊó∂',
                'data-source': 'Êï∞ÊçÆÊ∫ê',
                'professional-version': '‰∏ì‰∏öÁâà',
                'terminal-mode': 'ÁªàÁ´Ø',
                'strategy-control-center': 'Á≠ñÁï•ÊéßÂà∂‰∏≠ÂøÉ',
                'capital-management-title': 'ËµÑÈáëÁÆ°ÁêÜ',
                'initial-capital-label': 'ÂàùÂßãËµÑÈáë (USD)',
                'initial-capital-placeholder': 'ËæìÂÖ•ÂàùÂßãËµÑÈáë',
                'set-button': 'ËÆæÁΩÆ',
                'portfolio-allocation-title': 'ÊäïËµÑÁªÑÂêàÈÖçÁΩÆ',
                'current-holdings': 'ÂΩìÂâçÊåÅ‰ªìÔºö',
                'no-holdings': 'ÊöÇÊó†ÊåÅ‰ªì',
                'max-position-per-stock': 'ÂçïËÇ°ÊúÄÂ§ß‰ªì‰Ωç (%)',
                'rebalance-button': 'ÈáçÊñ∞Âπ≥Ë°°',
                'manage-positions': 'ÊåÅ‰ªìÁÆ°ÁêÜ',
                'used-label': 'Â∑≤Áî®',
                'available-label': 'ÂèØÁî®',
                'data-source-config-title': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'data-source-configuration': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'tushare-token-label': 'Tushare Token',
                'tushare-token-label-extended': 'Tushare Token (‰∏ì‰∏öÊï∞ÊçÆ)',
                'tushare-placeholder': 'ËØ∑ËæìÂÖ•Tushare‰∏ì‰∏öÊï∞ÊçÆToken',
                'save-data-source': '‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'data-source-status': 'Êï∞ÊçÆÊ∫êÁä∂ÊÄÅ',
                'service-endpoints': 'ÊúçÂä°Á´ØÁÇπ',
                'save-endpoints': '‰øùÂ≠òÁ´ØÁÇπ',
                'test-connections': 'ÊµãËØïËøûÊé•',
                'service-status-unknown': 'Êú™Áü•',
                'market-label': 'Â∏ÇÂú∫',
                'market-auto': 'Ëá™Âä®',
                'symbols-label': 'ËÇ°Á•®ÂàóË°®',
                'period-label': 'Âë®Êúü',
                'run-backtest': 'ËøêË°åÂõûÊµã',
                'indicator-label': 'ÊåáÊ†á',
                'symbol-label': 'ËÇ°Á•®',
                'data-points-label': 'Êï∞ÊçÆÁÇπÊï∞',
                'calculate-button': 'ËÆ°ÁÆó',
                'strategy-parameters-title': 'Á≠ñÁï•ÂèÇÊï∞',
                
                // ÂõæË°®Ê†áÁ≠æ
                'volume-tab': 'Êàê‰∫§Èáè',
                'performance-tab': 'Á≠ñÁï•Ë°®Áé∞',
                'risk-tab': 'È£éÈô©ÂàÜÊûê',
                'correlation-tab': 'Áõ∏ÂÖ≥ÊÄßÂàÜÊûê',
                'technical-tab': 'ÊäÄÊúØÂàÜÊûê',
                'system-status': 'Á≥ªÁªüÁä∂ÊÄÅ',
                'trading-active': '‰∫§ÊòìÊ¥ªË∑É',
                'active-strategies': 'Á≠ñÁï•',
                'running-status': 'ËøêË°å‰∏≠',
                'signals-today': '‰ªäÊó•‰ø°Âè∑',
                'ai-signals': 'AI‰ø°Âè∑',
                'ai-powered': 'AIÈ©±Âä®',
                'orders-today': '‰ªäÊó•ËÆ¢Âçï',
                'total-volume': '‰∫§ÊòìÈáè',
                'total-capital': 'ÊÄªËµÑÈáë',
                'available-funds': 'ÂèØÁî®ËµÑÈáë',
                'success-rate': 'ÊàêÂäüÁéá',
                'professional-grade': '‰∏ì‰∏öÊ∞¥ÂáÜ',
                'var-95': 'VaR 95%',
                'value-at-risk': 'È£éÈô©‰ª∑ÂÄº',
                
                // ËÆæÁΩÆÈ°µÈù¢
                'basic-settings': 'Âü∫Á°ÄËÆæÁΩÆ',
                'ai-configuration': 'AIÈÖçÁΩÆ',
                'tushare-config': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'backtest-tab': 'ÂõûÊµã',
                'services-config': 'ÊúçÂä°ÁÆ°ÁêÜ',
                'services-health': 'ÊúçÂä°ÂÅ•Â∫∑Áä∂ÂÜµ',
                'services-health-check': 'ÂÅ•Â∫∑Ê£ÄÊü•',
                'overall-health': 'Êï¥‰ΩìÂÅ•Â∫∑Áä∂ÂÜµ',
                'check-all': 'Ê£ÄÊü•ÂÖ®ÈÉ®',
                'data-sources': 'Êï∞ÊçÆÊ∫ê',
                'trading-platforms': '‰∫§ÊòìÂπ≥Âè∞',
                'crypto-exchanges': 'Âä†ÂØÜË¥ßÂ∏Å‰∫§ÊòìÊâÄ',
                'ai-services': '‰∫∫Â∑•Êô∫ËÉΩÊúçÂä°',
                'database-services': 'Êï∞ÊçÆÂ∫ìÊúçÂä°',
                'indicators-tab': 'ÊäÄÊúØÊåáÊ†á',
                'system-config': 'Á≥ªÁªüÈÖçÁΩÆ',
                'api-key': 'APIÂØÜÈí•',
                'api-key-placeholder': 'ËØ∑ËæìÂÖ•APIÂØÜÈí•',
                'model-selection': 'Ê®°ÂûãÈÄâÊã©',
                'temperature': 'ÁîüÊàêÊ∏©Â∫¶',
                'test-connection': 'ÊµãËØïËøûÊé•',
                'configure': 'ÈÖçÁΩÆ',
                'save-config': '‰øùÂ≠òÈÖçÁΩÆ',
                'config-saved': 'ÈÖçÁΩÆÂ∑≤‰øùÂ≠ò',
                'config-failed': 'ÈÖçÁΩÆÂ§±Ë¥•',
                'api-status': 'APIÁä∂ÊÄÅ',
                'not-configured': 'Êú™ÈÖçÁΩÆ',
                
                // AIÊ®°ÂûãÈÄâÈ°π
                'deepseek-chat': 'DeepSeek Chat',
                'deepseek-coder': 'DeepSeek Coder', 
                'deepseek-v25': 'DeepSeek V2.5 (Êé®Ëçê)',
                'deepseek-v3': 'DeepSeek V3 (ÊúÄÊñ∞)',
                
                // Ê∏©Â∫¶ÈÄâÈ°π
                'temp-conservative': '‰øùÂÆà',
                'temp-balanced': 'Âπ≥Ë°°',
                'temp-moderate': '‰∏≠Á≠â',
                'temp-aggressive': 'ÊøÄËøõ',
                
                // Áä∂ÊÄÅÊñáÊú¨
                'connecting': 'Ê≠£Âú®ËøûÊé•...',
                'connected': 'ËøûÊé•ÊàêÂäü',
                'connection-failed': 'ËøûÊé•Â§±Ë¥•',
                'api-status': 'APIÁä∂ÊÄÅ',
                'not-configured': 'Êú™ÈÖçÁΩÆ',
                'configured': 'Â∑≤ÈÖçÁΩÆ',
                'active': 'Ê¥ªË∑É',
                'inactive': 'Êú™ÊøÄÊ¥ª', 
                'enabled': 'Â∑≤ÂêØÁî®',
                'disabled': 'Â∑≤Á¶ÅÁî®',
                'online': 'Âú®Á∫ø',
                'offline': 'Á¶ªÁ∫ø',
                'loading': 'Âä†ËΩΩ‰∏≠...',
                'error': 'ÈîôËØØ',
                'success': 'ÊàêÂäü',
                'failed': 'Â§±Ë¥•',
                'pending': 'ÂæÖÂ§ÑÁêÜ',
                'available': 'ÂèØÁî®',
                'unavailable': '‰∏çÂèØÁî®',
                
                // ÂÖ®Â±ÄÂ∏ÇÂú∫ÊåáÊï∞
                'nasdaq': 'Á∫≥ÊñØËææÂÖã',
                'dow': 'ÈÅìÁêºÊñØ',
                
                // Á≥ªÁªüÈÖçÁΩÆ
                'refresh-interval': 'Âà∑Êñ∞Èó¥Èöî',
                'auto-refresh': 'Ëá™Âä®Âà∑Êñ∞',
                'sound-alerts': 'Â£∞Èü≥ÊèêÈÜí',
                'notifications': 'ÈÄöÁü•',
                'display-settings': 'ÊòæÁ§∫ËÆæÁΩÆ',
                'time-format': 'Êó∂Èó¥Ê†ºÂºè',
                'decimal-places': 'Â∞èÊï∞‰ΩçÊï∞',
                'language-setting': 'ËØ≠Ë®ÄËÆæÁΩÆ',
                'chinese': '‰∏≠Êñá',
                'english': 'Ëã±Êñá',
                'show': 'ÊòæÁ§∫',
                'hide': 'ÈöêËóè',
                'encrypted-local-storage': 'Âä†ÂØÜÊú¨Âú∞Â≠òÂÇ®',
                'enable-ai-signals': 'ÂêØÁî®AI‰ø°Âè∑',
                'model': 'Ê®°Âûã',
                
                // Êó∂Èó¥Ê†ºÂºèÈÄâÈ°π
                '24h-format': '24Â∞èÊó∂Âà∂',
                '12h-format': '12Â∞èÊó∂Âà∂',
                
                // Â∞èÊï∞‰ΩçÊï∞ÈÄâÈ°π
                '2-places': '2‰ΩçÂ∞èÊï∞',
                '3-places': '3‰ΩçÂ∞èÊï∞', 
                '4-places': '4‰ΩçÂ∞èÊï∞',
                
                // Âà∑Êñ∞Èó¥ÈöîÈÄâÈ°π
                '5-sec': '5Áßí',
                '10-sec': '10Áßí',
                '30-sec': '30Áßí',
                '60-sec': '60Áßí',
                
                // ‰∫§ÊòìÂπ≥Âè∞
                'binance': 'Â∏ÅÂÆâ',
                'okx': 'OKX',
                'interactive-brokers': 'ÁõàÈÄèËØÅÂà∏',
                'interactive-brokers-global': 'ÁõàÈÄèËØÅÂà∏(ÂÖ®ÁêÉ)',
                'coinbase-pro': 'Coinbase Pro',
                'kraken': 'Kraken',
                'alpaca': 'Alpaca',
                'yahoo-finance': 'ÈõÖËôéË¥¢Áªè',
                'akshare': 'AKShare',
                'tushare': 'Tushare',
                'quandl': 'Quandl',
                'alpha-vantage': 'Alpha Vantage',
                'iex-cloud': 'IEX Cloud',
                
                // ‰∫§ÊòìÈÄâÈ°π
                'paper-trading': 'Ê®°Êãü‰∫§Êòì',
                'live-trading': 'ÂÆûÁõò‰∫§Êòì',
                'sandbox': 'Ê≤ôÁÆ±ÁéØÂ¢É',
                'testnet': 'ÊµãËØïÁΩëÁªú',
                
                // Âπ≥Âè∞Áä∂ÊÄÅ
                'platform-status': 'Âπ≥Âè∞Áä∂ÊÄÅ',
                'trading-platforms': '‰∫§ÊòìÂπ≥Âè∞',
                'data-sources': 'Êï∞ÊçÆÊ∫ê',
                
                // Á≠ñÁï•ÂõûÊµã
                'strategy-backtesting': 'Á≠ñÁï•ÂõûÊµã',
                'strategy': 'Á≠ñÁï•',
                'momentum': 'Âä®ÈáèÁ≠ñÁï•',
                'mean-reversion': 'ÂùáÂÄºÂõûÂΩí',
                'breakout': 'Á™ÅÁ†¥Á≠ñÁï•',
                'initial-capital': 'ÂàùÂßãËµÑÈáë',
                'symbols': 'ËÇ°Á•®‰ª£Á†Å',
                'period': 'Âë®Êúü',
                'backtest-results': 'ÂõûÊµãÁªìÊûú',
                'success-rate-label': 'ÊàêÂäüÁéá',
                
                // ÂõæË°®
                'volume-trend': 'Êàê‰∫§ÈáèË∂ãÂäø',
                'strategy-performance': 'Á≠ñÁï•Ë°®Áé∞',
                'signal-distribution': '‰ø°Âè∑ÂàÜÂ∏É',
                
                // Êñ∞Â¢û‰ª™Ë°®ÊùøÊ®°Âùó
                'performance-metrics': 'Áª©ÊïàÊåáÊ†á',
                'risk-control': 'È£éÈô©ÊéßÂà∂',
                'service-overview-title': 'ÊúçÂä°ÂÅ•Â∫∑',
                'service-latency': 'Âª∂Ëøü',
                'service-uptime': 'Âú®Á∫øÁéá',
                'api-gateway-service': 'Áªü‰∏ÄÁΩëÂÖ≥',
                'ios-connector-service': 'iOSËøûÊé•Âô®',
                'quant-engine-service': 'ÈáèÂåñÂºïÊìé',
                'ai-agents-service': 'AIÊô∫ËÉΩ‰Ωì',
                'risk-management-service': 'È£éÈô©ÁÆ°ÁêÜ',
                'crypto-connectors-service': 'Âä†ÂØÜË¥ßÂ∏ÅËøûÊé•Âô®',
                'backtesting-engine-service': 'ÂõûÊµãÂºïÊìé',
                'portfolio-service': 'ÊäïËµÑÁªÑÂêàÊúçÂä°',
                'ios-status-healthy': 'Ê≠£Â∏∏',
                'ios-status-warning': 'Ë≠¶Âëä',
                'ios-status-error': 'Á¶ªÁ∫ø',
                'realtime-data': 'ÂÆûÊó∂Êï∞ÊçÆ',
                'ai-strategy-performance': 'AIÁ≠ñÁï•Ë°®Áé∞',
                'global-market-indices': 'ÂÖ®ÁêÉÂ∏ÇÂú∫ÊåáÊï∞',
                'latest-trading-signals': 'ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑',
                'latest-orders': 'ÊúÄÊñ∞Êàê‰∫§ËÆ¢Âçï',
                
                // ÊåáÊ†áÂêçÁß∞
                'sharpe-ratio': 'Â§èÊôÆÊØîÁéá',
                'info-ratio': '‰ø°ÊÅØÊØîÁéá',
                'max-drawdown': 'ÊúÄÂ§ßÂõûÊí§',
                'market-correlation': 'Â∏ÇÂú∫Áõ∏ÂÖ≥ÊÄß',
                
                // ËÇ°Á•®ÊêúÁ¥¢Áõ∏ÂÖ≥
                'target-market': 'ÁõÆÊ†áÂ∏ÇÂú∫',
                'target-stock-pool': 'ÁõÆÊ†áËÇ°Á•®Ê±†',
                'search-stocks': 'ÊêúÁ¥¢ËÇ°Á•®',
                'search-placeholder': 'ÊêúÁ¥¢ËÇ°Á•®ÔºöËæìÂÖ•ÂêçÁß∞/‰ª£Á†Å',
                'search-hint': 'Á§∫‰æãÔºöAAPL, TESLA, NVDA, Ë¥µÂ∑ûËåÖÂè∞',
                'search-status-ready': 'APIÂ∞±Áª™',
                'search-status-searching': 'ÊêúÁ¥¢‰∏≠',
                'search-status-completed': 'ÊêúÁ¥¢ÂÆåÊàê',
                'search-status-failed': 'ÊêúÁ¥¢Â§±Ë¥•',
                'search-status-random-selecting': 'ÈöèÊú∫ÈÄâËÇ°‰∏≠',
                'search-status-using-preset': '‰ΩøÁî®È¢ÑËÆæËÇ°Á•®Ê±†',
                'search-status-using-local': '‰ΩøÁî®Êú¨Âú∞ËÇ°Á•®Ê±†',
                'search-status-getting-hot': 'Ëé∑ÂèñÁÉ≠Èó®ËÇ°‰∏≠',
                'search-status-offline': 'Á¶ªÁ∫øÊ®°Âºè',
                'all-markets': 'ÊâÄÊúâÂ∏ÇÂú∫',
                'us-stocks': 'ÁæéËÇ°',
                'china-a-shares': 'AËÇ°',
                'china-a-shares-short': 'AËÇ°',
                'hk-stocks': 'Ê∏ØËÇ°',
                'jp-stocks': 'Êó•ËÇ°',
                'cryptocurrency': 'Âä†ÂØÜË¥ßÂ∏Å',
                'all-caps': 'ÊâÄÊúâÂ∏ÇÂÄº',
                'large-cap': 'Â§ßÁõòËÇ°',
                'mid-cap': '‰∏≠ÁõòËÇ°',
                'small-cap': 'Â∞èÁõòËÇ°',
                'tech-sector': 'ÁßëÊäÄËÇ°',
                'finance-sector': 'ÈáëËûçËÇ°',
                'healthcare-sector': 'ÂåªÁñóËÇ°',
                'energy-sector': 'ËÉΩÊ∫êËÇ°',
                'real-estate-sector': 'Âú∞‰∫ßËÇ°',
                'materials-sector': 'ÊùêÊñôËÇ°',
                'industrials-sector': 'Â∑•‰∏öËÇ°',
                'consumer-sector': 'Ê∂àË¥πËÇ°',
                'utilities-sector': 'ÂÖ¨Áî®‰∫ã‰∏öËÇ°',
                'telecom-sector': 'Áîµ‰ø°ËÇ°',
                
                // Áªü‰∏ÄÊêúÁ¥¢ÁªÑ‰ª∂
                'intelligent-stock-search': 'Êô∫ËÉΩËÇ°Á•®ÊêúÁ¥¢',
                'multi-source-ready': 'Â§öÊ∫êÂ∞±Áª™',
                'sector-filter': 'Ë°å‰∏öÁ≠õÈÄâ',
                'quick-stock-selection': 'Âø´ÈÄüÈÄâËÇ°',
                'random-30': 'ÈöèÊú∫30',
                'random-50': 'ÈöèÊú∫50',
                'hot-stocks': 'ÁÉ≠Èó®ËÇ°',
                'data-source-management': 'Êï∞ÊçÆÊ∫êÁÆ°ÁêÜ',
                'source-status': 'Ê∫êÁä∂ÊÄÅ',
                'refresh-cache': 'Âà∑Êñ∞ÁºìÂ≠ò',
                'searching': 'ÊêúÁ¥¢‰∏≠...',
                'search-completed': 'ÊêúÁ¥¢ÂÆåÊàê',
                'search-failed': 'ÊêúÁ¥¢Â§±Ë¥•',
                'random-selection': 'ÈöèÊú∫ÈÄâËÇ°‰∏≠...',
                'getting-hot-stocks': 'Ëé∑ÂèñÁÉ≠Èó®ËÇ°‰∏≠...',
                'checking-sources': 'Ê£ÄÊü•Êï∞ÊçÆÊ∫ê...',
                'refreshing': 'Âà∑Êñ∞‰∏≠...',
                'cache-cleared': 'ÁºìÂ≠òÂ∑≤Ê∏ÖÈô§',
                'sources-ready': 'Ê∫êÂ∞±Áª™',
                'check-failed': 'Ê£ÄÊü•Â§±Ë¥•',
                'acquisition-failed': 'Ëé∑ÂèñÂ§±Ë¥•',
                'using-local-pool': '‰ΩøÁî®Êú¨Âú∞ËÇ°Á•®Ê±†',
                'using-preset-pool': '‰ΩøÁî®È¢ÑËÆæËÇ°Á•®Ê±†',
                
                // Á≠ñÁï•Áõ∏ÂÖ≥
                'strategy-status': 'Á≠ñÁï•Áä∂ÊÄÅ',
                'strategy-performance': 'Á≠ñÁï•Ë°®Áé∞',
                'strategy-execution': 'Á≠ñÁï•ÊâßË°å',
                'strategy-control': 'Á≠ñÁï•ÊéßÂà∂',
                'running': 'ËøêË°å‰∏≠',
                'stopped': 'Â∑≤ÂÅúÊ≠¢',
                'paused': 'Â∑≤ÊöÇÂÅú',
                'error': 'ÈîôËØØ',
                
                // ‰∫§ÊòìÁõ∏ÂÖ≥
                'trade-execution': '‰∫§ÊòìÊâßË°å',
                'order-management': 'ËÆ¢ÂçïÁÆ°ÁêÜ',
                'position-management': '‰ªì‰ΩçÁÆ°ÁêÜ',
                'risk-management': 'È£éÈô©ÁÆ°ÁêÜ',
                'buy-signal': '‰π∞ÂÖ•‰ø°Âè∑',
                'sell-signal': 'ÂçñÂá∫‰ø°Âè∑',
                'hold-signal': 'ÊåÅÊúâ‰ø°Âè∑',
                'strong-signal': 'Âº∫‰ø°Âè∑',
                'weak-signal': 'Âº±‰ø°Âè∑',
                'moderate-signal': '‰∏≠Á≠â‰ø°Âè∑',
                
                // Êï∞ÊçÆÁõ∏ÂÖ≥
                'real-time-data': 'ÂÆûÊó∂Êï∞ÊçÆ',
                'historical-data': 'ÂéÜÂè≤Êï∞ÊçÆ',
                'market-data': 'Â∏ÇÂú∫Êï∞ÊçÆ',
                'price-data': '‰ª∑Ê†ºÊï∞ÊçÆ',
                'volume-data': 'Êàê‰∫§ÈáèÊï∞ÊçÆ',
                'technical-indicators': 'ÊäÄÊúØÊåáÊ†á',
                'fundamental-analysis': 'Âü∫Êú¨Èù¢ÂàÜÊûê',
                
                // ÊÄßËÉΩÊåáÊ†á
                'total-return': 'ÊÄªÊî∂ÁõäÁéá',
                'annual-return': 'Âπ¥ÂåñÊî∂ÁõäÁéá',
                'cumulative-return': 'Á¥ØËÆ°Êî∂ÁõäÁéá',
                'daily-return': 'Êó•Êî∂ÁõäÁéá',
                'win-rate': 'ËÉúÁéá',
                'profit-factor': 'ÁõàÂà©Âõ†Â≠ê',
                'kelly-ratio': 'ÂáØÂà©ÊØîÁéá',
                'calmar-ratio': 'CalmarÊØîÁéá',
                
                'ai-recommendations': 'AIÊé®Ëçê',
                'ai-supports-text': 'ÊîØÊåÅÁæéËÇ°‰∏éAËÇ°Ê†∏ÂøÉÊ†áÁöÑ',
                'generate-ai-signals': 'ÁîüÊàêAI‰ø°Âè∑',
                'start-auto-trading': 'ÂºÄÂßãËá™Âä®‰∫§Êòì',
                'stop-auto-trading': 'ÂÅúÊ≠¢Ëá™Âä®‰∫§Êòì',
                'execute-simulation-order': 'ÊâßË°åÊ®°ÊãüËÆ¢Âçï',
                'execute-order': 'ÊâßË°åËÆ¢Âçï',
                'generating-signals': 'ÁîüÊàê‰∏≠...',
                'signal-generated': '‰ø°Âè∑Â∑≤ÁîüÊàê',
                'auto-trading-started': 'Ëá™Âä®‰∫§ÊòìÂ∑≤ÂêØÂä®',
                'auto-trading-stopped': 'Ëá™Âä®‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢',
                'order-executed': 'ËÆ¢ÂçïÂ∑≤ÊâßË°å',
                'system-ready': 'Á≥ªÁªüÂ∞±Áª™',
                'data-source-config': 'Êï∞ÊçÆÊ∫êÈÖçÁΩÆ',
                'tushare-token': 'TUSHARE TOKEN',
                'enter-token-placeholder': 'ËæìÂÖ•‰∏ì‰∏öÊï∞ÊçÆÊ∫êToken',
                'config-button': 'ÈÖçÁΩÆ',
                'test-button': 'ÊµãËØï',
                'strategy-parameters': 'Á≠ñÁï•ÂèÇÊï∞',
                'risk-level': 'È£éÈô©Á≠âÁ∫ß',
                'balanced': 'Âπ≥Ë°°Âûã',
                'conservative': '‰øùÂÆàÂûã',
                'aggressive': 'ÊøÄËøõÂûã',
                'max-position': 'ÊúÄÂ§ß‰ªì‰Ωç',
                'stop-loss': 'Ê≠¢Êçü',
                'take-profit': 'Ê≠¢Áõà',
                'global-mixed': 'ÂÖ®ÁêÉÊ∑∑Âêà',
                'search-loading': 'ÊêúÁ¥¢‰∏≠...',
                'search-no-results': 'Êú™ÊâæÂà∞ÂåπÈÖçÁªìÊûú',
                'search-offline-mode': 'Á¶ªÁ∫øÊ®°Âºè',
                'search-load-more': 'Âä†ËΩΩÊõ¥Â§öÁªìÊûú...',
                'search-local-tag': 'Êú¨Âú∞ÁºìÂ≠ò',
                'reset-button': 'ÈáçÁΩÆ',
                'supports-text': 'ÊîØÊåÅÁæéËÇ°(AAPL)ÂíåAËÇ°(600519.SS)',
                'volatility': 'Ê≥¢Âä®Áéá',
                'tracking-error': 'Ë∑üË∏™ËØØÂ∑Æ',
                'online-time': 'Âú®Á∫øÊó∂Èó¥',
                'zero-signals': '0‰∏™‰ø°Âè∑',
                'zero-orders': '0‰∏™ËÆ¢Âçï',
                'click-generate-signals': 'ÁÇπÂáª"ÁîüÊàêAI‰∫§Êòì‰ø°Âè∑"ÂºÄÂßãÂàÜÊûê...',
                'click-execute-orders': 'ÁÇπÂáª"ÊâßË°åÊ®°ÊãüËÆ¢Âçï"ÂºÄÂßã‰∫§Êòì...',
                
                // Á≠ñÁï•ÊéßÂà∂‰∏≠ÂøÉÁõ∏ÂÖ≥
                'strategy-execution': 'Á≠ñÁï•ÊâßË°å',
                'strategy-status': 'Á≠ñÁï•Áä∂ÊÄÅ',
                'strategy-performance-title': 'Á≠ñÁï•Ë°®Áé∞',
                'strategy-control': 'Á≠ñÁï•ÊéßÂà∂',
                'execution-log': 'ÊâßË°åÊó•Âøó',
                'service-integration': 'ÊúçÂä°ÈõÜÊàê',
                'quantitative-metrics': 'ÈáèÂåñÊåáÊ†á',
                'confidence': 'ÁΩÆ‰ø°Â∫¶',
                'execute': 'ÊâßË°å',
                'executing': 'ÊâßË°å‰∏≠...',
                'executed': 'Â∑≤ÊâßË°å',
                'execution-failed': 'ÊâßË°åÂ§±Ë¥•',
                'shares': 'ËÇ°',
                'shares-unit': 'ËÇ°',
                'signal': '‰ø°Âè∑',
                'filled-price': 'Êàê‰∫§‰ª∑',
                
                // ÈáèÂåñÊåáÊ†á
                'sortino-ratio': 'SortinoÊØîÁéá',
                'treynor-ratio': 'TreynorÊØîÁéá',
                'beta-coefficient': 'BetaÁ≥ªÊï∞',
                'alpha-value': 'AlphaÂÄº',
                'active-share': '‰∏ªÂä®‰ªΩÈ¢ù',
                'risk-level-indicator': 'È£éÈô©Á≠âÁ∫ß',
                'liquidity-score': 'ÊµÅÂä®ÊÄßËØÑÂàÜ',
                'concentration-risk': 'ÈõÜ‰∏≠Â∫¶È£éÈô©',
                
                // Á≥ªÁªüÁä∂ÊÄÅÂíåÊéßÂà∂
                'system-integration': 'Á≥ªÁªüÈõÜÊàê',
                'service-health': 'ÊúçÂä°ÂÅ•Â∫∑',
                'data-connection': 'Êï∞ÊçÆËøûÊé•',
                'trading-engine': '‰∫§ÊòìÂºïÊìé',
                'risk-management': 'È£éÈô©ÁÆ°ÁêÜ',
                'portfolio-management': 'ÊäïËµÑÁªÑÂêàÁÆ°ÁêÜ',
                'real-time-monitoring': 'ÂÆûÊó∂ÁõëÊéß',
                'performance-analysis': 'Áª©ÊïàÂàÜÊûê',
                
                // Êï∞ÊçÆÊ∫êÂíåËøûÊé•
                'quant-engine-models': 'QuantEngineÊ®°Âûã',
                'market-data-sources': 'Â∏ÇÂú∫Êï∞ÊçÆÊ∫ê',
                'ml-models': 'Êú∫Âô®Â≠¶‰π†Ê®°Âûã',
                'backtest-data': 'ÂõûÊµãÊï∞ÊçÆ',
                'integration-success': 'ÈõÜÊàêÊàêÂäü',
                'integration-failed': 'ÈõÜÊàêÂ§±Ë¥•',
                'service-active': 'ÊúçÂä°Ê¥ªË∑É',
                'service-inactive': 'ÊúçÂä°ÈùûÊ¥ªË∑É',
                'pool-total': 'ÊÄªËÆ°:',
                'pool-us': 'ÁæéËÇ°:',
                'pool-cn': 'AËÇ°:',
                
                // ÊåÅ‰ªìÁÆ°ÁêÜÂô®
                'position-manager': 'ÊåÅ‰ªìÁÆ°ÁêÜÂô®',
                'total-position-value': 'ÊÄªÊåÅ‰ªì‰ª∑ÂÄº',
                'position-count': 'ÊåÅ‰ªìÊï∞Èáè',
                'average-holding-rate': 'Âπ≥ÂùáÊåÅ‰ªìÁéá',
                'current-positions': 'ÂΩìÂâçÊåÅ‰ªì',
                'loading-text': 'Âä†ËΩΩ‰∏≠...',
                'export-positions': 'ÂØºÂá∫ÊåÅ‰ªì',
                'clear-positions': 'Ê∏ÖÁ©∫ÊåÅ‰ªì',
                'close-button': 'ÂÖ≥Èó≠',
                
                // Á≠ñÁï•ÂêçÁß∞
                'strategy-deepseek-alpha': 'DeepSeek Alpha',
                'strategy-bayesian-momentum': 'Ë¥ùÂè∂ÊñØÂä®Èáè',
                'strategy-kelly-optimizer': 'ÂáØÂà©ÁªÑÂêà‰ºòÂåñ',
                'strategy-risk-parity': 'È£éÈô©Âπ≥‰ª∑',
                'strategy-stopped': 'Â∑≤ÂÅúÊ≠¢',
                'daily-return': 'Êó•Êî∂Áõä',
                'sharpe-short': 'Â§èÊôÆ',
                'positions-short': 'ÊåÅ‰ªì',
                
                // ToastÊ∂àÊÅØ
                'please-enter-api-key': 'ËØ∑ÂÖàËæìÂÖ•API Key',
                'invalid-api-key-format': 'API KeyÊ†ºÂºè‰∏çÊ≠£Á°ÆÔºåÂ∫î‰ª•sk-ÂºÄÂ§¥',
                'testing-connection': 'üîÑ Ê≠£Âú®ÊµãËØïËøûÊé•...',
                'ai-config-saved': '‚úÖ AIÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü',
                'system-init-failed': '‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•',
                'basic-functions-loaded': '‚úÖ Á≥ªÁªüÂü∫Á°ÄÂäüËÉΩÂ∑≤Âä†ËΩΩ',
                'system-load-complete': '‚úÖ Á≥ªÁªüÂä†ËΩΩÂÆåÊàêÔºåÊâÄÊúâÊåâÈíÆÂäüËÉΩÂèØÁî®ÔºÅ',
                'partial-load-failed': '‚ö†Ô∏è ÈÉ®ÂàÜÂäüËÉΩÂä†ËΩΩÂ§±Ë¥•ÔºåÊ†∏ÂøÉÂäüËÉΩÊ≠£Â∏∏',
                'system-init-error': '‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•',
                'capital-input-not-found': '‚ùå ËµÑÈáëËæìÂÖ•Ê°Ü‰∏çÂ≠òÂú®',
                'invalid-capital-amount': 'ËØ∑ËæìÂÖ•ÊúâÊïàÁöÑËµÑÈáëÈáëÈ¢ù (ÊúÄÂ∞è $1,000)',
                'auto-trading-active-cannot-modify': 'Ëá™Âä®‰∫§ÊòìËøõË°å‰∏≠ÔºåÊó†Ê≥ï‰øÆÊîπËµÑÈáë',
                'capital-set-failed-retry': 'ËµÑÈáëËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',
                'insufficient-funds': 'ÂèØÁî®ËµÑÈáë‰∏çË∂≥',
                'rebalancing-portfolio': 'üîÑ Ê≠£Âú®ÈáçÊñ∞Âπ≥Ë°°ÊäïËµÑÁªÑÂêà...',
                'rebalance-failed': '‚ùå ÈáçÊñ∞Âπ≥Ë°°Â§±Ë¥•',
                'strategy-service-integration-failed': 'Á≠ñÁï•ÊúçÂä°ÈõÜÊàêÂ§±Ë¥•Ôºå‰ΩøÁî®Âü∫Êú¨ÂäüËÉΩ',
                'clearing-all-positions': 'üîÑ Ê≠£Âú®Ê∏ÖÁ©∫ÊâÄÊúâÊåÅ‰ªì...',
                'all-positions-cleared': '‚úÖ ÊâÄÊúâÊåÅ‰ªìÂ∑≤Ê∏ÖÁ©∫',
                'clear-positions-failed': '‚ùå Ê∏ÖÁ©∫ÊåÅ‰ªìÂ§±Ë¥•',
                'position-export-complete': 'üìÑ ÊåÅ‰ªìÊï∞ÊçÆÂØºÂá∫ÂÆåÊàê',
                'get-position-data-failed': 'Ëé∑ÂèñÊåÅ‰ªìÊï∞ÊçÆÂ§±Ë¥•',
                'confirm-clear-positions': 'Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊåÅ‰ªìÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄÔºÅ',
                'exporting-position-data': 'üìÑ ÂØºÂá∫ÊåÅ‰ªìÊï∞ÊçÆ...',
                
                // È´òÁ∫ßÈáèÂåñÁ≠ñÁï•
                'advanced-strategies': 'È´òÁ∫ßÁ≠ñÁï•',
                'ml-strategies': 'Êú∫Âô®Â≠¶‰π†Á≠ñÁï•',
                'factor-strategies': 'Âõ†Â≠êÁ≠ñÁï•',
                'alpha-strategies': 'AlphaÁ≠ñÁï•',
                
                // MLÊ®°Âûã
                'lightgbm-model': 'LightGBMÊ®°Âûã',
                'xgboost-model': 'XGBoostÊ®°Âûã',
                'lstm-model': 'LSTMÁ•ûÁªèÁΩëÁªú',
                'transformer-model': 'TransformerÊ®°Âûã',
                'lstm-attention-model': 'LSTM-Ê≥®ÊÑèÂäõÊ®°Âûã',
                'ensemble-model': 'ÈõÜÊàêÊ®°Âûã',
                'model-training': 'Ê®°ÂûãËÆ≠ÁªÉ',
                'model-prediction': 'Ê®°ÂûãÈ¢ÑÊµã',
                'model-accuracy': 'Ê®°ÂûãÁ≤æÂ∫¶',
                'model-performance': 'Ê®°ÂûãË°®Áé∞',
                
                // Âõ†Â≠êÊ®°Âûã
                'alpha158-factors': 'Alpha158Âõ†Â≠ê',
                'momentum-factors': 'Âä®ÈáèÂõ†Â≠ê',
                'volatility-factors': 'Ê≥¢Âä®ÁéáÂõ†Â≠ê',
                'money-flow-factors': 'ËµÑÈáëÊµÅÂõ†Â≠ê',
                'quality-factors': 'Ë¥®ÈáèÂõ†Â≠ê',
                'value-factors': '‰ª∑ÂÄºÂõ†Â≠ê',
                'factor-analysis': 'Âõ†Â≠êÂàÜÊûê',
                'factor-loadings': 'Âõ†Â≠êËΩΩËç∑',
                'factor-returns': 'Âõ†Â≠êÊî∂Áõä',
                'factor-attribution': 'Âõ†Â≠êÂΩíÂõ†',
                
                // AlphaÁ≠ñÁï•
                'statistical-arbitrage': 'ÁªüËÆ°Â•óÂà©',
                'pairs-trading': 'ÈÖçÂØπ‰∫§Êòì',
                'market-neutral': 'Â∏ÇÂú∫‰∏≠ÊÄß',
                'long-short-equity': 'Â§öÁ©∫ËÇ°Á•®',
                'portfolio-optimization': 'ÁªÑÂêà‰ºòÂåñ',
                'mean-variance': 'ÂùáÂÄºÊñπÂ∑Æ',
                'black-litterman': 'Black-Litterman',
                'risk-parity': 'È£éÈô©Âπ≥‰ª∑',
                'kelly-optimization': 'ÂáØÂà©‰ºòÂåñ',
                
                // ÁõëÊéßÊåáÊ†á
                'monitoring-dashboard': 'ÁõëÊéßÈù¢Êùø',
                'system-health': 'Á≥ªÁªüÂÅ•Â∫∑',
                'performance-metrics': 'ÊÄßËÉΩÊåáÊ†á',
                'response-time': 'ÂìçÂ∫îÊó∂Èó¥',
                'error-rate': 'ÈîôËØØÁéá',
                'throughput': 'ÂêûÂêêÈáè',
                'cpu-usage': 'CPU‰ΩøÁî®Áéá',
                'memory-usage': 'ÂÜÖÂ≠ò‰ΩøÁî®Áéá',
                'disk-usage': 'Á£ÅÁõò‰ΩøÁî®Áéá',
                'network-latency': 'ÁΩëÁªúÂª∂Ëøü',
                'database-connections': 'Êï∞ÊçÆÂ∫ìËøûÊé•',
                'cache-hit-rate': 'ÁºìÂ≠òÂëΩ‰∏≠Áéá',
                
                // ÂëäË≠¶
                'alert-management': 'ÂëäË≠¶ÁÆ°ÁêÜ',
                'critical-alerts': 'Á¥ßÊÄ•ÂëäË≠¶',
                'warning-alerts': 'Ë≠¶ÂëäÂëäË≠¶',
                'info-alerts': '‰ø°ÊÅØÂëäË≠¶',
                'alert-rules': 'ÂëäË≠¶ËßÑÂàô',
                'notification-channels': 'ÈÄöÁü•Ê∏†ÈÅì',
                'alert-history': 'ÂëäË≠¶ÂéÜÂè≤',
                
                // Â§öËØ≠Ë®ÄÊîØÊåÅ
                'language-settings': 'ËØ≠Ë®ÄËÆæÁΩÆ',
                'supported-languages': 'ÊîØÊåÅËØ≠Ë®Ä',
                'auto-detect': 'Ëá™Âä®Ê£ÄÊµã',
                'language-changed': 'ËØ≠Ë®ÄÂ∑≤ÂàáÊç¢',
                'no-positions': 'ÊöÇÊó†ÊåÅ‰ªì',
                'stock-code': 'ËÇ°Á•®‰ª£Á†Å',
                'quantity': 'Êï∞Èáè',
                'cost-price': 'ÊàêÊú¨‰ª∑',
                'current-price': 'ÂΩìÂâç‰ª∑',
                'market-value': 'Â∏ÇÂÄº',
                'profit-loss': 'Áõà‰∫è',
                'percentage': 'Âç†ÊØî',
                'actions': 'Êìç‰Ωú',
                'sell': 'ÂçñÂá∫',
                'selling-symbol': 'üîÑ Ê≠£Âú®ÂçñÂá∫ {symbol}...',
                'no-available-position': 'Êó†ÂèØÁî®ÊåÅ‰ªì',
                'sell-success': '‚úÖ {symbol} ÂçñÂá∫ÊàêÂäü',
                'export-failed': '‚ùå ÂØºÂá∫Â§±Ë¥•',
                'max-position-must-be-positive': 'ÊúÄÂ§ß‰ªì‰ΩçÂøÖÈ°ªÊòØÊúâÊïàÁöÑÊ≠£Êï∞',
                'stop-loss-range-error': 'Ê≠¢ÊçüÁôæÂàÜÊØîÂøÖÈ°ªÂú®0-100‰πãÈó¥',
                'take-profit-must-be-positive': 'Ê≠¢ÁõàÁôæÂàÜÊØîÂøÖÈ°ªÂ§ß‰∫é0',
                'strategy-config-update-success': 'Á≠ñÁï•ÈÖçÁΩÆÊõ¥Êñ∞ÊàêÂäü',
                'strategy-config-update-failed': 'Á≠ñÁï•ÈÖçÁΩÆÊõ¥Êñ∞Â§±Ë¥•',
                'backend-unavailable-local-mode': 'ÂêéÁ´ØÊúçÂä°‰∏çÂèØÁî®ÔºåÂàáÊç¢Âà∞Êú¨Âú∞Ê®°Âºè',
                'insufficient-capital-auto-trading': 'ÂèØÁî®ËµÑÈáë‰∏çË∂≥‰ª•ÂêØÂä®Ëá™Âä®‰∫§Êòì',
                'auto-trading-started': 'Ëá™Âä®‰∫§ÊòìÂ∑≤ÂêØÂä®ÔºåÁ≥ªÁªüÂ∞ÜËá™Âä®ÁîüÊàê‰ø°Âè∑Âπ∂ÊâßË°å‰∫§Êòì',
                'auto-trading-stopped-local': 'Ëá™Âä®‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢ÔºàÊú¨Âú∞Ôºâ',
                'data-load-failed': 'Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•',
                'testing-multiple-data-sources': 'Ê≠£Âú®ÊµãËØïÂ§ö‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫ê...',
                'realtime-data-updated': '‚úÖ ÂÆûÊó∂Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞',
                'data-service-unavailable': '‚ö†Ô∏è Êï∞ÊçÆÊúçÂä°ÊöÇ‰∏çÂèØÁî®ÔºåÊòæÁ§∫ÂéÜÂè≤Êï∞ÊçÆ',
                'debug-mode-enabled': 'üîß Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂºÄÂêØÔºåÂèØ‰ª•Âú®ÊéßÂà∂Âè∞Êü•ÁúãËØ¶ÁªÜÊó•Âøó',
                'debug-mode-disabled': 'Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂÖ≥Èó≠',
                'key-test-complete': 'üß™ ÊåâÈîÆÊµãËØïÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞',
                'system-status-output': 'üìä Á≥ªÁªüÁä∂ÊÄÅÂ∑≤ËæìÂá∫Âà∞ÊéßÂà∂Âè∞',
                'dom-check-complete': 'üîç DOMÂÖÉÁ¥†Ê£ÄÊü•ÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞',
                'refreshing-chart-data': 'üîÑ Ê≠£Âú®Âà∑Êñ∞ÊâÄÊúâÂõæË°®Êï∞ÊçÆ...',
                'chart-data-refreshed': '‚úÖ ÂõæË°®Êï∞ÊçÆÂ∑≤Âà∑Êñ∞ÂÆåÊàêÔºÅ',
                'chart-refresh-failed': '‚ùå ÂõæË°®Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï'
            },
            en: {
                // Header and navigation
                'title': 'ARTHERA QUANTITATIVE TRADING SYSTEM',
                'dashboard': 'DASHBOARD',
                'settings': 'CONFIG',
                'refresh': 'REFRESH',
                'language-switch': 'SWITCH LANGUAGE',
                'real-time-connection': 'LIVE',
                'data-source': 'DATA',
                'professional-version': 'PROFESSIONAL',
                'terminal-mode': 'TERMINAL',
                'strategy-control-center': 'STRATEGY CONTROL CENTER',
                'capital-management-title': 'CAPITAL MANAGEMENT',
                'initial-capital-label': 'INITIAL CAPITAL (USD)',
                'initial-capital-placeholder': 'Enter initial capital',
                'set-button': 'SET',
                'used-label': 'USED:',
                'available-label': 'AVAILABLE:',
                'data-source-config-title': 'DATA SOURCE CONFIG',
                'data-source-configuration': 'DATA SOURCE CONFIGURATION',
                'tushare-token-label': 'Tushare Token',
                'tushare-token-label-extended': 'Tushare Token (Professional)',
                'tushare-placeholder': 'Enter Tushare Pro token',
                'save-data-source': 'SAVE DATA SOURCE CONFIG',
                'data-source-status': 'DATA SOURCE STATUS',
                'service-endpoints': 'SERVICE ENDPOINTS',
                'save-endpoints': 'SAVE ENDPOINTS',
                'test-connections': 'TEST CONNECTIONS',
                'service-status-unknown': 'UNKNOWN',
                'market-label': 'MARKET',
                'market-auto': 'AUTO',
                'symbols-label': 'SYMBOLS',
                'period-label': 'PERIOD',
                'run-backtest': 'RUN BACKTEST',
                'indicator-label': 'INDICATOR',
                'symbol-label': 'SYMBOL',
                'data-points-label': 'DATA POINTS',
                'calculate-button': 'CALCULATE',
                'strategy-parameters-title': 'STRATEGY PARAMETERS',
                
                // Chart tabs
                'volume-tab': 'VOLUME',
                'performance-tab': 'PERFORMANCE',
                'risk-tab': 'RISK',
                'correlation-tab': 'CORRELATION',
                'technical-tab': 'TECHNICAL',
                'system-status': 'System Status',
                'trading-active': 'Trading Active',
                'active-strategies': 'STRATEGIES',
                'running-status': 'RUNNING',
                'signals-today': 'Signals Today',
                'ai-signals': 'AI SIGNALS',
                'ai-powered': 'AI POWERED',
                'orders-today': 'Orders Today',
                'total-volume': 'VOLUME',
                'total-capital': 'CAPITAL',
                'available-funds': 'AVAILABLE',
                'success-rate': 'SUCCESS',
                'professional-grade': 'PROFESSIONAL',
                'var-95': 'VaR 95%',
                'value-at-risk': 'VALUE AT RISK',
                
                // Settings page
                'basic-settings': 'BASIC',
                'ai-configuration': 'AI CONFIG',
                'tushare-config': 'DATA SOURCE',
                'backtest-tab': 'BACKTEST',
                'services-config': 'SERVICES',
                'services-health': 'SERVICES HEALTH',
                'services-health-check': 'HEALTH CHECK',
                'overall-health': 'OVERALL HEALTH',
                'check-all': 'CHECK ALL',
                'data-sources': 'DATA SOURCES',
                'trading-platforms': 'TRADING PLATFORMS', 
                'crypto-exchanges': 'CRYPTO EXCHANGES',
                'ai-services': 'AI SERVICES',
                'database-services': 'DATABASE SERVICES',
                'indicators-tab': 'INDICATORS',
                'system-config': 'SYSTEM CONFIGURATION',
                'api-key': 'API KEY',
                'api-key-placeholder': 'ENTER API KEY',
                'model-selection': 'MODEL',
                'temperature': 'TEMPERATURE',
                'test-connection': 'TEST',
                'configure': 'CONFIGURE',
                'save-config': 'SAVE CONFIG',
                'config-saved': 'CONFIGURATION SAVED',
                'config-failed': 'CONFIGURATION FAILED',
                'api-status': 'API STATUS',
                'not-configured': 'NOT CONFIGURED',
                'configured': 'CONFIGURED',
                'active': 'ACTIVE',
                'inactive': 'INACTIVE',
                'enabled': 'ENABLED',
                'disabled': 'DISABLED',
                'online': 'ONLINE',
                'offline': 'OFFLINE',
                'loading': 'LOADING',
                'error': 'ERROR',
                'success': 'SUCCESS',
                'failed': 'FAILED',
                'pending': 'PENDING',
                'available': 'AVAILABLE',
                'unavailable': 'UNAVAILABLE',
                
                // Global Market Indices
                'nasdaq': 'NASDAQ',
                'dow': 'DOW',
                
                // System Configuration
                'refresh-interval': 'REFRESH INTERVAL',
                'auto-refresh': 'AUTO REFRESH',
                'sound-alerts': 'SOUND ALERTS',
                'notifications': 'NOTIFICATIONS',
                'display-settings': 'DISPLAY SETTINGS',
                'time-format': 'TIME FORMAT',
                'decimal-places': 'DECIMAL PLACES',
                'language-setting': 'LANGUAGE',
                'chinese': 'Chinese',
                'english': 'English',
                'show': 'SHOW',
                'hide': 'HIDE',
                'encrypted-local-storage': 'ENCRYPTED LOCAL STORAGE',
                'enable-ai-signals': 'ENABLE AI SIGNALS',
                'model': 'MODEL',
                
                // Time Format Options
                '24h-format': '24H FORMAT',
                '12h-format': '12H FORMAT',
                
                // Decimal Places Options
                '2-places': '2 PLACES',
                '3-places': '3 PLACES', 
                '4-places': '4 PLACES',
                
                // Refresh Interval Options
                '5-sec': '5 SEC',
                '10-sec': '10 SEC',
                '30-sec': '30 SEC',
                '60-sec': '60 SEC',
                
                // Trading Platforms
                'binance': 'BINANCE',
                'okx': 'OKX',
                'interactive-brokers': 'INTERACTIVE BROKERS',
                'interactive-brokers-global': 'INTERACTIVE BROKERS (GLOBAL)',
                'coinbase-pro': 'COINBASE PRO',
                'kraken': 'KRAKEN',
                'alpaca': 'ALPACA',
                'yahoo-finance': 'YAHOO FINANCE',
                'akshare': 'AKSHARE',
                'tushare': 'TUSHARE',
                'quandl': 'QUANDL',
                'alpha-vantage': 'ALPHA VANTAGE',
                'iex-cloud': 'IEX CLOUD',
                
                // Trading Options
                'paper-trading': 'PAPER TRADING',
                'live-trading': 'LIVE TRADING',
                'sandbox': 'SANDBOX',
                'testnet': 'TESTNET',
                
                // Platform Status
                'platform-status': 'PLATFORM STATUS',
                'trading-platforms': 'TRADING PLATFORMS',
                
                // Strategy Backtesting
                'strategy-backtesting': 'STRATEGY BACKTESTING',
                'strategy': 'STRATEGY',
                'momentum': 'MOMENTUM',
                'mean-reversion': 'MEAN REVERSION',
                'breakout': 'BREAKOUT',
                'initial-capital': 'INITIAL CAPITAL',
                'symbols': 'SYMBOLS',
                'period': 'PERIOD',
                'backtest-results': 'BACKTEST RESULTS',
                'success-rate-label': 'SUCCESS RATE',
                
                // AI model options
                'deepseek-chat': 'DeepSeek Chat',
                'deepseek-coder': 'DeepSeek Coder',
                'deepseek-v25': 'DeepSeek V2.5 (Recommended)',
                'deepseek-v3': 'DeepSeek V3 (Latest)',
                
                // Temperature options
                'temp-conservative': 'Conservative',
                'temp-balanced': 'Balanced',
                'temp-moderate': 'Moderate',
                'temp-aggressive': 'Aggressive',
                
                // Status text
                'connecting': 'Connecting...',
                'connected': 'Connected',
                'connection-failed': 'Connection Failed',
                'api-status': 'API Status',
                'not-configured': 'Not Configured',
                'configured': 'Configured',
                
                // Charts
                'volume-trend': 'Volume Trend',
                'strategy-performance': 'Strategy Performance',
                'signal-distribution': 'Signal Distribution',
                
                // Services
                'api-gateway-service': 'API Gateway',
                'ios-connector-service': 'iOS Connector',
                'quant-engine-service': 'Quant Engine',
                'risk-engine-service': 'Risk Engine',
                'portfolio-service': 'Portfolio/PnL',
                'ios-status-healthy': 'Healthy',
                'ios-status-warning': 'Degraded',
                'ios-status-error': 'Offline',
                
                // New Dashboard Modules
                'performance-metrics': 'PERFORMANCE METRICS',
                'risk-control': 'RISK CONTROL',
                'service-overview-title': 'SERVICE HEALTH',
                'service-latency': 'Latency',
                'service-uptime': 'Uptime',
                'realtime-data': 'REAL-TIME DATA',
                'ai-strategy-performance': 'AI STRATEGY PERFORMANCE',
                'global-market-indices': 'GLOBAL MARKET INDICES',
                'latest-trading-signals': 'LATEST TRADING SIGNALS',
                'latest-orders': 'LATEST ORDERS',
                
                // Metric Names
                'sharpe-ratio': 'SHARPE RATIO',
                'info-ratio': 'INFORMATION RATIO',
                'max-drawdown': 'MAX DRAWDOWN',
                'market-correlation': 'MARKET CORRELATION',
                'volatility': 'VOLATILITY',
                'tracking-error': 'TRACKING ERROR',
                'online-time': 'ONLINE TIME',
                'zero-signals': '0 SIGNALS',
                'zero-orders': '0 ORDERS',
                'click-generate-signals': 'CLICK "GENERATE AI SIGNALS" TO START ANALYSIS...',
                'click-execute-orders': 'CLICK "EXECUTE SIMULATION ORDER" TO START TRADING...',
                
                // Stock Search Related
                'target-market': 'TARGET MARKET',
                'target-stock-pool': 'TARGET STOCK POOL',
                'search-stocks': 'SEARCH STOCKS',
                'search-placeholder': 'Search stocks: type name or symbol',
                'search-hint': 'Try: AAPL, TESLA, NVDA, Maotai',
                'search-status-ready': 'API READY',
                'search-status-searching': 'SEARCHING',
                'search-status-completed': 'SEARCH COMPLETED',
                'search-status-failed': 'SEARCH FAILED',
                'search-status-random-selecting': 'RANDOM SELECTING',
                'search-status-using-preset': 'USING PRESET POOL',
                'search-status-using-local': 'USING LOCAL POOL',
                'search-status-getting-hot': 'GETTING HOT STOCKS',
                'search-status-offline': 'OFFLINE MODE',
                'all-markets': 'ALL MARKETS',
                'us-stocks': 'US STOCKS',
                'china-a-shares': 'CHINA A-SHARES',
                'china-a-shares-short': 'A-SHARES',
                'hk-stocks': 'HK STOCKS',
                'jp-stocks': 'JP STOCKS',
                'cryptocurrency': 'CRYPTOCURRENCY',
                'all-caps': 'ALL CAPS',
                'large-cap': 'LARGE CAP',
                'mid-cap': 'MID CAP',
                'small-cap': 'SMALL CAP',
                'tech-sector': 'TECHNOLOGY',
                'finance-sector': 'FINANCIAL',
                'healthcare-sector': 'HEALTHCARE',
                'energy-sector': 'ENERGY',
                'real-estate-sector': 'REAL ESTATE',
                'materials-sector': 'MATERIALS',
                'industrials-sector': 'INDUSTRIALS',
                'consumer-sector': 'CONSUMER',
                'utilities-sector': 'UTILITIES',
                'telecom-sector': 'TELECOM',
                
                // Unified Search Component
                'intelligent-stock-search': 'INTELLIGENT STOCK SEARCH',
                'multi-source-ready': 'MULTI-SOURCE READY',
                'sector-filter': 'SECTOR FILTER',
                'quick-stock-selection': 'QUICK SELECTION',
                'random-30': 'RANDOM 30',
                'random-50': 'RANDOM 50',
                'hot-stocks': 'HOT STOCKS',
                'data-source-management': 'DATA SOURCE MGMT',
                'source-status': 'SOURCE STATUS',
                'refresh-cache': 'REFRESH CACHE',
                'searching': 'SEARCHING...',
                'search-completed': 'SEARCH COMPLETED',
                'search-failed': 'SEARCH FAILED',
                'random-selection': 'RANDOM SELECTION...',
                'getting-hot-stocks': 'GETTING HOT STOCKS...',
                'checking-sources': 'CHECKING SOURCES...',
                'refreshing': 'REFRESHING...',
                'cache-cleared': 'CACHE CLEARED',
                'sources-ready': 'SOURCES READY',
                'check-failed': 'CHECK FAILED',
                'acquisition-failed': 'ACQUISITION FAILED',
                'using-local-pool': 'USING LOCAL POOL',
                'using-preset-pool': 'USING PRESET POOL',
                
                // Strategy Related
                'strategy-status': 'STRATEGY STATUS',
                'strategy-performance': 'STRATEGY PERFORMANCE',
                'strategy-execution': 'STRATEGY EXECUTION',
                'strategy-control': 'STRATEGY CONTROL',
                'running': 'RUNNING',
                'stopped': 'STOPPED',
                'paused': 'PAUSED',
                'error': 'ERROR',
                
                // Trading Related
                'trade-execution': 'TRADE EXECUTION',
                'order-management': 'ORDER MANAGEMENT',
                'position-management': 'POSITION MANAGEMENT',
                'risk-management': 'RISK MANAGEMENT',
                'buy-signal': 'BUY SIGNAL',
                'sell-signal': 'SELL SIGNAL',
                'hold-signal': 'HOLD SIGNAL',
                'strong-signal': 'STRONG SIGNAL',
                'weak-signal': 'WEAK SIGNAL',
                'moderate-signal': 'MODERATE SIGNAL',
                
                // Data Related
                'real-time-data': 'REAL-TIME DATA',
                'historical-data': 'HISTORICAL DATA',
                'market-data': 'MARKET DATA',
                'price-data': 'PRICE DATA',
                'volume-data': 'VOLUME DATA',
                'technical-indicators': 'TECHNICAL INDICATORS',
                'fundamental-analysis': 'FUNDAMENTAL ANALYSIS',
                
                // Performance Metrics
                'total-return': 'TOTAL RETURN',
                'annual-return': 'ANNUAL RETURN',
                'cumulative-return': 'CUMULATIVE RETURN',
                'daily-return': 'DAILY RETURN',
                'win-rate': 'WIN RATE',
                'profit-factor': 'PROFIT FACTOR',
                'kelly-ratio': 'KELLY RATIO',
                'calmar-ratio': 'CALMAR RATIO',
                
                'ai-recommendations': 'AI RECOMMENDATIONS',
                'ai-supports-text': 'AI recommendations cover US & CN core symbols',
                'pool-total': 'TOTAL:',
                'pool-us': 'US:',
                'pool-cn': 'CN:',
                'generate-ai-signals': 'GENERATE AI SIGNALS',
                'reset-button': 'RESET',
                'start-auto-trading': 'START AUTO TRADING',
                'stop-auto-trading': 'STOP AUTO TRADING',
                'execute-simulation-order': 'EXECUTE SIMULATION ORDER',
                'execute-order': 'EXECUTE ORDER',
                'generating-signals': 'GENERATING...',
                'signal-generated': 'SIGNALS GENERATED',
                'auto-trading-started': 'AUTO TRADING STARTED',
                'auto-trading-stopped': 'AUTO TRADING STOPPED', 
                'order-executed': 'ORDER EXECUTED',
                'system-ready': 'SYSTEM READY',
                'data-source-config': 'DATA SOURCE CONFIG',
                'tushare-token': 'TUSHARE TOKEN',
                'enter-token-placeholder': 'ENTER TOKEN FOR PROFESSIONAL DATA',
                'config-button': 'CONFIG',
                'test-button': 'TEST',
                'strategy-parameters': 'STRATEGY PARAMETERS',
                'risk-level': 'RISK LEVEL',
                'balanced': 'BALANCED',
                'conservative': 'CONSERVATIVE',
                'aggressive': 'AGGRESSIVE',
                'max-position': 'MAX POSITION',
                'stop-loss': 'STOP LOSS',
                'take-profit': 'TAKE PROFIT',
                'global-mixed': 'GLOBAL MIXED',
                'search-loading': 'SEARCHING...',
                'search-no-results': 'No results for',
                'search-offline-mode': 'Offline mode',
                'search-load-more': 'LOAD MORE RESULTS...',
                'search-local-tag': 'LOCAL',
                'supports-text': 'SUPPORTS US STOCKS (AAPL) AND CHINA A-SHARES (600519.SS)',
                
                // Strategy Control Center Related
                'strategy-execution': 'STRATEGY EXECUTION',
                'strategy-status': 'STRATEGY STATUS',
                'strategy-performance-title': 'STRATEGY PERFORMANCE',
                'strategy-control': 'STRATEGY CONTROL',
                'confidence': 'CONFIDENCE',
                'execute': 'EXECUTE',
                'executing': 'EXECUTING...',
                'executed': 'EXECUTED',
                'execution-failed': 'EXECUTION FAILED',
                'shares': 'SHARES',
                'shares-unit': 'SHARES',
                'signal': 'SIGNAL',
                'filled-price': 'FILLED PRICE',
                'execution-log': 'EXECUTION LOG',
                'service-integration': 'SERVICE INTEGRATION',
                'quantitative-metrics': 'QUANTITATIVE METRICS',
                
                // Quantitative Metrics
                'sortino-ratio': 'SORTINO RATIO',
                'treynor-ratio': 'TREYNOR RATIO',
                'beta-coefficient': 'BETA COEFFICIENT',
                'alpha-value': 'ALPHA VALUE',
                'active-share': 'ACTIVE SHARE',
                'risk-level-indicator': 'RISK LEVEL',
                'liquidity-score': 'LIQUIDITY SCORE',
                'concentration-risk': 'CONCENTRATION RISK',
                
                // System Status and Control
                'system-integration': 'SYSTEM INTEGRATION',
                'service-health': 'SERVICE HEALTH',
                'data-connection': 'DATA CONNECTION',
                'trading-engine': 'TRADING ENGINE',
                'risk-management': 'RISK MANAGEMENT',
                'portfolio-management': 'PORTFOLIO MANAGEMENT',
                'real-time-monitoring': 'REAL-TIME MONITORING',
                'performance-analysis': 'PERFORMANCE ANALYSIS',
                
                // Data Sources and Connections
                'quant-engine-models': 'QUANTENGINE MODELS',
                'market-data-sources': 'MARKET DATA SOURCES',
                'ml-models': 'ML MODELS',
                'backtest-data': 'BACKTEST DATA',
                'integration-success': 'INTEGRATION SUCCESS',
                'integration-failed': 'INTEGRATION FAILED',
                'service-active': 'SERVICE ACTIVE',
                'service-inactive': 'SERVICE INACTIVE',
                'pool-total': 'TOTAL:',
                'pool-us': 'US:',
                'pool-cn': 'CN:',
                
                // Position Manager
                'position-manager': 'Position Manager',
                'total-position-value': 'Total Value',
                'position-count': 'Positions',
                'average-holding-rate': 'Avg Rate',
                'current-positions': 'Current Positions',
                'loading-text': 'Loading...',
                'export-positions': 'Export',
                'clear-positions': 'Clear',
                'close-button': 'Close',
                
                // Strategy Names
                'strategy-deepseek-alpha': 'DeepSeek Alpha',
                'strategy-bayesian-momentum': 'Bayesian Momentum',
                'strategy-kelly-optimizer': 'Kelly Portfolio Optimizer',
                'strategy-risk-parity': 'Risk Parity',
                'strategy-stopped': 'Stopped',
                'daily-return': 'Daily Return',
                'sharpe-short': 'Sharpe',
                'positions-short': 'Pos',
                
                // Toast Messages
                'please-enter-api-key': 'Please enter API Key',
                'invalid-api-key-format': 'Invalid API Key format, should start with sk-',
                'testing-connection': 'üîÑ Testing connection...',
                'ai-config-saved': '‚úÖ AI configuration saved successfully',
                'system-init-failed': '‚ùå System initialization failed',
                'basic-functions-loaded': '‚úÖ Basic system functions loaded',
                'system-load-complete': '‚úÖ System loading complete, all buttons are functional!',
                'partial-load-failed': '‚ö†Ô∏è Some features failed to load, core functions are normal',
                'system-init-error': '‚ùå System initialization failed',
                'capital-input-not-found': '‚ùå Capital input not found',
                'invalid-capital-amount': 'Please enter valid capital amount (minimum $1,000)',
                'auto-trading-active-cannot-modify': 'Auto trading is active, cannot modify capital',
                'capital-set-failed-retry': 'Capital setting failed, please retry',
                'insufficient-funds': 'Insufficient funds',
                'rebalancing-portfolio': 'üîÑ Rebalancing portfolio...',
                'rebalance-failed': '‚ùå Rebalancing failed',
                'strategy-service-integration-failed': 'Strategy service integration failed, using basic functions',
                'clearing-all-positions': 'üîÑ Clearing all positions...',
                'all-positions-cleared': '‚úÖ All positions cleared',
                'clear-positions-failed': '‚ùå Clear positions failed',
                'position-export-complete': 'üìÑ Position data export completed',
                'get-position-data-failed': 'Failed to get position data',
                'confirm-clear-positions': 'Are you sure you want to clear all positions? This action cannot be undone!',
                'exporting-position-data': 'üìÑ Exporting position data...',
                
                // Advanced Quantitative Strategies
                'advanced-strategies': 'Advanced Strategies',
                'ml-strategies': 'Machine Learning Strategies',
                'factor-strategies': 'Factor Strategies',
                'alpha-strategies': 'Alpha Strategies',
                
                // ML Models
                'lightgbm-model': 'LightGBM Model',
                'xgboost-model': 'XGBoost Model',
                'lstm-model': 'LSTM Neural Network',
                'transformer-model': 'Transformer Model',
                'lstm-attention-model': 'LSTM-Attention Model',
                'ensemble-model': 'Ensemble Model',
                'model-training': 'Model Training',
                'model-prediction': 'Model Prediction',
                'model-accuracy': 'Model Accuracy',
                'model-performance': 'Model Performance',
                
                // Factor Models
                'alpha158-factors': 'Alpha158 Factors',
                'momentum-factors': 'Momentum Factors',
                'volatility-factors': 'Volatility Factors',
                'money-flow-factors': 'Money Flow Factors',
                'quality-factors': 'Quality Factors',
                'value-factors': 'Value Factors',
                'factor-analysis': 'Factor Analysis',
                'factor-loadings': 'Factor Loadings',
                'factor-returns': 'Factor Returns',
                'factor-attribution': 'Factor Attribution',
                
                // Alpha Strategies
                'statistical-arbitrage': 'Statistical Arbitrage',
                'pairs-trading': 'Pairs Trading',
                'market-neutral': 'Market Neutral',
                'long-short-equity': 'Long-Short Equity',
                'portfolio-optimization': 'Portfolio Optimization',
                'mean-variance': 'Mean Variance',
                'black-litterman': 'Black-Litterman',
                'risk-parity': 'Risk Parity',
                'kelly-optimization': 'Kelly Optimization',
                
                // Monitoring Metrics
                'monitoring-dashboard': 'Monitoring Dashboard',
                'system-health': 'System Health',
                'performance-metrics': 'Performance Metrics',
                'response-time': 'Response Time',
                'error-rate': 'Error Rate',
                'throughput': 'Throughput',
                'cpu-usage': 'CPU Usage',
                'memory-usage': 'Memory Usage',
                'disk-usage': 'Disk Usage',
                'network-latency': 'Network Latency',
                'database-connections': 'Database Connections',
                'cache-hit-rate': 'Cache Hit Rate',
                
                // Alerting
                'alert-management': 'Alert Management',
                'critical-alerts': 'Critical Alerts',
                'warning-alerts': 'Warning Alerts',
                'info-alerts': 'Info Alerts',
                'alert-rules': 'Alert Rules',
                'notification-channels': 'Notification Channels',
                'alert-history': 'Alert History',
                
                // Multi-language Support
                'language-settings': 'Language Settings',
                'supported-languages': 'Supported Languages',
                'auto-detect': 'Auto Detect',
                'language-changed': 'Language Changed',
                'no-positions': 'No positions yet',
                'stock-code': 'Symbol',
                'quantity': 'Qty',
                'cost-price': 'Cost Price',
                'current-price': 'Current Price',
                'market-value': 'Market Value',
                'profit-loss': 'P&L',
                'percentage': 'Percentage',
                'actions': 'Actions',
                'sell': 'Sell',
                'selling-symbol': 'üîÑ Selling {symbol}...',
                'no-available-position': 'No available position',
                'sell-success': '‚úÖ {symbol} sold successfully',
                'export-failed': '‚ùå Export failed',
                'max-position-must-be-positive': 'Max position must be a valid positive number',
                'stop-loss-range-error': 'Stop loss percentage must be between 0-100',
                'take-profit-must-be-positive': 'Take profit percentage must be greater than 0',
                'strategy-config-update-success': 'Strategy configuration updated successfully',
                'strategy-config-update-failed': 'Strategy configuration update failed',
                'backend-unavailable-local-mode': 'Backend service unavailable, switching to local mode',
                'insufficient-capital-auto-trading': 'Insufficient capital to start auto trading',
                'auto-trading-started': 'Auto trading started, system will automatically generate signals and execute trades',
                'auto-trading-stopped-local': 'Auto trading stopped (local)',
                'data-load-failed': 'Data loading failed',
                'testing-multiple-data-sources': 'Testing multiple stock data sources...',
                'realtime-data-updated': '‚úÖ Real-time data updated',
                'data-service-unavailable': '‚ö†Ô∏è Data service unavailable, showing historical data',
                'debug-mode-enabled': 'üîß Debug mode enabled, check console for detailed logs',
                'debug-mode-disabled': 'Debug mode disabled',
                'key-test-complete': 'üß™ Key test completed, check console',
                'system-status-output': 'üìä System status output to console',
                'dom-check-complete': 'üîç DOM element check completed, check console',
                'refreshing-chart-data': 'üîÑ Refreshing all chart data...',
                'chart-data-refreshed': '‚úÖ Chart data refreshed successfully!',
                'chart-refresh-failed': '‚ùå Chart data refresh failed, please try again later'
            }
        };
        
        window.t = function(key) {
            return translations[window.currentLanguage][key] || key;
        };

        let searchStatusState = 'ready';
        function updateSearchStatus(state = 'ready', detail) {
            searchStatusState = state;
            const statusEl = document.getElementById('search-status');
            if (!statusEl) {
                return;
            }
            const classes = ['text-green-400', 'text-blue-400', 'text-yellow-400', 'text-red-400', 'hidden'];
            statusEl.classList.remove(...classes);
            const colorMap = {
                ready: 'text-green-400',
                searching: 'text-blue-400',
                offline: 'text-yellow-400'
            };
            statusEl.classList.add(colorMap[state] || 'text-green-400');
            const textMap = {
                ready: window.t('search-status-ready'),
                searching: window.t('search-status-searching'),
                offline: window.t('search-status-offline')
            };
            const base = textMap[state] || textMap.ready;
            statusEl.textContent = detail ? `${base}: ${detail}` : base;
        }
        window.updateSearchStatus = updateSearchStatus;

        window.updateAllText = function() {
            console.log(`üåç Êõ¥Êñ∞ËØ≠Ë®ÄÂà∞: ${window.currentLanguage}`);
            
            // Êõ¥Êñ∞ÊâÄÊúâÂÖ∑Êúâdata-i18nÂ±ûÊÄßÁöÑÂÖÉÁ¥†
            document.querySelectorAll('[data-i18n]').forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.textContent = translation;
                }
            });
            
            // Êõ¥Êñ∞Âç†‰ΩçÁ¨¶ÊñáÊú¨
            document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.placeholder = translation;
                }
            });
            
            // Êõ¥Êñ∞Ê†áÈ¢òÂ±ûÊÄß
            document.querySelectorAll('[data-i18n-title]').forEach(element => {
                const key = element.getAttribute('data-i18n-title');
                const translation = window.t(key);
                if (translation && translation !== key) {
                    element.title = translation;
                }
            });
            
            // Êõ¥Êñ∞Ê†áÈ¢ò
            document.title = window.t('title');
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆÊñáÊú¨
            const langButtons = document.querySelectorAll('.language-toggle');
            langButtons.forEach(langButton => {
                langButton.textContent = window.currentLanguage === 'zh' ? 'EN' : '‰∏≠Êñá';
            });
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÈÄâÊã©Âô®
            const langSelector = document.getElementById('language-select');
            if (langSelector) {
                langSelector.value = window.currentLanguage;
            }
            updateSearchStatus(searchStatusState);
            updateLanguageSelector();
            
            // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂ÔºåÈÄöÁü•ÂÖ∂‰ªñÁªÑ‰ª∂ËØ≠Ë®ÄÂ∑≤ÂèòÊõ¥
            window.dispatchEvent(new CustomEvent('languageChanged', { 
                detail: { language: window.currentLanguage } 
            }));
            
            console.log(`‚úÖ ËØ≠Ë®ÄÊõ¥Êñ∞ÂÆåÊàê`);
        }

        function switchLanguage(lang) {
            console.log(`üåç ÂàáÊç¢ËØ≠Ë®ÄÂà∞: ${lang}`);
            
            if (!translations[lang]) {
                console.error(`‚ùå ‰∏çÊîØÊåÅÁöÑËØ≠Ë®Ä: ${lang}`);
                return;
            }
            
            window.currentLanguage = lang;
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÊåâÈíÆÊòæÁ§∫
            const languageToggle = document.querySelector('.language-toggle');
            if (languageToggle) {
                languageToggle.textContent = lang === 'zh' ? 'EN' : '‰∏≠';
            }
            
            // Êõ¥Êñ∞ËØ≠Ë®ÄÈÄâÊã©‰∏ãÊãâÊ°Ü
            const languageSelect = document.getElementById('language-select');
            if (languageSelect) {
                languageSelect.value = lang;
            }
            
            // Êõ¥Êñ∞ÊâÄÊúâÊñáÊú¨
            window.updateAllText();
            
            // ‰øùÂ≠òËØ≠Ë®ÄËÆæÁΩÆ
            localStorage.setItem('arthera-language', lang);
            
            // Êõ¥Êñ∞ÂõæË°®Ê†áÁ≠æÂíåÊèêÁ§∫ÊñáÊú¨
            if (window.updateChartLabels) {
                window.updateChartLabels();
            }
            
            // ÊòæÁ§∫ÂàáÊç¢ÊàêÂäüÊèêÁ§∫
            if (typeof showToast === 'function') {
                const message = lang === 'zh' ? 'ËØ≠Ë®ÄÂ∑≤ÂàáÊç¢Âà∞‰∏≠Êñá' : 'Language switched to English';
                showToast(message, 'info');
            }
            
            console.log(`‚úÖ ËØ≠Ë®ÄÂàáÊç¢ÊàêÂäü`);
        }

        window.updateAllText = updateAllText;
        window.switchLanguage = switchLanguage;
        window.updateStrategyDisplayTexts = updateStrategyDisplayTexts;

        // Ê∑ªÂä†ËØ≠Ë®ÄÂàáÊç¢‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºåÂà∑Êñ∞Âä®ÊÄÅÂÜÖÂÆπ
        window.addEventListener('languageChanged', function(event) {
            console.log('üåç ËØ≠Ë®ÄÂàáÊç¢‰∫ã‰ª∂Ëß¶ÂèëÔºåÂà∑Êñ∞Âä®ÊÄÅÂÜÖÂÆπ...');
            
            // Âà∑Êñ∞ÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑ÂíåËÆ¢ÂçïÊòæÁ§∫
            if (typeof updateLatestSignalsDisplay === 'function') {
                updateLatestSignalsDisplay();
            }
            
            // Âà∑Êñ∞ÊúÄÊñ∞ËÆ¢ÂçïÊòæÁ§∫
            if (typeof updateLatestOrdersDisplay === 'function') {
                updateLatestOrdersDisplay();
            }
            
            // Âà∑Êñ∞Position ManagerÊòæÁ§∫ÔºàÂ¶ÇÊûúÂΩìÂâçÊ≠£Âú®ÊòæÁ§∫Ôºâ
            const positionManagerModal = document.querySelector('.fixed .bg-gray-900');
            if (positionManagerModal && positionManagerModal.style.display !== 'none') {
                if (typeof loadPositionManagerData === 'function') {
                    loadPositionManagerData();
                }
            }
            
            console.log('‚úÖ Âä®ÊÄÅÂÜÖÂÆπÂ∑≤Ê†πÊçÆÊñ∞ËØ≠Ë®ÄÂà∑Êñ∞');
        });

        // ==================== Á≥ªÁªüÂàùÂßãÂåñ ====================
        
        // ÂàùÂßãÂåñÊâÄÊúâÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
        function initializeButtonListeners() {
            console.log('üéõÔ∏è ÂàùÂßãÂåñÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®...');
            
            try {
                // Á°Æ‰øùÊâÄÊúâÂáΩÊï∞Âú®ÂÖ®Â±Ä‰ΩúÁî®ÂüüÂèØÁî®
                window.generateSignals = window.generateSignals || generateSignals;
                window.executeOrder = window.executeOrder || executeOrder;
                window.executeSimulationOrder = window.executeSimulationOrder || executeSimulationOrder;
                window.startAutoTrading = startAutoTrading;
                window.stopAutoTrading = stopAutoTrading;
                window.resetStrategy = resetStrategy;
                window.refreshAllData = window.refreshAllData || refreshAllData;
                
                // AI‰ø°Âè∑ÁîüÊàêÊåâÈíÆ
                const signalBtn = document.querySelector('button[onclick="generateSignals()"]');
                if (signalBtn) {
                    signalBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.generateSignals();
                    });
                    console.log('‚úÖ AI‰ø°Âè∑ÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                }
                
                // Ëá™Âä®‰∫§ÊòìÊåâÈíÆ
                const autoTradingBtn = document.querySelector('#auto-trading-btn, button[onclick="startAutoTrading()"]');
                if (autoTradingBtn) {
                    autoTradingBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        startAutoTrading();
                    });
                    console.log('‚úÖ Ëá™Âä®‰∫§ÊòìÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                }
                
                // ÊâßË°åÊ®°ÊãüËÆ¢ÂçïÊåâÈíÆ
                const executeBtn = document.querySelector('button[onclick="executeSimulationOrder()"]');
                if (executeBtn) {
                    executeBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.executeSimulationOrder();
                    });
                    console.log('‚úÖ ÊâßË°åÊ®°ÊãüËÆ¢ÂçïÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                }
                
                // Âà∑Êñ∞ÊåâÈíÆ
                const refreshBtn = document.querySelector('button[onclick="refreshAllData()"]');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        window.refreshAllData();
                    });
                    console.log('‚úÖ Âà∑Êñ∞ÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                }
                
                // ÈáçÁΩÆÊåâÈíÆ
                const resetBtn = document.querySelector('button[onclick="resetStrategy()"]');
                if (resetBtn) {
                    resetBtn.addEventListener('click', function(e) {
                        e.preventDefault();
                        resetStrategy();
                    });
                    console.log('‚úÖ ÈáçÁΩÆÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                }
                
                // ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ
                const langBtns = document.querySelectorAll('.language-toggle, button[onclick*="switchLanguage"]');
                langBtns.forEach(btn => {
                    btn.addEventListener('click', function(e) {
                        e.preventDefault();
                        const currentLang = window.currentLanguage || 'zh';
                        const newLang = currentLang === 'zh' ? 'en' : 'zh';
                        window.switchLanguage(newLang);
                    });
                });
                console.log('‚úÖ ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆ‰∫ã‰ª∂Â∑≤ÁªëÂÆö');
                
                console.log('‚úÖ ÊâÄÊúâÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®ÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñÊåâÈíÆ‰∫ã‰ª∂Â§±Ë¥•:', error);
            }
        }
        
        // ÂàùÂßãÂåñÊúçÂä°Áä∂ÊÄÅ
        function initializeServices() {
            console.log('üîß ÂàùÂßãÂåñÊúçÂä°Áä∂ÊÄÅ...');
            
            try {
                // ÂàùÂßãÂåñ‰∫§ÊòìÁä∂ÊÄÅÊòæÁ§∫
                updateCapitalDisplay();
                updateTradingState();
                
                // ÂàùÂßãÂåñÊï∞ÊçÆÊ∫êÊåáÁ§∫Âô®
                updateDataSourceIndicator('mixed', 'testing');
                
                // ÂàùÂßãÂåñÊó∂Èó¥ÊòæÁ§∫
                updateTime();
                setInterval(updateTime, 1000);
                
                // ÂàùÂßãÂåñËÇ°Á•®Ê±†ÁªüËÆ°
                if (window.updatePoolStats) {
                    window.updatePoolStats();
                }
                
                // ËÆæÁΩÆËá™Âä®Âà∑Êñ∞
                setInterval(() => {
                    if (!tradingState.isAutoTrading) {
                        updateTime();
                        if (Math.random() < 0.3) { // 30%Ê¶ÇÁéáÂà∑Êñ∞Êï∞ÊçÆ
                            loadInitialData().catch(console.error);
                        }
                    }
                }, 30000); // ÊØè30Áßí
                
                console.log('‚úÖ ÊúçÂä°Áä∂ÊÄÅÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñÊúçÂä°Â§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫ÊñáÊú¨
        function updateStrategyDisplayTexts() {
            // Êõ¥Êñ∞ÈáèÂåñÊåáÊ†áÊñáÊú¨
            const metricElements = {
                'sharpe-ratio': 'sharpe-ratio',
                'sortino-ratio': 'sortino-ratio', 
                'treynor-ratio': 'treynor-ratio',
                'beta-coefficient': 'beta-coefficient',
                'alpha-value': 'alpha-value',
                'active-share': 'active-share',
                'risk-level-indicator': 'risk-level-indicator',
                'liquidity-score': 'liquidity-score'
            };
            
            Object.keys(metricElements).forEach(id => {
                const element = document.getElementById(id);
                const labelElement = document.querySelector(`label[for="${id}"]`);
                const key = metricElements[id];
                
                if (labelElement) {
                    labelElement.textContent = window.t(key);
                }
            });
            
            // Êõ¥Êñ∞Á≠ñÁï•Áä∂ÊÄÅÊñáÊú¨
            const statusElements = document.querySelectorAll('.strategy-status');
            statusElements.forEach(element => {
                if (element.textContent.includes('ËøêË°å‰∏≠') || element.textContent.includes('running')) {
                    element.textContent = window.t('running-status');
                } else if (element.textContent.includes('Â∑≤ÂÅúÊ≠¢') || element.textContent.includes('stopped')) {
                    element.textContent = window.currentLanguage === 'zh' ? 'Â∑≤ÂÅúÊ≠¢' : 'STOPPED';
                }
            });
            
            console.log(`‚úÖ Á≠ñÁï•ÊòæÁ§∫ÊñáÊú¨Â∑≤Êõ¥Êñ∞‰∏∫: ${window.currentLanguage}`);
        }
        
        // È™åËØÅÁøªËØëÂÆåÊï¥ÊÄß
        function validateTranslations() {
            console.log('üîç ÂºÄÂßãÈ™åËØÅÁøªËØëÂÆåÊï¥ÊÄß...');
            
            const languages = Object.keys(translations);
            const allKeys = new Set();
            
            // Êî∂ÈõÜÊâÄÊúâÈîÆÂÄº
            languages.forEach(lang => {
                Object.keys(translations[lang]).forEach(key => allKeys.add(key));
            });
            
            // Ê£ÄÊü•ÊØèÁßçËØ≠Ë®ÄÁöÑÁº∫Â§±ÈîÆÂÄº
            const missingKeys = {};
            languages.forEach(lang => {
                const langKeys = Object.keys(translations[lang]);
                const missing = [...allKeys].filter(key => !langKeys.includes(key));
                if (missing.length > 0) {
                    missingKeys[lang] = missing;
                }
            });
            
            // Êä•ÂëäÁªìÊûú
            if (Object.keys(missingKeys).length > 0) {
                console.warn('üîç ÂèëÁé∞Áº∫Â§±ÁöÑÁøªËØëÈîÆÂÄº:', missingKeys);
                
                // Ëá™Âä®Ë°•ÂÖ®Áº∫Â§±ÁöÑÈîÆÂÄº(‰ΩøÁî®ÈîÆÂêç‰Ωú‰∏∫fallback)
                Object.entries(missingKeys).forEach(([lang, missing]) => {
                    missing.forEach(key => {
                        if (!translations[lang][key]) {
                            // ‰∏∫Áº∫Â§±ÁöÑÈîÆÂÄºÊèê‰æõÊô∫ËÉΩfallback
                            const fallbackTranslation = lang === 'zh' ? 
                                key.toUpperCase().replace(/-/g, ' ') : 
                                key.replace(/-/g, ' ').toLowerCase();
                            translations[lang][key] = fallbackTranslation;
                        }
                    });
                });
                
                console.log('‚úÖ Â∑≤Ëá™Âä®Ë°•ÂÖ®Áº∫Â§±ÁöÑÁøªËØëÈîÆÂÄº');
            } else {
                console.log('‚úÖ ÁøªËØëÈîÆÂÄºÊ£ÄÊü•ÈÄöËøáÔºåÊó†Áº∫Â§±È°π');
            }
            
            // ÊòæÁ§∫ÁªüËÆ°‰ø°ÊÅØ
            const stats = {};
            languages.forEach(lang => {
                stats[lang] = Object.keys(translations[lang]).length;
            });
            console.log('üìä ÁøªËØëÈîÆÂÄºÁªüËÆ°:', stats);
        }
        
        // Â¢ûÂº∫ÁöÑÁøªËØëÂáΩÊï∞
        function enhancedTranslationFunction() {
            window.t = function(key, params = {}) {
                try {
                    const lang = window.currentLanguage || 'zh';
                    let translation = translations[lang]?.[key];
                    
                    if (!translation) {
                        // Â¶ÇÊûúÂΩìÂâçËØ≠Ë®ÄÊ≤°ÊúâÁøªËØëÔºåÂ∞ùËØï‰ªéÂè¶‰∏ÄÁßçËØ≠Ë®ÄËé∑Âèñ
                        const fallbackLang = lang === 'zh' ? 'en' : 'zh';
                        translation = translations[fallbackLang]?.[key];
                        
                        if (translation) {
                            console.debug(`üîÑ ‰ΩøÁî®${fallbackLang}ÁøªËØë‰Ωú‰∏∫${lang}ÁöÑfallback: ${key}`);
                        } else {
                            // ÊúÄÂêé‰ΩøÁî®ÈîÆÂêç‰Ωú‰∏∫fallback
                            console.debug(`‚ö†Ô∏è Êâæ‰∏çÂà∞ÁøªËØëÈîÆÂÄº: ${key}`);
                            translation = key.replace(/-/g, ' ').toUpperCase();
                        }
                    }
                    
                    // ÊîØÊåÅÂèÇÊï∞ÊõøÊç¢ (‰æãÂ¶Ç: "hello {name}" ÈÖçÂêà {name: "world"})
                    if (typeof translation === 'string' && Object.keys(params).length > 0) {
                        Object.entries(params).forEach(([paramKey, paramValue]) => {
                            const placeholder = `{${paramKey}}`;
                            translation = translation.replace(new RegExp(placeholder, 'g'), paramValue);
                        });
                    }
                    
                    return translation;
                } catch (error) {
                    console.warn(`ÁøªËØëÈîÆÂÄºÈîôËØØ: ${key}`, error);
                    return key;
                }
            };
        }
        
        // ÂàùÂßãÂåñËØ≠Ë®ÄÂíåÁïåÈù¢
        function initializeLanguageAndUI() {
            console.log('üåç ÂàùÂßãÂåñËØ≠Ë®ÄÂíåÁïåÈù¢...');
            
            try {
                // 1. È™åËØÅÁøªËØëÂÆåÊï¥ÊÄß
                validateTranslations();
                
                // 2. ÂàùÂßãÂåñÂ¢ûÂº∫ÁøªËØëÂáΩÊï∞
                enhancedTranslationFunction();
                
                // 3. ÊÅ¢Â§ç‰øùÂ≠òÁöÑËØ≠Ë®ÄËÆæÁΩÆ
                const savedLang = localStorage.getItem('arthera-language') || 'zh';
                
                // 4. È™åËØÅËØ≠Ë®ÄÊîØÊåÅ
                if (translations[savedLang]) {
                    window.currentLanguage = savedLang;
                    
                    // 5. Á´ãÂç≥Êõ¥Êñ∞ÁïåÈù¢ÊñáÊú¨
                    window.updateAllText();
                    
                    // 6. Êõ¥Êñ∞ËØ≠Ë®ÄÂàáÊç¢ÊåâÈíÆÊòæÁ§∫
                    const languageToggle = document.querySelector('.language-toggle');
                    if (languageToggle) {
                        languageToggle.textContent = savedLang === 'zh' ? 'EN' : '‰∏≠';
                    }
                    
                    // 7. Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫ÊñáÊú¨
                    updateStrategyDisplayTexts();
                    
                    console.log(`‚úÖ ËØ≠Ë®ÄËÆæÁΩÆÂ∑≤Âä†ËΩΩ: ${savedLang}`);
                } else {
                    console.warn(`‚ö†Ô∏è ‰∏çÊîØÊåÅÁöÑËØ≠Ë®Ä: ${savedLang}Ôºå‰ΩøÁî®ÈªòËÆ§ËØ≠Ë®Ä`);
                    window.currentLanguage = 'zh';
                    window.updateAllText();
                    updateStrategyDisplayTexts();
                }
                
                console.log(`‚úÖ ËØ≠Ë®ÄÂàùÂßãÂåñÂÆåÊàê: ${savedLang}`);
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñËØ≠Ë®ÄÂ§±Ë¥•:', error);
            }
        }
        
        // ÂàùÂßãÂåñÊåâÈíÆÊñáÊú¨ÂíåÁä∂ÊÄÅ
        function initializeButtonStates() {
            console.log('üéõÔ∏è ÂàùÂßãÂåñÊåâÈíÆÁä∂ÊÄÅ...');
            
            try {
                // ËÆæÁΩÆÊåâÈíÆÂàùÂßãÁä∂ÊÄÅ
                const signalBtn = document.getElementById('signal-btn-text');
                if (signalBtn) {
                    signalBtn.textContent = window.t('generate-ai-signals');
                    signalBtn.setAttribute('data-i18n', 'generate-ai-signals');
                }
                
                const autoTradingBtn = document.getElementById('auto-trading-text');
                if (autoTradingBtn) {
                    autoTradingBtn.textContent = window.t('start-auto-trading');
                    autoTradingBtn.setAttribute('data-i18n', 'start-auto-trading');
                }
                
                // ËÆæÁΩÆÂÖ∂‰ªñÊåâÈíÆÁöÑdata-i18nÂ±ûÊÄß
                const executeBtn = document.querySelector('button[onclick="executeSimulationOrder()"] span');
                if (executeBtn && !executeBtn.hasAttribute('data-i18n')) {
                    executeBtn.setAttribute('data-i18n', 'execute-simulation-order');
                    executeBtn.textContent = window.t('execute-simulation-order');
                }
                
                const refreshBtn = document.querySelector('button[onclick="refreshAllData()"] span');
                if (refreshBtn && !refreshBtn.hasAttribute('data-i18n')) {
                    refreshBtn.setAttribute('data-i18n', 'refresh');
                    refreshBtn.textContent = window.t('refresh');
                }
                
                const resetBtn = document.querySelector('button[onclick="resetStrategy()"] span');
                if (resetBtn && !resetBtn.hasAttribute('data-i18n')) {
                    resetBtn.setAttribute('data-i18n', 'reset-button');
                    resetBtn.textContent = window.t('reset-button');
                }
                
                // ÈöêËóèÂä†ËΩΩÂä®Áîª
                const loadingElements = document.querySelectorAll('.loading-spinner');
                loadingElements.forEach(el => el.classList.add('hidden'));
                
                // ËÆæÁΩÆÊåâÈíÆÂèØÁî®Áä∂ÊÄÅ
                const buttons = document.querySelectorAll('button');
                buttons.forEach(btn => {
                    if (!btn.disabled) {
                        btn.classList.remove('opacity-50', 'cursor-not-allowed');
                    }
                });
                
                console.log('‚úÖ ÊåâÈíÆÁä∂ÊÄÅÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÂàùÂßãÂåñÊåâÈíÆÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }
        
        // È™åËØÅÂÖ≥ÈîÆÂáΩÊï∞ÊòØÂê¶ÂèØÁî®
        function validateCriticalFunctions() {
            console.log('üîç È™åËØÅÂÖ≥ÈîÆÂáΩÊï∞...');
            
            const criticalFunctions = [
                'generateSignals',
                'executeOrder',
                'executeSimulationOrder',
                'startAutoTrading',
                'updatePoolStats',
                'generateAIRecommendations',
                'showToast',
                'switchLanguage',
                'updateAllText'
            ];
            
            const missing = [];
            const available = [];
            
            criticalFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    available.push(funcName);
                } else {
                    missing.push(funcName);
                    console.warn(`‚ö†Ô∏è ÂáΩÊï∞ ${funcName} ‰∏çÂèØÁî®`);
                }
            });
            
            console.log(`‚úÖ ÂèØÁî®ÂáΩÊï∞ (${available.length}):`, available);
            if (missing.length > 0) {
                console.error(`‚ùå Áº∫Â§±ÂáΩÊï∞ (${missing.length}):`, missing);
            }
            
            return missing.length === 0;
        }
        
        // ‰∏ªÂàùÂßãÂåñÂáΩÊï∞
        function initializeSystem() {
            console.log('üöÄ ÂºÄÂßãÁ≥ªÁªüÂàùÂßãÂåñ...');
            
            try {
                loadServiceConfigForm();
                setTimeout(() => {
                    try { testServiceEndpoints(); } catch (err) { console.warn('ÊúçÂä°ÊµãËØïÂ§±Ë¥•:', err); }
                }, 200);
                // 1. ÂàùÂßãÂåñËØ≠Ë®ÄÂíåÁïåÈù¢
                initializeLanguageAndUI();
                
                // 2. ÂàùÂßãÂåñÊúçÂä°Áä∂ÊÄÅ
                initializeServices();
                
                // 3. ÂàùÂßãÂåñÊåâÈíÆÁä∂ÊÄÅ
                initializeButtonStates();
                
                // 4. ÂàùÂßãÂåñÊåâÈíÆ‰∫ã‰ª∂ÁõëÂê¨Âô®
                initializeButtonListeners();
                
                // 5. È™åËØÅÂÖ≥ÈîÆÂáΩÊï∞
                const functionsOK = validateCriticalFunctions();
                
                // 6. Âä†ËΩΩÂàùÂßãÊï∞ÊçÆ
                setTimeout(() => {
                    loadInitialData().catch(error => {
                        console.error('‚ùå Âä†ËΩΩÂàùÂßãÊï∞ÊçÆÂ§±Ë¥•:', error);
                    });
                }, 1000);
                
                // 7. ÂêØÂä®Ëá™Âä®Êõ¥Êñ∞
                if (window.startAutoUpdate) {
                    window.startAutoUpdate();
                }
                
                // ÊòæÁ§∫ÂàùÂßãÂåñÂÆåÊàêÊèêÁ§∫
                setTimeout(() => {
                    if (window.showToast) {
                        const message = window.currentLanguage === 'zh' ? 
                            '‚úÖ Á≥ªÁªüÂàùÂßãÂåñÂÆåÊàêÔºåÊâÄÊúâÂäüËÉΩÂ∑≤Â∞±Áª™ÔºÅ' : 
                            '‚úÖ System initialized, all features ready!';
                        window.showToast(message, 'success');
                    }
                }, 2000);
                
                console.log('‚úÖ Á≥ªÁªüÂàùÂßãÂåñÊàêÂäüÔºÅ');
                return true;
            } catch (error) {
                console.error('‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•', 'error');
                }
                return false;
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂ËøõË°åÂÆåÊï¥ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOMÂÜÖÂÆπÂ∑≤Âä†ËΩΩÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            
            // Âª∂ËøüÂàùÂßãÂåñ‰ª•Á°Æ‰øùÊâÄÊúâËÑöÊú¨ÈÉΩÂ∑≤Âä†ËΩΩ
            setTimeout(initializeSystem, 500);
        });
        
        // Á™óÂè£Âä†ËΩΩÂÆåÊàêÊó∂ËøõË°å‰∫åÊ¨°Ê£ÄÊü•
        window.addEventListener('load', function() {
            console.log('üñºÔ∏è Á™óÂè£Âä†ËΩΩÂÆåÊàêÔºåËøõË°å‰∫åÊ¨°Ê£ÄÊü•...');
            
            // Â¶ÇÊûúÁ≥ªÁªüÂ∞öÊú™Ê≠£Á°ÆÂàùÂßãÂåñÔºåÂÜçÊ¨°Â∞ùËØï
            setTimeout(() => {
                if (!window.systemInitialized) {
                    console.log('üîÑ ËøõË°å‰∫åÊ¨°ÂàùÂßãÂåñ...');
                    initializeSystem();
                    window.systemInitialized = true;
                }
            }, 1000);
        });
        
        // ==================== ÂÖ®Â±ÄÂèòÈáèÂíåÈÖçÁΩÆ ====================
        function computeApiBaseUrl() {
            const configBaseUrl = window.__TRADING_ENGINE_CONFIG__ && window.__TRADING_ENGINE_CONFIG__.apiBaseUrl;
            const originCandidate = (typeof window !== 'undefined' && window.location) ? window.location.origin : '';
            const normalizedOrigin = originCandidate && originCandidate !== 'null' ? originCandidate : '';
            const baseUrl = configBaseUrl || normalizedOrigin || 'http://localhost:8001';
            console.log('üåê API Base URL:', baseUrl);
            return baseUrl;
        }

        let API_BASE_URL = computeApiBaseUrl();
        
        // Ê∑ªÂä†ÁºìÂ≠òÊ∏ÖÈô§ÂèÇÊï∞ÔºåÁ°Æ‰øù‰ΩøÁî®ÊúÄÊñ∞ÈÖçÁΩÆ
        function addCacheBuster(url) {
            const separator = url.includes('?') ? '&' : '?';
            return `${url}${separator}_t=${Date.now()}`;
        }

        let charts = {
            volume: null,
            performance: null,
            risk: null,
            correlation: null,
            technical: null,
            signals: null
        };
        
        let financialMetrics = {
            sharpeRatio: 0,
            sortino: 0,
            maxDrawdown: 0,
            var95: 0,
            beta: 0,
            alpha: 0,
            informationRatio: 0,
            treynor: 0,
            correlation: null,
            volatility: null,
            trackingError: null
        };
        
        let updateIntervals = {
            main: null,
            charts: null,
            autoTrading: null,
            indices: null
        };
        
        let tradingState = {
            totalCapital: 100000,
            availableCapital: 100000,
            usedCapital: 0,
            positions: [],
            isAutoTrading: false,
            totalProfit: 0,
            tradingHistory: []
        };
        window.tradingState = tradingState;
        
        let strategyConfig = {
            riskLevel: 'moderate',
            maxPosition: 10000,
            stopLoss: 5,
            takeProfit: 15
        };

        // ==================== ÂàùÂßãÂåñ ====================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñArthera‰∫§ÊòìÁ≥ªÁªü...');
            
            try {
                // Âü∫Á°ÄÂàùÂßãÂåñ
                updateTime();
                console.log('‚úÖ Êó∂Èó¥Êõ¥Êñ∞ÂàùÂßãÂåñÂÆåÊàê');
                
                initializeCapital();
                loadStrategyConfig();
                console.log('‚úÖ ËµÑÈáëÁÆ°ÁêÜÂíåÁ≠ñÁï•ÈÖçÁΩÆÂàùÂßãÂåñÂÆåÊàê');
                
                // ÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÊúÄÈáçË¶ÅÔºâ
                bindEventListeners();
                console.log('‚úÖ ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂÆåÊàê');
                
                // È™åËØÅÊ†∏ÂøÉÂáΩÊï∞
                validateCoreFunctions();
                
                // ÊòæÁ§∫Âü∫Êú¨ÁïåÈù¢
                showToast(window.t('basic-functions-loaded'), 'success');
                console.log('‚úÖ Âü∫Á°ÄÂàùÂßãÂåñÂÆåÊàê');
                
                // Âª∂ËøüÂä†ËΩΩÂÖ∂‰ªñÂäüËÉΩÔºåÈÅøÂÖçÈòªÂ°ûUI
                setTimeout(async () => {
                    try {
                        console.log('üîÑ ÂºÄÂßãÂä†ËΩΩÈ´òÁ∫ßÂäüËÉΩ...');
                        
                        // ÂàÜÊ≠•Âä†ËΩΩÔºåÊØèÊ≠•ÈÉΩÊúâÁã¨Á´ãÈîôËØØÂ§ÑÁêÜ
                        try {
                            await initializeCharts();
                            console.log('‚úÖ ÂõæË°®ÂàùÂßãÂåñÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è ÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•ÔºåÁªßÁª≠Âä†ËΩΩÂÖ∂‰ªñÂäüËÉΩ:', error);
                        }
                        
                        try {
                            await loadInitialData();
                            console.log('‚úÖ ÂàùÂßãÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadConfigStatus();
                            console.log('‚úÖ ÈÖçÁΩÆÁä∂ÊÄÅÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è ÈÖçÁΩÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadMarketIndices();
                            console.log('‚úÖ Â∏ÇÂú∫ÊåáÊï∞Âä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        try {
                            await loadStrategies();
                            console.log('‚úÖ Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Á≠ñÁï•Âä†ËΩΩÂ§±Ë¥•:', error);
                        }
                        
                        // ÂêØÂä®Ëá™Âä®Êõ¥Êñ∞
                        try {
                            startAutoUpdate();
                            console.log('‚úÖ Ëá™Âä®Êõ¥Êñ∞ÂêØÂä®ÂÆåÊàê');
                        } catch (error) {
                            console.warn('‚ö†Ô∏è Ëá™Âä®Êõ¥Êñ∞ÂêØÂä®Â§±Ë¥•:', error);
                        }
                        
                        // Âä†ËΩΩÂàùÂßãÂõæË°®Êï∞ÊçÆ
                        // ÂàùÂßãÂåñÊñ∞Â¢ûÂäüËÉΩ - Á°Æ‰øùDOMÂÆåÂÖ®Â∞±Áª™
                        console.log('üöÄ ÂºÄÂßãÂàùÂßãÂåñÊñ∞Â¢ûÂäüËÉΩ...');
                        
                        // Á´ãÂç≥ÂàùÂßãÂåñËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ
                        try {
                            const searchInput = document.getElementById('stock-search');
                            const dropdown = document.getElementById('search-dropdown');
                            
                            if (searchInput && dropdown) {
                                console.log('‚úÖ ÊêúÁ¥¢ÂÖÉÁ¥†Â∑≤Â∞±Áª™ÔºåÁ´ãÂç≥ÂàùÂßãÂåñ...');
                                window.initStockSearch();
                                window.updateStockChips();
                                window.updatePoolStats();
                                window.generateAIRecommendations();
                                console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàê');
                            } else {
                                console.log('‚ö†Ô∏è ÊêúÁ¥¢ÂÖÉÁ¥†Êú™Â∞±Áª™ÔºåÁ≠âÂæÖDOMËß£ÊûêÂÆåÊàê...');
                                // ‰ΩøÁî®MutationObserverÁõëÊéßDOMÂèòÂåñ
                                const observer = new MutationObserver((mutations) => {
                                    const searchInput = document.getElementById('stock-search');
                                    const dropdown = document.getElementById('search-dropdown');
                                    
                                    if (searchInput && dropdown && !window.searchInitialized) {
                                        console.log('‚úÖ ÊêúÁ¥¢ÂÖÉÁ¥†ÈÄöËøáMutationObserverÊâæÂà∞ÔºåÂºÄÂßãÂàùÂßãÂåñ...');
                                        observer.disconnect();
                                        try {
                                            window.initStockSearch();
                                            window.updateStockChips();
                                            window.updatePoolStats();
                                            window.generateAIRecommendations();
                                            console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàêÔºàÂª∂ËøüÔºâ');
                                        } catch (error) {
                                            console.error('ÊêúÁ¥¢ÂàùÂßãÂåñÈîôËØØ:', error);
                                        }
                                    }
                                });
                                
                                observer.observe(document.body, { 
                                    childList: true, 
                                    subtree: true 
                                });
                                
                                // 3ÁßíÂêéÊñ≠ÂºÄËßÇÂØüÂô®ÔºàÈò≤Ê≠¢ÂÜÖÂ≠òÊ≥ÑÊºèÔºâ
                                setTimeout(() => {
                                    if (observer) {
                                        observer.disconnect();
                                        console.log('üîß MutationObserverÂ∑≤Êñ≠ÂºÄ');
                                    }
                                }, 3000);
                            }
                        } catch (error) {
                            console.error('Êñ∞Â¢ûÂäüËÉΩÂàùÂßãÂåñÂ§±Ë¥•:', error);
                        }
                        
                        showToast(window.t('system-load-complete'), 'success');
                        
                        // È¢ùÂ§ñÁöÑÊêúÁ¥¢ÂäüËÉΩ‰øùÈô©ÂàùÂßãÂåñ - Âú®1ÁßíÂêéÊ£ÄÊü•
                        setTimeout(() => {
                            if (!window.searchInitialized) {
                                console.log('üîÑ ÊâßË°å‰øùÈô©ÊêúÁ¥¢ÂàùÂßãÂåñÊ£ÄÊü•...');
                                const searchInput = document.getElementById('stock-search');
                                const dropdown = document.getElementById('search-dropdown');
                                
                                if (searchInput && dropdown) {
                                    console.log('üÜò ÊêúÁ¥¢ÂÖÉÁ¥†Â≠òÂú®‰ΩÜÊú™ÂàùÂßãÂåñÔºåÊâßË°å‰øùÈô©ÂàùÂßãÂåñ...');
                                    try {
                                        window.initStockSearch();
                                        console.log('‚úÖ ‰øùÈô©ÂàùÂßãÂåñÂÆåÊàê');
                                    } catch (error) {
                                        console.error('‰øùÈô©ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                                    }
                                } else {
                                    console.log('‚ùå ‰øùÈô©Ê£ÄÊü•: ÊêúÁ¥¢ÂÖÉÁ¥†‰ªçÊú™ÊâæÂà∞');
                                }
                            } else {
                                console.log('‚úÖ ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Ê≠£Â∏∏ÂàùÂßãÂåñÔºåÊó†ÈúÄ‰øùÈô©Êé™ÊñΩ');
                            }
                        }, 1000);
                        
                    } catch (error) {
                        console.error('‚ùå È´òÁ∫ßÂäüËÉΩÂä†ËΩΩÂ§±Ë¥•:', error);
                        showToast(window.t('partial-load-failed'), 'warning');
                    }
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Âü∫Á°ÄÂàùÂßãÂåñÂ§±Ë¥•:', error);
                showToast('‚ùå Á≥ªÁªüÂàùÂßãÂåñÂ§±Ë¥•: ' + error.message, 'error');
            }
        });

        function bindEventListeners() {
            console.log('üîß ÂºÄÂßãÁªëÂÆö‰∫ã‰ª∂ÁõëÂê¨Âô®...');
            
            try {
                // Â∏ÇÂú∫ÈÄâÊã©Âô®
                const marketSelect = document.getElementById('market-select');
                if (marketSelect) {
                    marketSelect.addEventListener('change', function(e) {
                        const selectedMarket = e.target.value;
                        console.log(`üìä Â∏ÇÂú∫ÂàáÊç¢Âà∞: ${selectedMarket}`);
                        showToast(`ÂàáÊç¢Âà∞${selectedMarket === 'US' ? 'ÁæéËÇ°' : 'AËÇ°'}Â∏ÇÂú∫ÔºåÊ≠£Âú®ÈáçÊñ∞Âä†ËΩΩÂõæË°®Êï∞ÊçÆ...`, 'info');
                        
                        // ‰ΩøÁî®Á´ãÂç≥ÊâßË°åÁöÑÂºÇÊ≠•ÂáΩÊï∞ÈÅøÂÖçÊ∂àÊÅØÈÄöÈÅìÈîôËØØ
                        (async () => {
                            try {
                                await loadInitialChartData();
                                await loadMarketIndices();
                                showToast(`‚úÖ ${selectedMarket === 'US' ? 'ÁæéËÇ°' : 'AËÇ°'}ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê`, 'success');
                            } catch (error) {
                                console.error('Â∏ÇÂú∫ÂàáÊç¢Â§±Ë¥•:', error);
                                showToast('‚ö†Ô∏è ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'warning');
                            }
                        })();
                    });
                    console.log('‚úÖ Â∏ÇÂú∫ÈÄâÊã©Âô®‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Â∏ÇÂú∫ÈÄâÊã©Âô®ÂÖÉÁ¥†');
                }
                
                // Âà∑Êñ∞ÊåâÈíÆ
                const refreshBtn = document.getElementById('refresh-btn');
                if (refreshBtn) {
                    refreshBtn.addEventListener('click', refreshAllData);
                    console.log('‚úÖ Âà∑Êñ∞ÊåâÈíÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞Âà∑Êñ∞ÊåâÈíÆÂÖÉÁ¥†');
                }
                
                // ËÆæÁΩÆÊåâÈíÆ
                const settingsBtn = document.getElementById('settings-btn');
                if (settingsBtn) {
                    settingsBtn.addEventListener('click', openSettings);
                    console.log('‚úÖ ËÆæÁΩÆÊåâÈíÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ËÆæÁΩÆÊåâÈíÆÂÖÉÁ¥†');
                }
                
                // ËµÑÈáëËæìÂÖ•Ê°Ü
                const capitalInput = document.getElementById('initial-capital');
                if (capitalInput) {
                    capitalInput.addEventListener('change', function(e) {
                        const newCapital = parseFloat(e.target.value);
                        console.log(`üí∞ ËµÑÈáëËæìÂÖ•ÂèòÂåñ: ${newCapital}`);
                        if (newCapital && newCapital >= 1000) {
                            updateCapitalDisplay();
                            showToast(`üí∞ ËµÑÈáëÂ∑≤Êõ¥Êñ∞‰∏∫ $${newCapital.toLocaleString()}`, 'info');
                        }
                    });
                    console.log('‚úÖ ËµÑÈáëËæìÂÖ•Ê°Ü‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                } else {
                    console.warn('‚ö†Ô∏è Êú™ÊâæÂà∞ËµÑÈáëËæìÂÖ•Ê°ÜÂÖÉÁ¥†');
                }
                
                // ÂÖ®Â±ÄÂø´Êç∑ÈîÆ
                document.addEventListener('keydown', function(e) {
                    if (e.ctrlKey && e.key === 'r') {
                        e.preventDefault();
                        console.log('‚å®Ô∏è Âø´Êç∑ÈîÆËß¶Âèë: Ctrl+R');
                        refreshAllData();
                    }
                });
                console.log('‚úÖ ÂÖ®Â±ÄÂø´Êç∑ÈîÆ‰∫ã‰ª∂ÁªëÂÆöÊàêÂäü');
                
                console.log('üéâ ÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂÆåÊàê');
                
            } catch (error) {
                console.error('‚ùå ‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÂ§±Ë¥•:', error);
                showToast('‚ùå ‰∫ã‰ª∂ÁªëÂÆöÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        function startAutoUpdate() {
            if (!settings.autoRefresh) return;

            const refreshIntervalMs = Math.max(5000, Number(settings.refreshInterval) || 30000);

            if (updateIntervals.main) clearInterval(updateIntervals.main);
            updateIntervals.main = setInterval(() => {
                updateDashboard();
                loadStrategyData(); // ÂÆöÊúüÊõ¥Êñ∞Á≠ñÁï•Êï∞ÊçÆ
                loadAnalyticsPanels();
                loadRecentSignals();
                loadRecentOrders();
                updateTime();
            }, refreshIntervalMs);

            if (updateIntervals.charts) clearInterval(updateIntervals.charts);
            updateIntervals.charts = setInterval(() => {
                updateCharts();
            }, 10000);

            if (updateIntervals.indices) clearInterval(updateIntervals.indices);
            updateIntervals.indices = setInterval(() => {
                loadMarketIndices();
            }, 30000);
        }

        // ==================== ËµÑÈáëÁÆ°ÁêÜ ====================
        async function initializeCapital() {
            console.log('üí∞ ÂàùÂßãÂåñËµÑÈáëÁÆ°ÁêÜ...');
            
            try {
                // ËÆæÁΩÆÂàùÂßãËµÑÈáëÁä∂ÊÄÅ
                const initialCapital = 100000; // ÈªòËÆ§10‰∏á
                tradingState.totalCapital = initialCapital;
                tradingState.availableCapital = initialCapital;
                tradingState.usedCapital = 0;
                
                // ËÆæÁΩÆËæìÂÖ•Ê°ÜÈªòËÆ§ÂÄº
                const capitalInput = document.getElementById('initial-capital');
                if (capitalInput && !capitalInput.value) {
                    capitalInput.value = initialCapital;
                }
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                updateCapitalDisplay();
                
                // Â∞ùËØïÂä†ËΩΩËµÑÈáëÁä∂ÊÄÅÔºàÂ¶ÇÊûúÂêéÁ´ØÂèØÁî®Ôºâ
                await loadCapitalStatus();
                await updatePortfolioHoldings();
                
                console.log('‚úÖ ËµÑÈáëÁÆ°ÁêÜÂàùÂßãÂåñÂÆåÊàê:', tradingState);
            } catch (error) {
                console.warn('‚ö†Ô∏è ËµÑÈáëÁä∂ÊÄÅÂä†ËΩΩÂ§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÂÄº:', error);
                updateCapitalDisplay(); // Á°Æ‰øùÊòæÁ§∫ÈªòËÆ§ÂÄº
            }
        }
        
        async function setCapital() {
            console.log('üí∞ setCapital() ÂáΩÊï∞Ë¢´Ë∞ÉÁî®');
            
            const capitalInput = document.getElementById('initial-capital');
            if (!capitalInput) {
                console.error('‚ùå Êú™ÊâæÂà∞ initial-capital ÂÖÉÁ¥†');
                showToast(window.t('capital-input-not-found'), 'error');
                return;
            }
            
            const newCapital = parseFloat(capitalInput.value) || 100000; // ÈªòËÆ§ÂÄº
            console.log(`üí∞ ËæìÂÖ•ÁöÑËµÑÈáëÈáëÈ¢ù: ${newCapital}`);
            
            if (isNaN(newCapital) || newCapital < 1000) {
                console.warn('‚ö†Ô∏è ËµÑÈáëÈáëÈ¢ùÊó†ÊïàÊàñËøáÂ∞è');
                showToast(window.t('invalid-capital-amount'), 'warning');
                return;
            }
            
            if (tradingState.isAutoTrading) {
                showToast(window.t('auto-trading-active-cannot-modify'), 'warning');
                return;
            }
            
            try {
                // Á´ãÂç≥Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
                const oldCapital = tradingState.totalCapital;
                tradingState.totalCapital = newCapital;
                tradingState.availableCapital = newCapital - tradingState.usedCapital;
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                updateCapitalDisplay();
                
                // Â∞ùËØïË∞ÉÁî®ÂêéÁ´ØAPIËÆæÁΩÆÂàùÂßãËµÑÈáëÔºàÂ¶ÇÊûúÂèØÁî®Ôºâ
                try {
                    const response = await fetch(`${API_BASE_URL}/portfolio/set-capital`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ initial_capital: newCapital })
                    });
                    
                    if (response.ok) {
                        const result = await response.json();
                        console.log('‚úÖ ÂêéÁ´ØËµÑÈáëËÆæÁΩÆÊàêÂäü:', result);
                        
                        // ÈáçÊñ∞Âä†ËΩΩËµÑÈáëÁä∂ÊÄÅ
                        await loadCapitalStatus();
                    } else {
                        let errorDetails = '';
                        try {
                            const errorData = await response.json();
                            errorDetails = errorData.detail || errorData.message || 'Unknown error';
                        } catch (e) {
                            errorDetails = `HTTP ${response.status}`;
                        }
                        console.warn(`‚ö†Ô∏è ÂêéÁ´ØËµÑÈáëËÆæÁΩÆÂ§±Ë¥• (${response.status}): ${errorDetails}Ôºå‰ΩÜÊú¨Âú∞Áä∂ÊÄÅÂ∑≤Êõ¥Êñ∞`);
                    }
                } catch (apiError) {
                    console.warn('‚ö†Ô∏è Êó†Ê≥ïËøûÊé•ÂêéÁ´ØAPIÔºå‰ªÖÊõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ:', apiError.message);
                }
                
                showToast(`üí∞ ËµÑÈáëÂ∑≤ËÆæÁΩÆ‰∏∫: $${newCapital.toLocaleString()}`, 'success');
                    
                // Âà∑Êñ∞Áõ∏ÂÖ≥Èù¢Êùø
                loadAnalyticsPanels();
                updateDashboard();
                loadRecentSignals();
                loadRecentOrders();
                
            } catch (error) {
                console.error('‚ùå ËÆæÁΩÆËµÑÈáëÂ§±Ë¥•:', error);
                showToast('ËµÑÈáëËÆæÁΩÆÂ§±Ë¥•ÔºåËØ∑ÈáçËØï', 'error');
            }
        }
        
        async function loadCapitalStatus() {
            try {
                console.log('üîÑ Ê≠£Âú®Âä†ËΩΩËµÑÈáëÁä∂ÊÄÅ...', `${API_BASE_URL}/portfolio/capital-status`);
                const response = await fetch(`${API_BASE_URL}/portfolio/capital-status`);
                if (!response.ok) {
                    console.error('‚ùå ËµÑÈáëÁä∂ÊÄÅAPIÂ§±Ë¥•:', response.status, response.statusText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const capitalData = await response.json();
                
                // Êõ¥Êñ∞Êú¨Âú∞Áä∂ÊÄÅ
                tradingState.totalCapital = capitalData.total_capital;
                tradingState.usedCapital = capitalData.used_capital;
                tradingState.availableCapital = capitalData.available_capital;
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                updateCapitalDisplay();
                
                console.log('‚úÖ ËµÑÈáëÁä∂ÊÄÅÊõ¥Êñ∞ÊàêÂäü', capitalData);
                return capitalData;
                
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñËµÑÈáëÁä∂ÊÄÅÂ§±Ë¥•:', error);
                showToast(`‚ö†Ô∏è ËµÑÈáëÁä∂ÊÄÅÂä†ËΩΩÂ§±Ë¥•: ${error.message}`, 'warning');
                // ‰ΩøÁî®ÈªòËÆ§ÂÄºÊàñ‰πãÂâçÁöÑÁä∂ÊÄÅ
                updateCapitalDisplay();
            }
        }
        
        function updateCapitalDisplay() {
            // Êõ¥Êñ∞ÊÄªËµÑÈáëÊòæÁ§∫
            const totalCapitalElement = document.getElementById('total-capital');
            if (totalCapitalElement) {
                totalCapitalElement.textContent = '$' + tradingState.totalCapital.toLocaleString();
            }
            
            // Êõ¥Êñ∞Â∑≤Áî®ËµÑÈáëÊòæÁ§∫
            const usedCapitalElement = document.getElementById('used-capital');
            if (usedCapitalElement) {
                usedCapitalElement.textContent = '$' + tradingState.usedCapital.toLocaleString();
            }
            
            // Êõ¥Êñ∞ÂèØÁî®ËµÑÈáëÊòæÁ§∫  
            const availableCapitalElement = document.getElementById('available-capital');
            if (availableCapitalElement) {
                availableCapitalElement.textContent = '$' + tradingState.availableCapital.toLocaleString();
            }
            
            // Êõ¥Êñ∞ËµÑÈáëÂà©Áî®Áéá
            const utilizationRate = tradingState.totalCapital > 0 ? (tradingState.usedCapital / tradingState.totalCapital) * 100 : 0;
            const capitalChangeElement = document.getElementById('capital-change');
            if (capitalChangeElement) {
                capitalChangeElement.textContent = `ËµÑÈáëÂà©Áî®Áéá: ${utilizationRate.toFixed(1)}%`;
            }
            
            console.log('üí∞ ËµÑÈáëÊòæÁ§∫Â∑≤Êõ¥Êñ∞:', {
                total: tradingState.totalCapital,
                used: tradingState.usedCapital,
                available: tradingState.availableCapital
            });
        }
        
        function allocateCapital(amount) {
            if (amount > tradingState.availableCapital) {
                showToast('ÂèØÁî®ËµÑÈáë‰∏çË∂≥', 'error');
                return false;
            }
            
            tradingState.usedCapital += amount;
            tradingState.availableCapital -= amount;
            updateCapitalDisplay();
            return true;
        }
        
        function releaseCapital(amount, profit = 0) {
            tradingState.usedCapital -= amount;
            tradingState.availableCapital += amount + profit;
            tradingState.totalProfit += profit;
            
            if (tradingState.usedCapital < 0) tradingState.usedCapital = 0;
            if (tradingState.availableCapital > tradingState.totalCapital + tradingState.totalProfit) {
                tradingState.totalCapital = tradingState.availableCapital;
            }
            
            updateCapitalDisplay();
        }
        
        // ==================== ÊåÅ‰ªìÈÖçÊØîÁÆ°ÁêÜÁ≥ªÁªü ====================
        
        async function rebalancePortfolio() {
            console.log('‚öñÔ∏è ÂºÄÂßãÊäïËµÑÁªÑÂêàÈáçÊñ∞Âπ≥Ë°°...');
            
            try {
                const maxPositionPercent = document.getElementById('max-position-percent').value;
                showToast('üîÑ Ê≠£Âú®ÈáçÊñ∞Âπ≥Ë°°ÊäïËµÑÁªÑÂêà...', 'info');
                
                // Ëé∑ÂèñÂΩìÂâçÊåÅ‰ªìÁä∂ÊÄÅ
                const response = await fetch(`${API_BASE_URL}/portfolio/positions`);
                if (!response.ok) {
                    throw new Error(translations[currentLanguage]['get-position-data-failed']);
                }
                
                const positionsData = await response.json();
                const currentPositions = positionsData.positions || {};
                const totalCapital = positionsData.total_capital || tradingState.totalCapital;
                
                console.log('üìä ÂΩìÂâçÊåÅ‰ªì:', currentPositions);
                
                // ËÆ°ÁÆóÊØè‰∏™ÊåÅ‰ªìÁöÑÁõÆÊ†áÈáëÈ¢ù
                const maxPositionAmount = (totalCapital * maxPositionPercent) / 100;
                const rebalanceActions = [];
                
                for (const [symbol, position] of Object.entries(currentPositions)) {
                    const currentValue = position.current_value || 0;
                    const targetValue = maxPositionAmount;
                    const difference = targetValue - currentValue;
                    
                    if (Math.abs(difference) > targetValue * 0.05) { // 5%ÈòàÂÄº
                        rebalanceActions.push({
                            symbol: symbol,
                            current_value: currentValue,
                            target_value: targetValue,
                            action: difference > 0 ? 'buy' : 'sell',
                            amount: Math.abs(difference)
                        });
                    }
                }
                
                // ÊâßË°åÈáçÊñ∞Âπ≥Ë°°
                for (const action of rebalanceActions) {
                    console.log(`‚öñÔ∏è ${action.action} ${action.symbol}: $${action.amount.toFixed(2)}`);
                    
                    const orderResponse = await fetch(`${API_BASE_URL}/orders/submit`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            symbol: action.symbol,
                            action: action.action,
                            amount: action.amount,
                            order_type: 'rebalance'
                        })
                    });
                    
                    if (orderResponse.ok) {
                        const orderResult = await orderResponse.json();
                        console.log(`‚úÖ ${action.symbol} ÈáçÂπ≥Ë°°ÊàêÂäü:`, orderResult);
                    } else {
                        console.warn(`‚ö†Ô∏è ${action.symbol} ÈáçÂπ≥Ë°°Â§±Ë¥•`);
                    }
                }
                
                // Êõ¥Êñ∞ÊåÅ‰ªìÊòæÁ§∫
                await updatePortfolioHoldings();
                
                showToast(`‚úÖ ÊäïËµÑÁªÑÂêàÈáçÊñ∞Âπ≥Ë°°ÂÆåÊàêÔºåÂ§ÑÁêÜ‰∫Ü ${rebalanceActions.length} ‰∏™ÊåÅ‰ªì`, 'success');
                
            } catch (error) {
                console.error('‚ùå ÊäïËµÑÁªÑÂêàÈáçÊñ∞Âπ≥Ë°°Â§±Ë¥•:', error);
                showToast('‚ùå ÈáçÊñ∞Âπ≥Ë°°Â§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        window.showPositionManager = function() {
            console.log('üìã ÊòæÁ§∫ÊåÅ‰ªìÁÆ°ÁêÜÂô®...');
            
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            const totalValue = tradingState.positions.reduce((sum, pos) => sum + (pos.value || 0), 0);
            const positionCount = tradingState.positions.length;
            const avgReturn = positionCount > 0 ? 
                tradingState.positions.reduce((sum, pos) => sum + (pos.return || 0), 0) / positionCount : 0;
            
            // ÂàõÂª∫Ê®°ÊÄÅÊ°Ü
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="bg-black border border-white p-6 rounded-lg max-w-4xl w-full mx-4 max-h-80vh overflow-y-auto">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-white font-mono text-lg" data-i18n="position-manager">Position Manager</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-white hover:text-gray-300">‚úï</button>
                    </div>
                    
                    <!-- ÊåÅ‰ªìÊ¶ÇËßà -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <div class="bg-gray-900 p-3 rounded border border-gray-600">
                            <div class="text-xs text-gray-400" data-i18n="total-position-value">Total Value</div>
                            <div id="total-portfolio-value" class="text-white font-mono">$0.00</div>
                        </div>
                        <div class="bg-gray-900 p-3 rounded border border-gray-600">
                            <div class="text-xs text-gray-400" data-i18n="position-count">Positions</div>
                            <div id="position-count" class="text-white font-mono">0</div>
                        </div>
                        <div class="bg-gray-900 p-3 rounded border border-gray-600">
                            <div class="text-xs text-gray-400" data-i18n="average-holding-rate">Avg Rate</div>
                            <div id="avg-position-rate" class="text-white font-mono">0%</div>
                        </div>
                    </div>
                    
                    <!-- ÊåÅ‰ªìÂàóË°® -->
                    <div class="mb-4">
                        <h4 class="text-white font-mono text-sm mb-2" data-i18n="current-positions">Current Positions</h4>
                        <div id="positions-table" class="bg-gray-900 rounded border border-gray-600">
                            <div class="text-center text-gray-400 p-4" data-i18n="loading-text">Loading...</div>
                        </div>
                    </div>
                    
                    <!-- Êìç‰ΩúÊåâÈíÆ -->
                    <div class="flex gap-2 justify-end">
                        <button onclick="exportPositions()" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700" data-i18n="export-positions">
                            Export
                        </button>
                        <button onclick="clearAllPositions()" class="bg-red-600 text-white px-4 py-2 rounded text-sm hover:bg-red-700" data-i18n="clear-positions">
                            Clear
                        </button>
                        <button onclick="this.closest('.fixed').remove()" class="bg-gray-600 text-white px-4 py-2 rounded text-sm hover:bg-gray-700" data-i18n="close-button">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Â∫îÁî®ÁøªËØëÂà∞Âä®ÊÄÅÁîüÊàêÁöÑÂÖÉÁ¥†
            if (typeof window.applyTranslations === 'function') {
                window.applyTranslations();
            }
            
            // Âä†ËΩΩÊåÅ‰ªìÊï∞ÊçÆ
            loadPositionManagerData();
        };
        
        async function loadPositionManagerData() {
            try {
                console.log('üîÑ Âä†ËΩΩÊåÅ‰ªìÁÆ°ÁêÜÂô®Êï∞ÊçÆ...');
                
                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                const positionsTableEl = document.getElementById('positions-table');
                if (positionsTableEl) {
                    positionsTableEl.innerHTML = `
                        <div class="text-center text-gray-400 p-4">
                            <i class="fas fa-spinner fa-spin mr-2"></i><span data-i18n="loading-text">${translations[currentLanguage]['loading-text']}</span>
                        </div>
                    `;
                }
                
                const response = await fetch(`${API_BASE_URL}/portfolio/positions`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä ÊåÅ‰ªìÊï∞ÊçÆ:', data);
                
                const positions = data?.positions || {};
                const totalCapital = data?.total_capital || 0;
                
                // Êõ¥Êñ∞Ê¶ÇËßàÊï∞ÊçÆ
                let totalValue = 0;
                const positionCount = Object.keys(positions).length;
                
                for (const position of Object.values(positions)) {
                    totalValue += position.current_value || 0;
                }
                
                const avgPositionRate = totalCapital > 0 ? (totalValue / totalCapital * 100) : 0;
                
                const totalValueEl = document.getElementById('total-portfolio-value');
                const positionCountEl = document.getElementById('position-count');
                const avgPositionRateEl = document.getElementById('avg-position-rate');
                
                if (totalValueEl) totalValueEl.textContent = `$${totalValue.toLocaleString()}`;
                if (positionCountEl) positionCountEl.textContent = positionCount;
                if (avgPositionRateEl) avgPositionRateEl.textContent = `${avgPositionRate.toFixed(1)}%`;
                
                // ÁîüÊàêÊåÅ‰ªìË°®Ê†º
                if (!positionsTableEl) return;
                
                if (positionCount === 0) {
                    positionsTableEl.innerHTML = `
                        <div class="text-center text-gray-400 p-4" data-i18n="no-positions">${translations[currentLanguage]['no-positions']}</div>
                    `;
                } else {
                    const tableHTML = `
                        <table class="w-full text-xs">
                            <thead>
                                <tr class="border-b border-gray-600">
                                    <th class="text-left p-2 text-gray-400" data-i18n="stock-code">${translations[currentLanguage]['stock-code']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="quantity">${translations[currentLanguage]['quantity']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="cost-price">${translations[currentLanguage]['cost-price']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="current-price">${translations[currentLanguage]['current-price']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="market-value">${translations[currentLanguage]['market-value']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="profit-loss">${translations[currentLanguage]['profit-loss']}</th>
                                    <th class="text-right p-2 text-gray-400" data-i18n="percentage">${translations[currentLanguage]['percentage']}</th>
                                    <th class="text-center p-2 text-gray-400" data-i18n="actions">${translations[currentLanguage]['actions']}</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${Object.entries(positions).map(([symbol, pos]) => {
                                    const pnl = (pos.current_value || 0) - (pos.cost_basis || 0);
                                    const pnlPercent = pos.cost_basis > 0 ? (pnl / pos.cost_basis * 100) : 0;
                                    const positionPercent = totalCapital > 0 ? (pos.current_value / totalCapital * 100) : 0;
                                    
                                    return `
                                        <tr class="border-b border-gray-700 hover:bg-gray-800">
                                            <td class="p-2 text-white font-mono">${symbol}</td>
                                            <td class="p-2 text-white text-right">${pos.quantity || 0}</td>
                                            <td class="p-2 text-white text-right">$${(pos.avg_price || 0).toFixed(2)}</td>
                                            <td class="p-2 text-white text-right">$${(pos.current_price || 0).toFixed(2)}</td>
                                            <td class="p-2 text-white text-right">$${(pos.current_value || 0).toLocaleString()}</td>
                                            <td class="p-2 text-right ${pnl >= 0 ? 'text-green-400' : 'text-red-400'}">
                                                $${pnl.toFixed(2)} (${pnlPercent.toFixed(1)}%)
                                            </td>
                                            <td class="p-2 text-white text-right">${positionPercent.toFixed(1)}%</td>
                                            <td class="p-2 text-center">
                                                <button onclick="sellPosition('${symbol}')" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600" data-i18n="sell">
                                                    ${translations[currentLanguage]['sell']}
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    
                    positionsTableEl.innerHTML = tableHTML;
                }
                
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊåÅ‰ªìÁÆ°ÁêÜÂô®Êï∞ÊçÆÂ§±Ë¥•:', error);
                const errorTableEl = document.getElementById('positions-table');
                if (errorTableEl) {
                    errorTableEl.innerHTML = `
                        <div class="text-center text-red-400 p-4">Âä†ËΩΩÂ§±Ë¥•: ${error.message}</div>
                    `;
                }
            }
        }
        
        async function updatePortfolioHoldings() {
            console.log('üîÑ Êõ¥Êñ∞ÊåÅ‰ªìÊòæÁ§∫...', `${API_BASE_URL}/portfolio/positions`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/portfolio/positions`);
                if (!response.ok) {
                    console.error('‚ùå ÊåÅ‰ªìÊï∞ÊçÆAPIÂ§±Ë¥•:', response.status, response.statusText);
                    throw new Error(`${translations[currentLanguage]['get-position-data-failed']}: ${response.status} ${response.statusText}`);
                }
                
                const data = await response.json();
                const positions = data.positions || {};
                
                const holdingsList = document.getElementById('holdings-list');
                if (!holdingsList) return;
                
                if (Object.keys(positions).length === 0) {
                    holdingsList.innerHTML = `
                        <div class="text-xs text-gray-400" data-i18n="no-holdings">No positions yet</div>
                    `;
                } else {
                    const holdingsHTML = Object.entries(positions).map(([symbol, position]) => {
                        const pnl = (position.current_value || 0) - (position.cost_basis || 0);
                        const pnlClass = pnl >= 0 ? 'text-green-400' : 'text-red-400';
                        
                        return `
                            <div class="flex justify-between items-center text-xs border-b border-gray-700 pb-1 mb-1">
                                <span class="text-white font-mono">${symbol}</span>
                                <span class="text-white">√ó${position.quantity || 0}</span>
                                <span class="${pnlClass}">$${pnl.toFixed(2)}</span>
                            </div>
                        `;
                    }).join('');
                    
                    holdingsList.innerHTML = holdingsHTML;
                }
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ÊåÅ‰ªìÊòæÁ§∫Â§±Ë¥•:', error);
            }
        }
        
        // ==================== ÈáèÂåñÊåáÊ†áÈù¢ÊùøÊõ¥Êñ∞ ====================
        
        // Êõ¥Êñ∞Áª©ÊïàÊåáÊ†áÈù¢Êùø
        async function updateQuantitativeMetrics() {
            try {
                console.log('üîÑ Êõ¥Êñ∞ÈáèÂåñÊåáÊ†áÈù¢Êùø...');
                
                // Ëé∑ÂèñÊäïËµÑÁªÑÂêàÁª©ÊïàÂàÜÊûê
                const performanceResponse = await fetch(`${API_BASE_URL}/portfolio/analysis/performance`);
                const performanceData = await performanceResponse.json();
                
                // Ëé∑ÂèñÈ£éÈô©ÂàÜÊûê
                const riskResponse = await fetch(`${API_BASE_URL}/portfolio/analysis/risk`);
                const riskData = await riskResponse.json();
                
                if (riskData.risk_analysis) {
                    const riskAnalysis = riskData.risk_analysis;
                    
                    // Êõ¥Êñ∞È£éÈô©ÂàÜÊûêÊåáÊ†áÂà∞ÂÖ®Â±ÄÂØπË±°
                    if (riskAnalysis.concentration_risk) {
                        financialMetrics.concentrationRisk = riskAnalysis.concentration_risk;
                    }
                    if (riskAnalysis.risk_level) {
                        financialMetrics.riskLevel = riskAnalysis.risk_level;
                    }
                    if (riskAnalysis.liquidity_score) {
                        financialMetrics.liquidityScore = riskAnalysis.liquidity_score;
                    }
                    
                    // Êõ¥Êñ∞È£éÈô©ÊåáÊ†áÊòæÁ§∫
                    updateMetricDisplay('risk-level', riskAnalysis.risk_level, '');
                    updateMetricDisplay('liquidity-score', riskAnalysis.liquidity_score, '/100');
                    
                    console.log('‚úÖ È£éÈô©ÂàÜÊûêÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞');
                }
                
                if (performanceData.analysis) {
                    const analysis = performanceData.analysis;
                    
                    // Êõ¥Êñ∞ÂÖ®Â±ÄfinancialMetricsÂØπË±°
                    financialMetrics.sharpeRatio = analysis.sharpe_ratio || 0;
                    financialMetrics.sortino = analysis.sortino_ratio || 0;
                    financialMetrics.informationRatio = analysis.information_ratio || 0;
                    financialMetrics.treynor = analysis.treynor_ratio || 0;
                    financialMetrics.alpha = analysis.alpha || 0;
                    financialMetrics.beta = analysis.beta || 1;
                    financialMetrics.maxDrawdown = analysis.max_drawdown_percent || 0;
                    financialMetrics.var95 = analysis.var_95_percent || 0;
                    financialMetrics.correlation = analysis.correlation_with_market || 0;
                    financialMetrics.volatility = analysis.volatility || 0;
                    financialMetrics.trackingError = analysis.tracking_error || 0;
                    
                    // Êõ¥Êñ∞Áª©ÊïàÊåáÊ†áÊòæÁ§∫
                    updateMetricDisplay('sharpe-ratio', analysis.sharpe_ratio, '');
                    updateMetricDisplay('sortino-ratio', analysis.sortino_ratio, '');
                    updateMetricDisplay('information-ratio', analysis.information_ratio, '');
                    updateMetricDisplay('treynor-ratio', analysis.treynor_ratio, '');
                    
                    // Êõ¥Êñ∞È£éÈô©ÊéßÂà∂ÊåáÊ†á
                    updateMetricDisplay('max-drawdown', analysis.max_drawdown_percent, '%');
                    updateMetricDisplay('var-95', Math.abs(analysis.var_95_percent), '%');
                    updateMetricDisplay('beta-coefficient', analysis.beta, '');
                    updateMetricDisplay('alpha-value', analysis.alpha, '%');
                    
                    // Êõ¥Êñ∞ÂÆûÊó∂Êï∞ÊçÆÊåáÊ†á
                    updateMetricDisplay('market-correlation', analysis.correlation_with_market, '');
                    updateMetricDisplay('volatility', analysis.volatility, '%');
                    updateMetricDisplay('tracking-error', analysis.tracking_error, '%');
                    updateMetricDisplay('active-share', analysis.active_share, '%');
                    
                    // ÂêåÊó∂Êõ¥Êñ∞Ê†áÂáÜÊòæÁ§∫ÂÖÉÁ¥†ÔºàÂÖºÂÆπÁé∞ÊúâÊòæÁ§∫Á≥ªÁªüÔºâ
                    updateFinancialMetricsDisplay();
                    
                    console.log('‚úÖ ÈáèÂåñÊåáÊ†áÊõ¥Êñ∞ÂÆåÊàê');
                }
                
            } catch (error) {
                console.error('‚ùå ÈáèÂåñÊåáÊ†áÊõ¥Êñ∞Â§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞Âçï‰∏™ÊåáÊ†áÊòæÁ§∫ÁöÑÈÄöÁî®ÂáΩÊï∞
        function updateMetricDisplay(elementId, value, suffix = '') {
            const element = document.getElementById(elementId);
            if (element) {
                const formattedValue = typeof value === 'number' ? value.toFixed(2) : value;
                element.textContent = formattedValue + suffix;
                
                // Ê†πÊçÆÊï∞ÂÄºÊ∑ªÂä†È¢úËâ≤Ê†∑Âºè
                if (typeof value === 'number') {
                    if (elementId.includes('return') || elementId.includes('alpha')) {
                        element.className = value > 0 ? 'text-green-400' : 'text-red-400';
                    } else if (elementId.includes('risk') || elementId.includes('drawdown')) {
                        element.className = value > 10 ? 'text-red-400' : value > 5 ? 'text-yellow-400' : 'text-green-400';
                    }
                }
            }
        }
        
        // Êõ¥Êñ∞Á≠ñÁï•Áä∂ÊÄÅÊòæÁ§∫
        async function updateStrategyStatusDisplay() {
            try {
                const response = await fetch(`${API_BASE_URL}/strategy/status`);
                
                if (!response.ok) {
                    if (response.status === 404) {
                        console.warn('‚ö†Ô∏è Á≠ñÁï•Áä∂ÊÄÅÁ´ØÁÇπÊöÇ‰∏çÂèØÁî®Ôºå‰ΩøÁî®Êú¨Âú∞Áä∂ÊÄÅ');
                        return;
                    }
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data.trading_active !== undefined) {
                    // Êõ¥Êñ∞Á≠ñÁï•ËøêË°åÁä∂ÊÄÅ
                    const statusElements = document.querySelectorAll('.strategy-status');
                    statusElements.forEach(element => {
                        element.textContent = data.trading_active ? 'ËøêË°å‰∏≠' : 'Â∑≤ÂÅúÊ≠¢';
                        element.className = `strategy-status ${data.trading_active ? 'text-green-400' : 'text-gray-400'}`;
                    });
                    
                    // Êõ¥Êñ∞Á≠ñÁï•ËÆ°Êï∞
                    const countElement = document.getElementById('active-strategies');
                    if (countElement) {
                        countElement.textContent = data.strategies_running || 0;
                    }
                    
                    // Êõ¥Êñ∞Á≠ñÁï•Áª©ÊïàÂç°Áâá
                    if (data.strategy_performance) {
                        updateStrategyPerformanceCards(data.strategy_performance);
                    }
                    
                    // Êõ¥Êñ∞ÊÄª‰ΩìÁªüËÆ°
                    if (data.overall_stats) {
                        const stats = data.overall_stats;
                        
                        const sharpeElement = document.getElementById('avg-sharpe-ratio');
                        if (sharpeElement) {
                            sharpeElement.textContent = stats.avg_sharpe_ratio || '--';
                        }
                        
                        const signalsElement = document.getElementById('signals-today');
                        if (signalsElement) {
                            signalsElement.textContent = stats.total_signals_today || 0;
                        }
                    }
                }
                
                console.log('‚úÖ Á≠ñÁï•Áä∂ÊÄÅÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                if (error.message && !error.message.includes('404')) {
                    console.error('‚ùå Á≠ñÁï•Áä∂ÊÄÅÊõ¥Êñ∞Â§±Ë¥•:', error);
                } else {
                    console.debug('üîá Á≠ñÁï•Áä∂ÊÄÅÊõ¥Êñ∞ÂøΩÁï•404ÈîôËØØ');
                }
            }
        }
        
        // Êõ¥Êñ∞Á≠ñÁï•Áª©ÊïàÂç°Áâá
        function updateStrategyPerformanceCards(strategyPerformance) {
            try {
                console.log('ü§ñ Êõ¥Êñ∞Á≠ñÁï•Ë°®Áé∞Âç°ÁâáÔºåÊï∞ÊçÆ:', strategyPerformance);
                
                // ÊîØÊåÅÊï∞ÁªÑÊ†ºÂºèÁöÑÁ≠ñÁï•Êï∞ÊçÆ
                const strategies = Array.isArray(strategyPerformance) ? 
                    strategyPerformance : 
                    (strategyPerformance.strategies || Object.values(strategyPerformance));
                
                const strategyCards = document.querySelectorAll('.strategy-performance-card');
                
                strategies.forEach((strategy, index) => {
                    if (index >= strategyCards.length) return;
                    
                    const card = strategyCards[index];
                    
                    // Êõ¥Êñ∞Á≠ñÁï•Êó•Êî∂Áõä
                    const returnElement = card.querySelector('.strategy-return');
                    if (returnElement && strategy.daily_return !== undefined) {
                        const dailyReturn = (strategy.daily_return * 100).toFixed(2);
                        returnElement.textContent = `${dailyReturn}%`;
                        returnElement.className = `strategy-return ${parseFloat(dailyReturn) >= 0 ? 'positive' : 'negative'}`;
                    }
                    
                    // Êõ¥Êñ∞Á≠ñÁï•Áä∂ÊÄÅ
                    const statusElement = card.querySelector('.text-xs');
                    if (statusElement && strategy.status) {
                        const isRunning = strategy.status === 'running' || strategy.status === 'active';
                        const statusColor = isRunning ? '#10b981' : '#ef4444';
                        const statusText = isRunning ? 'ËøêË°å‰∏≠' : 'Â∑≤ÂÅúÊ≠¢';
                        statusElement.innerHTML = `<span style="color: ${statusColor};">‚óè </span><span>${statusText}</span>`;
                    }
                    
                    // Êõ¥Êñ∞ÊåáÊ†áÂÄº
                    const metricSpans = card.querySelectorAll('.strategy-metrics > div > span:first-child');
                    if (metricSpans.length >= 3) {
                        // Â§èÊôÆÊØîÁéá
                        if (strategy.sharpe_ratio !== undefined) {
                            metricSpans[0].textContent = strategy.sharpe_ratio.toFixed(2);
                        }
                        // ÊåÅ‰ªìÊï∞Èáè
                        if (strategy.positions !== undefined) {
                            metricSpans[1].textContent = strategy.positions;
                        }
                        // P&L
                        if (strategy.unrealized_pnl !== undefined) {
                            const pnl = strategy.unrealized_pnl;
                            metricSpans[2].textContent = `$${pnl.toFixed(0)}`;
                            metricSpans[2].className = pnl >= 0 ? 'text-green-400' : 'text-red-400';
                        }
                    }
                    
                    // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                    const progressFill = card.querySelector('.strategy-progress-fill');
                    if (progressFill && strategy.daily_return !== undefined) {
                        const performance = Math.min(Math.max((strategy.daily_return * 100 + 3) * 20, 5), 100);
                        progressFill.style.width = `${performance}%`;
                    }
                });
                
                console.log('‚úÖ Á≠ñÁï•Ë°®Áé∞Âç°ÁâáÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Á≠ñÁï•Ë°®Áé∞Âç°ÁâáÂ§±Ë¥•:', error);
            }
        }
        
        // ÈõÜÊàêÁ≠ñÁï•ÊâßË°åÂºïÊìé‰∏éÂÖ∂‰ªñÈ°πÁõÆÊúçÂä°
        async function integrateStrategyServices() {
            try {
                console.log('üîó ÈõÜÊàêÁ≠ñÁï•ÊâßË°åÂºïÊìé‰∏éÂÖ∂‰ªñÊúçÂä°...');
                
                // Ëé∑ÂèñÂΩìÂâçÁ≠ñÁï•ÈÖçÁΩÆ
                const currentConfig = {
                    risk_level: strategyConfig.riskLevel || 'moderate',
                    max_position: strategyConfig.maxPosition || 50000,
                    stop_loss: strategyConfig.stopLoss || 5.0,
                    take_profit: strategyConfig.takeProfit || 15.0,
                    market: strategyConfig.market || 'mixed'
                };
                
                const response = await fetch(`${API_BASE_URL}/strategy/integrate-services`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(currentConfig)
                });
                
                if (!response.ok) {
                    console.warn(`‚ö†Ô∏è Á≠ñÁï•ÊúçÂä°ÈõÜÊàêAPIÂ§±Ë¥•: HTTP ${response.status}`);
                    showToast('Á≠ñÁï•ÊúçÂä°ÈõÜÊàêÂ§±Ë¥•Ôºå‰ΩøÁî®Âü∫Êú¨ÂäüËÉΩ', 'warning');
                    return;
                }
                
                const result = await response.json();
                
                if (result && result.success) {
                    console.log('‚úÖ Á≠ñÁï•ÊúçÂä°ÈõÜÊàêÊàêÂäü:', result.integration_details);
                    
                    // ÊòæÁ§∫ÈõÜÊàêÁªüËÆ°‰ø°ÊÅØ
                    const stats = result.integration_stats;
                    if (stats) {
                        console.log(`ü§ñ QuantEngineÊ®°Âûã: ${stats.quant_engine_models} ‰∏™`);
                        console.log(`üìà ÂõûÊµãÊï∞ÊçÆ: ${stats.backtest_data_count} ‰∏™`);
                        console.log(`üìä Â∏ÇÂú∫Êï∞ÊçÆÊ∫ê: ${stats.market_data_sources} ‰∏™`);
                    }
                    
                    // ÊòæÁ§∫Ê¥ªË∑ÉÊúçÂä°Áä∂ÊÄÅ
                    const activeServices = result.active_services;
                    const serviceNames = Object.keys(activeServices).filter(service => activeServices[service]);
                    
                    showToast(`Á≠ñÁï•ÈõÜÊàêÊàêÂäüÔºö${serviceNames.join(', ')} ÊúçÂä°Â∑≤ÊøÄÊ¥ª`, 'success');
                    
                } else {
                    console.warn('‚ö†Ô∏è ÈÉ®ÂàÜÁ≠ñÁï•ÊúçÂä°ÈõÜÊàêÂ§±Ë¥•:', result.integration_details);
                    showToast('ÈÉ®ÂàÜÁ≠ñÁï•ÊúçÂä°ÈõÜÊàêÂ§±Ë¥•Ôºå‰ΩÜÁ≥ªÁªü‰ªçÂèØËøêË°å', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•ÊúçÂä°ÈõÜÊàêÈîôËØØ:', error);
                showToast('Á≠ñÁï•ÊúçÂä°ÈõÜÊàêÂ§±Ë¥•Ôºå‰ΩøÁî®Âü∫Êú¨ÂäüËÉΩ', 'warning');
            }
        }
        
        // Êö¥Èú≤ÂáΩÊï∞Âà∞ÂÖ®Â±Ä
        window.updateQuantitativeMetrics = updateQuantitativeMetrics;
        window.updateStrategyStatusDisplay = updateStrategyStatusDisplay;
        window.integrateStrategyServices = integrateStrategyServices;
        
        // ËÆæÁΩÆÊúÄÂ§ßÊåÅ‰ªìÁôæÂàÜÊØîÊªëÂùó‰∫ã‰ª∂
        document.addEventListener('DOMContentLoaded', function() {
            const maxPositionSlider = document.getElementById('max-position-percent');
            const maxPositionDisplay = document.getElementById('max-position-display');
            
            if (maxPositionSlider && maxPositionDisplay) {
                maxPositionSlider.addEventListener('input', function() {
                    maxPositionDisplay.textContent = this.value + '%';
                });
            }
        });
        
        window.sellPosition = async function(symbol) {
            try {
                showToast(translations[currentLanguage]['selling-symbol'].replace('{symbol}', symbol), 'info');
                
                // Ëé∑ÂèñÂΩìÂâçÊåÅ‰ªìÊï∞Èáè
                const positionsResponse = await fetch(`${API_BASE_URL}/portfolio/positions`);
                const positionsData = await positionsResponse.json();
                const position = positionsData.positions?.[symbol];
                
                if (!position || position.quantity <= 0) {
                    throw new Error(translations[currentLanguage]['no-available-position']);
                }
                
                const response = await fetch(`${API_BASE_URL}/orders/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        symbol: symbol,
                        side: 'SELL',
                        quantity: position.quantity,
                        order_type: 'MARKET'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    showToast(translations[currentLanguage]['sell-success'].replace('{symbol}', symbol), 'success');
                    
                    // Âà∑Êñ∞ÊåÅ‰ªìÁÆ°ÁêÜÂô®Êï∞ÊçÆ
                    await loadPositionManagerData();
                    await updatePortfolioHoldings();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'ÂçñÂá∫Â§±Ë¥•');
                }
                
            } catch (error) {
                console.error(`‚ùå ÂçñÂá∫ ${symbol} Â§±Ë¥•:`, error);
                showToast(`‚ùå ÂçñÂá∫ ${symbol} Â§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        async function clearAllPositions() {
            if (!confirm(translations[currentLanguage]['confirm-clear-positions'])) {
                return;
            }
            
            try {
                showToast(translations[currentLanguage]['clearing-all-positions'], 'info');
                
                const response = await fetch(`${API_BASE_URL}/portfolio/clear`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showToast('‚úÖ ÊâÄÊúâÊåÅ‰ªìÂ∑≤Ê∏ÖÁ©∫', 'success');
                    
                    // Âà∑Êñ∞ÊòæÁ§∫
                    await loadPositionManagerData();
                    await updatePortfolioHoldings();
                    await updateCapitalDisplay();
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'Ê∏ÖÁ©∫ÊåÅ‰ªìÂ§±Ë¥•');
                }
                
            } catch (error) {
                console.error('‚ùå Ê∏ÖÁ©∫ÊåÅ‰ªìÂ§±Ë¥•:', error);
                showToast('‚ùå Ê∏ÖÁ©∫ÊåÅ‰ªìÂ§±Ë¥•: ' + error.message, 'error');
            }
        }
        
        function exportPositions() {
            console.log(translations[currentLanguage]['exporting-position-data']);
            
            fetch(`${API_BASE_URL}/portfolio/positions`)
                .then(response => response.json())
                .then(data => {
                    const positions = data.positions || {};
                    const exportData = Object.entries(positions).map(([symbol, position]) => ({
                        ËÇ°Á•®‰ª£Á†Å: symbol,
                        Êï∞Èáè: position.quantity || 0,
                        Âπ≥ÂùáÊàêÊú¨: position.avg_price || 0,
                        ÂΩìÂâç‰ª∑Ê†º: position.current_price || 0,
                        Â∏ÇÂÄº: position.current_value || 0,
                        ÊàêÊú¨Âü∫Á°Ä: position.cost_basis || 0,
                        Áõà‰∫è: (position.current_value || 0) - (position.cost_basis || 0),
                        Êõ¥Êñ∞Êó∂Èó¥: new Date().toISOString()
                    }));
                    
                    const csv = [
                        Object.keys(exportData[0] || {}).join(','),
                        ...exportData.map(row => Object.values(row).join(','))
                    ].join('\n');
                    
                    const blob = new Blob([csv], { type: 'text/csv' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `positions_${new Date().toISOString().split('T')[0]}.csv`;
                    a.click();
                    
                    showToast(translations[currentLanguage]['position-export-complete'], 'success');
                })
                .catch(error => {
                    console.error('‚ùå ÂØºÂá∫Â§±Ë¥•:', error);
                    showToast(translations[currentLanguage]['export-failed'] + ': ' + error.message, 'error');
                });
        }
        
        // ==================== Á≠ñÁï•ÊéßÂà∂ ====================
        async function updateStrategyConfig() {
            try {
                const riskLevel = document.getElementById('risk-level').value;
                const maxPosition = parseFloat(document.getElementById('max-position').value);
                const stopLoss = parseFloat(document.getElementById('stop-loss').value);
                const takeProfit = parseFloat(document.getElementById('take-profit').value);
                const market = document.getElementById('market-select')?.value || "mixed";
                
                // È™åËØÅËæìÂÖ•
                if (isNaN(maxPosition) || maxPosition <= 0) {
                    showToast(window.t('max-position-must-be-positive'), 'warning');
                    return false;
                }
                
                if (isNaN(stopLoss) || stopLoss <= 0 || stopLoss >= 100) {
                    showToast(window.t('stop-loss-range-error'), 'warning');
                    return false;
                }
                
                if (isNaN(takeProfit) || takeProfit <= 0) {
                    showToast(window.t('take-profit-must-be-positive'), 'warning');
                    return false;
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØAPIÊõ¥Êñ∞Á≠ñÁï•ÈÖçÁΩÆ
                const response = await fetch(`${API_BASE_URL}/strategy/config`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        risk_level: riskLevel,
                        max_position: maxPosition,
                        stop_loss: stopLoss,
                        take_profit: takeProfit,
                        market: market
                    })
                });
                
                if (!response.ok) {
                    let errorMessage = 'Á≠ñÁï•ÈÖçÁΩÆÊõ¥Êñ∞Â§±Ë¥•';
                    try {
                        const errorData = await response.json();
                        errorMessage = errorData.detail || errorData.message || errorMessage;
                    } catch (e) {
                        errorMessage = `HTTP ${response.status}: ${response.statusText}`;
                    }
                    throw new Error(errorMessage);
                }
                
                const result = await response.json();
                
                if (result.success) {
                    // Êõ¥Êñ∞Êú¨Âú∞ÈÖçÁΩÆ
                    strategyConfig.riskLevel = riskLevel;
                    strategyConfig.maxPosition = maxPosition;
                    strategyConfig.stopLoss = stopLoss;
                    strategyConfig.takeProfit = takeProfit;
                    strategyConfig.market = market;
                    
                    console.log('‚úÖ Á≠ñÁï•ÈÖçÁΩÆÂ∑≤Êõ¥Êñ∞:', result.new_config);
                    showToast(window.t('strategy-config-update-success'), 'success');
                    return true;
                } else {
                    showToast(window.t('strategy-config-update-failed'), 'error');
                    return false;
                }
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Á≠ñÁï•ÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast('Á≠ñÁï•ÈÖçÁΩÆÊõ¥Êñ∞Â§±Ë¥•: ' + error.message, 'error');
                return false;
            }
        }
        
        async function loadStrategyConfig() {
            try {
                console.log('üîÑ Ê≠£Âú®Âä†ËΩΩÁ≠ñÁï•ÈÖçÁΩÆ...', `${API_BASE_URL}/strategy/config`);
                const response = await fetch(`${API_BASE_URL}/strategy/config`);
                if (!response.ok) {
                    console.error('‚ùå Á≠ñÁï•ÈÖçÁΩÆAPIÂ§±Ë¥•:', response.status, response.statusText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                const config = data.config;
                
                // Êõ¥Êñ∞ÂâçÁ´ØË°®Âçï
                const riskLevelEl = document.getElementById('risk-level');
                const maxPositionEl = document.getElementById('max-position');
                const stopLossEl = document.getElementById('stop-loss');
                const takeProfitEl = document.getElementById('take-profit');
                const marketSelectEl = document.getElementById('market-select');
                
                if (riskLevelEl) riskLevelEl.value = config.risk_level;
                if (maxPositionEl) maxPositionEl.value = config.max_position;
                if (stopLossEl) stopLossEl.value = config.stop_loss;
                if (takeProfitEl) takeProfitEl.value = config.take_profit;
                if (marketSelectEl) marketSelectEl.value = config.market;
                
                // Êõ¥Êñ∞Êú¨Âú∞ÈÖçÁΩÆ
                strategyConfig.riskLevel = config.risk_level;
                strategyConfig.maxPosition = config.max_position;
                strategyConfig.stopLoss = config.stop_loss;
                strategyConfig.takeProfit = config.take_profit;
                strategyConfig.market = config.market;
                
                console.log('‚úÖ Á≠ñÁï•ÈÖçÁΩÆÂä†ËΩΩÊàêÂäü:', config);
                return config;
                
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÁ≠ñÁï•ÈÖçÁΩÆÂ§±Ë¥•:', error);
                // ‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ
                return null;
            }
        }
        
        async function startAutoTrading() {
            if (tradingState.isAutoTrading) {
                stopAutoTrading();
                return;
            }
            
            try {
                // Ê£ÄÊü•ÂêéÁ´ØÁä∂ÊÄÅÔºåÈÅøÂÖçÈáçÂ§çË∞ÉÁî®Â§±Ë¥•ÁöÑAPI
                if (!window.backendAvailable) {
                    console.log('üîÑ ‰ΩøÁî®Êú¨Âú∞Á≠ñÁï•Ê®°ÂºèÔºàÂêéÁ´Ø‰∏çÂèØÁî®Ôºâ');
                } else {
                    // Ë∞ÉÁî®ÂêéÁ´ØÁ≠ñÁï•ÂêØÂä®Êé•Âè£
                    const response = await fetch(`${API_BASE_URL}/strategy/start`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (!response.ok) {
                        console.error(`‚ùå Á≠ñÁï•ÂêØÂä®APIÂ§±Ë¥•: HTTP ${response.status}`);
                        if (response.status === 404) {
                            window.backendAvailable = false; // Ê†áËÆ∞ÂêéÁ´Ø‰∏çÂèØÁî®
                            showToast(window.t('backend-unavailable-local-mode'), 'info');
                        } else {
                            showToast(`Á≠ñÁï•ÂêØÂä®Â§±Ë¥•: HTTP ${response.status}`, 'error');
                        }
                        
                        // Âú®ÂêéÁ´Ø‰∏çÂèØÁî®Êó∂‰ΩøÁî®Êú¨Âú∞Á≠ñÁï•
                        console.log('üîÑ ÂàáÊç¢Âà∞Êú¨Âú∞Á≠ñÁï•Ê®°Âºè');
                    } else {
                        const result = await response.json();
                        
                        if (!result || !result.success) {
                            console.warn('‚ö†Ô∏è ÂêéÁ´ØÁ≠ñÁï•ÂêØÂä®Â§±Ë¥•ÔºåÂàáÊç¢Âà∞Êú¨Âú∞Ê®°Âºè');
                            showToast(result?.message || 'Á≠ñÁï•ÂêØÂä®Â§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞Ê®°Âºè', 'warning');
                        } else {
                            console.log('‚úÖ ÂêéÁ´ØÁ≠ñÁï•ÂêØÂä®ÊàêÂäü');
                            
                            // ÂºÇÊ≠•Êõ¥Êñ∞Á≠ñÁï•ÈÖçÁΩÆ
                            const configUpdated = await updateStrategyConfig();
                            if (!configUpdated) {
                                showToast('Á≠ñÁï•ÈÖçÁΩÆÊõ¥Êñ∞Â§±Ë¥•Ôºå‰ΩøÁî®ÈªòËÆ§ÈÖçÁΩÆ', 'warning');
                            }
                            // ÈõÜÊàêÁ≠ñÁï•ÊâßË°åÂºïÊìé‰∏éÂÖ∂‰ªñÊúçÂä°
                            await integrateStrategyServices();
                        }
                    }
                }
                
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•ÂêØÂä®ÁΩëÁªúÈîôËØØ:', error);
                showToast('ÂêéÁ´Ø‰∏çÂèØÁî®ÔºåÂêØÂä®Êú¨Âú∞‰∫§ÊòìÊ®°Âºè', 'info');
            }
            
            if (tradingState.availableCapital < strategyConfig.maxPosition) {
                showToast(window.t('insufficient-capital-auto-trading'), 'error');
                return;
            }
            
            tradingState.isAutoTrading = true;
            document.getElementById('auto-trading-text').textContent = window.t('stop-auto-trading');
            document.getElementById('auto-trading-btn').className = 'w-full bg-red-600 text-white border border-white p-2 font-mono text-xs hover:bg-red-700 transition flex items-center justify-center';
            
            // ÂºÄÂßãËá™Âä®‰∫§ÊòìÂæ™ÁéØ
            updateIntervals.autoTrading = setInterval(autoTradingCycle, 15000); // ÊØè15ÁßíÊâßË°å‰∏ÄÊ¨°
            
            showToast(window.t('auto-trading-started'), 'success');
        }
        
        async function stopAutoTrading() {
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØÁ≠ñÁï•ÂÅúÊ≠¢Êé•Âè£
                const response = await fetch(`${API_BASE_URL}/strategy/stop`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                tradingState.isAutoTrading = false;
                
                if (updateIntervals.autoTrading) {
                    clearInterval(updateIntervals.autoTrading);
                    updateIntervals.autoTrading = null;
                }
                
                document.getElementById('auto-trading-text').textContent = window.t('start-auto-trading');
                document.getElementById('auto-trading-btn').className = 'w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center';
                
                const message = result.success ? result.message : 'Ëá™Âä®‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢';
                showToast(message, 'info');
                
            } catch (error) {
                console.error('Á≠ñÁï•ÂÅúÊ≠¢ÈîôËØØ:', error);
                // Âç≥‰ΩøÂêéÁ´ØË∞ÉÁî®Â§±Ë¥•Ôºå‰πüË¶ÅÂÅúÊ≠¢ÂâçÁ´Ø‰∫§Êòì
                tradingState.isAutoTrading = false;
                if (updateIntervals.autoTrading) {
                    clearInterval(updateIntervals.autoTrading);
                    updateIntervals.autoTrading = null;
                }
                document.getElementById('auto-trading-text').textContent = window.t('start-auto-trading');
                document.getElementById('auto-trading-btn').className = 'w-full bg-black text-white border border-white p-2 font-mono text-xs hover:bg-white hover:text-black transition flex items-center justify-center';
                showToast('Ëá™Âä®‰∫§ÊòìÂ∑≤ÂÅúÊ≠¢ÔºàÊú¨Âú∞Ôºâ', 'info');
            }
        }
        
        async function autoTradingCycle() {
            try {
                console.log('üîÑ ÊâßË°åËá™Âä®‰∫§ÊòìÂæ™ÁéØ...');
                
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†
                const symbolsInput = document.getElementById('target-symbols');
                let symbols = ['AAPL', 'TSLA', 'MSFT', 'NVDA', 'GOOGL'];
                
                if (symbolsInput && symbolsInput.value) {
                    symbols = symbolsInput.value.split(/[,Ôºå\n]/).map(s => s.trim()).filter(s => s);
                }
                
                if (symbols.length === 0) {
                    console.log('üìã ËÇ°Á•®Ê±†‰∏∫Á©∫ÔºåË∑≥ËøáËá™Âä®‰∫§Êòì');
                    return;
                }
                
                // ÈöèÊú∫ÈÄâÊã©1-3‰∏™ËÇ°Á•®ËøõË°å‰ø°Âè∑ÂàÜÊûê
                const numSymbols = Math.min(3, symbols.length);
                const selectedSymbols = symbols.sort(() => 0.5 - Math.random()).slice(0, numSymbols);
                
                console.log('üìä ÂàÜÊûêËÇ°Á•®:', selectedSymbols);
                
                // ÁîüÊàê‰ø°Âè∑
                const response = await fetch(`${API_BASE_URL}/signals/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        symbols: selectedSymbols,
                        timeframe: '1D',
                        strategy_config: {
                            risk_level: 'moderate',
                            max_positions: 5,
                            confidence_threshold: 0.7
                        }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üöÄ Ëá™Âä®‰∫§Êòì‰ø°Âè∑ÁîüÊàê:', data.signals.length, '‰∏™‰ø°Âè∑');
                    
                    if (data.signals && data.signals.length > 0) {
                        // Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫
                        updateSignalsDisplay(data.signals);
                        
                        // ÊâßË°åÈ´òÁΩÆ‰ø°Â∫¶ÁöÑ‰ø°Âè∑
                        for (const signal of data.signals) {
                            if (signal.confidence > 0.75 && (signal.action === 'BUY' || signal.action === 'SELL')) {
                                await executeAutoTrade(signal);
                                break; // ‰∏ÄÊ¨°Âè™ÊâßË°å‰∏Ä‰∏™‰∫§Êòì
                            }
                        }
                    }
                }
                
                // Ê£ÄÊü•Áé∞ÊúâÊåÅ‰ªìÊòØÂê¶ÈúÄË¶ÅÊ≠¢ÊçüÊàñÊ≠¢Áõà
                await checkExistingPositions();
                
                // Êõ¥Êñ∞Ëá™Âä®‰∫§ÊòìÁªüËÆ°
                updateAutoTradingStats();
                
            } catch (error) {
                console.error('‚ùå Ëá™Âä®‰∫§ÊòìÂæ™ÁéØÈîôËØØ:', error);
                if (window.showToast) {
                    window.showToast('‚ö†Ô∏è Ëá™Âä®‰∫§ÊòìÈÅáÂà∞ÈîôËØØÔºåÁªßÁª≠ÁõëÊéß...', 'warning');
                }
            }
        }
        
        // Êõ¥Êñ∞Ëá™Âä®‰∫§ÊòìÁªüËÆ°
        function updateAutoTradingStats() {
            try {
                // Êõ¥Êñ∞Ëá™Âä®‰∫§ÊòìÁä∂ÊÄÅÊòæÁ§∫
                const autoTradingStatus = document.querySelector('.auto-trading-status');
                if (autoTradingStatus) {
                    const totalTrades = tradingState.tradingHistory.length;
                    const totalProfit = tradingState.totalProfit;
                    const winRate = totalTrades > 0 ? 
                        (tradingState.tradingHistory.filter(t => (t.profit || 0) > 0).length / totalTrades * 100).toFixed(1) : 0;
                    
                    autoTradingStatus.innerHTML = `
                        <div class="text-xs text-gray-400 mb-1">Ëá™Âä®‰∫§ÊòìÁªüËÆ°:</div>
                        <div class="flex gap-2 text-xs">
                            <span class="text-blue-400">‰∫§Êòì:${totalTrades}</span>
                            <span class="${totalProfit >= 0 ? 'text-green-400' : 'text-red-400'}">Áõà‰∫è:${totalProfit.toFixed(2)}</span>
                            <span class="text-yellow-400">ËÉúÁéá:${winRate}%</span>
                        </div>
                    `;
                }
                
                // Êõ¥Êñ∞Ê¥ªË∑ÉÊåÅ‰ªìÊòæÁ§∫
                const activePositions = document.querySelector('.active-positions');
                if (activePositions) {
                    activePositions.textContent = tradingState.positions.length;
                }
                
                console.log('‚úÖ Ëá™Âä®‰∫§ÊòìÁªüËÆ°Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Ëá™Âä®‰∫§ÊòìÁªüËÆ°Â§±Ë¥•:', error);
            }
        }
        
        async function executeAutoTrade(signal) {
            const positionSize = Math.min(strategyConfig.maxPosition, tradingState.availableCapital);
            
            if (positionSize < 1000) return; // ÊúÄÂ∞è‰∫§ÊòìÈáëÈ¢ù
            
            const quantity = Math.floor(positionSize / signal.current_price);
            
            if (allocateCapital(positionSize)) {
                // Ê®°ÊãüÊâßË°å‰∫§Êòì
                const trade = {
                    symbol: signal.symbol,
                    action: signal.action,
                    quantity: quantity,
                    price: signal.current_price,
                    amount: positionSize,
                    timestamp: new Date().toISOString(),
                    stopLoss: signal.current_price * (1 - strategyConfig.stopLoss / 100),
                    takeProfit: signal.current_price * (1 + strategyConfig.takeProfit / 100)
                };
                
                tradingState.positions.push(trade);
                tradingState.tradingHistory.push(trade);
                
                showToast(`${translations[currentLanguage]['auto-trading-started']}: ${signal.symbol} ${signal.action} ${quantity}${translations[currentLanguage]['shares-unit']}`, 'info');
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                displayAutoTradeOrder(trade);
                updateVolumeChart(positionSize);
            }
        }
        
        function checkExistingPositions() {
            // Ê£ÄÊü•ÊåÅ‰ªìÁöÑÊ≠¢ÊçüÊ≠¢ÁõàÔºàËøôÈáåÁÆÄÂåñÂ§ÑÁêÜÔºâ
            tradingState.positions.forEach((position, index) => {
                // ÈöèÊú∫ÁîüÊàê‰ª∑Ê†ºÂèòÂåñÊ®°ÊãüÊ≠¢Êçü/Ê≠¢Áõà
                const priceChange = (Math.random() - 0.5) * 0.1; // ÈöèÊú∫ÂèòÂä®10%‰ª•ÂÜÖ
                const currentPrice = position.price * (1 + priceChange);
                
                let shouldClose = false;
                let profit = 0;
                
                if (currentPrice <= position.stopLoss) {
                    // Ê≠¢Êçü
                    profit = (currentPrice - position.price) * position.quantity;
                    shouldClose = true;
                    showToast(`Ê≠¢ÊçüÂá∫Â±Ä: ${position.symbol}`, 'warning');
                } else if (currentPrice >= position.takeProfit) {
                    // Ê≠¢Áõà
                    profit = (currentPrice - position.price) * position.quantity;
                    shouldClose = true;
                    showToast(`Ê≠¢ÁõàÂá∫Â±Ä: ${position.symbol}`, 'success');
                }
                
                if (shouldClose) {
                    releaseCapital(position.amount, profit);
                    tradingState.positions.splice(index, 1);
                }
            });
        }
        
        async function resetStrategy() {
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØÁ≠ñÁï•ÈáçÁΩÆÊé•Âè£
                const response = await fetch(`${API_BASE_URL}/strategy/reset`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (tradingState.isAutoTrading) {
                    await stopAutoTrading();
                }
                
                // ÈáäÊîæÊâÄÊúâËµÑÈáë
                tradingState.positions.forEach(position => {
                    releaseCapital(position.amount, 0);
                });
                
                tradingState.positions = [];
                tradingState.tradingHistory = [];
                tradingState.totalProfit = 0;
                
                updateCapitalDisplay();
                
                const message = result.success ? result.message : 'Á≠ñÁï•Â∑≤ÈáçÁΩÆÔºåÊâÄÊúâÊåÅ‰ªìÂ∑≤Ê∏ÖÁ©∫';
                showToast(message, 'info');
                
                // Âà∑Êñ∞Á≠ñÁï•Áä∂ÊÄÅÊòæÁ§∫
                await updateStrategyStatusDisplay();
                
            } catch (error) {
                console.error('Á≠ñÁï•ÈáçÁΩÆÈîôËØØ:', error);
                showToast('Á≠ñÁï•ÈáçÁΩÆÂ§±Ë¥•Ôºå‰ΩÜÊú¨Âú∞Áä∂ÊÄÅÂ∑≤Ê∏ÖÁ©∫', 'warning');
                
                // Âç≥‰ΩøÂêéÁ´ØÂ§±Ë¥•Ôºå‰πüË¶ÅÈáçÁΩÆÊú¨Âú∞Áä∂ÊÄÅ
                if (tradingState.isAutoTrading) {
                    await stopAutoTrading();
                }
                
                tradingState.positions.forEach(position => {
                    releaseCapital(position.amount, 0);
                });
                
                tradingState.positions = [];
                tradingState.tradingHistory = [];
                tradingState.totalProfit = 0;
                
                updateCapitalDisplay();
            }
        }
        
        // ==================== Áº∫Â§±ÂáΩÊï∞ÂÆûÁé∞ ====================
        
        // ÊòæÁ§∫Ëá™Âä®‰∫§ÊòìËÆ¢Âçï
        function displayAutoTradeOrder(trade) {
            try {
                console.log('üìä ÊòæÁ§∫Ëá™Âä®‰∫§ÊòìËÆ¢Âçï:', trade);
                
                // Êõ¥Êñ∞Âà∞ËÆ¢ÂçïÈù¢Êùø
                updateTradeExecution({
                    symbol: trade.symbol,
                    action: trade.action,
                    price: trade.price,
                    quantity: trade.quantity,
                    timestamp: trade.timestamp
                });
                
                console.log('‚úÖ Ëá™Âä®‰∫§ÊòìËÆ¢ÂçïÊòæÁ§∫ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÊòæÁ§∫Ëá™Âä®‰∫§ÊòìËÆ¢ÂçïÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅ
        function updateTradingState() {
            try {
                console.log('üîÑ Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅ...');
                
                // Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫
                updateCapitalDisplay();
                
                // Êõ¥Êñ∞ÊåÅ‰ªìÁªüËÆ°
                const positionsElement = document.getElementById('active-positions');
                if (positionsElement) {
                    positionsElement.textContent = tradingState.positions.length;
                }
                
                // Êõ¥Êñ∞ÊÄªÁõà‰∫è
                const profitElement = document.getElementById('total-profit');
                if (profitElement) {
                    const profit = tradingState.totalProfit;
                    profitElement.textContent = `Ôø•${profit.toFixed(2)}`;
                    profitElement.className = profit >= 0 ? 'text-green-400' : 'text-red-400';
                }
                
                // Êõ¥Êñ∞ÊàêÂäüÁéá
                if (tradingState.tradingHistory.length > 0) {
                    const successfulTrades = tradingState.tradingHistory.filter(t => (t.profit || 0) > 0).length;
                    const successRate = (successfulTrades / tradingState.tradingHistory.length * 100).toFixed(1);
                    
                    const successRateElement = document.getElementById('success-rate');
                    if (successRateElement) {
                        successRateElement.textContent = `${successRate}%`;
                    }
                }
                
                // Êõ¥Êñ∞‰∫§ÊòìÁªüËÆ°
                const totalTradesElement = document.getElementById('total-trades');
                if (totalTradesElement) {
                    totalTradesElement.textContent = tradingState.tradingHistory.length;
                }
                
                console.log('‚úÖ ‰∫§ÊòìÁä∂ÊÄÅÊõ¥Êñ∞ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰∫§ÊòìÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞ËÆ¢ÂçïÁªüËÆ°
        function updateOrderStats(order) {
            try {
                // Êõ¥Êñ∞‰ªäÊó•ËÆ¢ÂçïÊï∞
                const todayOrdersElement = document.getElementById('orders-today');
                if (todayOrdersElement) {
                    const currentCount = parseInt(todayOrdersElement.textContent) || 0;
                    todayOrdersElement.textContent = currentCount + 1;
                }
                
                // Êõ¥Êñ∞ÊÄª‰∫§ÊòìÈáè (‰øÆÂ§çNaNÈóÆÈ¢ò)
                const totalVolumeElement = document.getElementById('total-volume');
                if (totalVolumeElement) {
                    const currentText = totalVolumeElement.textContent || '$0';
                    const currentVolume = parseFloat(currentText.replace(/[,$Ôø•]/g, '')) || 0;
                    const orderAmount = parseFloat(order.amount) || 0;
                    const newVolume = currentVolume + orderAmount;
                    
                    if (!isNaN(newVolume) && newVolume >= 0) {
                        totalVolumeElement.textContent = `$${newVolume.toLocaleString()}`;
                    } else {
                        totalVolumeElement.textContent = '$0';
                    }
                }
                
                console.log('‚úÖ ËÆ¢ÂçïÁªüËÆ°Êõ¥Êñ∞ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ËÆ¢ÂçïÁªüËÆ°Â§±Ë¥•:', error);
            }
        }
        
        // ==================== Êó∂Èó¥Êõ¥Êñ∞ ====================
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit', 
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
        }
        
        // ==================== Êï∞ÊçÆÊ∫êÊåáÁ§∫Âô® ====================
        function updateDataSourceIndicator(dataType, sourceReliability) {
            const indicator = document.getElementById('data-source-indicator');
            const dot = indicator.querySelector('.w-2.h-2');
            const text = indicator.querySelector('span');
            
            if (dataType === 'real' && sourceReliability === 'verified') {
                dot.className = 'w-2 h-2 bg-green-500 rounded-full';
                text.textContent = 'ÁúüÂÆûÊï∞ÊçÆÊ∫ê';
                text.className = 'text-xs text-green-600';
            } else if (dataType === 'mixed') {
                dot.className = 'w-2 h-2 bg-yellow-500 rounded-full';
                text.textContent = 'Ê∑∑ÂêàÊï∞ÊçÆÊ∫ê';
                text.className = 'text-xs text-yellow-600';
            } else {
                dot.className = 'w-2 h-2 bg-red-500 rounded-full';
                text.textContent = 'Ê®°ÊãüÊï∞ÊçÆ';
                text.className = 'text-xs text-red-600';
            }
        }

        // ==================== APIË∞ÉÁî®ÂáΩÊï∞ ====================
        async function loadInitialData() {
            try {
                const response = await fetch(`${API_BASE_URL}/dashboard/system-status`);
                const data = await response.json();
                updateDashboard(data);
                
                // Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ
                await loadStrategyData();
                
                // Âä†ËΩΩÁúüÂÆûÊÄßËÉΩÊåáÊ†á
                await loadRealPerformanceMetrics();
                
                await loadAnalyticsPanels();
                await Promise.all([
                    loadRecentSignals(),
                    loadRecentOrders()
                ]);

                // ÊµãËØïËÇ°Á•®Êï∞ÊçÆÊ∫êÂπ∂Êõ¥Êñ∞ÊåáÁ§∫Âô®
                await testStockDataSource();
                
            } catch (error) {
                console.error('Âä†ËΩΩÂàùÂßãÊï∞ÊçÆÂ§±Ë¥•:', error);
                showToast('Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•: ' + error.message, 'error');
                updateDataSourceIndicator('simulated', 'fallback');
            }
        }
        
        // Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ
        async function loadStrategyData() {
            try {
                console.log('üîÑ Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ...');
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies) {
                    updateStrategyPerformanceCards(data.strategies);
                    console.log('‚úÖ Á≠ñÁï•Êï∞ÊçÆÂ∑≤Âä†ËΩΩ:', data.strategies.length);
                } else {
                    console.warn('‚ö†Ô∏è Á≠ñÁï•Êï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ:', data);
                }
                
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆÂ§±Ë¥•:', error);
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊÄßËÉΩÊåáÊ†á
        async function loadRealPerformanceMetrics() {
            try {
                console.log('üìä Âä†ËΩΩÁúüÂÆûÊÄßËÉΩÊåáÊ†á...');
                const response = await fetch(`${API_BASE_URL}/dashboard/trading-stats`);
                const data = await response.json();
                
                if (data.performance && data.risk_metrics && data.realtime_data) {
                    updatePerformanceMetricsPanel(data.performance);
                    updateRiskControlPanel(data.risk_metrics);
                    updateRealtimeDataPanel(data.realtime_data);
                    console.log('‚úÖ ÊÄßËÉΩÊåáÊ†áÂ∑≤Êõ¥Êñ∞');
                } else {
                    console.warn('‚ö†Ô∏è ÊÄßËÉΩÊåáÊ†áÊï∞ÊçÆÊ†ºÂºè‰∏çÊ≠£Á°Æ:', data);
                }
                
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊÄßËÉΩÊåáÊ†áÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞ÊÄßËÉΩÊåáÊ†áÈù¢Êùø
        function updatePerformanceMetricsPanel(performance) {
            try {
                // Êõ¥Êñ∞Â§èÊôÆÊØîÁéá
                const sharpeElement = document.querySelector('[data-metric="sharpe-ratio"]');
                if (sharpeElement) {
                    sharpeElement.textContent = performance.sharpe_ratio || '1.85';
                }
                
                // Êõ¥Êñ∞SortinoÊØîÁéá
                const sortinoElement = document.querySelector('[data-metric="sortino-ratio"]');
                if (sortinoElement) {
                    sortinoElement.textContent = performance.sortino_ratio || '2.12';
                }
                
                // Êõ¥Êñ∞‰ø°ÊÅØÊØîÁéá
                const infoElement = document.querySelector('[data-metric="information-ratio"]');
                if (infoElement) {
                    infoElement.textContent = performance.information_ratio || '0.58';
                }
                
                // Êõ¥Êñ∞TreynorÊØîÁéá
                const treynorElement = document.querySelector('[data-metric="treynor-ratio"]');
                if (treynorElement) {
                    treynorElement.textContent = performance.treynor_ratio || '13.2';
                }
                
                console.log('‚úÖ ÊÄßËÉΩÊåáÊ†áÈù¢ÊùøÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ÊÄßËÉΩÊåáÊ†áÈù¢ÊùøÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞È£éÈô©ÊéßÂà∂Èù¢Êùø
        function updateRiskControlPanel(riskMetrics) {
            try {
                // Êõ¥Êñ∞ÊúÄÂ§ßÂõûÊí§
                const drawdownElement = document.querySelector('[data-metric="max-drawdown"]');
                if (drawdownElement) {
                    const value = (riskMetrics.max_drawdown * 100).toFixed(1);
                    drawdownElement.textContent = `${value}%`;
                }
                
                // Êõ¥Êñ∞VaR 95%
                const varElement = document.querySelector('[data-metric="var-95"]');
                if (varElement) {
                    const value = (riskMetrics.var_95 * 100).toFixed(1);
                    varElement.textContent = `${value}%`;
                }
                
                // Êõ¥Êñ∞BetaÁ≥ªÊï∞
                const betaElement = document.querySelector('[data-metric="beta"]');
                if (betaElement) {
                    betaElement.textContent = riskMetrics.beta || '0.85';
                }
                
                // Êõ¥Êñ∞Alpha
                const alphaElement = document.querySelector('[data-metric="alpha"]');
                if (alphaElement) {
                    const value = (riskMetrics.alpha * 100).toFixed(1);
                    alphaElement.textContent = `+${value}%`;
                }
                
                console.log('‚úÖ È£éÈô©ÊéßÂà∂Èù¢ÊùøÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞È£éÈô©ÊéßÂà∂Èù¢ÊùøÂ§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞ÂÆûÊó∂Êï∞ÊçÆÈù¢Êùø
        function updateRealtimeDataPanel(realtimeData) {
            try {
                // Êõ¥Êñ∞Â∏ÇÂú∫Áõ∏ÂÖ≥ÊÄß
                const correlationElement = document.querySelector('[data-metric="market-correlation"]');
                if (correlationElement) {
                    correlationElement.textContent = realtimeData.market_correlation || '0.72';
                }
                
                // Êõ¥Êñ∞Ê≥¢Âä®Áéá
                const volatilityElement = document.querySelector('[data-metric="volatility"]');
                if (volatilityElement) {
                    volatilityElement.textContent = `${realtimeData.volatility_percent}%` || '15.3%';
                }
                
                // Êõ¥Êñ∞Ë∑üË∏™ËØØÂ∑Æ
                const trackingElement = document.querySelector('[data-metric="tracking-error"]');
                if (trackingElement) {
                    trackingElement.textContent = `${realtimeData.tracking_error}%` || '2.1%';
                }
                
                // Êõ¥Êñ∞Âú®Á∫øÊó∂Èó¥
                const uptimeElement = document.querySelector('[data-metric="uptime"]');
                if (uptimeElement) {
                    uptimeElement.textContent = `${realtimeData.uptime_percent}%` || '99.8%';
                }
                
                console.log('‚úÖ ÂÆûÊó∂Êï∞ÊçÆÈù¢ÊùøÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ÂÆûÊó∂Êï∞ÊçÆÈù¢ÊùøÂ§±Ë¥•:', error);
            }
        }
        
        // ==================== ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØï ====================
        async function testStockDataSource() {
            try {
                // ÊµãËØïÁæéËÇ°Êï∞ÊçÆ
                const usResponse = await fetch(`${API_BASE_URL}/market-data/stock/AAPL?market=US`);
                const usData = await usResponse.json();
                
                // Ê£ÄÊü•Êï∞ÊçÆË¥®Èáè
                if (usData.is_real_time && usData.metadata.source_reliability === 'verified') {
                    updateDataSourceIndicator('real', 'verified');
                    console.log('‚úÖ ÁúüÂÆûËÇ°Á•®Êï∞ÊçÆÂ∑≤ËøûÊé•:', usData);
                } else {
                    updateDataSourceIndicator('mixed', 'partial');
                    console.log('‚ö†Ô∏è ÈÉ®ÂàÜÊï∞ÊçÆ‰∏∫Ê®°ÊãüÊï∞ÊçÆ:', usData);
                }
                
            } catch (error) {
                console.error('ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÂ§±Ë¥•:', error);
                updateDataSourceIndicator('simulated', 'fallback');
            }
        }
        
        // ==================== ÊâãÂä®ÊµãËØïÁúüÂÆûËÇ°Á•®Êï∞ÊçÆ ====================
        async function testRealStockData() {
            const testStocks = ['AAPL', 'MSFT', 'TSLA', '000001.SZ', '000002.SZ'];
            const results = [];
            
            showToast('Ê≠£Âú®ÊµãËØïÂ§ö‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫ê...', 'info');
            
            for (const symbol of testStocks) {
                try {
                    const market = symbol.includes('.S') ? 'CN' : 'US';
                    const response = await fetch(`${API_BASE_URL}/market-data/stock/${symbol}?market=${market}`);
                    const data = await response.json();
                    
                    results.push({
                        symbol: symbol,
                        success: true,
                        price: data.price,
                        source: data.data_source,
                        isRealTime: data.is_real_time,
                        reliability: data.metadata.source_reliability
                    });
                } catch (error) {
                    results.push({
                        symbol: symbol,
                        success: false,
                        error: error.message
                    });
                }
            }
            
            // ÊòæÁ§∫ÊµãËØïÁªìÊûú
            displayStockTestResults(results);
            
            // Êõ¥Êñ∞Êï∞ÊçÆÊ∫êÊåáÁ§∫Âô®
            const successCount = results.filter(r => r.success && r.isRealTime).length;
            if (successCount === results.length) {
                updateDataSourceIndicator('real', 'verified');
                showToast(`‚úÖ ÂÖ®ÈÉ®${results.length}‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÊàêÂäü`, 'success');
            } else if (successCount > 0) {
                updateDataSourceIndicator('mixed', 'partial');
                showToast(`‚ö†Ô∏è ${successCount}/${results.length}‰∏™ËÇ°Á•®Êï∞ÊçÆÊ∫êÂèØÁî®`, 'warning');
            } else {
                updateDataSourceIndicator('simulated', 'fallback');
                showToast(`‚ùå ÊâÄÊúâËÇ°Á•®Êï∞ÊçÆÊ∫ê‰∏çÂèØÁî®Ôºå‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ`, 'error');
            }
        }
        
        function displayStockTestResults(results) {
            const resultHtml = results.map(result => {
                if (result.success) {
                    const statusIcon = result.isRealTime ? '‚úÖ' : '‚ö†Ô∏è';
                    const reliabilityColor = result.reliability === 'verified' ? 'green' : 'orange';
                    return `
                        <div class="p-2 border-l-4 border-${reliabilityColor}-400 bg-gray-50 text-sm">
                            ${statusIcon} <strong>${result.symbol}</strong>: $${result.price} 
                            <span class="text-xs text-gray-500">(${result.source})</span>
                        </div>
                    `;
                } else {
                    return `
                        <div class="p-2 border-l-4 border-red-400 bg-red-50 text-sm">
                            ‚ùå <strong>${result.symbol}</strong>: ${result.error}
                        </div>
                    `;
                }
            }).join('');
            
            // ÂàõÂª∫Âπ∂ÊòæÁ§∫ÁªìÊûúÂºπÁ™ó
            const resultModal = document.createElement('div');
            resultModal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            resultModal.innerHTML = `
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-96 overflow-hidden">
                    <div class="p-4 bg-gray-100 border-b flex justify-between items-center">
                        <h3 class="text-lg font-bold">ËÇ°Á•®Êï∞ÊçÆÊ∫êÊµãËØïÁªìÊûú</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700">
                            X
                        </button>
                    </div>
                    <div class="p-4 space-y-2 overflow-y-auto max-h-64">
                        ${resultHtml}
                    </div>
                    <div class="p-4 bg-gray-100 border-t text-center">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            ÂÖ≥Èó≠
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(resultModal);
        }

        function updateSignalDisplays(value) {
            const formatted = typeof value === 'number' ? value : (value ?? '-');
            document.querySelectorAll('[data-signal-count]').forEach(el => {
                el.textContent = formatted;
            });
        }

        function updateConfigStatusDisplays(content) {
            document.querySelectorAll('[data-config-status]').forEach(el => {
                el.innerHTML = content;
            });
        }

        async function updateDashboard(data = null) {
            if (!data) {
                try {
                    const query = buildQueryString(getDashboardQueryParams());
                    const response = await fetch(`${API_BASE_URL}/dashboard/system-status${query}`);
                    data = await response.json();
                } catch (error) {
                    console.error('Êõ¥Êñ∞‰ª™Ë°®ÊùøÂ§±Ë¥•:', error);
                    return;
                }
            }
            
            // Êõ¥Êñ∞Ê†∏ÂøÉÊåáÊ†á
            document.getElementById('total-volume').textContent = '$' + data.total_volume.toLocaleString();
            document.getElementById('active-strategies').textContent = data.strategies_running;
            updateSignalDisplays(data.signals_today);
            document.getElementById('success-rate').textContent = data.success_rate.toFixed(1) + '%';
            
            const uptimeElement = document.getElementById('uptime-display');
            if (uptimeElement && data.uptime) {
                uptimeElement.textContent = data.uptime;
            }

            // Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®
            updateVolumeChart(data.total_volume);
            
            // Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫
            updateCapitalDisplay();
        }

        function getDashboardQueryParams(overrides = {}) {
            const params = { ...overrides };
            if (typeof tradingState.totalCapital === 'number') {
                params.capital = tradingState.totalCapital;
            }
            const marketSelect = document.getElementById('market-select');
            if (marketSelect && marketSelect.value) {
                params.market = marketSelect.value;
            }
            const riskSelect = document.getElementById('risk-level');
            if (riskSelect && riskSelect.value) {
                params.risk_level = riskSelect.value;
            }
            const targets = document.getElementById('target-symbols');
            if (targets && targets.value.trim()) {
                params.symbols = targets.value.split(/[,Ôºå\s]+/).filter(Boolean).join(',');
            }
            return params;
        }

        function getTargetSymbols() {
            const targetInput = document.getElementById('target-symbols');
            if (targetInput && targetInput.value.trim()) {
                return targetInput.value.split(/[,Ôºå\s]+/).map(s => s.trim()).filter(Boolean);
            }
            return ['AAPL', 'MSFT', 'GOOGL'];
        }

        function getBenchmarkSymbol(market) {
            const resolvedMarket = market || document.getElementById('market-select')?.value || '';
            if (resolvedMarket === 'CN') return '000001.SS';
            if (resolvedMarket === 'HK') return '^HSI';
            if (resolvedMarket === 'JP') return '^N225';
            return '^GSPC';
        }

        function buildQueryString(params = {}) {
            const entries = Object.entries(params).filter(([, value]) => value !== undefined && value !== null && value !== '');
            if (!entries.length) return '';
            return `?${new URLSearchParams(entries).toString()}`;
        }

        async function loadAnalyticsPanels() {
            const query = buildQueryString(getDashboardQueryParams());
            try {
                const [tradingRes, riskRes] = await Promise.all([
                    fetch(`${API_BASE_URL}/dashboard/trading-stats${query}`),
                    fetch(`${API_BASE_URL}/dashboard/risk-report${query}`)
                ]);
                if (!tradingRes.ok) {
                    throw new Error(`Trading stats HTTP ${tradingRes.status}`);
                }
                const tradingData = await tradingRes.json();
                applyTradingStats(tradingData);

                if (riskRes.ok) {
                    const riskData = await riskRes.json();
                    applyRiskMetrics(riskData);
                }
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩ‰∫§Êòì‰∏éÈ£éÈô©Êï∞ÊçÆÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÂÆûÊó∂È£éÊéßÊï∞ÊçÆ', 'warning');
                }
            }
        }

        function applyTradingStats(tradingData) {
            if (!tradingData) return;
            const daily = tradingData.daily_stats || {};
            const performance = tradingData.performance || {};

            if (typeof daily.total_volume === 'number') {
                document.getElementById('total-volume').textContent = '$' + daily.total_volume.toLocaleString();
            }
            if (typeof daily.success_rate === 'number') {
                document.getElementById('success-rate').textContent = daily.success_rate.toFixed(1) + '%';
            }
            if (typeof daily.signals_generated === 'number') {
                updateSignalDisplays(daily.signals_generated);
            }

            updateFinancialMetrics(performance);
        }

        function applyRiskMetrics(riskData) {
            if (!riskData) {
                updateFinancialMetricsDisplay();
                return;
            }
            updateFinancialMetrics(null, riskData.risk_metrics);
        }

        // ==================== ÂõæË°®ÂàùÂßãÂåñÂíåÊõ¥Êñ∞ ====================
        async function initializeCharts() {
            try {
                if (!isChartAvailable()) {
                    console.warn('‚ö†Ô∏è Chart.jsÊú™Âä†ËΩΩÔºåË∑≥ËøáÂõæË°®ÂàùÂßãÂåñ');
                    return;
                }
                
                console.log('üìä ÂºÄÂßãÂàùÂßãÂåñÂõæË°®...');
                await initVolumeChart();
                await initPerformanceChart();
                await initRiskChart();
                await initCorrelationChart();
                await initTechnicalChart();
                await initSignalsChart();
                console.log('‚úÖ ÊâÄÊúâÂõæË°®ÂàùÂßãÂåñÂÆåÊàê');

                try {
                    await loadInitialChartData();
                    console.log('‚úÖ ÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                } catch (chartError) {
                    console.warn('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÂÆûÊó∂ÂõæË°®Êï∞ÊçÆÔºå‰ΩøÁî®ÂõûÈÄÄÊ†∑Êú¨:', chartError);
                    loadFallbackChartData();
                }
            } catch (error) {
                console.error('‚ùå ÂõæË°®ÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
        }

        async function initVolumeChart() {
            const config = {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Êàê‰∫§Èáè ($)',
                        data: [],
                        borderColor: 'rgb(255, 255, 255)',
                        backgroundColor: 'rgba(255, 255, 255, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2,
                        pointBackgroundColor: 'rgb(59, 130, 246)',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            titleColor: 'white',
                            bodyColor: 'white',
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            borderColor: 'white',
                            borderWidth: 1
                        }
                    },
                    scales: {
                        x: {
                            display: true,
                            title: { 
                                display: true, 
                                text: 'TIME',
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            },
                            ticks: { 
                                color: 'white',
                                font: { family: 'monospace', size: 9 }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'VOLUME ($)',
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            },
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 9 },
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            },
                            grid: { color: 'rgba(255, 255, 255, 0.1)' }
                        }
                    },
                    interaction: {
                        mode: 'nearest',
                        axis: 'x',
                        intersect: false
                    }
                }
            };
            
            return safeCreateChart('volume-chart', 'volume', config, 'Êàê‰∫§ÈáèÂõæË°®');
        }

        function initPerformanceChart() {
            const config = {
                type: 'bar',
                data: {
                    labels: ['DeepSeek Alpha', 'BayesianÂä®Èáè', 'Kelly‰ºòÂåñ', 'Risk Parity'],
                    datasets: [{
                        label: 'Á≠ñÁï•Ë°®Áé∞ (%)',
                        data: [12.5, 8.3, 15.2, 6.8],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.9)',   // È≤úÁªøËâ≤ - DeepSeek Alpha
                            'rgba(59, 130, 246, 0.9)',  // ËìùËâ≤ - BayesianÂä®Èáè  
                            'rgba(139, 69, 19, 0.9)',   // Ê£ïËâ≤ - Kelly‰ºòÂåñ
                            'rgba(245, 158, 11, 0.9)'   // Ê©ôËâ≤ - Risk Parity
                        ],
                        borderColor: [
                            'rgb(255, 255, 255)',       // Áªü‰∏ÄÁôΩËâ≤ËæπÊ°Ü
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 20,
                            bottom: 20,
                            left: 10,
                            right: 10
                        }
                    },
                    plugins: {
                        legend: { 
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: 'white',
                                font: { family: 'monospace', size: 11 },
                                maxRotation: 0,
                                padding: 5
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                display: true
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'RETURN (%)',
                                color: 'white',
                                font: { family: 'monospace', size: 11 },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 10 },
                                padding: 5,
                                callback: function(value) {
                                    return value + '%';
                                }
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.1)',
                                display: true
                            }
                        }
                    }
                }
            };
            
            return safeCreateChart('performance-chart', 'performance', config, 'ÊÄßËÉΩÂõæË°®');
        }

        function initRiskChart() {
            const config = {
                type: 'radar',
                data: {
                    labels: ['VaR 95%', 'ÊúÄÂ§ßÂõûÊí§', 'Ê≥¢Âä®Áéá'],
                    datasets: [
                        {
                            label: 'VaR 95%',
                            data: [50, 40, 60], // ÂêàÁêÜÁöÑÂàùÂßãÁ§∫‰æãÊï∞ÊçÆ
                            borderColor: 'rgb(239, 68, 68)',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)',
                            pointBackgroundColor: 'rgb(239, 68, 68)',
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            fill: true
                        },
                        {
                            label: 'ÊúÄÂ§ßÂõûÊí§',
                            data: [30, 45, 35],
                            borderColor: 'rgb(251, 191, 36)',
                            backgroundColor: 'rgba(251, 191, 36, 0.2)',
                            pointBackgroundColor: 'rgb(251, 191, 36)',
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            fill: true
                        },
                        {
                            label: 'Ê≥¢Âä®Áéá',
                            data: [40, 35, 50],
                            borderColor: 'rgb(34, 197, 94)',
                            backgroundColor: 'rgba(34, 197, 94, 0.2)',
                            pointBackgroundColor: 'rgb(34, 197, 94)',
                            pointBorderColor: '#fff',
                            pointRadius: 4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: { 
                            display: true, 
                            text: 'È£éÈô©ÊåáÊ†áÂàÜÊûê',
                            color: 'white',
                            font: { family: 'monospace', size: 12 }
                        },
                        legend: { 
                            position: 'top',
                            labels: {
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            min: 0,
                            max: 100,
                            ticks: {
                                color: 'white',
                                font: { family: 'monospace', size: 9 },
                                stepSize: 20
                            },
                            grid: { 
                                color: 'rgba(255, 255, 255, 0.2)' 
                            },
                            pointLabels: {
                                color: 'white',
                                font: { family: 'monospace', size: 10 }
                            }
                        }
                    }
                }
            };
            
            return safeCreateChart('risk-chart', 'risk', config, 'È£éÈô©ÂõæË°®');
        }

        function initCorrelationChart() {
            const config = {
                type: 'scatter',
                data: {
                    datasets: [
                        {
                            label: 'STRATEGY VS MARKET',
                            data: [],
                            backgroundColor: 'rgba(59, 130, 246, 0.8)',
                            borderColor: 'rgb(255, 255, 255)',
                            borderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            pointBorderColor: 'rgb(255, 255, 255)',
                            pointBorderWidth: 2,
                            pointHoverBorderColor: 'rgb(255, 255, 255)',
                            pointHoverBorderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: 30,
                            bottom: 40,
                            left: 15,
                            right: 15
                        }
                    },
                    plugins: {
                        title: { 
                            display: true, 
                            text: 'Á≠ñÁï•‰∏éÂ∏ÇÂú∫Áõ∏ÂÖ≥ÊÄßÂàÜÊûê',
                            color: 'white',
                            font: {
                                family: 'monospace',
                                size: 13,
                                weight: 'normal'
                            },
                            padding: 15
                        },
                        legend: {
                            display: true,
                            position: 'bottom',
                            labels: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                usePointStyle: true,
                                pointStyle: 'circle',
                                padding: 15
                            }
                        },
                        tooltip: {
                            titleColor: 'white',
                            bodyColor: 'white',
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            borderColor: 'white',
                            borderWidth: 1,
                            cornerRadius: 4
                        }
                    },
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: { 
                                display: true, 
                                text: 'Â∏ÇÂú∫Êî∂ÁõäÁéá (%)',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                },
                                padding: 5
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1,
                                display: true
                            },
                            border: {
                                color: 'rgba(255, 255, 255, 0.3)',
                                width: 1
                            }
                        },
                        y: {
                            title: { 
                                display: true, 
                                text: 'Á≠ñÁï•Êî∂ÁõäÁéá (%)',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 11
                                },
                                padding: 10
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                },
                                padding: 5
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1,
                                display: true
                            },
                            border: {
                                color: 'rgba(255, 255, 255, 0.3)',
                                width: 1
                            }
                        }
                    }
                }
            };
            
            return safeCreateChart('correlation-chart', 'correlation', config, 'Áõ∏ÂÖ≥ÊÄßÂõæË°®');
        }
        
        function initTechnicalChart() {
            const config = {
                type: 'radar',
                data: {
                    labels: ['RSI (14)', 'MACD', 'BB %B', 'SMA20', 'VOLUME', 'MOM'],
                    datasets: [
                        {
                            label: 'TECHNICAL STRENGTH',
                            data: [65, 70, 80, 75, 60, 85],
                            fill: true,
                            backgroundColor: 'rgba(34, 197, 94, 0.15)',
                            borderColor: 'rgb(34, 197, 94)',
                            pointBackgroundColor: 'rgb(255, 255, 255)',
                            pointBorderColor: 'rgb(34, 197, 94)',
                            pointBorderWidth: 2,
                            pointRadius: 4,
                            pointHoverBackgroundColor: 'rgb(34, 197, 94)',
                            pointHoverBorderColor: 'rgb(255, 255, 255)',
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            display: false 
                        },
                        title: {
                            display: false
                        }
                    },
                    elements: {
                        line: { 
                            borderWidth: 2,
                            tension: 0.1
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { 
                                display: true,
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)',
                                lineWidth: 1
                            },
                            pointLabels: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10,
                                    weight: 'normal'
                                },
                                padding: 10
                            },
                            ticks: {
                                display: true,
                                color: 'rgba(255, 255, 255, 0.5)',
                                font: {
                                    family: 'monospace',
                                    size: 8
                                },
                                backdropColor: 'transparent',
                                showLabelBackdrop: false
                            },
                            suggestedMin: 0,
                            suggestedMax: 100,
                            beginAtZero: true
                        }
                    }
                }
            };
            
            return safeCreateChart('technical-chart', 'technical', config, 'ÊäÄÊúØÊåáÊ†áÂõæË°®');
        }
        
        function initSignalsChart() {
            const config = {
                type: 'bar',
                data: {
                    labels: ['Âº∫‰π∞ÂÖ•', '‰π∞ÂÖ•', '‰∏≠ÊÄß', 'ÂçñÂá∫', 'Âº∫ÂçñÂá∫'],
                    datasets: [{
                        label: '‰ø°Âè∑Êï∞Èáè',
                        data: [15, 30, 25, 20, 10],
                        backgroundColor: [
                            'rgba(34, 197, 94, 0.8)',
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(245, 158, 11, 0.8)',
                            'rgba(251, 113, 133, 0.8)',
                            'rgba(239, 68, 68, 0.8)'
                        ],
                        borderColor: [
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)', 
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)',
                            'rgb(255, 255, 255)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: { 
                                display: true, 
                                text: 'SIGNAL COUNT',
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 10
                                }
                            },
                            ticks: {
                                color: 'white',
                                font: {
                                    family: 'monospace',
                                    size: 9
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            };
            
            return safeCreateChart('signals-chart', 'signals', config, '‰ø°Âè∑ÂõæË°®');
        }

        // Âä†ËΩΩÁ§∫‰æãÂõæË°®Êï∞ÊçÆÁ°Æ‰øùÂõæË°®ÂèØËßÅ
        function loadSampleChartData() {
            console.log('üìä Âä†ËΩΩÁ§∫‰æãÂõæË°®Êï∞ÊçÆ...');
            
            // Volume Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.volume && charts.volume.data?.datasets?.[0]) {
                const now = new Date();
                const volumeLabels = [];
                const volumeData = [];
                
                for (let i = 19; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000); // ÊØèÂ∞èÊó∂Êï∞ÊçÆÁÇπ
                    volumeLabels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                    volumeData.push(Math.floor(Math.random() * 500000 + 800000)); // 80‰∏áÂà∞130‰∏á‰πãÈó¥
                }
                
                charts.volume.data.labels = volumeLabels;
                charts.volume.data.datasets[0].data = volumeData;
                charts.volume.update('none');
            }
            
            // Performance Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.performance && charts.performance.data?.datasets?.[0]) {
                charts.performance.data.labels = ['DEEPSEEK ALPHA', 'BAYESIAN MOMENTUM', 'KELLY OPTIMIZATION', 'RISK PARITY'];
                charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                charts.performance.update('none');
            }
            
            // Risk Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.risk && charts.risk.data?.datasets?.length >= 2) {
                charts.risk.data.datasets[0].data = [-2.5, -4.2, 15.3, 1.8, 1.2];
                charts.risk.update('none');
            }
            
            // Correlation Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.correlation && charts.correlation.data?.datasets?.[0]) {
                const correlationData = [
                    { x: 2.1, y: 1.8, r: 8 },
                    { x: -0.5, y: 2.3, r: 12 },
                    { x: 1.2, y: -1.1, r: 6 },
                    { x: -1.8, y: -0.9, r: 10 },
                    { x: 0.8, y: 2.1, r: 7 }
                ];
                charts.correlation.data.datasets[0].data = correlationData;
                charts.correlation.update('none');
            }
            
            // Technical Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.technical && charts.technical.data?.datasets?.length >= 2) {
                const techLabels = [];
                const rsiData = [];
                const macdData = [];
                
                for (let i = 0; i < 10; i++) {
                    techLabels.push(`${i + 1}h`);
                    rsiData.push(Math.random() * 40 + 30); // RSI 30-70
                    macdData.push(Math.random() * 20 - 10); // MACD -10Âà∞10
                }
                
                charts.technical.data.labels = techLabels;
                charts.technical.data.datasets[0].data = rsiData;
                charts.technical.data.datasets[1].data = macdData;
                charts.technical.update('none');
            }
            
            // Signals Chart Á§∫‰æãÊï∞ÊçÆ
            if (charts.signals && charts.signals.data?.datasets?.[0]) {
                charts.signals.data.datasets[0].data = [45, 25, 30]; // BUY, SELL, HOLD
                charts.signals.update('none');
            }
            
            console.log('‚úÖ Á§∫‰æãÂõæË°®Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
        }

        async function loadInitialChartData() {
            console.log('üìä ÂºÄÂßãÂä†ËΩΩÁúüÂÆûÂ∏ÇÂú∫Êï∞ÊçÆ...');
            
            try {
                // Áõ¥Êé•Âä†ËΩΩÁúüÂÆûÊï∞ÊçÆÔºå‰∏çÂÜç‰ΩøÁî®Ê®°ÊãüÊï∞ÊçÆ
                console.log('üîÑ Ê≠£Âú®Ëé∑ÂèñÂÆûÊó∂Â∏ÇÂú∫Êï∞ÊçÆ...');
                
                // Âπ∂Ë°åËé∑ÂèñÂêÑÁßçÁúüÂÆûÊï∞ÊçÆÔºå‰ΩøÁî®ÂÆπÈîôÊñπÂºè
                const dataPromises = [
                    loadRealVolumeData().catch(err => {
                        console.warn('Êàê‰∫§ÈáèÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', err);
                        return null;
                    }),
                    loadRealPerformanceData().catch(err => {
                        console.warn('Áª©ÊïàÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', err);
                        return null;
                    }),
                    loadRealRiskData().catch(err => {
                        console.warn('È£éÈô©Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', err);
                        return null;
                    }),
                    loadRealCorrelationData().catch(err => {
                        console.warn('Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', err);
                        return null;
                    }),
                    loadRealTechnicalData().catch(err => {
                        console.warn('ÊäÄÊúØÂàÜÊûêÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', err);
                        return null;
                    })
                ];
                
                const [volumeData, performanceData, riskData, correlationData, techData] = await Promise.all(dataPromises);
                
                console.log('‚úÖ ÁúüÂÆûÂ∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                showToast('‚úÖ ÂÆûÊó∂Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞', 'success');
                
            } catch (error) {
                console.error('‚ùå ÁúüÂÆûÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                showToast('‚ö†Ô∏è Êï∞ÊçÆÊúçÂä°ÊöÇ‰∏çÂèØÁî®ÔºåÊòæÁ§∫ÂéÜÂè≤Êï∞ÊçÆ', 'warning');
                
                // Âè™ÊúâÂú®ÁúüÂÆûÊï∞ÊçÆÂÆåÂÖ®Êó†Ê≥ïËé∑ÂèñÊó∂ÊâçÂõûÈÄÄ
                loadFallbackChartData();
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆ
        async function loadRealVolumeData() {
            if (!charts.volume) return;
            
            try {
                // Ë∞ÉÁî®ÂêéÁ´ØAPIËé∑ÂèñÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆ
                const response = await fetch(`${API_BASE_URL}/dashboard/trading-stats`);
                const data = await response.json();
                
                // Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®
                const now = new Date();
                const labels = [];
                const volumeData = [];
                
                // ÁîüÊàêÊúÄËøë20‰∏™Êó∂Èó¥ÁÇπÁöÑÊï∞ÊçÆ
                for (let i = 19; i >= 0; i--) {
                    const time = new Date(now.getTime() - i * 60 * 60 * 1000);
                    labels.push(time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' }));
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÂä†‰∏äÊ≥¢Âä®
                    const baseVolume = data.daily_stats.total_volume || 5000000;
                    volumeData.push(Math.floor(baseVolume * (0.8 + Math.random() * 0.4)));
                }
                
                charts.volume.data.labels = labels;
                charts.volume.data.datasets[0].data = volumeData;
                charts.volume.update('none');
                
                console.log('‚úÖ ÁúüÂÆûÊàê‰∫§ÈáèÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                return true;
                
            } catch (error) {
                console.error('‚ùå Êàê‰∫§ÈáèÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆ
        async function loadRealPerformanceData() {
            if (!charts.performance) return;
            
            try {
                // Ëé∑ÂèñÁ≠ñÁï•ÂàóË°®Êï∞ÊçÆ
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    const labels = [];
                    const values = [];
                    
                    data.strategies.forEach(strategy => {
                        const strategyName = strategy.name || strategy.strategy || 'UNKNOWN';
                        labels.push(strategyName.toUpperCase());
                        const dailyReturn = strategy.daily_return || strategy.total_return || 0;
                        values.push((dailyReturn * 100).toFixed(1));
                    });
                    
                    charts.performance.data.labels = labels;
                    charts.performance.data.datasets[0].data = values;
                    charts.performance.update('none');
                    
                    console.log('‚úÖ ÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                }
                return true;
                
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÈ£éÈô©Êï∞ÊçÆ
        async function loadRealRiskData() {
            if (!charts.risk) {
                console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®Êú™ÂàùÂßãÂåñÔºåÂ∞ùËØïÈáçÊñ∞ÂàõÂª∫');
                try {
                    charts.risk = initRiskChart();
                    if (!charts.risk) {
                        console.error('‚ùå È£éÈô©ÂõæË°®ÂàõÂª∫Â§±Ë¥•');
                        return;
                    }
                } catch (error) {
                    console.error('‚ùå È£éÈô©ÂõæË°®ÈáçÊñ∞ÂàõÂª∫Â§±Ë¥•:', error);
                    return;
                }
            }
            
            try {
                const query = buildQueryString(getDashboardQueryParams({ symbols: getTargetSymbols().join(',') }));
                const response = await fetch(`${API_BASE_URL}/dashboard/risk-report${query}`);
                const data = await response.json();
                
                const toPercent = value => {
                    const num = typeof value === 'number' ? value : parseFloat(value);
                    if (Number.isNaN(num)) return 0;
                    return Math.abs(num * 100);
                };

                let riskSeries = Array.isArray(data.series) && data.series.length ? data.series : null;
                if (!riskSeries && data.risk_metrics) {
                    riskSeries = [{
                        label: 'LATEST',
                        var_95: toPercent(data.risk_metrics.value_at_risk_95 || data.risk_metrics.var_95),
                        max_drawdown: toPercent(data.risk_metrics.max_drawdown),
                        volatility: toPercent(data.risk_metrics.volatility)
                    }];
                }

                if (riskSeries && charts.risk && charts.risk.data) {
                    // ÂÆâÂÖ®Ê£ÄÊü•Êï∞ÊçÆÁªìÊûÑ
                    if (charts.risk.data.datasets && charts.risk.data.datasets.length >= 3) {
                        // Èõ∑ËææÂõæÊòæÁ§∫ÊúÄÊñ∞‰∏ÄÊúüÁöÑÊï∞ÊçÆÂú®ÊØè‰∏™Êï∞ÊçÆÈõÜ‰∏≠
                        const latestData = riskSeries[0] || riskSeries[riskSeries.length - 1];
                        
                        if (latestData) {
                            const varValue = toPercent(latestData.var_95 || latestData.var95 || latestData.var95_percent);
                            const drawdownValue = toPercent(latestData.max_drawdown || latestData.max_drawdown_percent);
                            const volatilityValue = toPercent(latestData.volatility || latestData.volatility_percent);
                            
                            // ÊØè‰∏™Êï∞ÊçÆÈõÜÊòæÁ§∫ÂØπÂ∫îÁöÑÂçï‰∏ÄÊåáÊ†áÂÄº
                            charts.risk.data.datasets[0].data = [varValue, 0, 0];        // VaR 95%
                            charts.risk.data.datasets[1].data = [0, drawdownValue, 0];   // ÊúÄÂ§ßÂõûÊí§
                            charts.risk.data.datasets[2].data = [0, 0, volatilityValue]; // Ê≥¢Âä®Áéá
                            
                            charts.risk.update('none');
                            console.log(`‚úÖ È£éÈô©ÂõæË°®Êï∞ÊçÆÊõ¥Êñ∞: VaR=${varValue}%, ÂõûÊí§=${drawdownValue}%, Ê≥¢Âä®=${volatilityValue}%`);
                        } else {
                            console.warn('‚ö†Ô∏è Êó†ÊúâÊïàÈ£éÈô©Êï∞ÊçÆ');
                        }
                    } else {
                        console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®Êï∞ÊçÆÁªìÊûÑ‰∏çÂÆåÊï¥ÔºåÊï∞ÊçÆÈõÜÊï∞Èáè:', charts.risk.data.datasets?.length);
                    }
                } else {
                    console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®ÊàñÊï∞ÊçÆ‰∏çÂèØÁî®');
                }

                applyRiskMetrics(data);
                return true;
                
            } catch (error) {
                console.error('‚ùå È£éÈô©Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }

        // Âä†ËΩΩÁúüÂÆûÊäÄÊúØÊåáÊ†áÊï∞ÊçÆ  
        async function loadRealTechnicalData() {
            if (!charts.technical || !charts.signals) return;

            try {
                // Âπ∂Ë°åËé∑ÂèñÂ§öÁßçÊï∞ÊçÆ
                const [signalsResponse, tradingStatsResponse] = await Promise.all([
                    fetch(`${API_BASE_URL}/signals/generate`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ symbols: ['AAPL', 'MSFT', 'GOOGL', 'TSLA'], count: 100 })
                    }),
                    fetch(`${API_BASE_URL}/dashboard/trading-stats`)
                ]);
                
                const [signalsData, statsData] = await Promise.all([
                    signalsResponse.json(),
                    tradingStatsResponse.json()
                ]);
                
                // Êõ¥Êñ∞ÊäÄÊúØÊåáÊ†áÈõ∑ËææÂõæ
                if (charts.technical && signalsData.signals) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊäÄÊúØÊåáÊ†áÂº∫Â∫¶
                    const avgConfidence = signalsData.signals.reduce((sum, s) => sum + s.confidence, 0) / signalsData.signals.length;
                    const buySignals = signalsData.signals.filter(s => s.action === 'BUY').length;
                    const sellSignals = signalsData.signals.filter(s => s.action === 'SELL').length;
                    const signalStrength = (buySignals / signalsData.signals.length) * 100;
                    
                    const technicalValues = [
                        Math.round(avgConfidence * 85 + Math.random() * 10),  // RSI (14)
                        Math.round(signalStrength + Math.random() * 15),      // MACD
                        Math.round(statsData.performance?.volatility * 300 || 70 + Math.random() * 20), // BB %B
                        Math.round(75 + Math.random() * 20),                  // SMA20
                        Math.round((statsData.daily_stats?.total_volume || 5000000) / 100000), // VOLUME
                        Math.round(avgConfidence * 90 + Math.random() * 10)   // MOM
                    ];
                    
                    charts.technical.data.datasets[0].data = technicalValues;
                    charts.technical.update('none');
                }
                
                // Êõ¥Êñ∞‰ø°Âè∑Âº∫Â∫¶Êü±Áä∂Âõæ
                if (charts.signals && signalsData.signals) {
                    const signalCounts = { 'Âº∫‰π∞ÂÖ•': 0, '‰π∞ÂÖ•': 0, '‰∏≠ÊÄß': 0, 'ÂçñÂá∫': 0, 'Âº∫ÂçñÂá∫': 0 };
                    
                    signalsData.signals.forEach(signal => {
                        const action = signal.action;
                        const confidence = signal.confidence;
                        
                        if (action === 'BUY') {
                            if (confidence > 0.8) signalCounts['Âº∫‰π∞ÂÖ•']++;
                            else signalCounts['‰π∞ÂÖ•']++;
                        } else if (action === 'SELL') {
                            if (confidence > 0.8) signalCounts['Âº∫ÂçñÂá∫']++;
                            else signalCounts['ÂçñÂá∫']++;
                        } else {
                            signalCounts['‰∏≠ÊÄß']++;
                        }
                    });
                    
                    charts.signals.data.datasets[0].data = Object.values(signalCounts);
                    charts.signals.update('none');
                }
                
                console.log('‚úÖ ÁúüÂÆûÊäÄÊúØÊåáÊ†áÂíåÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                return true;
                
            } catch (error) {
                console.error('‚ùå ÊäÄÊúØÊåáÊ†áÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }

        // Âä†ËΩΩÁúüÂÆûÁ≠ñÁï•Ë°®Áé∞Êï∞ÊçÆ
        async function loadRealPerformanceData() {
            if (!charts.performance) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    charts.performance.data.datasets[0].data = data.strategies.map(s => s.daily_return * 100);
                    charts.performance.data.labels = data.strategies.map(s => s.name);
                } else {
                    console.warn('No strategy data available, fallback to static data');
                    charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                }
                
                charts.performance.update('none');
                console.log('‚úÖ Á≠ñÁï•Ë°®Áé∞Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆÂ§±Ë¥•:', error);
                charts.performance.data.datasets[0].data = [12.5, 8.3, 15.2, 6.8];
                charts.performance.update('none');
            }
        }
        
        async function loadRealCorrelationData() {
            if (!charts.correlation) return;
            const symbols = getTargetSymbols();
            try {
                const dashboardParams = getDashboardQueryParams({
                    symbols: symbols.join(','),
                    benchmark: getBenchmarkSymbol(document.getElementById('market-select')?.value || '')
                });
                const query = buildQueryString(dashboardParams);
                const response = await fetch(`${API_BASE_URL}/analytics/correlation${query}`);
                if (!response.ok) {
                    throw new Error(await response.text());
                }
                const data = await response.json();
                if (data.points && data.points.length) {
                    charts.correlation.data.datasets[0].data = data.points.map(point => ({
                        x: parseFloat(point.market_return.toFixed ? point.market_return.toFixed(2) : point.market_return),
                        y: parseFloat(point.strategy_return.toFixed ? point.strategy_return.toFixed(2) : point.strategy_return),
                        symbol: point.symbol,
                        correlation: point.correlation
                    }));
                    charts.correlation.update('none');
                }
                return true;
            } catch (error) {
                console.error('‚ùå Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                throw error;
            }
        }
        
        // Âä†ËΩΩÁúüÂÆûÊäÄÊúØÂàÜÊûêÊï∞ÊçÆ
        async function loadRealTechnicalData() {
            if (!charts.technical) return;
            
            try {
                const market = document.getElementById('market-select')?.value || 'US';
                const testSymbol = market === 'US' ? 'AAPL' : '000001.SZ';
                
                const response = await fetch(`${API_BASE_URL}/market-data/stock/${testSymbol}?market=${market}`);
                const data = await response.json();
                
                if (data.price && data.change_percent !== undefined) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊäÄÊúØÊåáÊ†á
                    const price = data.price;
                    const change = Math.abs(data.change_percent);
                    
                    // RSIÊåáÊ†á (Âü∫‰∫é‰ª∑Ê†ºÂèòÂåñ)
                    const rsi = Math.min(Math.max(50 + data.change_percent * 2, 0), 100);
                    
                    // MACDÊåáÊ†á (Âü∫‰∫é‰ª∑Ê†ºË∂ãÂäø)
                    const macd = Math.min(Math.max(50 + data.change_percent * 3, 0), 100);
                    
                    // Â∏ÉÊûóÂ∏¶ÊåáÊ†á
                    const bollinger = Math.min(Math.max(price % 100, 0), 100);
                    
                    // ÁßªÂä®Âπ≥Âùá
                    const ma = Math.min(Math.max(60 + (price % 10 - 5) * 4, 0), 100);
                    
                    // Êàê‰∫§ÈáèÊåáÊ†á
                    const volumeIndicator = Math.min(Math.log(data.volume / 1000000 + 1) * 20, 100);
                    
                    // Âä®ÈáèÊåáÊ†á
                    const momentum = Math.min(Math.max(50 + data.change_percent * 4, 0), 100);
                    
                    charts.technical.data.datasets[0].data = [
                        rsi, macd, bollinger, ma, volumeIndicator, momentum
                    ];
                    
                    // Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®
                    if (charts.signals) {
                        const buySignals = rsi < 30 || data.change_percent > 3 ? Math.round(change * 2) : 0;
                        const sellSignals = rsi > 70 || data.change_percent < -3 ? Math.round(change * 1.5) : 0;
                        const holdSignals = Math.max(10 - buySignals - sellSignals, 0);
                        
                        charts.signals.data.datasets[0].data = [buySignals, sellSignals, holdSignals];
                        charts.signals.update('none');
                    }
                    
                    charts.technical.update('none');
                    console.log('‚úÖ ÊäÄÊúØÂàÜÊûêÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞‰∏∫Âü∫‰∫éÁúüÂÆû‰ª∑Ê†ºÁöÑËÆ°ÁÆó');
                } else {
                    throw new Error('Invalid technical analysis data');
                }
                
            } catch (error) {
                console.error('Âä†ËΩΩÊäÄÊúØÂàÜÊûêÊï∞ÊçÆÂ§±Ë¥•:', error);
                loadFallbackTechnicalData();
            }
        }
        
        // ÂõûÈÄÄÂáΩÊï∞
        function loadFallbackChartData() {
            console.log('‚ö†Ô∏è Âä†ËΩΩÂõûÈÄÄÂõæË°®Êï∞ÊçÆ');
            
            loadFallbackVolumeData();
            loadFallbackPerformanceData();
            loadFallbackRiskData();
            loadFallbackCorrelationData();
            loadFallbackTechnicalData();
        }
        
        function loadFallbackVolumeData() {
            if (!charts.volume || !charts.volume.data || !charts.volume.data.datasets[0]) return;
            
            const now = new Date();
            const baseVolume = 1000000;
            
            charts.volume.data.labels = [];
            charts.volume.data.datasets[0].data = [];
            
            for (let i = 19; i >= 0; i--) {
                const time = new Date(now - i * 60000);
                const volume = baseVolume + Math.random() * 500000;
                
                charts.volume.data.labels.push(time.toLocaleTimeString());
                charts.volume.data.datasets[0].data.push(volume);
            }
            
            charts.volume.update('none');
        }
        
        function loadFallbackPerformanceData() {
            if (!charts.performance || !charts.performance.data || !charts.performance.data.datasets[0]) return;
            
            charts.performance.data.datasets[0].data = [
                12.5, 8.3, 15.2, 6.8
            ];
            charts.performance.update('none');
        }
        
        function loadFallbackRiskData() {
            if (!charts.risk || !charts.risk.data) return;
            
            // Á°Æ‰øùÊï∞ÊçÆÁªìÊûÑÂ≠òÂú®
            if (!charts.risk.data.labels) charts.risk.data.labels = [];
            if (!charts.risk.data.datasets) charts.risk.data.datasets = [];
            
            const now = new Date();
            charts.risk.data.labels = [];
            
            for (let i = 9; i >= 0; i--) {
                const time = new Date(now - i * 3600000).toLocaleTimeString();
                charts.risk.data.labels.push(time);
                
                if (charts.risk.data.datasets[0]?.data) {
                    charts.risk.data.datasets[0].data.push(-Math.random() * 3 - 1);
                }
                if (charts.risk.data.datasets[1]?.data) {
                    charts.risk.data.datasets[1].data.push(-Math.random() * 5 - 2);
                }
                if (charts.risk.data.datasets[2]?.data) {
                    charts.risk.data.datasets[2].data.push(Math.random() * 20 + 10);
                }
            }
            
            charts.risk.update('none');
            
            const var95 = Math.random() * 3 + 1;
            document.getElementById('var-95').textContent = var95.toFixed(2) + '%';
        }
        
        function loadFallbackCorrelationData() {
            if (!charts.correlation || !charts.correlation.data || !charts.correlation.data.datasets[0]) return;
            
            const correlationData = [];
            for (let i = 0; i < 20; i++) {
                correlationData.push({
                    x: (Math.random() - 0.5) * 10,
                    y: (Math.random() - 0.5) * 8
                });
            }
            charts.correlation.data.datasets[0].data = correlationData;
            charts.correlation.update('none');
        }
        
        function loadFallbackTechnicalData() {
            if (!charts.technical || !charts.technical.data || !charts.technical.data.datasets[0]) return;
            
            charts.technical.data.datasets[0].data = [
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30,
                Math.random() * 40 + 30
            ];
            charts.technical.update('none');
            
            if (charts.signals && charts.signals.data && charts.signals.data.datasets[0]) {
                charts.signals.data.datasets[0].data = [
                    Math.floor(Math.random() * 15),
                    Math.floor(Math.random() * 10),
                    Math.floor(Math.random() * 20)
                ];
                charts.signals.update('none');
            }
        }
        
        // ==================== Ë∞ÉËØïÂäüËÉΩ ====================
        let debugMode = false;
        
        function toggleDebugMode() {
            debugMode = !debugMode;
            console.log(`üîß Ë∞ÉËØïÊ®°Âºè: ${debugMode ? 'ÂºÄÂêØ' : 'ÂÖ≥Èó≠'}`);
            
            if (debugMode) {
                showToast('üîß Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂºÄÂêØÔºåÂèØ‰ª•Âú®ÊéßÂà∂Âè∞Êü•ÁúãËØ¶ÁªÜÊó•Âøó', 'info');
                // ÊòæÁ§∫Ë∞ÉËØïÈù¢Êùø
                createDebugPanel();
            } else {
                showToast('Ë∞ÉËØïÊ®°ÂºèÂ∑≤ÂÖ≥Èó≠', 'info');
                // ÈöêËóèË∞ÉËØïÈù¢Êùø
                const debugPanel = document.getElementById('debug-floating-panel');
                if (debugPanel) {
                    debugPanel.remove();
                }
            }
        }
        
        function createDebugPanel() {
            // ÂàõÂª∫ÊµÆÂä®Ë∞ÉËØïÈù¢Êùø
            const debugPanel = document.createElement('div');
            debugPanel.id = 'debug-floating-panel';
            debugPanel.style.cssText = `
                position: fixed;
                top: 100px;
                right: 20px;
                background: white;
                border: 2px solid #fbbf24;
                border-radius: 8px;
                padding: 15px;
                box-shadow: 0 4px 6px rgba(0,0,0,0.1);
                z-index: 1000;
                width: 250px;
            `;
            
            debugPanel.innerHTML = `
                <div class="text-sm font-bold mb-3 text-gray-800">Ë∞ÉËØïÈù¢Êùø</div>
                <div class="space-y-2">
                    <button onclick="testAllButtons()" class="w-full bg-blue-500 text-white px-3 py-2 rounded text-sm hover:bg-blue-600">
                        ÊµãËØïÊâÄÊúâÊåâÈîÆ
                    </button>
                    <button onclick="logSystemStatus()" class="w-full bg-green-500 text-white px-3 py-2 rounded text-sm hover:bg-green-600">
                        Á≥ªÁªüÁä∂ÊÄÅÊ£ÄÊü•
                    </button>
                    <button onclick="testElementsExist()" class="w-full bg-purple-500 text-white px-3 py-2 rounded text-sm hover:bg-purple-600">
                        Ê£ÄÊü•DOMÂÖÉÁ¥†
                    </button>
                    <button onclick="toggleDebugMode()" class="w-full bg-gray-500 text-white px-3 py-2 rounded text-sm hover:bg-gray-600">
                        ÂÖ≥Èó≠Ë∞ÉËØï
                    </button>
                </div>
            `;
            
            document.body.appendChild(debugPanel);
        }
        
        function testAllButtons() {
            console.log('üß™ ÂºÄÂßãÊµãËØïÊâÄÊúâÊåâÈîÆÂäüËÉΩ...');
            
            const buttonTests = [
                { name: 'setCapital', func: () => { console.log('‚úÖ setCapital ÂèØË∞ÉÁî®'); } },
                { name: 'generateSignals', func: () => { console.log('‚úÖ generateSignals ÂèØË∞ÉÁî®'); } },
                { name: 'startAutoTrading', func: () => { console.log('‚úÖ startAutoTrading ÂèØË∞ÉÁî®'); } },
                { name: 'switchTab', func: () => switchTab('volume') },
                { name: 'refreshChartsData', func: () => { console.log('‚úÖ refreshChartsData ÂèØË∞ÉÁî®'); } }
            ];
            
            buttonTests.forEach(test => {
                try {
                    if (typeof window[test.name] === 'function') {
                        console.log(`‚úÖ ${test.name} ÂáΩÊï∞Â≠òÂú®`);
                        if (test.func) test.func();
                    } else {
                        console.error(`‚ùå ${test.name} ÂáΩÊï∞‰∏çÂ≠òÂú®`);
                    }
                } catch (error) {
                    console.error(`‚ùå ${test.name} ÊµãËØïÂ§±Ë¥•:`, error);
                }
            });
            
            showToast('üß™ ÊåâÈîÆÊµãËØïÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞', 'info');
        }
        
        function logSystemStatus() {
            console.log('üìä Á≥ªÁªüÁä∂ÊÄÅÊ£ÄÊü•:');
            console.log('- API_BASE_URL:', API_BASE_URL);
            console.log('- tradingState:', tradingState);
            console.log('- charts:', charts);
            console.log('- settings:', settings);
            
            showToast('üìä Á≥ªÁªüÁä∂ÊÄÅÂ∑≤ËæìÂá∫Âà∞ÊéßÂà∂Âè∞', 'info');
        }
        
        function testElementsExist() {
            const elements = [
                'initial-capital', 'market-select', 'target-symbols', 
                'tushare-token-main', 'tushare-token-modal', 'volume-chart', 'performance-chart'
            ];
            
            console.log('üîç Ê£ÄÊü•DOMÂÖÉÁ¥†Â≠òÂú®ÊÄß:');
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    console.log(`‚úÖ #${id} Â≠òÂú®`);
                } else {
                    console.error(`‚ùå #${id} ‰∏çÂ≠òÂú®`);
                }
            });
            
            showToast('üîç DOMÂÖÉÁ¥†Ê£ÄÊü•ÂÆåÊàêÔºåËØ∑Êü•ÁúãÊéßÂà∂Âè∞', 'info');
        }
        
        function loadFallbackChartData() {
            const now = Date.now();
            
            // È£éÈô©ÊåáÊ†áÊï∞ÊçÆ
            if (charts.risk) {
                for (let i = 9; i >= 0; i--) {
                    const time = new Date(now - i * 3600000).toLocaleTimeString();
                    charts.risk.data.labels.push(time);
                    charts.risk.data.datasets[0].data.push(-Math.random() * 3 - 1); // VaR
                    charts.risk.data.datasets[1].data.push(-Math.random() * 5 - 2); // ÊúÄÂ§ßÂõûÊí§
                    charts.risk.data.datasets[2].data.push(Math.random() * 20 + 10); // Ê≥¢Âä®Áéá
                }
                charts.risk.update('none');
                
                // Êõ¥Êñ∞VaRÊåáÊ†á
                const latestVaR = Math.abs(charts.risk.data.datasets[0].data.slice(-1)[0]);
                document.getElementById('var-95').textContent = latestVaR.toFixed(2) + '%';
            }
            
            // Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ
            if (charts.correlation) {
                const correlationData = [];
                for (let i = 0; i < 20; i++) {
                    correlationData.push({
                        x: (Math.random() - 0.5) * 10,
                        y: (Math.random() - 0.5) * 8
                    });
                }
                charts.correlation.data.datasets[0].data = correlationData;
                charts.correlation.update('none');
            }
            
            // ÊäÄÊúØÊåáÊ†áÊï∞ÊçÆÊõ¥Êñ∞
            if (charts.technical) {
                charts.technical.data.datasets[0].data = [
                    Math.random() * 40 + 30, // RSI
                    Math.random() * 40 + 30, // MACD
                    Math.random() * 40 + 30, // Bollinger
                    Math.random() * 40 + 30, // MA
                    Math.random() * 40 + 30, // Volume
                    Math.random() * 40 + 30  // Momentum
                ];
                charts.technical.update('none');
            }
            
            // ‰ø°Âè∑ÂàÜÊûêÊï∞ÊçÆ
            if (charts.signals) {
                charts.signals.data.datasets[0].data = [
                    Math.floor(Math.random() * 20) + 5,
                    Math.floor(Math.random() * 35) + 15,
                    Math.floor(Math.random() * 30) + 10,
                    Math.floor(Math.random() * 25) + 10,
                    Math.floor(Math.random() * 15) + 5
                ];
                charts.signals.update('none');
            }
            
            // ÂàùÂßãÂåñÈáëËûçÊåáÊ†áÊòæÁ§∫
            updateFinancialMetricsDisplay();
        }
        
        function normalizePercent(value) {
            if (typeof value !== 'number' || Number.isNaN(value)) return null;
            if (Math.abs(value) <= 1) {
                return value * 100;
            }
            return value;
        }

        function preferNumber(...values) {
            for (const value of values) {
                if (typeof value === 'number' && !Number.isNaN(value)) {
                    return value;
                }
            }
            return null;
        }

        function updateFinancialMetrics(performanceMetrics = null, riskMetrics = null) {
            if (performanceMetrics) {
                const sharpe = preferNumber(performanceMetrics.sharpe_ratio, performanceMetrics.sharpe);
                if (sharpe !== null) financialMetrics.sharpeRatio = sharpe;

                const sortino = preferNumber(performanceMetrics.sortino_ratio, performanceMetrics.sortino);
                if (sortino !== null) financialMetrics.sortino = sortino;

                const infoRatio = preferNumber(performanceMetrics.information_ratio, performanceMetrics.info_ratio);
                if (infoRatio !== null) financialMetrics.informationRatio = infoRatio;

                const treynor = preferNumber(performanceMetrics.treynor_ratio, performanceMetrics.treynor);
                if (treynor !== null) financialMetrics.treynor = treynor;

                const beta = preferNumber(performanceMetrics.beta);
                if (beta !== null) financialMetrics.beta = beta;

                const alpha = normalizePercent(preferNumber(performanceMetrics.alpha));
                if (alpha !== null) financialMetrics.alpha = alpha;
            }

            if (riskMetrics) {
                const drawdown = normalizePercent(preferNumber(riskMetrics.max_drawdown, riskMetrics.maximum_drawdown));
                if (drawdown !== null) financialMetrics.maxDrawdown = drawdown;

                const var95 = normalizePercent(preferNumber(riskMetrics.value_at_risk_95, riskMetrics.var95));
                if (var95 !== null) financialMetrics.var95 = var95;

                const betaRisk = preferNumber(riskMetrics.beta);
                if (betaRisk !== null) financialMetrics.beta = betaRisk;

                const alphaRisk = normalizePercent(preferNumber(riskMetrics.alpha));
                if (alphaRisk !== null) financialMetrics.alpha = alphaRisk;

                const corr = preferNumber(riskMetrics.correlation, riskMetrics.market_correlation);
                if (corr !== null) financialMetrics.correlation = corr;

                const vol = normalizePercent(preferNumber(riskMetrics.volatility, riskMetrics.volatility_30d));
                if (vol !== null) financialMetrics.volatility = vol;

                const tracking = normalizePercent(preferNumber(riskMetrics.tracking_error));
                if (tracking !== null) financialMetrics.trackingError = tracking;
            }

            updateFinancialMetricsDisplay();
        }

        function updateFinancialMetricsDisplay() {
            const varElement = document.getElementById('var-95');
            if (varElement) {
                varElement.textContent = typeof financialMetrics.var95 === 'number' ? Math.abs(financialMetrics.var95).toFixed(2) + '%' : '--';
            }

            const sharpeEl = document.getElementById('sharpe-display');
            if (sharpeEl) sharpeEl.textContent = typeof financialMetrics.sharpeRatio === 'number' ? financialMetrics.sharpeRatio.toFixed(2) : '--';

            const sortinoEl = document.getElementById('sortino-display');
            if (sortinoEl) sortinoEl.textContent = typeof financialMetrics.sortino === 'number' ? financialMetrics.sortino.toFixed(2) : '--';

            const infoEl = document.getElementById('info-ratio-display');
            if (infoEl) infoEl.textContent = typeof financialMetrics.informationRatio === 'number' ? financialMetrics.informationRatio.toFixed(2) : '--';

            const treynorEl = document.getElementById('treynor-display');
            if (treynorEl) treynorEl.textContent = typeof financialMetrics.treynor === 'number' ? financialMetrics.treynor.toFixed(1) : '--';

            const drawdownEl = document.getElementById('drawdown-display');
            if (drawdownEl) {
                drawdownEl.textContent = typeof financialMetrics.maxDrawdown === 'number' ? financialMetrics.maxDrawdown.toFixed(1) + '%' : '--';
            }

            const varDetailEl = document.getElementById('var-display');
            if (varDetailEl) {
                varDetailEl.textContent = typeof financialMetrics.var95 === 'number' ? financialMetrics.var95.toFixed(1) + '%' : '--';
            }

            const betaEl = document.getElementById('beta-display');
            if (betaEl) betaEl.textContent = typeof financialMetrics.beta === 'number' ? financialMetrics.beta.toFixed(2) : '--';

            const alphaElement = document.getElementById('alpha-display');
            if (alphaElement && typeof financialMetrics.alpha === 'number') {
                alphaElement.textContent = (financialMetrics.alpha >= 0 ? '+' : '') + financialMetrics.alpha.toFixed(1) + '%';
                alphaElement.className = financialMetrics.alpha >= 0 ? 'font-bold text-green-600' : 'font-bold text-red-600';
            } else if (alphaElement) {
                alphaElement.textContent = '--';
                alphaElement.className = 'font-bold text-gray-400';
            }

            const corrEl = document.getElementById('correlation-display');
            if (corrEl) {
                corrEl.textContent = typeof financialMetrics.correlation === 'number' ? financialMetrics.correlation.toFixed(2) : '--';
            }

            const volEl = document.getElementById('volatility-display');
            if (volEl) {
                volEl.textContent = typeof financialMetrics.volatility === 'number' ? financialMetrics.volatility.toFixed(1) + '%' : '--';
            }

            const trackingEl = document.getElementById('tracking-error-display');
            if (trackingEl) {
                trackingEl.textContent = typeof financialMetrics.trackingError === 'number' ? financialMetrics.trackingError.toFixed(1) + '%' : '--';
            }
        }
        
        function updateVolumeChart(volume) {
            const now = new Date().toLocaleTimeString();
            
            if (charts.volume.data.labels.length > 20) {
                charts.volume.data.labels.shift();
                charts.volume.data.datasets[0].data.shift();
            }
            
            charts.volume.data.labels.push(now);
            charts.volume.data.datasets[0].data.push(volume);
            charts.volume.update('none');
        }

        async function updateCharts() {
            try {
                // Ê†πÊçÆÁî®Êà∑ÈÄâÊã©ÁöÑÂ∏ÇÂú∫Âíå‰∫§ÊòìÁä∂ÊÄÅÊõ¥Êñ∞ÂõæË°®
                const market = document.getElementById('market-select')?.value || 'US';
                
                // ÂºÇÊ≠•Êõ¥Êñ∞ÂêÑ‰∏™ÂõæË°®
                await updatePerformanceChart();
                await updateRiskChart();
                await updateTechnicalChart(market);
                await updateCorrelationChart(market);
                
                console.log('üìä ÂõæË°®Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞ (Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÂíå‰∫§ÊòìÁä∂ÊÄÅ)');
                
            } catch (error) {
                console.error('Êõ¥Êñ∞ÂõæË°®Â§±Ë¥•:', error);
                // ÂõûÈÄÄÂà∞ÁÆÄÂçïÁöÑÊ®°ÊãüÊï∞ÊçÆÊõ¥Êñ∞
                updateChartsWithFallback();
            }
        }
        
        async function updatePerformanceChart() {
            if (!charts.performance) return;
            
            try {
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                const data = await response.json();
                
                if (data.strategies && data.strategies.length > 0) {
                    // ‰ΩøÁî®Á∫ØÁúüÂÆûÁ≠ñÁï•Êï∞ÊçÆÔºåÊó†‰∫∫Â∑•ÂèòÂåñ
                    charts.performance.data.datasets[0].data = data.strategies.map(s => {
                        return Math.round((s.daily_return * 100) * 100) / 100;
                    });
                    
                    // Êõ¥Êñ∞Á≠ñÁï•Ê†áÁ≠æ
                    charts.performance.data.labels = data.strategies.map(s => s.name || s.id);
                    charts.performance.update('none');
                    
                    console.log('üìä Á≠ñÁï•Ë°®Áé∞ÂõæË°®Â∑≤Êõ¥Êñ∞ (ÁúüÂÆûÊï∞ÊçÆ):', data.strategies.length);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Á≠ñÁï•Êï∞ÊçÆËé∑ÂèñÂ§±Ë¥•Ôºå‰øùÊåÅÂΩìÂâçÊï∞ÊçÆ:', error);
            }
        }
        
        async function updateRiskChart() {
            if (!charts || !charts.risk) {
                console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®ÂØπË±°Êú™ÂàùÂßãÂåñÔºåË∑≥ËøáÊõ¥Êñ∞');
                return;
            }

            try {
                // Ê£ÄÊü•ÂõæË°®Êï∞ÊçÆÁªìÊûÑ
                if (!charts.risk.data || !charts.risk.data.datasets || !charts.risk.data.datasets[0]) {
                    console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®Êï∞ÊçÆÁªìÊûÑÊú™Â∞±Áª™Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ');
                    // Â∞ùËØïÂàùÂßãÂåñÊï∞ÊçÆÁªìÊûÑ
                    if (charts.risk.data) {
                        charts.risk.data.datasets = [{
                            label: 'È£éÈô©ÊåáÊ†á',
                            data: [50, 40, 60],
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)'
                        }];
                    }
                    return;
                }
                
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†ÂíåËµÑÈáëËÆæÁΩÆ
                const symbolsInput = document.getElementById('target-symbols');
                const capitalInput = document.getElementById('capital');
                
                let symbols = 'AAPL,TSLA,NVDA,MSFT,GOOGL'; // ÈªòËÆ§
                let capital = 100000; // ÈªòËÆ§ËµÑÈáë
                
                if (symbolsInput && symbolsInput.value) {
                    symbols = symbolsInput.value;
                }
                if (capitalInput && capitalInput.value) {
                    capital = parseFloat(capitalInput.value) || 100000;
                }
                
                console.log(`üìä Êõ¥Êñ∞È£éÈô©Èõ∑ËææÂõæË°®: ËµÑÈáë=${capital}, ËÇ°Á•®=${symbols}`);
                
                // Ë∞ÉÁî®ÁúüÂÆûÁöÑÈ£éÈô©Êä•ÂëäÊé•Âè£
                const response = await fetch(`${API_BASE_URL}/dashboard/risk-report?capital=${capital}&market=mixed&risk_level=moderate&symbols=${symbols}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ È£éÈô©Êä•ÂëäÊï∞ÊçÆ:', data);
                
                // ‰ΩøÁî®ÁúüÂÆûÈ£éÈô©ÊåáÊ†áÊï∞ÊçÆ
                if (data && data.risk_metrics) {
                    // ÈáçÊñ∞ËÆ°ÁÆóÂêàÁêÜÁöÑÈ£éÈô©ÊåáÊ†áÂÄº
                    const var95 = Math.abs(data.risk_metrics.var_95 || 0.025) * 100; // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî
                    const maxDrawdown = Math.abs(data.risk_metrics.max_drawdown || 0.05) * 100; // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî
                    const volatility = Math.abs(data.risk_metrics.annualized_volatility || 0.15) * 100; // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî

                    console.log(`üìä ÂéüÂßãÈ£éÈô©Êï∞ÊçÆ: VaR=${data.risk_metrics.var_95}, ÂõûÊí§=${data.risk_metrics.max_drawdown}, Ê≥¢Âä®Áéá=${data.risk_metrics.annualized_volatility}`);

                    // Á°Æ‰øùÊúâÂêàÁêÜÁöÑÊòæÁ§∫ËåÉÂõ¥ (Èõ∑ËææÂõæÈúÄË¶ÅËæÉÂ§ßÁöÑÊï∞ÂÄº)
                    const var95Display = Math.max(var95, 2.5) * 20;        // VaR 95% (ÈÄÇÂ∫¶ÊîæÂ§ß)
                    const maxDrawdownDisplay = Math.max(maxDrawdown, 5.0) * 15; // ÊúÄÂ§ßÂõûÊí§ (ÈÄÇÂ∫¶ÊîæÂ§ß)
                    const volatilityDisplay = Math.max(volatility, 15.0) * 8;   // Ê≥¢Âä®Áéá (ÈÄÇÂ∫¶ÊîæÂ§ß)

                    // ÂÆâÂÖ®Âú∞Êõ¥Êñ∞Èõ∑ËææÂõæÊï∞ÊçÆ
                    const riskData = [var95Display, maxDrawdownDisplay, volatilityDisplay];
                    charts.risk.data.datasets[0].data = riskData;

                    console.log(`‚úÖ È£éÈô©ÊåáÊ†áÊòæÁ§∫: VaR=${var95Display.toFixed(0)}, ÊúÄÂ§ßÂõûÊí§=${maxDrawdownDisplay.toFixed(0)}, Ê≥¢Âä®Áéá=${volatilityDisplay.toFixed(0)}`);
                } else {
                    // FallbackÊï∞ÊçÆ - Èõ∑ËææÂõæÊ†ºÂºè
                    charts.risk.data.datasets[0].data = [50, 40, 60];  // [VaR, ÂõûÊí§, Ê≥¢Âä®Áéá] ËæÉÂ∞èÁöÑÂêàÁêÜÂÄº
                    console.log('‚ÑπÔ∏è È£éÈô©Êï∞ÊçÆÊú™Â∞±Áª™Ôºå‰ΩøÁî®ÈªòËÆ§ÊòæÁ§∫Êï∞ÊçÆ');
                }
                
                charts.risk.update('none');
                console.log('‚úÖ È£éÈô©Èõ∑ËææÂõæË°®Â∑≤Êõ¥Êñ∞');
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞È£éÈô©ÂõæË°®Â§±Ë¥•:', error);
                
                // ÂÆâÂÖ®ÁöÑFallbackÊï∞ÊçÆÊõ¥Êñ∞
                try {
                    if (charts.risk && charts.risk.data && charts.risk.data.datasets && charts.risk.data.datasets[0]) {
                        charts.risk.data.datasets[0].data = [60, 45, 70];  // Èõ∑ËææÂõæÊ†ºÂºè: [VaR, ÂõûÊí§, Ê≥¢Âä®Áéá]
                        charts.risk.update('none');
                        console.log('‚úÖ ‰ΩøÁî®fallbackÈ£éÈô©Èõ∑ËææÊï∞ÊçÆ');
                    }
                } catch (fallbackError) {
                    console.error('‚ùå FallbackÈ£éÈô©Êï∞ÊçÆ‰πüÂ§±Ë¥•:', fallbackError);
                }
            }
        }
        
        async function updateTechnicalChart(market) {
            if (!charts.technical) return;
            
            try {
                const testSymbol = market === 'US' ? 'AAPL' : '000001.SZ';
                const response = await fetch(`${API_BASE_URL}/market-data/stock/${testSymbol}?market=${market}`);
                const data = await response.json();
                
                if (data.price && data.change_percent !== undefined) {
                    // Âü∫‰∫éÁúüÂÆûÊï∞ÊçÆÈáçÊñ∞ËÆ°ÁÆóÊäÄÊúØÊåáÊ†á
                    const price = data.price;
                    const change = data.change_percent;
                    
                    // ‰ΩøÁî®ÁúüÂÆûÊï∞ÊçÆËÆ°ÁÆóÊåáÊ†áÔºå‰ΩÜÊ∑ªÂä†Êó∂Èó¥ÂèòÂåñÊ®°Êãü
                    const timeVariation = Math.sin(Date.now() / 60000) * 5; // Âü∫‰∫éÊó∂Èó¥ÁöÑÂë®ÊúüÊÄßÂèòÂåñ
                    
                    const indicators = [
                        Math.max(0, Math.min(100, 50 + change * 2 + timeVariation)), // RSI
                        Math.max(0, Math.min(100, 50 + change * 3 + timeVariation)), // MACD  
                        Math.max(0, Math.min(100, (price % 100) + timeVariation)),   // Â∏ÉÊûóÂ∏¶
                        Math.max(0, Math.min(100, 60 + (price % 10 - 5) * 4)),      // MA
                        Math.max(0, Math.min(100, Math.log(data.volume / 1000000 + 1) * 20)), // Êàê‰∫§Èáè
                        Math.max(0, Math.min(100, 50 + change * 4 + timeVariation))  // Âä®Èáè
                    ];
                    
                    charts.technical.data.datasets[0].data = indicators;
                    charts.technical.update('none');
                } else {
                    throw new Error('Invalid data for technical analysis');
                }
                
            } catch (error) {
                // ÂõûÈÄÄÂà∞Ê∏êËøõÂºèÊõ¥Êñ∞
                if (charts.technical && charts.technical.data.datasets[0].data.length > 0) {
                    charts.technical.data.datasets[0].data = charts.technical.data.datasets[0].data.map(
                        value => Math.max(0, Math.min(100, value + (Math.random() - 0.5) * 5))
                    );
                    charts.technical.update('none');
                }
            }
        }
        
        async function updateCorrelationChart(market) {
            if (!charts.correlation) return;
            
            try {
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†
                const symbolsInput = document.getElementById('target-symbols');
                let symbols = 'AAPL,TSLA,NVDA,MSFT,GOOGL'; // ÈªòËÆ§ÁæéËÇ°
                
                if (symbolsInput && symbolsInput.value) {
                    symbols = symbolsInput.value;
                } else if (market === 'CN') {
                    symbols = '600519.SS,000858.SZ,600036.SS,000001.SZ';
                } else if (market === 'mixed') {
                    symbols = 'AAPL,TSLA,600519.SS,000858.SZ';
                }
                
                console.log(`üìä Êõ¥Êñ∞Áõ∏ÂÖ≥ÊÄßÂàÜÊûêÂõæË°®: ${symbols}`);
                
                // Ë∞ÉÁî®‰∏ìÈó®ÁöÑÁõ∏ÂÖ≥ÊÄßÂàÜÊûêÊé•Âè£
                const response = await fetch(`${API_BASE_URL}/analysis/correlation?symbols=${symbols}&period=30&market=${market}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ Áõ∏ÂÖ≥ÊÄßÂàÜÊûêÊï∞ÊçÆ:', data);
                
                if (data.scatter_data && data.scatter_data.length > 0) {
                    // Ê∏ÖÁ©∫Áé∞ÊúâÊï∞ÊçÆ
                    charts.correlation.data.datasets[0].data = [];
                    
                    // Ê∑ªÂä†ÁúüÂÆûÁöÑÊï£ÁÇπÊï∞ÊçÆ
                    data.scatter_data.forEach(point => {
                        charts.correlation.data.datasets[0].data.push({
                            x: point.market_return * 100, // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî
                            y: point.strategy_return * 100, // ËΩ¨Êç¢‰∏∫ÁôæÂàÜÊØî
                            r: Math.max(3, Math.min(15, point.volume_factor * 10)) // ÊéßÂà∂Ê∞îÊ≥°Â§ßÂ∞è
                        });
                    });
                    
                    charts.correlation.update('none');
                    console.log(`‚úÖ Áõ∏ÂÖ≥ÊÄßÂõæË°®Â∑≤Êõ¥Êñ∞Ôºå${data.scatter_data.length}‰∏™Êï∞ÊçÆÁÇπ`);
                } else {
                    throw new Error('No scatter data available');
                }
                
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Áõ∏ÂÖ≥ÊÄßÂõæË°®Â§±Ë¥•:', error);
                
                // ÁîüÊàêÂü∫‰∫éÁúüÂÆûÊï∞ÊçÆÁöÑfallbackÊï∞ÊçÆÁÇπ
                try {
                    const symbolsInput = document.getElementById('target-symbols');
                    const symbols = symbolsInput?.value?.split(',') || ['AAPL', 'TSLA', 'NVDA'];
                    
                    charts.correlation.data.datasets[0].data = [];
                    
                    // ‰∏∫ÊØè‰∏™ËÇ°Á•®ÁîüÊàêÂêàÁêÜÁöÑÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆÁÇπ
                    for (let i = 0; i < Math.min(symbols.length, 20); i++) {
                        const baseReturn = (Math.random() - 0.5) * 8; // -4% to +4%
                        charts.correlation.data.datasets[0].data.push({
                            x: baseReturn,
                            y: baseReturn * (0.7 + Math.random() * 0.6) + (Math.random() - 0.5) * 2, // Áõ∏ÂÖ≥‰ΩÜÊúâÂô™Â£∞
                            r: 5 + Math.random() * 10
                        });
                    }
                    
                    charts.correlation.update('none');
                    console.log('‚úÖ ‰ΩøÁî®fallbackÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ');
                } catch (fallbackError) {
                    console.error('‚ùå FallbackÁõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ‰πüÂ§±Ë¥•:', fallbackError);
                }
            }
        }
        
        function updateChartsWithFallback() {
            // Âü∫Êú¨ÁöÑÊ®°ÊãüÊï∞ÊçÆÊõ¥Êñ∞‰Ωú‰∏∫ÂõûÈÄÄÊñπÊ°à
            console.log('‚ö†Ô∏è ‰ΩøÁî®ÂõûÈÄÄÂõæË°®Êõ¥Êñ∞Êú∫Âà∂');
            
            // ÁÆÄÂçïÁöÑÊÄßËÉΩÊï∞ÊçÆÊõ¥Êñ∞
            if (charts.performance?.data?.datasets?.[0]?.data?.length > 0) {
                charts.performance.data.datasets[0].data = charts.performance.data.datasets[0].data.map(val => {
                    const variation = (Math.random() - 0.5) * 0.5;
                    return Math.round((val + variation) * 100) / 100;
                });
                charts.performance.update('none');
            }
            
            // ÁÆÄÂçïÁöÑÊäÄÊúØÊåáÊ†áÊõ¥Êñ∞
            if (charts.technical?.data?.datasets?.[0]?.data?.length > 0) {
                charts.technical.data.datasets[0].data = charts.technical.data.datasets[0].data.map(
                    value => Math.max(0, Math.min(100, value + (Math.random() - 0.5) * 3))
                );
                charts.technical.update('none');
            }
        }
        
        // ==================== ÊâãÂä®Âà∑Êñ∞ÂõæË°®Êï∞ÊçÆ ====================
        async function refreshChartsData() {
            const refreshBtn = document.querySelector('[onclick="refreshChartsData()"]');
            const originalText = refreshBtn.innerHTML;
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            refreshBtn.innerHTML = `[${window.t('loading')}] Âà∑Êñ∞‰∏≠...`;
            refreshBtn.disabled = true;
            refreshBtn.classList.add('opacity-70');
            
            try {
                showToast('üîÑ Ê≠£Âú®Âà∑Êñ∞ÊâÄÊúâÂõæË°®Êï∞ÊçÆ...', 'info');
                
                // ÈáçÊñ∞Âä†ËΩΩÊâÄÊúâÂõæË°®Êï∞ÊçÆ
                await loadInitialChartData();
                
                showToast('‚úÖ ÂõæË°®Êï∞ÊçÆÂ∑≤Âà∑Êñ∞ÂÆåÊàêÔºÅ', 'success');
                
            } catch (error) {
                console.error('Âà∑Êñ∞ÂõæË°®Êï∞ÊçÆÂ§±Ë¥•:', error);
                showToast('‚ùå ÂõæË°®Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
                
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                setTimeout(() => {
                    refreshBtn.innerHTML = originalText;
                    refreshBtn.disabled = false;
                    refreshBtn.classList.remove('opacity-70');
                }, 1000);
            }
        }
        
        function updateChartsWithNewData() {
            // Êõ¥Êñ∞Áõ∏ÂÖ≥ÊÄßÊï∞ÊçÆ
            if (charts.correlation && charts.correlation.data?.datasets?.[0]?.data) {
                const newPoint = {
                    x: (Math.random() - 0.5) * 10,
                    y: (Math.random() - 0.5) * 8
                };
                
                if (charts.correlation.data.datasets[0].data.length >= 20) {
                    charts.correlation.data.datasets[0].data.shift();
                }
                
                charts.correlation.data.datasets[0].data.push(newPoint);
                charts.correlation.update('none');
            }
            
            // Êõ¥Êñ∞ÈáëËûçÊåáÊ†á
            loadAnalyticsPanels();
        }

        // ==================== Ê†áÁ≠æÈ°µÂàáÊç¢ ====================
        function switchTab(tabName, evt) {
            // ÈöêËóèÊâÄÊúâÊ†áÁ≠æÂÜÖÂÆπ
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ÈáçÁΩÆÊâÄÊúâÊåâÈíÆ‰∏∫BloombergÈùûÊ¥ªË∑ÉÊ†∑Âºè
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
                btn.className = 'tab-button px-3 py-2 bg-black text-white border border-white font-mono text-xs hover:bg-white hover:text-black transition-all';
            });
            
            // ÊòæÁ§∫ÈÄâ‰∏≠ÁöÑÊ†áÁ≠æÂÜÖÂÆπ
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // ÊøÄÊ¥ªÂØπÂ∫îÁöÑÊåâÈíÆ - BloombergÊ¥ªË∑ÉÊ†∑Âºè
            const trigger = evt || window.event;
            if (trigger && trigger.target) {
                trigger.target.classList.add('active');
                trigger.target.className = 'tab-button active px-3 py-2 bg-white text-black font-mono text-xs transition-all';
            }
        }

        // ==================== Êï∞ÊçÆÊ∫êÈÖçÁΩÆ ====================
        async function loadConfigStatus() {
            try {
                const response = await fetch(`${API_BASE_URL}/config/data-source`);
                const data = await response.json();
                const message = data.tushare_enabled
                    ? '[OK] <span class="text-green-600">Tushare‰∏ì‰∏öÊï∞ÊçÆÊ∫êÂ∑≤ÂêØÁî®</span>'
                    : '[INFO] <span class="text-blue-600">‰ΩøÁî®AkShare+Êñ∞Êµ™Ë¥¢ÁªèÊï∞ÊçÆÊ∫ê</span>';
                updateConfigStatusDisplays(message);
            } catch (error) {
                console.error('Âä†ËΩΩÈÖçÁΩÆÁä∂ÊÄÅÂ§±Ë¥•:', error);
            }
        }

        async function configureTushare() {
            const tokenInput = document.getElementById('tushare-token-main') || document.getElementById('tushare-token-modal');
            const token = tokenInput ? tokenInput.value : '';
            
            if (!token.trim()) {
                showToast('ËØ∑ËæìÂÖ•Tushare Token', 'warning');
                return;
            }
            
            try {
                updateConfigStatusDisplays('[LOADING] <span class="text-blue-600">ÈÖçÁΩÆ‰∏≠...</span>');
                
                // ‰ΩøÁî®Êñ∞ÁöÑ‰∏ìÈó®TushareÈÖçÁΩÆÁ´ØÁÇπ
                const response = await fetch(`${API_BASE_URL}/config/tushare`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        token: token,
                        test_symbols: ["000001.SZ", "600519.SS", "000858.SZ"]
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.status === 'success') {
                    const successCount = data.test_results ? data.test_results.filter(r => r.status === 'success').length : 0;
                    updateConfigStatusDisplays(`[OK] <span class="text-green-600">TushareÈÖçÁΩÆÊàêÂäüÔºåÊµãËØïÈÄöËøá ${successCount} ‰∏™ËÇ°Á•®</span>`);
                    showToast(`TushareÈÖçÁΩÆÊàêÂäüÔºÅ${data.message}`, 'success');
                    
                    // Ê∏ÖÁ©∫ËæìÂÖ•Ê°Ü
                    if (tokenInput) tokenInput.value = '';
                    
                    // ÊòæÁ§∫ÊµãËØïÁªìÊûú
                    if (data.test_results && data.test_results.length > 0) {
                        console.log('üß™ TushareÊµãËØïÁªìÊûú:', data.test_results);
                    }
                } else {
                    const detail = data.detail || data.message || 'ÈÖçÁΩÆÂ§±Ë¥•';
                    updateConfigStatusDisplays(`[ERROR] <span class="text-red-600">${detail}</span>`);
                    showToast('TushareÈÖçÁΩÆÂ§±Ë¥•: ' + detail, 'error');
                }
            } catch (error) {
                updateConfigStatusDisplays('<i class="fas fa-exclamation-circle text-red-600 mr-1"></i><span class="text-red-600">ÈÖçÁΩÆÂ§±Ë¥•</span>');
                showToast('ÈÖçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
                console.error('‚ùå TushareÈÖçÁΩÆÈîôËØØ:', error);
            }
        }
        
        async function saveTushareConfig() {
            // ‰∏éconfigureTushareÁõ∏ÂêåÔºåÊèê‰æõÂ§áÈÄâÂÖ•Âè£
            await configureTushare();
        }

        // ==================== ÊúçÂä°ÈÖçÁΩÆÁÆ°ÁêÜ ====================
        
        // ÊâßË°åÂÖ®Èù¢ÂÅ•Â∫∑Ê£ÄÊü•
        async function performFullHealthCheck() {
            try {
                showToast('üîÑ Ê≠£Âú®ÊâßË°åÂÖ®Èù¢ÂÅ•Â∫∑Ê£ÄÊü•...', 'info');
                
                // Â∞ùËØï‰ΩøÁî®Â¢ûÂº∫ÂÅ•Â∫∑Ê£ÄÊü•
                let response;
                let result;
                let enhanced = false;
                
                try {
                    response = await fetch(`${API_BASE_URL}/api/services/enhanced-health-check`, {
                        method: 'POST'
                    });
                    result = await response.json();
                    enhanced = result.enhanced || false;
                } catch (enhancedError) {
                    console.warn('‚ö†Ô∏è Â¢ûÂº∫ÂÅ•Â∫∑Ê£ÄÊü•‰∏çÂèØÁî®Ôºå‰ΩøÁî®Ê†áÂáÜÂÅ•Â∫∑Ê£ÄÊü•');
                    // ÂõûÈÄÄÂà∞Ê†áÂáÜÂÅ•Â∫∑Ê£ÄÊü•
                    response = await fetch(`${API_BASE_URL}/api/services/health-check`, {
                        method: 'POST'
                    });
                    result = await response.json();
                }
                
                if (result.status === 'success') {
                    if (enhanced) {
                        // ‰ΩøÁî®Â¢ûÂº∫ÁªìÊûú
                        updateOverallHealth(result.health_percentage);
                        updateEnhancedServicesDisplay(result);
                        showToast(`‚úÖ Â¢ûÂº∫ÂÅ•Â∫∑Ê£ÄÊü•ÂÆåÊàê: ${result.healthy_services}/${result.total_services} ÊúçÂä°Ê≠£Â∏∏ (${result.health_percentage}%)`, 'success');
                    } else {
                        // ‰ΩøÁî®Ê†áÂáÜÁªìÊûú
                        updateOverallHealth(result.overall_health_percentage);
                        updateServicesStatusGrid(result.results);
                        showToast(`‚úÖ ÂÅ•Â∫∑Ê£ÄÊü•ÂÆåÊàê: ${result.healthy_services}/${result.total_services} ÊúçÂä°Ê≠£Â∏∏`, 'success');
                    }
                } else {
                    showToast('‚ùå ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', 'error');
                }
                
            } catch (error) {
                console.error('‚ùå ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•:', error);
                showToast('‚ùå ÂÅ•Â∫∑Ê£ÄÊü•Â§±Ë¥•', 'error');
            }
        }
        
        // Êõ¥Êñ∞Â¢ûÂº∫ÊúçÂä°Áä∂ÊÄÅÊòæÁ§∫
        function updateEnhancedServicesDisplay(results) {
            const gridElement = document.getElementById('services-status-grid');
            if (!gridElement) return;
            
            gridElement.innerHTML = '';
            
            // ÊåâÁ±ªÂà´ÊòæÁ§∫ÊúçÂä°Áä∂ÊÄÅ
            for (const [category, categoryData] of Object.entries(results.categories || {})) {
                // ÂàõÂª∫Á±ªÂà´Ê†áÈ¢ò
                const categoryTitle = document.createElement('div');
                categoryTitle.className = 'col-span-full text-xs font-mono text-white border-b border-white pb-1 mb-2';
                categoryTitle.textContent = `${category.toUpperCase()} (${categoryData.healthy}/${categoryData.total})`;
                gridElement.appendChild(categoryTitle);
                
                // ÊòæÁ§∫ËØ•Á±ªÂà´‰∏ãÁöÑÊúçÂä°
                for (const [serviceName, status] of Object.entries(categoryData.services || {})) {
                    const serviceCard = document.createElement('div');
                    const connected = status.is_healthy;
                    const statusColor = connected ? 'text-green-400' : 'text-red-400';
                    
                    serviceCard.className = 'border border-white p-2 text-center';
                    serviceCard.innerHTML = `
                        <div class="text-xs font-mono text-white">${serviceName.replace('_', ' ').toUpperCase()}</div>
                        <div class="text-xs font-mono ${statusColor}">${connected ? window.t('online') : window.t('error')}</div>
                        ${status.response_time_ms ? `<div class="text-xs font-mono text-gray-400">${Math.round(status.response_time_ms)}ms</div>` : ''}
                        ${status.error_message ? `<div class="text-xs font-mono text-red-400" title="${status.error_message}">!</div>` : ''}
                    `;
                    
                    gridElement.appendChild(serviceCard);
                }
            }
        }
        
        // Êõ¥Êñ∞ÊÄª‰ΩìÂÅ•Â∫∑Áä∂ÊÄÅ
        function updateOverallHealth(percentage) {
            const healthElement = document.getElementById('overall-health');
            if (healthElement) {
                healthElement.textContent = `${percentage}%`;
                if (percentage >= 90) {
                    healthElement.className = 'text-xs font-mono text-green-400';
                } else if (percentage >= 70) {
                    healthElement.className = 'text-xs font-mono text-yellow-400';
                } else {
                    healthElement.className = 'text-xs font-mono text-red-400';
                }
            }
        }
        
        // Êõ¥Êñ∞ÊúçÂä°Áä∂ÊÄÅÁΩëÊ†º
        function updateServicesStatusGrid(results) {
            const gridElement = document.getElementById('services-status-grid');
            if (!gridElement) return;
            
            gridElement.innerHTML = '';
            
            for (const [category, services] of Object.entries(results)) {
                for (const [serviceName, status] of Object.entries(services)) {
                    const serviceCard = document.createElement('div');
                    const connected = status.connected;
                    const statusColor = connected ? 'text-green-400' : 'text-red-400';
                    
                    serviceCard.className = 'border border-white p-2 text-center';
                    serviceCard.innerHTML = `
                        <div class="text-xs font-mono text-white">${serviceName.toUpperCase()}</div>
                        <div class="text-xs font-mono ${statusColor}">${connected ? window.t('online') : window.t('error')}</div>
                        ${status.response_time_ms ? `<div class="text-xs font-mono text-gray-400">${status.response_time_ms}ms</div>` : ''}
                    `;
                    
                    gridElement.appendChild(serviceCard);
                }
            }
        }
        
        // ÊµãËØïÊï∞ÊçÆÊ∫êËøûÊé•
        async function testDataSourceConnection(serviceName) {
            try {
                showToast(`üîÑ Ê≠£Âú®ÊµãËØï ${serviceName} ËøûÊé•...`, 'info');
                
                const response = await fetch(`${API_BASE_URL}/api/services/test-connection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'data_sources',
                        service_name: serviceName
                    })
                });
                
                const result = await response.json();
                
                // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫
                const statusElement = document.getElementById(`${serviceName.replace('_', '-')}-status`);
                if (statusElement) {
                    if (result.connected) {
                        statusElement.textContent = window.t('connected');
                        statusElement.className = 'text-xs font-mono text-green-400';
                        showToast(`‚úÖ ${serviceName} ËøûÊé•ÊàêÂäü`, 'success');
                    } else {
                        statusElement.textContent = window.t('error');
                        statusElement.className = 'text-xs font-mono text-red-400';
                        showToast(`‚ùå ${serviceName} ËøûÊé•Â§±Ë¥•: ${result.error}`, 'error');
                    }
                }
                
            } catch (error) {
                console.error(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•:`, error);
                showToast(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•`, 'error');
            }
        }
        
        // ÊµãËØï‰∫§ÊòìÂπ≥Âè∞ËøûÊé•
        async function testTradingPlatformConnection(serviceName) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/services/test-connection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'trading_platforms',
                        service_name: serviceName
                    })
                });
                
                const result = await response.json();
                updateServiceStatus(serviceName, result.connected, result.error);
                
            } catch (error) {
                console.error(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•:`, error);
                updateServiceStatus(serviceName, false, error.message);
            }
        }
        
        // ÊµãËØïÂä†ÂØÜË¥ßÂ∏Å‰∫§ÊòìÊâÄËøûÊé•
        async function testCryptoExchangeConnection(serviceName) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/services/test-connection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'crypto_exchanges',
                        service_name: serviceName
                    })
                });
                
                const result = await response.json();
                updateServiceStatus(serviceName, result.connected, result.error);
                
            } catch (error) {
                console.error(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•:`, error);
                updateServiceStatus(serviceName, false, error.message);
            }
        }
        
        // ÊµãËØïAIÊúçÂä°ËøûÊé•
        async function testAIServiceConnection(serviceName) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/services/test-connection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'ai_services',
                        service_name: serviceName
                    })
                });
                
                const result = await response.json();
                updateServiceStatus(serviceName, result.connected, result.error);
                
            } catch (error) {
                console.error(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•:`, error);
                updateServiceStatus(serviceName, false, error.message);
            }
        }
        
        // ÊµãËØïÊï∞ÊçÆÂ∫ìËøûÊé•
        async function testDatabaseConnection(serviceName) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/services/test-connection`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'database_services',
                        service_name: serviceName
                    })
                });
                
                const result = await response.json();
                updateServiceStatus(serviceName, result.connected, result.error);
                
            } catch (error) {
                console.error(`‚ùå ÊµãËØï ${serviceName} ËøûÊé•Â§±Ë¥•:`, error);
                updateServiceStatus(serviceName, false, error.message);
            }
        }
        
        // ÈÄöÁî®ÊúçÂä°Áä∂ÊÄÅÊõ¥Êñ∞
        function updateServiceStatus(serviceName, connected, error) {
            const statusElement = document.getElementById(`${serviceName.replace('_', '-')}-status`);
            if (statusElement) {
                if (connected) {
                    statusElement.textContent = window.t('connected');
                    statusElement.className = 'text-xs font-mono text-green-400';
                    showToast(`‚úÖ ${serviceName} ËøûÊé•ÊàêÂäü`, 'success');
                } else {
                    statusElement.textContent = window.t('error');
                    statusElement.className = 'text-xs font-mono text-red-400';
                    showToast(`‚ùå ${serviceName} ËøûÊé•Â§±Ë¥•: ${error || 'Êú™Áü•ÈîôËØØ'}`, 'error');
                }
            }
        }
        
        // ÈÖçÁΩÆ Tushare
        async function configureTushare() {
            try {
                const token = document.getElementById('tushare-service-token').value;
                if (!token) {
                    showToast('ËØ∑ËæìÂÖ• Tushare Token', 'warning');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/services/credentials/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'data_sources',
                        service_name: 'tushare',
                        credentials: { token: token }
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    updateServiceStatus('tushare', true);
                    showToast('‚úÖ Tushare ÈÖçÁΩÆÊàêÂäü', 'success');
                } else {
                    showToast(`‚ùå Tushare ÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Tushare ÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast('‚ùå Tushare ÈÖçÁΩÆÂ§±Ë¥•', 'error');
            }
        }
        
        // ÈÖçÁΩÆ Alpaca
        async function configureAlpaca() {
            try {
                const apiKey = document.getElementById('alpaca-api-key').value;
                const secretKey = document.getElementById('alpaca-secret-key').value;
                
                if (!apiKey || !secretKey) {
                    showToast('ËØ∑ËæìÂÖ• Alpaca API ÂØÜÈí•', 'warning');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/services/credentials/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'trading_platforms',
                        service_name: 'alpaca',
                        credentials: { api_key: apiKey, secret_key: secretKey }
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    updateServiceStatus('alpaca', true);
                    showToast('‚úÖ Alpaca ÈÖçÁΩÆÊàêÂäü', 'success');
                } else {
                    showToast(`‚ùå Alpaca ÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Alpaca ÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast('‚ùå Alpaca ÈÖçÁΩÆÂ§±Ë¥•', 'error');
            }
        }
        
        // ÈÖçÁΩÆ Binance (Êñ∞)
        async function configureBinanceNew() {
            try {
                const apiKey = document.getElementById('binance-api-key-new').value;
                const secretKey = document.getElementById('binance-secret-key-new').value;
                
                if (!apiKey || !secretKey) {
                    showToast('ËØ∑ËæìÂÖ• Binance API ÂØÜÈí•', 'warning');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/services/credentials/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'crypto_exchanges',
                        service_name: 'binance',
                        credentials: { api_key: apiKey, secret_key: secretKey }
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    updateServiceStatus('binance', true);
                    showToast('‚úÖ Binance ÈÖçÁΩÆÊàêÂäü', 'success');
                } else {
                    showToast(`‚ùå Binance ÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå Binance ÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast('‚ùå Binance ÈÖçÁΩÆÂ§±Ë¥•', 'error');
            }
        }
        
        // ÈÖçÁΩÆ OpenAI
        async function configureOpenAI() {
            try {
                const apiKey = document.getElementById('openai-service-key').value;

                if (!apiKey) {
                    showToast('ËØ∑ËæìÂÖ• OpenAI API Key', 'warning');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/services/credentials/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'ai_services',
                        service_name: 'openai',
                        credentials: { api_key: apiKey }
                    })
                });
                
                const result = await response.json();
                if (result.status === 'success') {
                    updateServiceStatus('openai', true);
                    showToast('‚úÖ OpenAI ÈÖçÁΩÆÊàêÂäü', 'success');
                } else {
                    showToast(`‚ùå OpenAI ÈÖçÁΩÆÂ§±Ë¥•: ${result.message}`, 'error');
                }
                
            } catch (error) {
                console.error('‚ùå OpenAI ÈÖçÁΩÆÂ§±Ë¥•:', error);
                showToast('‚ùå OpenAI ÈÖçÁΩÆÂ§±Ë¥•', 'error');
            }
        }

        // ==================== ‰∫§ÊòìÂπ≥Âè∞APIÈÖçÁΩÆ ====================
        
        // BinanceÈÖçÁΩÆÂáΩÊï∞
        async function saveBinanceConfig() {
            const apiKey = document.getElementById('binance-api-key').value.trim();
            const secretKey = document.getElementById('binance-secret-key').value.trim();
            
            if (!apiKey || !secretKey) {
                showToast('ËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑBinance API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/config/trading-platform`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'binance',
                        api_key: apiKey,
                        secret_key: secretKey
                    })
                });

                if (response.ok) {
                    document.getElementById('binance-status').textContent = window.t('configured');
                    document.getElementById('binance-status').className = 'text-yellow-400';
                    showToast('‚úÖ BinanceÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü', 'success');
                } else {
                    throw new Error('ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (error) {
                showToast('‚ùå BinanceÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        async function testBinanceConnection() {
            const apiKey = document.getElementById('binance-api-key').value.trim();
            const secretKey = document.getElementById('binance-secret-key').value.trim();
            
            if (!apiKey || !secretKey) {
                showToast('ËØ∑ÂÖàËæìÂÖ•Binance API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                showToast('üîÑ Ê≠£Âú®ÊµãËØïBinanceËøûÊé•...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/config/trading-platform/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'binance',
                        api_key: apiKey,
                        secret_key: secretKey
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.connected) {
                    document.getElementById('binance-status').textContent = 'CONNECTED';
                    document.getElementById('binance-status').className = 'text-green-400';
                    showToast('‚úÖ BinanceËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                } else {
                    document.getElementById('binance-status').textContent = 'ERROR';
                    document.getElementById('binance-status').className = 'text-red-400';
                    showToast('‚ùå BinanceËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (error) {
                document.getElementById('binance-status').textContent = 'ERROR';
                document.getElementById('binance-status').className = 'text-red-400';
                showToast('‚ùå BinanceÊµãËØïÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // OKXÈÖçÁΩÆÂáΩÊï∞
        async function saveOKXConfig() {
            const apiKey = document.getElementById('okx-api-key').value.trim();
            const secretKey = document.getElementById('okx-secret-key').value.trim();
            const passphrase = document.getElementById('okx-passphrase').value.trim();
            
            if (!apiKey || !secretKey || !passphrase) {
                showToast('ËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑOKX API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/config/trading-platform`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'okx',
                        api_key: apiKey,
                        secret_key: secretKey,
                        passphrase: passphrase
                    })
                });

                if (response.ok) {
                    document.getElementById('okx-status').textContent = window.t('configured');
                    document.getElementById('okx-status').className = 'text-yellow-400';
                    showToast('‚úÖ OKXÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü', 'success');
                } else {
                    throw new Error('ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (error) {
                showToast('‚ùå OKXÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        async function testOKXConnection() {
            const apiKey = document.getElementById('okx-api-key').value.trim();
            const secretKey = document.getElementById('okx-secret-key').value.trim();
            const passphrase = document.getElementById('okx-passphrase').value.trim();
            
            if (!apiKey || !secretKey || !passphrase) {
                showToast('ËØ∑ÂÖàËæìÂÖ•ÂÆåÊï¥ÁöÑOKX API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                showToast('üîÑ Ê≠£Âú®ÊµãËØïOKXËøûÊé•...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/config/trading-platform/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'okx',
                        api_key: apiKey,
                        secret_key: secretKey,
                        passphrase: passphrase
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.connected) {
                    document.getElementById('okx-status').textContent = 'CONNECTED';
                    document.getElementById('okx-status').className = 'text-green-400';
                    showToast('‚úÖ OKXËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                } else {
                    document.getElementById('okx-status').textContent = 'ERROR';
                    document.getElementById('okx-status').className = 'text-red-400';
                    showToast('‚ùå OKXËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (error) {
                document.getElementById('okx-status').textContent = 'ERROR';
                document.getElementById('okx-status').className = 'text-red-400';
                showToast('‚ùå OKXÊµãËØïÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // AlpacaÈÖçÁΩÆÂáΩÊï∞
        async function saveAlpacaConfig() {
            const apiKey = document.getElementById('alpaca-api-key').value.trim();
            const secretKey = document.getElementById('alpaca-secret-key').value.trim();
            const environment = document.getElementById('alpaca-environment').value;
            
            if (!apiKey || !secretKey) {
                showToast('ËØ∑ËæìÂÖ•ÂÆåÊï¥ÁöÑAlpaca API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/config/trading-platform`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'alpaca',
                        api_key: apiKey,
                        secret_key: secretKey,
                        environment: environment
                    })
                });

                if (response.ok) {
                    document.getElementById('alpaca-status').textContent = `CONFIGURED (${environment.toUpperCase()})`;
                    document.getElementById('alpaca-status').className = 'text-yellow-400';
                    showToast('‚úÖ AlpacaÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü', 'success');
                } else {
                    throw new Error('ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•');
                }
            } catch (error) {
                showToast('‚ùå AlpacaÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        async function testAlpacaConnection() {
            const apiKey = document.getElementById('alpaca-api-key').value.trim();
            const secretKey = document.getElementById('alpaca-secret-key').value.trim();
            const environment = document.getElementById('alpaca-environment').value;
            
            if (!apiKey || !secretKey) {
                showToast('ËØ∑ÂÖàËæìÂÖ•Alpaca API‰ø°ÊÅØ', 'error');
                return;
            }

            try {
                showToast('üîÑ Ê≠£Âú®ÊµãËØïAlpacaËøûÊé•...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/config/trading-platform/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        platform: 'alpaca',
                        api_key: apiKey,
                        secret_key: secretKey,
                        environment: environment
                    })
                });

                const data = await response.json();
                
                if (response.ok && data.connected) {
                    document.getElementById('alpaca-status').textContent = `CONNECTED (${environment.toUpperCase()})`;
                    document.getElementById('alpaca-status').className = 'text-green-400';
                    showToast(`‚úÖ Alpaca${environment === 'live' ? 'ÂÆûÁõò' : 'Ê®°Êãü'}ËøûÊé•ÊµãËØïÊàêÂäü`, 'success');
                } else {
                    document.getElementById('alpaca-status').textContent = 'ERROR';
                    document.getElementById('alpaca-status').className = 'text-red-400';
                    showToast('‚ùå AlpacaËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (error) {
                document.getElementById('alpaca-status').textContent = 'ERROR';
                document.getElementById('alpaca-status').className = 'text-red-400';
                showToast('‚ùå AlpacaÊµãËØïÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Âä†ËΩΩÊâÄÊúâÂπ≥Âè∞ÈÖçÁΩÆÁä∂ÊÄÅ
        async function loadTradingPlatformStatus() {
            try {
                console.log('üîÑ Âä†ËΩΩ‰∫§ÊòìÂπ≥Âè∞Áä∂ÊÄÅ...');
                const response = await fetch(`${API_BASE_URL}/config/trading-platforms`);
                if (response.ok) {
                    const platforms = await response.json();
                    console.log('üìä Âπ≥Âè∞ÈÖçÁΩÆÊï∞ÊçÆ:', platforms);
                    
                    // ÈáçÁΩÆÊâÄÊúâÂπ≥Âè∞Áä∂ÊÄÅ‰∏∫Êú™ÈÖçÁΩÆ
                    ['binance', 'okx', 'alpaca'].forEach(platform => {
                        const statusElement = document.getElementById(`${platform}-status`);
                        if (statusElement) {
                            statusElement.textContent = window.t('not-configured');
                            statusElement.className = 'text-gray-400';
                        }
                    });
                    
                    // Êõ¥Êñ∞Â∑≤ÈÖçÁΩÆÂπ≥Âè∞ÁöÑÁä∂ÊÄÅÊòæÁ§∫
                    Object.keys(platforms).forEach(platform => {
                        const statusElement = document.getElementById(`${platform}-status`);
                        if (statusElement && platforms[platform]) {
                            const config = platforms[platform];
                            
                            if (config.test_status === 'ÊµãËØïÊàêÂäü') {
                                statusElement.textContent = window.t('connected');
                                statusElement.className = 'text-green-400';
                            } else if (config.configured) {
                                statusElement.textContent = window.t('configured');
                                statusElement.className = 'text-yellow-400';
                            } else {
                                statusElement.textContent = window.t('error');
                                statusElement.className = 'text-red-400';
                            }
                            
                            console.log(`‚úÖ Êõ¥Êñ∞${platform}Áä∂ÊÄÅ: ${statusElement.textContent}`);
                        }
                    });
                } else {
                    console.warn('‚ö†Ô∏è Ëé∑ÂèñÂπ≥Âè∞Áä∂ÊÄÅÂ§±Ë¥•:', response.status);
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩ‰∫§ÊòìÂπ≥Âè∞Áä∂ÊÄÅ:', error.message);
            }
        }
        
        async function testTushareConnection() {
            try {
                updateConfigStatusDisplays('[TESTING] <span class="text-blue-600">ÊµãËØïTushareËøûÊé•...</span>');
                
                const response = await fetch(`${API_BASE_URL}/config/tushare/test`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                const data = await response.json();
                
                if (response.ok && data.connected) {
                    const successCount = data.test_results ? data.test_results.filter(r => r.status === 'success').length : 0;
                    updateConfigStatusDisplays(`[TEST OK] <span class="text-green-600">TushareËøûÊé•Ê≠£Â∏∏ÔºåÊàêÂäüËé∑Âèñ ${successCount} ‰∏™ËÇ°Á•®Êï∞ÊçÆ</span>`);
                    showToast(`TushareËøûÊé•ÊµãËØïÊàêÂäüÔºÅ${data.message}`, 'success');
                    
                    // ÊòæÁ§∫ËØ¶ÁªÜÊµãËØïÁªìÊûú
                    if (data.test_results) {
                        console.log('üß™ TushareËøûÊé•ÊµãËØïÁªìÊûú:', data.test_results);
                    }
                } else {
                    updateConfigStatusDisplays(`[TEST FAILED] <span class="text-red-600">${data.message || 'TushareËøûÊé•Â§±Ë¥•'}</span>`);
                    showToast('TushareËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + (data.message || 'Êú™Áü•ÈîôËØØ'), 'error');
                }
            } catch (error) {
                updateConfigStatusDisplays('<i class="fas fa-exclamation-circle text-red-600 mr-1"></i><span class="text-red-600">ÊµãËØïÂ§±Ë¥•</span>');
                showToast('ËøûÊé•ÊµãËØïÂ§±Ë¥•: ' + error.message, 'error');
                console.error('‚ùå TushareËøûÊé•ÊµãËØïÈîôËØØ:', error);
            }
        }

        const SERVICE_ENDPOINT_DEFS = [
            { key: 'apiGateway', fieldId: 'service-api-gateway', statusId: 'service-status-api', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'quantEngine', fieldId: 'service-quant-engine', statusId: 'service-status-quant', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'aiAgents', fieldId: 'service-ai-agents', statusId: 'service-status-ai-agents', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'riskManagement', fieldId: 'service-risk-management', statusId: 'service-status-risk-management', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'cryptoConnectors', fieldId: 'service-crypto-connectors', statusId: 'service-status-crypto-connectors', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'backtestingEngine', fieldId: 'service-backtesting-engine', statusId: 'service-status-backtesting-engine', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'iosConnector', fieldId: 'service-ios-connector', statusId: 'service-status-ios-connector', healthPath: '/health', defaultUrl: 'http://localhost:8001' },
            { key: 'portfolioService', fieldId: 'service-portfolio', statusId: 'service-status-portfolio', healthPath: '/health', defaultUrl: 'http://localhost:8001' }
        ];

        function getStoredServiceConfig() {
            try {
                return JSON.parse(localStorage.getItem(SERVICE_CONFIG_STORAGE_KEY)) || {};
            } catch (error) {
                console.warn('Êó†Ê≥ïËß£ÊûêÊúçÂä°ÈÖçÁΩÆ:', error);
                return {};
            }
        }

        function setStoredServiceConfig(config) {
            const sanitized = { ...DEFAULT_SERVICE_CONFIG };
            Object.keys(config || {}).forEach(key => {
                if (sanitized[key] !== undefined) {
                    sanitized[key] = normalizeEndpointUrl(config[key], sanitized[key]);
                }
            });
            localStorage.setItem(SERVICE_CONFIG_STORAGE_KEY, JSON.stringify(sanitized));
        }

        function normalizeEndpointUrl(value, fallback) {
            if (!value) return fallback;
            let sanitized = value.trim();
            if (!sanitized) return fallback;
            if (sanitized.startsWith('//')) {
                sanitized = sanitized.slice(2);
            }
            if (sanitized.startsWith(':')) {
                sanitized = `localhost${sanitized}`;
            }
            if (!/^https?:\/\//i.test(sanitized)) {
                sanitized = `http://${sanitized}`;
            }
            try {
                const normalized = new URL(sanitized);
                return `${normalized.protocol}//${normalized.host}`;
            } catch (error) {
                console.warn('Êó†Ê≥ïËß£ÊûêÊúçÂä°Âú∞ÂùÄ:', value, error);
                return fallback;
            }
        }

        function applyServiceConfig(config) {
            if (!window.__TRADING_ENGINE_CONFIG__) {
                window.__TRADING_ENGINE_CONFIG__ = {};
            }
            SERVICE_ENDPOINT_DEFS.forEach(def => {
                const value = config[def.key];
                if (value) {
                    const normalized = normalizeEndpointUrl(value, def.defaultUrl);
                    config[def.key] = normalized;
                    switch (def.key) {
                        case 'apiGateway':
                            window.__TRADING_ENGINE_CONFIG__.apiBaseUrl = normalized;
                            break;
                        case 'quantEngine':
                            window.__TRADING_ENGINE_CONFIG__.quantEngineUrl = normalized;
                            break;
                        case 'strategyRunner':
                            window.__TRADING_ENGINE_CONFIG__.strategyRunnerUrl = normalized;
                            break;
                        case 'paperTrading':
                            window.__TRADING_ENGINE_CONFIG__.paperTradingUrl = normalized;
                            break;
                        case 'riskEngine':
                            window.__TRADING_ENGINE_CONFIG__.riskEngineUrl = normalized;
                            break;
                        case 'portfolioService':
                            window.__TRADING_ENGINE_CONFIG__.portfolioServiceUrl = normalized;
                            break;
                        default:
                            break;
                    }
                }
            });
            API_BASE_URL = computeApiBaseUrl();
        }

        function getServiceConfigFromInputs() {
            const config = { ...getStoredServiceConfig() };
            SERVICE_ENDPOINT_DEFS.forEach(def => {
                const input = document.getElementById(def.fieldId);
                if (input && input.value.trim()) {
                    config[def.key] = normalizeEndpointUrl(input.value, def.defaultUrl);
                } else {
                    config[def.key] = normalizeEndpointUrl(config[def.key] || def.defaultUrl, def.defaultUrl);
                }
            });
            return config;
        }

        function populateServiceConfigForm() {
            const config = getStoredServiceConfig();
            SERVICE_ENDPOINT_DEFS.forEach(def => {
                const input = document.getElementById(def.fieldId);
                if (input) {
                    input.value = config[def.key] || '';
                }
            });
            updateServiceStatusLabels('UNKNOWN', 'text-gray-400');
        }

        function updateServiceStatusLabels(text, className) {
            const fallback = window.t ? window.t('service-status-unknown') : 'UNKNOWN';
            SERVICE_ENDPOINT_DEFS.forEach(def => {
                const label = document.getElementById(def.statusId);
                if (label) {
                    label.textContent = text || fallback;
                    label.className = className;
                }
            });
        }

        function updateSingleServiceStatus(id, message, colorClass) {
            const label = document.getElementById(id);
            if (label) {
                label.textContent = message || (window.t ? window.t('service-status-unknown') : 'UNKNOWN');
                label.className = colorClass;
            }
        }

        function setServiceConfigStatus(message, type = 'info') {
            const status = document.getElementById('service-config-status');
            if (!status) return;
            const color = type === 'success' ? 'text-green-400' : type === 'error' ? 'text-red-400' : 'text-gray-400';
            status.className = `mt-3 text-xs font-mono ${color}`;
            status.textContent = message;
        }

        function loadServiceConfigForm() {
            const config = getStoredServiceConfig();
            populateServiceConfigForm();
            applyServiceConfig(config);
        }

        function saveServiceConfig() {
            const config = getServiceConfigFromInputs();
            setStoredServiceConfig(config);
            applyServiceConfig(config);
            populateServiceConfigForm();
            setServiceConfigStatus('Service endpoints saved locally', 'success');
            showToast('ÊúçÂä°Á´ØÁÇπÂ∑≤‰øùÂ≠ò', 'success');
            testServiceEndpoints();
        }

        async function testServiceEndpoints() {
            const config = getServiceConfigFromInputs();
            setStoredServiceConfig(config);
            applyServiceConfig(config);
            updateServiceStatusLabels('TESTING...', 'text-yellow-400');
            setServiceConfigStatus('Testing service connectivity...', 'info');

            for (const def of SERVICE_ENDPOINT_DEFS) {
                const baseUrl = normalizeEndpointUrl(config[def.key], def.defaultUrl);
                if (!baseUrl) {
                    updateSingleServiceStatus(def.statusId, 'MISSING', 'text-red-400');
                    continue;
                }
                try {
                    const testUrl = addCacheBuster(`${baseUrl}${def.healthPath}`);
                    console.log(`üîç Testing service ${def.key} at:`, testUrl);
                    const response = await fetch(testUrl);
                    if (response.ok) {
                        updateSingleServiceStatus(def.statusId, window.t('online'), 'text-green-400');
                    } else {
                        updateSingleServiceStatus(def.statusId, `ERR ${response.status}`, 'text-red-400');
                    }
                } catch (error) {
                    console.error(`ÊµãËØïÊúçÂä°Â§±Ë¥• ${def.key}:`, error);
                    updateSingleServiceStatus(def.statusId, window.t('offline'), 'text-red-400');
                }
            }

            setServiceConfigStatus('Service test completed', 'success');
        }

        // ==================== ËÇ°Á•®Ê±†Êõ¥Êñ∞ ====================
        function updateStockPool() {
            const market = document.getElementById('market-select').value;
            const symbolsInput = document.getElementById('target-symbols');
            
            if (market === 'US') {
                symbolsInput.value = 'AAPL,TSLA,NVDA,MSFT,GOOGL,AMZN,META,NFLX';
            } else if (market === 'CN') {
                symbolsInput.value = '600519.SS,000858.SZ,600036.SS,000001.SZ,000002.SZ,600000.SS,000166.SZ,002415.SZ';
            } else {
                symbolsInput.value = 'AAPL,TSLA,NVDA,600519.SS,000858.SZ,MSFT,600036.SS,GOOGL';
            }
            
            updateStockChips();
            updatePoolStats();
            showToast(`Â∑≤ÂàáÊç¢Âà∞${market === 'US' ? 'ÁæéËÇ°' : market === 'CN' ? 'AËÇ°' : 'Ê∑∑Âêà'}Â∏ÇÂú∫ËÇ°Á•®Ê±†`, 'info');
        }
        
        // ==================== ËÇ°Á•®Ê±†ÁªüËÆ°Êõ¥Êñ∞ ====================
        function updatePoolStats() {
            try {
                const symbolsInput = document.getElementById('target-symbols');
                if (!symbolsInput || !symbolsInput.value) {
                    console.log('üìä ËÇ°Á•®Ê±†‰∏∫Á©∫ÔºåË∑≥ËøáÁªüËÆ°Êõ¥Êñ∞');
                    return;
                }
                
                const symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                let usCount = 0;
                let cnCount = 0;
                
                symbols.forEach(symbol => {
                    if (symbol.includes('.SS') || symbol.includes('.SZ') || /^[0-9]{6}/.test(symbol)) {
                        cnCount++;
                    } else {
                        usCount++;
                    }
                });
                
                // Êõ¥Êñ∞ÁªüËÆ°ÊòæÁ§∫
                const totalElement = document.getElementById('total-count');
                const usElement = document.getElementById('us-count');
                const cnElement = document.getElementById('cn-count');
                
                if (totalElement) totalElement.textContent = symbols.length;
                if (usElement) usElement.textContent = usCount;
                if (cnElement) cnElement.textContent = cnCount;
                
                console.log(`üìä ËÇ°Á•®Ê±†ÁªüËÆ°Â∑≤Êõ¥Êñ∞: ÊÄªËÆ° ${symbols.length}, ÁæéËÇ° ${usCount}, AËÇ° ${cnCount}`);
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ËÇ°Á•®Ê±†ÁªüËÆ°Êó∂Âá∫Èîô:', error);
            }
        }
        
        // Á°Æ‰øùÂáΩÊï∞Âú®ÂÖ®Â±Ä‰ΩúÁî®ÂüüÂèØËÆøÈóÆ
        window.updatePoolStats = updatePoolStats;
        window.generateAIRecommendations = generateAIRecommendations;
        window.addRecommendedStock = addRecommendedStock;
        
        // AIÊé®ËçêÂäüËÉΩ
        async function generateAIRecommendations() {
            try {
                console.log('ü§ñ ÂºÄÂßãÁîüÊàêAIÊé®Ëçê...');
                
                // Ëé∑ÂèñÂΩìÂâçÈÖçÁΩÆ
                const marketSelect = document.getElementById('market-select');
                const riskLevel = document.getElementById('risk-level');
                const symbolsInput = document.getElementById('target-symbols');
                
                const market = marketSelect ? marketSelect.value : 'mixed';
                const risk = riskLevel ? riskLevel.value : 'moderate';
                
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†Áî®‰∫éÊéíÈô§
                let excludeSymbols = '';
                if (symbolsInput && symbolsInput.value) {
                    excludeSymbols = symbolsInput.value.split(',').map(s => s.trim()).join(',');
                }
                
                // Ë∞ÉÁî®ÂêéÁ´ØAIÊé®ËçêAPI
                const response = await fetch(`${API_BASE_URL}/ai/stock-recommendations?market=${market}&risk_level=${risk}&count=5&exclude_symbols=${excludeSymbols}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.recommendations) {
                    // Êõ¥Êñ∞AIÊé®ËçêÊòæÁ§∫
                    updateAIRecommendationDisplay(data.recommendations);
                    console.log(`ü§ñ AIÊé®ËçêÁîüÊàêÂÆåÊàêÔºåÂÖ±${data.recommendations.length}Êù°Âª∫ËÆÆ`);
                    
                    // ÊòæÁ§∫Êé®ËçêÁªüËÆ°
                    const aiRecommendationsDiv = document.getElementById('ai-recommendations');
                    if (aiRecommendationsDiv) {
                        // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
                        aiRecommendationsDiv.innerHTML = '';
                        
                        // Ê∑ªÂä†Êé®ËçêËÇ°Á•®Ê†áÁ≠æ
                        data.recommendations.forEach(rec => {
                            const chip = document.createElement('div');
                            chip.className = 'inline-block bg-blue-600 text-white text-xs px-2 py-1 rounded mr-1 mb-1 cursor-pointer hover:bg-blue-700';
                            chip.innerHTML = `
                                <span class="font-mono">${rec.symbol}</span>
                                <span class="ml-1 opacity-75">${rec.action}</span>
                                <span class="ml-1 text-xs">${rec.confidence}%</span>
                            `;
                            
                            // ÁÇπÂáªÊ∑ªÂä†Âà∞ËÇ°Á•®Ê±†
                            chip.addEventListener('click', () => {
                                addRecommendedStock(rec.symbol);
                            });
                            
                            aiRecommendationsDiv.appendChild(chip);
                        });
                        
                        // Ê∑ªÂä†Âà∑Êñ∞ÊåâÈíÆ
                        const refreshBtn = document.createElement('button');
                        refreshBtn.className = 'inline-block bg-gray-600 text-white text-xs px-2 py-1 rounded hover:bg-gray-700';
                        refreshBtn.innerHTML = 'üîÑ';
                        refreshBtn.title = 'Âà∑Êñ∞AIÊé®Ëçê';
                        refreshBtn.addEventListener('click', generateAIRecommendations);
                        aiRecommendationsDiv.appendChild(refreshBtn);
                    }
                } else {
                    throw new Error('Êé®ËçêÊï∞ÊçÆÊ†ºÂºèÈîôËØØ');
                }
                
            } catch (error) {
                console.error('‚ùå AIÊé®ËçêÁîüÊàêÂ§±Ë¥•:', error);
                showToast('AIÊé®ËçêÁîüÊàêÂ§±Ë¥•: ' + error.message, 'error');
                
                // ÊòæÁ§∫ÈîôËØØÁä∂ÊÄÅ
                const aiRecommendationsDiv = document.getElementById('ai-recommendations');
                if (aiRecommendationsDiv) {
                    aiRecommendationsDiv.innerHTML = '<div class="text-red-400 text-xs">Êé®ËçêÁîüÊàêÂ§±Ë¥•</div>';
                }
            }
        }
        
        function addRecommendedStock(symbol) {
            try {
                const symbolsInput = document.getElementById('target-symbols');
                if (!symbolsInput) return;
                
                const currentSymbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                
                if (!currentSymbols.includes(symbol)) {
                    currentSymbols.push(symbol);
                    symbolsInput.value = currentSymbols.join(',');
                    
                    // Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÂíåÁªüËÆ°
                    if (window.updateStockChips) {
                        window.updateStockChips();
                    }
                    if (window.updatePoolStats) {
                        window.updatePoolStats();
                    }
                    
                    showToast(`Â∑≤Ê∑ªÂä† ${symbol} Âà∞ËÇ°Á•®Ê±†`, 'success');
                } else {
                    showToast(`${symbol} Â∑≤Â≠òÂú®‰∫éËÇ°Á•®Ê±†‰∏≠`, 'info');
                }
                
            } catch (error) {
                console.error('‚ùå Ê∑ªÂä†Êé®ËçêËÇ°Á•®Â§±Ë¥•:', error);
                showToast('Ê∑ªÂä†ËÇ°Á•®Â§±Ë¥•', 'error');
            }
        }
        
        function updateAIRecommendationDisplay(recommendations) {
            // ËøôÈáåÂèØ‰ª•Êõ¥Êñ∞È°µÈù¢‰∏äÁöÑAIÊé®ËçêÊòæÁ§∫Âå∫Âüü
            // Â¶ÇÊûúÊúâAIÊé®ËçêÈù¢ÊùøÁöÑËØù
            console.log('ü§ñ AIÊé®ËçêÁªìÊûú:', recommendations);
        }
        
        // Á°Æ‰øùÂáΩÊï∞Âú®ÂÖ®Â±Ä‰ΩúÁî®ÂüüÂèØËÆøÈóÆ
        window.generateAIRecommendations = generateAIRecommendations;
        
        // ==================== ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ ====================
        let searchTimeout = null;
        
        // ÂÖ®Â±ÄËÇ°Á•®Êï∞ÊçÆÂ∫ì - Êâ©ÂÖÖÁâàÊú¨
        window.stockDatabase = {
            // =========================== ÁæéËÇ° ===========================
            // Â§ßÂûãÁßëÊäÄËÇ° (Large Cap Tech)
            'AAPL': { name: 'Apple Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 185.25, change: 1.2 },
            'MSFT': { name: 'Microsoft Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 415.80, change: 0.5 },
            'GOOGL': { name: 'Alphabet Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 2650.75, change: 1.8 },
            'AMZN': { name: 'Amazon Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 3245.50, change: 2.3 },
            'TSLA': { name: 'Tesla Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 248.50, change: -0.8 },
            'META': { name: 'Meta Platforms', sector: 'tech', market: 'US', marketCap: 'Large', price: 485.30, change: 1.5 },
            'NVDA': { name: 'NVIDIA Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 875.30, change: 2.1 },
            'NFLX': { name: 'Netflix Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 445.20, change: -0.3 },
            'CRM': { name: 'Salesforce Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 255.40, change: 0.9 },
            'ORCL': { name: 'Oracle Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 125.30, change: 1.1 },
            'ADBE': { name: 'Adobe Inc', sector: 'tech', market: 'US', marketCap: 'Large', price: 545.80, change: 0.7 },
            'INTC': { name: 'Intel Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 45.65, change: -1.2 },
            'CSCO': { name: 'Cisco Systems', sector: 'tech', market: 'US', marketCap: 'Large', price: 55.20, change: 0.4 },
            'IBM': { name: 'IBM Corp', sector: 'tech', market: 'US', marketCap: 'Large', price: 165.85, change: -0.3 },
            
            // ‰∏≠ÂûãÁßëÊäÄËÇ° (Mid Cap Tech)
            'PLTR': { name: 'Palantir Technologies', sector: 'tech', market: 'US', marketCap: 'Mid', price: 18.45, change: 3.2 },
            'SNOW': { name: 'Snowflake Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 185.60, change: 2.1 },
            'ZM': { name: 'Zoom Video', sector: 'tech', market: 'US', marketCap: 'Mid', price: 68.90, change: -0.8 },
            'TWLO': { name: 'Twilio Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 62.35, change: 1.5 },
            'OKTA': { name: 'Okta Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 78.20, change: 0.9 },
            'DDOG': { name: 'Datadog Inc', sector: 'tech', market: 'US', marketCap: 'Mid', price: 115.40, change: 2.3 },
            
            // Â∞èÂûãÁßëÊäÄËÇ° (Small Cap Tech)
            'SMAR': { name: 'Smartsheet Inc', sector: 'tech', market: 'US', marketCap: 'Small', price: 42.80, change: 1.8 },
            'FROG': { name: 'JFrog Ltd', sector: 'tech', market: 'US', marketCap: 'Small', price: 28.55, change: 0.6 },
            'PLAN': { name: 'Anaplan Inc', sector: 'tech', market: 'US', marketCap: 'Small', price: 65.20, change: -0.4 },
            
            // ÈáëËûçËÇ° (Financial)
            'JPM': { name: 'JPMorgan Chase', sector: 'finance', market: 'US', marketCap: 'Large', price: 165.45, change: 0.3 },
            'BAC': { name: 'Bank of America', sector: 'finance', market: 'US', marketCap: 'Large', price: 34.12, change: -0.2 },
            'WFC': { name: 'Wells Fargo', sector: 'finance', market: 'US', marketCap: 'Large', price: 45.80, change: 0.8 },
            'GS': { name: 'Goldman Sachs', sector: 'finance', market: 'US', marketCap: 'Large', price: 385.60, change: 1.1 },
            'C': { name: 'Citigroup Inc', sector: 'finance', market: 'US', marketCap: 'Large', price: 52.35, change: 0.5 },
            'MS': { name: 'Morgan Stanley', sector: 'finance', market: 'US', marketCap: 'Large', price: 95.40, change: 0.7 },
            'AXP': { name: 'American Express', sector: 'finance', market: 'US', marketCap: 'Large', price: 185.25, change: 1.0 },
            'BRK.B': { name: 'Berkshire Hathaway', sector: 'finance', market: 'US', marketCap: 'Large', price: 445.80, change: 0.4 },
            
            // ËÉΩÊ∫êËÇ° (Energy)
            'XOM': { name: 'Exxon Mobil', sector: 'energy', market: 'US', marketCap: 'Large', price: 108.25, change: 1.5 },
            'CVX': { name: 'Chevron Corp', sector: 'energy', market: 'US', marketCap: 'Large', price: 155.30, change: 2.1 },
            'COP': { name: 'ConocoPhillips', sector: 'energy', market: 'US', marketCap: 'Large', price: 125.40, change: 1.8 },
            'SLB': { name: 'Schlumberger', sector: 'energy', market: 'US', marketCap: 'Large', price: 58.65, change: 2.2 },
            'OXY': { name: 'Occidental Petroleum', sector: 'energy', market: 'US', marketCap: 'Mid', price: 65.45, change: 3.1 },
            'EOG': { name: 'EOG Resources', sector: 'energy', market: 'US', marketCap: 'Mid', price: 135.20, change: 2.5 },
            
            // ÂåªÁñóËÇ° (Healthcare)
            'JNJ': { name: 'Johnson & Johnson', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 165.80, change: 0.6 },
            'UNH': { name: 'UnitedHealth Group', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 545.25, change: 1.2 },
            'PFE': { name: 'Pfizer Inc', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 28.95, change: -0.8 },
            'ABBV': { name: 'AbbVie Inc', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 175.40, change: 0.9 },
            'TMO': { name: 'Thermo Fisher Scientific', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 565.30, change: 1.5 },
            'DHR': { name: 'Danaher Corp', sector: 'healthcare', market: 'US', marketCap: 'Large', price: 265.85, change: 0.8 },
            
            // Ê∂àË¥πËÇ° (Consumer)
            'KO': { name: 'Coca-Cola Company', sector: 'consumer', market: 'US', marketCap: 'Large', price: 58.45, change: 0.4 },
            'PEP': { name: 'PepsiCo Inc', sector: 'consumer', market: 'US', marketCap: 'Large', price: 185.60, change: 0.7 },
            'WMT': { name: 'Walmart Inc', sector: 'consumer', market: 'US', marketCap: 'Large', price: 165.25, change: 0.9 },
            'TGT': { name: 'Target Corp', sector: 'consumer', market: 'US', marketCap: 'Large', price: 145.80, change: 1.2 },
            'HD': { name: 'Home Depot', sector: 'consumer', market: 'US', marketCap: 'Large', price: 345.60, change: 0.8 },
            'LOW': { name: 'Lowes Companies', sector: 'consumer', market: 'US', marketCap: 'Large', price: 245.35, change: 1.1 },
            
            // Â∑•‰∏öËÇ° (Industrial)
            'BA': { name: 'Boeing Company', sector: 'industrial', market: 'US', marketCap: 'Large', price: 225.40, change: 2.1 },
            'GE': { name: 'General Electric', sector: 'industrial', market: 'US', marketCap: 'Large', price: 125.85, change: 1.8 },
            'CAT': { name: 'Caterpillar Inc', sector: 'industrial', market: 'US', marketCap: 'Large', price: 285.60, change: 1.5 },
            'MMM': { name: '3M Company', sector: 'industrial', market: 'US', marketCap: 'Large', price: 98.45, change: -0.3 },
            'HON': { name: 'Honeywell International', sector: 'industrial', market: 'US', marketCap: 'Large', price: 215.30, change: 0.9 },
            
            // =========================== AËÇ° ===========================
            // Â§ßÂûãËÇ°Á•®
            '600519.SS': { name: 'Ë¥µÂ∑ûËåÖÂè∞', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 1650.00, change: 0.8 },
            '000858.SZ': { name: '‰∫îÁ≤ÆÊ∂≤', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 165.50, change: -0.5 },
            '000001.SZ': { name: 'Âπ≥ÂÆâÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 18.50, change: -0.1 },
            '600036.SS': { name: 'ÊãõÂïÜÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 45.20, change: 0.3 },
            '600000.SS': { name: 'Êµ¶ÂèëÈì∂Ë°å', sector: 'finance', market: 'CN', marketCap: 'Large', price: 11.25, change: 0.2 },
            '000002.SZ': { name: '‰∏áÁßëA', sector: 'real_estate', market: 'CN', marketCap: 'Large', price: 12.30, change: 1.2 },
            '600030.SS': { name: '‰∏≠‰ø°ËØÅÂà∏', sector: 'finance', market: 'CN', marketCap: 'Large', price: 24.85, change: 0.6 },
            '000166.SZ': { name: 'Áî≥‰∏áÂÆèÊ∫ê', sector: 'real_estate', market: 'CN', marketCap: 'Large', price: 14.60, change: 2.1 },
            
            // ÁßëÊäÄËÇ°
            '002415.SZ': { name: 'Êµ∑Â∫∑Â®ÅËßÜ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 58.80, change: 2.5 },
            '300750.SZ': { name: 'ÂÆÅÂæ∑Êó∂‰ª£', sector: 'tech', market: 'CN', marketCap: 'Large', price: 185.60, change: 3.2 },
            '002594.SZ': { name: 'ÊØî‰∫öËø™', sector: 'tech', market: 'CN', marketCap: 'Large', price: 285.40, change: 1.8 },
            '600570.SS': { name: 'ÊÅíÁîüÁîµÂ≠ê', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 45.30, change: 2.3 },
            '002230.SZ': { name: 'ÁßëÂ§ßËÆØÈ£û', sector: 'tech', market: 'CN', marketCap: 'Large', price: 48.65, change: 1.9 },
            '000063.SZ': { name: '‰∏≠ÂÖ¥ÈÄöËÆØ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 28.75, change: 0.8 },
            '002241.SZ': { name: 'Ê≠åÂ∞îËÇ°‰ªΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 25.40, change: 1.5 },
            
            // Êñ∞ËÉΩÊ∫êËΩ¶
            '002812.SZ': { name: 'ÊÅ©Êç∑ËÇ°‰ªΩ', sector: 'automotive', market: 'CN', marketCap: 'Mid', price: 148.60, change: 4.2 },
            '300014.SZ': { name: '‰∫øÁ∫¨ÈîÇËÉΩ', sector: 'tech', market: 'CN', marketCap: 'Large', price: 78.25, change: 2.8 },
            '002129.SZ': { name: '‰∏≠ÁéØËÇ°‰ªΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 15.80, change: 1.2 },
            '688599.SH': { name: 'Â§©ÂêàÂÖâËÉΩ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 25.90, change: 3.5 },
            
            // ÂåªËçØËÇ°
            '000661.SZ': { name: 'ÈïøÊò•È´òÊñ∞', sector: 'healthcare', market: 'CN', marketCap: 'Large', price: 385.20, change: 1.4 },
            '300015.SZ': { name: 'Áà±Â∞îÁúºÁßë', sector: 'healthcare', market: 'CN', marketCap: 'Mid', price: 48.75, change: 0.9 },
            '002007.SZ': { name: 'ÂçéÂÖ∞ÁîüÁâ©', sector: 'healthcare', market: 'CN', marketCap: 'Mid', price: 35.60, change: 2.1 },
            '600276.SS': { name: 'ÊÅíÁëûÂåªËçØ', sector: 'healthcare', market: 'CN', marketCap: 'Large', price: 58.40, change: 0.8 },
            
            // Ê∂àË¥πËÇ°
            '002304.SZ': { name: 'Ê¥ãÊ≤≥ËÇ°‰ªΩ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 125.85, change: 1.1 },
            '000568.SZ': { name: 'Ê≥∏Â∑ûËÄÅÁ™ñ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 245.60, change: 0.7 },
            '600887.SS': { name: '‰ºäÂà©ËÇ°‰ªΩ', sector: 'consumer', market: 'CN', marketCap: 'Large', price: 28.45, change: 0.5 },
            '000596.SZ': { name: 'Âè§‰∫ïË¥°ÈÖí', sector: 'consumer', market: 'CN', marketCap: 'Mid', price: 285.30, change: 1.8 },
            
            // ‰∏≠ÂûãËÇ°Á•®
            '300274.SZ': { name: 'Èò≥ÂÖâÁîµÊ∫ê', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 85.40, change: 2.2 },
            '002938.SZ': { name: 'ÈπÖÊØõÂÆ∂Á∫∫', sector: 'consumer', market: 'CN', marketCap: 'Mid', price: 45.25, change: 1.6 },
            '300692.SZ': { name: '‰∏≠ÁéØÁéØ‰øù', sector: 'environmental', market: 'CN', marketCap: 'Mid', price: 15.80, change: 0.9 },
            '688981.SH': { name: '‰∏≠ËäØÂõΩÈôÖ', sector: 'tech', market: 'CN', marketCap: 'Mid', price: 68.90, change: 3.1 },
            
            // Â∞èÂûãËÇ°Á•®
            '300888.SZ': { name: 'Á®≥ÂÅ•ÂåªÁñó', sector: 'healthcare', market: 'CN', marketCap: 'Small', price: 58.75, change: 2.8 },
            '688065.SH': { name: 'ÂáØËµõÁîüÁâ©', sector: 'healthcare', market: 'CN', marketCap: 'Small', price: 125.40, change: 4.5 },
            '300896.SZ': { name: 'Áà±ÁæéÂÆ¢', sector: 'consumer', market: 'CN', marketCap: 'Small', price: 185.60, change: 1.9 },
            
            // =========================== Ê∏ØËÇ° ===========================
            '0700.HK': { name: 'ËÖæËÆØÊéßËÇ°', sector: 'tech', market: 'HK', marketCap: 'Large', price: 385.40, change: 1.2 },
            '9988.HK': { name: 'ÈòøÈáåÂ∑¥Â∑¥-SW', sector: 'tech', market: 'HK', marketCap: 'Large', price: 78.50, change: 0.8 },
            '1024.HK': { name: 'Âø´Êâã-W', sector: 'tech', market: 'HK', marketCap: 'Large', price: 52.30, change: 2.1 },
            '3690.HK': { name: 'ÁæéÂõ¢-W', sector: 'tech', market: 'HK', marketCap: 'Large', price: 68.75, change: -0.5 },
            '2318.HK': { name: '‰∏≠ÂõΩÂπ≥ÂÆâ', sector: 'finance', market: 'HK', marketCap: 'Large', price: 45.85, change: 0.3 },
            '0941.HK': { name: '‰∏≠ÂõΩÁßªÂä®', sector: 'telecom', market: 'HK', marketCap: 'Large', price: 58.20, change: 0.6 },
            '1398.HK': { name: 'Â∑•ÂïÜÈì∂Ë°å', sector: 'finance', market: 'HK', marketCap: 'Large', price: 4.85, change: 0.2 },
            
            // =========================== Êó•ËÇ° ===========================
            '7203.T': { name: 'Toyota Motor Corp', sector: 'automotive', market: 'JP', marketCap: 'Large', price: 2850.50, change: 0.8 },
            '6758.T': { name: 'Sony Group Corp', sector: 'tech', market: 'JP', marketCap: 'Large', price: 12450.00, change: 1.5 },
            '9984.T': { name: 'SoftBank Group', sector: 'tech', market: 'JP', marketCap: 'Large', price: 5890.00, change: 2.1 },
            '8306.T': { name: 'Mitsubishi UFJ Financial', sector: 'finance', market: 'JP', marketCap: 'Large', price: 885.50, change: 0.4 }
        };
        
        // ================ ÂÖ®Â±ÄÂáΩÊï∞ÂÆö‰πâÂå∫Âüü ================
        // Èò≤Ê≠¢ÈáçÂ§çÂàùÂßãÂåñ
        window.searchInitialized = false;
        
        // ÊµãËØïÊêúÁ¥¢ÂáΩÊï∞ - ÈúÄË¶ÅÂú®È°µÈù¢Êó©ÊúüÂÆö‰πâ
        window.testSearch = function(query) {
            console.log('üß™ ÊâãÂä®ÊµãËØïÊêúÁ¥¢:', query);
            const searchInput = document.getElementById('stock-search');
            const dropdown = document.getElementById('search-dropdown');
            
            if (searchInput && dropdown) {
                searchInput.value = query;
                
                // Áõ¥Êé•Ë∞ÉÁî®handleSearch
                if (window.handleSearch) {
                    window.handleSearch(query, 'test-button');
                } else {
                    console.error('‚ùå handleSearch ÂáΩÊï∞‰∏çÂ≠òÂú®');
                }
            } else {
                console.error('‚ùå ÊêúÁ¥¢ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
            }
        };
        
        // ÂÆûÊó∂ÊêúÁ¥¢ÊµãËØïÂáΩÊï∞
        window.testSearchNow = function() {
            console.log('üß™ ÂÆûÊó∂ÊêúÁ¥¢ÊµãËØï...');
            const searchInput = document.getElementById('stock-search');
            const dropdown = document.getElementById('search-dropdown');
            
            if (!searchInput || !dropdown) {
                console.error('‚ùå ÊêúÁ¥¢ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            const currentValue = searchInput.value;
            console.log('üìù ÂΩìÂâçÊêúÁ¥¢ÂÄº:', JSON.stringify(currentValue));
            
            if (currentValue && currentValue.length > 0) {
                console.log('üîÑ Ëß¶ÂèëÊâãÂä®ÊêúÁ¥¢...');
                window.handleSearch(currentValue, 'manual-test');
            } else {
                console.log('‚ö†Ô∏è ÊêúÁ¥¢Ê°Ü‰∏∫Á©∫ÔºåËÆæÁΩÆÊµãËØïÂÄºÂπ∂ÊêúÁ¥¢');
                searchInput.value = 'n';
                window.handleSearch('n', 'manual-test');
            }
        };
        
        // Âº∫Âà∂ÊòæÁ§∫‰∏ãÊãâÊ°ÜÁî®‰∫éË∞ÉËØï
        window.forceShowDropdown = function() {
            console.log('üîß Âº∫Âà∂ÊòæÁ§∫‰∏ãÊãâÊ°Ü');
            const dropdown = document.getElementById('search-dropdown');
            
            if (dropdown) {
                dropdown.innerHTML = `
                    <div class="p-3 text-xs font-mono text-white bg-black border-b border-gray-600">
                        üß™ FORCE SHOW TEST
                    </div>
                    <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600">
                        <div class="stock-result-symbol">AAPL <span class="text-xs bg-gray-600 px-1 rounded ml-1">US</span></div>
                        <div class="stock-result-name">Apple Inc</div>
                        <div class="stock-result-info">
                            <div class="flex gap-1">
                                <span class="text-xs bg-purple-600 px-1 rounded">Large</span>
                                <span class="text-xs bg-orange-600 px-1 rounded">TECH</span>
                            </div>
                            <div class="text-right">
                                <div class="font-mono text-xs">$185.25</div>
                                <div class="font-mono text-xs text-green-400">+1.20%</div>
                            </div>
                        </div>
                    </div>
                `;
                
                dropdown.classList.remove('hidden');
                dropdown.style.display = 'block';
                dropdown.style.visibility = 'visible';
                dropdown.style.opacity = '1';
                console.log('‚úÖ Âº∫Âà∂ÊòæÁ§∫ÂÆåÊàê');
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞‰∏ãÊãâÊ°ÜÂÖÉÁ¥†');
            }
        };
        
        // ==================== Áªü‰∏ÄÊêúÁ¥¢ÊúçÂä°ÂáΩÊï∞ ====================
        
        // Áªü‰∏ÄË°å‰∏öÊêúÁ¥¢ÂáΩÊï∞ - Êï¥ÂêàÂ§ö‰∏™Êï∞ÊçÆÊ∫ê
        window.unifiedSectorSearch = async function(sector) {
            console.log('üîç Áªü‰∏ÄË°å‰∏öÊêúÁ¥¢:', sector);
            
            // Êõ¥Êñ∞ÊêúÁ¥¢Áä∂ÊÄÅ  
            updateSearchStatus('search-status-searching');
            
            const sectorMappings = {
                'tech': {
                    'us': ['AAPL', 'GOOGL', 'MSFT', 'NVDA', 'META', 'TSLA', 'NFLX', 'AMZN'],
                    'cn': ['600519', '000858', '300750', '002594', '601012', '300059', '000002', '002415'],
                    'crypto': ['BTC', 'ETH', 'BNB', 'ADA', 'SOL']
                },
                'finance': {
                    'us': ['JPM', 'BAC', 'WFC', 'GS', 'MS', 'C', 'USB', 'PNC'],
                    'cn': ['600036', '601398', '601288', '000001', '600000', '601166', '601328', '600015'],
                    'crypto': ['USDT', 'USDC', 'BUSD', 'DAI']
                },
                'healthcare': {
                    'us': ['JNJ', 'PFE', 'UNH', 'ABBV', 'TMO', 'DHR', 'BMY', 'MRK'],
                    'cn': ['300015', '000661', '002007', '600276', '600867', '000538', '002252', '002821'],
                    'crypto': []
                },
                'energy': {
                    'us': ['XOM', 'CVX', 'COP', 'EOG', 'SLB', 'PSX', 'VLO', 'MPC'],
                    'cn': ['600028', '601857', '600309', '002493', '600188', '000983', '600989', '600256'],
                    'crypto': []
                }
            };
            
            const sectorNames = {
                'tech': 'ÁßëÊäÄ', 'finance': 'ÈáëËûç', 'healthcare': 'ÂåªÁñó', 'energy': 'ËÉΩÊ∫ê'
            };
            
            try {
                // Ê†πÊçÆÁõÆÊ†áÂ∏ÇÂú∫ÈÄâÊã©ËÇ°Á•®
                const selectedMarket = getSelectedMarket();
                let symbols = [];
                
                if (selectedMarket === 'ALL') {
                    // Â¶ÇÊûúÈÄâÊã©ÂÖ®ÈÉ®Â∏ÇÂú∫ÔºåÊØè‰∏™Â∏ÇÂú∫ÈÄâÊã©Ââç4Âè™
                    symbols = [
                        ...sectorMappings[sector]['us'].slice(0, 4),
                        ...sectorMappings[sector]['cn'].slice(0, 4),
                        ...sectorMappings[sector]['crypto'].slice(0, 2)
                    ];
                } else if (selectedMarket === 'US') {
                    symbols = sectorMappings[sector]['us'];
                } else if (selectedMarket === 'CN') {
                    symbols = sectorMappings[sector]['cn'];
                } else if (selectedMarket === 'CRYPTO') {
                    symbols = sectorMappings[sector]['crypto'];
                }
                
                // ‰ΩøÁî®APIÊêúÁ¥¢È™åËØÅËÇ°Á•®
                await performAdvancedSearch({
                    sector: sectorNames[sector],
                    market: selectedMarket,
                    max_results: symbols.length
                });
                
                // ÊâπÈáèÊ∑ªÂä†Âà∞ÈÄâ‰∏≠ÂàóË°®
                addStocksToSelection(symbols);
                
                updateSearchStatus('search-status-completed');
                console.log(`‚úÖ ${sectorNames[sector]}Ë°å‰∏öÊêúÁ¥¢ÂÆåÊàê: ${symbols.length}Âè™ËÇ°Á•®`);
                
            } catch (error) {
                console.error('‚ùå Áªü‰∏ÄË°å‰∏öÊêúÁ¥¢Â§±Ë¥•:', error);
                updateSearchStatus('search-status-failed');
            }
        };
        
        // Ëé∑ÂèñÈöèÊú∫ËÇ°Á•®
        window.getRandomStocks = async function(count) {
            console.log(`üé≤ Ëé∑ÂèñÈöèÊú∫${count}Âè™ËÇ°Á•®`);
            updateSearchStatus('search-status-random-selecting');
            
            try {
                // ‰ΩøÁî®ÊêúÁ¥¢APIËé∑ÂèñË∂ãÂäøËÇ°Á•®
                const selectedMarket = getSelectedMarket();
                const response = await fetch(`/market-data/trending/${selectedMarket}?limit=${count}`);
                
                if (response.ok) {
                    const data = await response.json();
                    const symbols = data.trending_stocks?.map(stock => stock.symbol) || [];
                    
                    if (symbols.length > 0) {
                        addStocksToSelection(symbols);
                        updateSearchStatus('search-status-completed');
                    } else {
                        // fallback to predefined stocks
                        const fallbackStocks = generateFallbackStocks(count);
                        addStocksToSelection(fallbackStocks);
                        updateSearchStatus('search-status-using-preset');
                    }
                } else {
                    throw new Error('APIËØ∑Ê±ÇÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('‚ùå ÈöèÊú∫ÈÄâËÇ°Â§±Ë¥•:', error);
                const fallbackStocks = generateFallbackStocks(count);
                addStocksToSelection(fallbackStocks);
                updateSearchStatus('search-status-using-local');
            }
        };
        
        // Ëé∑ÂèñÁÉ≠Èó®ËÇ°Á•®
        window.getTopStocks = async function() {
            console.log('üî• Ëé∑ÂèñÁÉ≠Èó®ËÇ°Á•®');
            updateSearchStatus('search-status-getting-hot');
            
            try {
                const selectedMarket = getSelectedMarket();
                const response = await fetch(`/market-data/trending/${selectedMarket}?limit=20`);
                
                if (response.ok) {
                    const data = await response.json();
                    const symbols = data.trending_stocks?.map(stock => stock.symbol) || [];
                    
                    if (symbols.length > 0) {
                        addStocksToSelection(symbols);
                        updateSearchStatus('search-status-completed');
                    }
                } else {
                    throw new Error('APIËØ∑Ê±ÇÂ§±Ë¥•');
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñÁÉ≠Èó®ËÇ°Â§±Ë¥•:', error);
                updateSearchStatus('search-status-failed');
            }
        };
        
        // Ê£ÄÊü•ÊâÄÊúâÊï∞ÊçÆÊ∫êÁä∂ÊÄÅ
        window.checkAllDataSources = async function() {
            console.log('üîç Ê£ÄÊü•ÊâÄÊúâÊï∞ÊçÆÊ∫êÁä∂ÊÄÅ');
            updateSearchStatus('checking-sources', 'Ê£ÄÊü•Êï∞ÊçÆÊ∫ê...');
            
            try {
                const response = await fetch('/config/trading-platforms');
                
                if (response.ok) {
                    const platforms = await response.json();
                    const platformCount = Object.keys(platforms).length;
                    const configuredCount = Object.values(platforms).filter(p => p.configured).length;
                    
                    updateSearchStatus('sources-ready', `${configuredCount}/${platformCount}Ê∫êÂ∞±Áª™`);
                    
                    // ÊòæÁ§∫ËØ¶ÁªÜÁä∂ÊÄÅ
                    console.log('üìä Êï∞ÊçÆÊ∫êÁä∂ÊÄÅ:', platforms);
                } else {
                    updateSearchStatus('check-failed', 'Áä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•');
                }
            } catch (error) {
                console.error('‚ùå Êï∞ÊçÆÊ∫êÁä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', error);
                updateSearchStatus('check-failed', 'Ê£ÄÊü•Â§±Ë¥•');
            }
        };
        
        // Âà∑Êñ∞ÊêúÁ¥¢ÁºìÂ≠ò
        window.refreshSearchCache = function() {
            console.log('üîÑ Âà∑Êñ∞ÊêúÁ¥¢ÁºìÂ≠ò');
            updateSearchStatus('refreshing', 'Âà∑Êñ∞‰∏≠...');
            
            // Ê∏ÖÈô§Êú¨Âú∞ÁºìÂ≠ò
            if (typeof(Storage) !== "undefined") {
                const keys = Object.keys(localStorage);
                keys.forEach(key => {
                    if (key.startsWith('search_') || key.startsWith('stock_')) {
                        localStorage.removeItem(key);
                    }
                });
            }
            
            setTimeout(() => {
                updateSearchStatus('cache-cleared', 'ÁºìÂ≠òÂ∑≤Ê∏ÖÈô§');
            }, 1000);
        };
        
        // ËæÖÂä©ÂáΩÊï∞ - ‰ΩøÁî®ÂõΩÈôÖÂåñÁä∂ÊÄÅÊõ¥Êñ∞
        function updateSearchStatus(statusKey, fallbackText) {
            const statusElement = document.getElementById('search-status');
            if (statusElement) {
                // Â∞ùËØï‰ΩøÁî®ÂõΩÈôÖÂåñÈîÆÂÄºÔºåÂ¶ÇÊûú‰∏çÂ≠òÂú®Âàô‰ΩøÁî®fallbackÊàñÁõ¥Êé•ÊñáÊú¨
                const translatedText = statusKey ? window.t(statusKey) : fallbackText;
                statusElement.textContent = translatedText || fallbackText || statusKey;
            }
        }
        
        function getSelectedMarket() {
            const marketSelect = document.getElementById('target-market-select');
            return marketSelect ? marketSelect.value : 'ALL';
        }
        
        function addStocksToSelection(symbols) {
            symbols.forEach(symbol => {
                if (symbol && symbol.trim()) {
                    selectStock(symbol.trim(), symbol.trim());
                }
            });
        }
        
        function generateFallbackStocks(count) {
            const stockPool = [
                'AAPL', 'GOOGL', 'MSFT', 'NVDA', 'TSLA', 'AMZN', 'META', 'NFLX',
                '600519', '000858', '600036', '601398', '300750', '002594', '000002',
                'BTC', 'ETH', 'BNB', 'ADA', 'SOL', 'DOT', 'LINK', 'UNI'
            ];
            
            // ÈöèÊú∫ÈÄâÊã©
            const shuffled = stockPool.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, Math.min(count, stockPool.length));
        }
        
        async function performAdvancedSearch(options) {
            try {
                const response = await fetch('/market-data/advanced-search', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(options)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('üéØ È´òÁ∫ßÊêúÁ¥¢ÁªìÊûú:', data);
                    return data;
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è È´òÁ∫ßÊêúÁ¥¢APIË∞ÉÁî®Â§±Ë¥•:', error);
            }
            return null;
        }
        
        // ==================== ‰øùÁïôÂéüÊúâÂáΩÊï∞‰ª•Á°Æ‰øùÂÖºÂÆπÊÄß ====================
        
        // Ë°å‰∏öÂø´ÈÄüÁ≠õÈÄâÂáΩÊï∞ (‰øùÁïôÁî®‰∫éÂÖºÂÆπ)
        window.quickSectorFilter = function(sector) {
            console.log('üîÑ ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÊêúÁ¥¢:', sector);
            unifiedSectorSearch(sector);
        };

        // Áªü‰∏ÄÊêúÁ¥¢Â§ÑÁêÜÂáΩÊï∞ - Ê†∏ÂøÉÊêúÁ¥¢ÈÄªËæë
        window.handleSearch = function(value, source = 'unknown') {
            console.log(`üîç [${source}] handleSearchË¢´Ë∞ÉÁî®:`, value);
            console.log(`üîç [${source}] ÂéüÂßãÂÄºÁ±ªÂûã:`, typeof value, 'ÈïøÂ∫¶:', value ? value.length : 'undefined');
            console.log(`üîç [${source}] ÂéüÂßãÂÄºÂÜÖÂÆπ:`, JSON.stringify(value));
            
            const query = value ? value.trim() : '';
            console.log(`üîç [${source}] trimÂêéÊü•ËØ¢:`, JSON.stringify(query), 'ÈïøÂ∫¶:', query.length);
            
            const dropdown = document.getElementById('search-dropdown');
            
            if (!dropdown) {
                console.error('‚ùå ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            if (query.length === 0) {
                console.log('üö´ Êü•ËØ¢‰∏∫Á©∫ÔºåÈöêËóè‰∏ãÊãâÊ°Ü');
                dropdown.classList.add('hidden');
                return;
            }
            
            console.log('üîÑ ÂºÄÂßãÊêúÁ¥¢Â§ÑÁêÜ...');
            
            // ÊòæÁ§∫ÊêúÁ¥¢‰∏≠Áä∂ÊÄÅ
            dropdown.innerHTML = '<div class="p-3 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">üîç SEARCHING...</div>';
            dropdown.classList.remove('hidden');
            
            // ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ì
            console.log('üîç Ë∞ÉÁî® searchLocalDatabase...');
            const localResults = window.searchLocalDatabase(query);
            console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÂÆåÊàêÔºåÁªìÊûúÊï∞:', localResults.length);
            
            if (localResults.length > 0) {
                console.log('‚úÖ ÊâæÂà∞ÁªìÊûúÔºåÂºÄÂßãÊ∏≤Êüì...');
                window.renderSearchResults(localResults, query, true);
            } else {
                console.log('‚ö†Ô∏è Ê≤°ÊúâÊâæÂà∞ÁªìÊûú');
                dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-gray-400 bg-black">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖç "${query}" ÁöÑÁªìÊûú</div>`;
                dropdown.classList.remove('hidden');
            }
        };
        
        // ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ìÂáΩÊï∞
        window.searchLocalDatabase = function(query) {
            console.log('üîç searchLocalDatabaseË¢´Ë∞ÉÁî®ÔºåÊü•ËØ¢:', JSON.stringify(query));
            
            const results = [];
            const queryLower = String(query || '').toLowerCase().trim();
            
            console.log('üîç Â§ÑÁêÜÂêéÊü•ËØ¢:', JSON.stringify(queryLower), 'ÈïøÂ∫¶:', queryLower.length);
            console.log('üìö Êï∞ÊçÆÂ∫ìÊù°ÁõÆÊï∞:', Object.keys(window.stockDatabase).length);
            
            // Ê£ÄÊü•Êï∞ÊçÆÂ∫ìÊòØÂê¶Â∑≤Âä†ËΩΩ
            if (!window.stockDatabase || Object.keys(window.stockDatabase).length === 0) {
                console.error('‚ùå ËÇ°Á•®Êï∞ÊçÆÂ∫ì‰∏∫Á©∫ÊàñÊú™Âä†ËΩΩ');
                return [];
            }
            
            // ÂØπ‰∫éÂçïÂ≠óÁ¨¶ÊêúÁ¥¢ÔºåÈôç‰ΩéÊêúÁ¥¢Ë¶ÅÊ±Ç‰ΩÜÈôêÂà∂ÁªìÊûúÊï∞Èáè
            let maxResults = queryLower.length === 1 ? 20 : 50;
            
            for (const [symbol, data] of Object.entries(window.stockDatabase)) {
                if (results.length >= maxResults) break;
                
                const symbolLower = symbol.toLowerCase();
                const nameLower = data.name.toLowerCase();
                const sectorLower = (data.sector || '').toLowerCase();
                
                let isMatch = false;
                let matchType = '';
                
                // Á≤æÁ°ÆÂåπÈÖç
                if (symbolLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'symbol';
                }
                else if (nameLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'name';
                }
                else if (sectorLower.includes(queryLower)) {
                    isMatch = true;
                    matchType = 'sector';
                }
                else {
                    // ËØçÊ±áÂåπÈÖçÔºàÂàÜËØçÊêúÁ¥¢Ôºâ
                    const nameWords = nameLower.split(/\s+/);
                    const wordMatch = nameWords.some(word => word.startsWith(queryLower));
                    if (wordMatch) {
                        isMatch = true;
                        matchType = 'word';
                    }
                    // Ê®°Á≥äÊêúÁ¥¢ (‰ªÖÂØπÈïøÂ∫¶>1ÁöÑÊü•ËØ¢)
                    else if (queryLower.length > 1) {
                        const fuzzyNameMatch = window.fuzzyMatch && window.fuzzyMatch(nameLower, queryLower);
                        const fuzzySymbolMatch = window.fuzzyMatch && window.fuzzyMatch(symbolLower, queryLower);
                        if (fuzzyNameMatch || fuzzySymbolMatch) {
                            isMatch = true;
                            matchType = 'fuzzy';
                        }
                    }
                }
                
                if (isMatch) {
                    const score = window.calculateRelevanceScore ? 
                        window.calculateRelevanceScore(queryLower, symbol, data) : 100;
                    
                    const result = { 
                        symbol, 
                        ...data,
                        displayName: data.name,
                        exchange: data.market || (window.getMarketFromSymbol ? window.getMarketFromSymbol(symbol) : 'N/A'),
                        marketCap: data.marketCap || 'Unknown',
                        score: score,
                        matchType: matchType
                    };
                    results.push(result);
                    
                    console.log('‚úÖ ÂåπÈÖç:', symbol, '-', data.name, 'Á±ªÂûã:', matchType, 'ÂàÜÊï∞:', score);
                }
            }
            
            console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÂÆåÊàêÔºåÁªìÊûúÊï∞:', results.length);
            
            // ÊåâÂàÜÊï∞ÊéíÂ∫è
            results.sort((a, b) => (b.score || 0) - (a.score || 0));
            
            return results.slice(0, maxResults);
        };
        
        // Ê∏≤ÊüìÊêúÁ¥¢ÁªìÊûúÂáΩÊï∞
        window.renderSearchResults = function(results, query, isLocal = false, append = false) {
            console.log('üé® renderSearchResults Ë¢´Ë∞ÉÁî®:', results.length, '‰∏™ÁªìÊûú');
            console.log('üîç Êü•ËØ¢:', query, 'Êú¨Âú∞ÊêúÁ¥¢:', isLocal, 'ËøΩÂä†:', append);
            
            const dropdown = document.getElementById('search-dropdown');
            if (!dropdown) {
                console.error('‚ùå ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            console.log('üìç ‰∏ãÊãâÊ°ÜÂÖÉÁ¥†Â≠òÂú®ÔºåÂΩìÂâçÁ±ª:', dropdown.className);

            if (results.length === 0 && !append) {
                console.log('‚ö†Ô∏è Ê≤°ÊúâÊêúÁ¥¢ÁªìÊûú');
                dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-white bg-black">NO RESULTS FOR "${query}"</div>`;
                dropdown.classList.remove('hidden');
                console.log('‚úÖ ËÆæÁΩÆÊó†ÁªìÊûúÊ∂àÊÅØ');
                return;
            }
            
            console.log('‚úÖ ÂºÄÂßãÊ∏≤Êüì', results.length, '‰∏™ÊêúÁ¥¢ÁªìÊûú');

            const resultsHtml = results.map((stock, index) => {
                const priceValue = typeof stock.price === 'number'
                    ? stock.price
                    : (typeof stock.last_price === 'number' ? stock.last_price : null);
                const changeValue = typeof stock.change === 'number'
                    ? stock.change
                    : (typeof stock.change_pct === 'number' ? stock.change_pct : null);
                const changeColor = (changeValue || 0) >= 0 ? 'text-green-400' : 'text-red-400';
                const changeSign = (changeValue || 0) >= 0 ? '+' : '';
                const currencyLabel = stock.currency === 'CNY' ? '¬•' : '$';
                const price = priceValue !== null ? `${currencyLabel}${Number(priceValue).toFixed(2)}` : 'N/A';
                const change = changeValue !== null ? `${changeSign}${Number(changeValue).toFixed(2)}%` : 'N/A';
                const exchangeLabel = stock.exchange || (window.getMarketFromSymbol ? window.getMarketFromSymbol(stock.symbol) : 'N/A');
                const marketCapLabel = stock.marketCap || 'N/A';
                const sectorLabel = (stock.sector || stock.industry || 'GENERAL').toUpperCase();

                return `
                    <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600 last:border-b-0" 
                         onclick="window.addStockToPool('${stock.symbol}')">
                        <div class="stock-result-symbol">${stock.symbol} <span class="text-xs bg-gray-600 px-1 rounded ml-1">${exchangeLabel}</span></div>
                        <div class="stock-result-name">${stock.displayName}</div>
                        <div class="stock-result-info">
                            <div class="flex gap-1">
                                <span class="text-xs bg-purple-600 px-1 rounded">${marketCapLabel}</span>
                                <span class="text-xs bg-orange-600 px-1 rounded">${sectorLabel.length > 8 ? sectorLabel.substring(0,8) : sectorLabel}</span>
                                ${isLocal ? `<span class="text-xs bg-blue-600 px-1 rounded">LOCAL</span>` : ''}
                            </div>
                            <div class="text-right">
                                <div class="font-mono text-xs">${price}</div>
                                <div class="font-mono text-xs ${changeColor}">${change}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            if (append && dropdown.innerHTML) {
                dropdown.innerHTML += resultsHtml;
            } else {
                dropdown.innerHTML = resultsHtml;
            }

            dropdown.classList.remove('hidden');
            console.log('‚úÖ ÊêúÁ¥¢ÁªìÊûúÊ∏≤ÊüìÂÆåÊàêÔºå‰∏ãÊãâÊ°ÜÂ∑≤ÊòæÁ§∫');
        };
        
        window.initStockSearch = function() {
            console.log('üîç [INIT] ÂºÄÂßãÂàùÂßãÂåñËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩ...');
            
            if (window.searchInitialized) {
                console.log('‚ö†Ô∏è [INIT] ÊêúÁ¥¢ÂäüËÉΩÂ∑≤ÁªèÂàùÂßãÂåñÔºåË∑≥ËøáÈáçÂ§çÂàùÂßãÂåñ');
                return true; // ËøîÂõûÊàêÂäüÁä∂ÊÄÅ
            }
            
            // Á´ãÂç≥Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®
            let searchInput = document.getElementById('stock-search');
            let dropdown = document.getElementById('search-dropdown');
            
            console.log('üîç [INIT] ÂÖÉÁ¥†Ê£ÄÊü•ÁªìÊûú:');
            console.log('  - searchInputÂ≠òÂú®:', !!searchInput);
            console.log('  - dropdownÂ≠òÂú®:', !!dropdown);
            
            // Á≠âÂæÖDOMÂä†ËΩΩÂÆåÊàê
            setTimeout(() => {
                console.log('üîç [INIT] Âª∂ËøüÊâßË°åÂºÄÂßã...');
                
                // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†
                searchInput = document.getElementById('stock-search');
                dropdown = document.getElementById('search-dropdown');
                
                console.log('üîç [INIT] Âª∂ËøüÂêéÂÖÉÁ¥†Ê£ÄÊü•:');
                console.log('  - searchInputÂ≠òÂú®:', !!searchInput);
                console.log('  - dropdownÂ≠òÂú®:', !!dropdown);
                
                if (!searchInput) {
                    console.error('‚ùå [INIT] Êú™ÊâæÂà∞ stock-search ËæìÂÖ•Ê°Ü');
                    
                    // Â∞ùËØïÂÖ∂‰ªñÊñπÂºèÊü•Êâæ
                    const allInputs = document.querySelectorAll('input');
                    console.log('üîç [INIT] È°µÈù¢‰∏≠ÊâÄÊúâinputÂÖÉÁ¥†:', allInputs.length);
                    allInputs.forEach((input, index) => {
                        console.log(`  Input ${index}:`, {
                            id: input.id,
                            type: input.type,
                            placeholder: input.placeholder
                        });
                    });
                    window.searchInitialized = false;
                    return false;
                }
                
                if (!dropdown) {
                    console.error('‚ùå [INIT] Êú™ÊâæÂà∞ search-dropdown ÂÖÉÁ¥†');
                    window.searchInitialized = false;
                    return false;
                }
                
                console.log('‚úÖ [INIT] ËÇ°Á•®ÊêúÁ¥¢ÂÖÉÁ¥†ÊâæÂà∞ÔºåÂºÄÂßãÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®...');
                
                // Ê∏ÖÁêÜ‰πãÂâçÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
                if (window.stockSearchHandler) {
                    searchInput.removeEventListener('input', window.stockSearchHandler);
                }
                if (window.stockKeyupHandler) {
                    searchInput.removeEventListener('keyup', window.stockKeyupHandler);
                }
                
                // ÂÆö‰πâ‰∫ã‰ª∂Â§ÑÁêÜÂáΩÊï∞Âπ∂Á´ãÂç≥ÁªëÂÆöÂà∞windowÂØπË±°
                console.log('üîß ÂÆö‰πâ stockSearchHandler ÂáΩÊï∞');
                window.stockSearchHandler = function(e) {
                    console.log('üîç ËæìÂÖ•‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    clearTimeout(searchTimeout);
                    const query = e.target.value.trim();
                    
                    if (query.length < 1) {
                        dropdown.classList.add('hidden');
                        updateSearchStatus('ready');
                        return;
                    }
                    
                    // Á´ãÂç≥ÊòæÁ§∫"Ê≠£Âú®ÊêúÁ¥¢"ÊèêÁ§∫
                    dropdown.innerHTML = '<div class="p-3 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">üîç SEARCHING...</div>';
                    dropdown.classList.remove('hidden');
                    console.log('‚úÖ ‰∏ãÊãâÊ°ÜÂ∑≤ÊòæÁ§∫ÔºåÊü•ËØ¢:', query);
                    
                    // È¶ñÂÖàÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ìÔºàÊâÄÊúâÊü•ËØ¢ÈïøÂ∫¶Ôºâ
                    console.log('üîç ÊêúÁ¥¢Êú¨Âú∞Êï∞ÊçÆÂ∫ì:', query);
                    const localResults = window.searchLocalDatabase(query);
                    console.log('üìä Êú¨Âú∞ÊêúÁ¥¢ÁªìÊûú:', localResults.length, '‰∏™', localResults);
                    
                    if (localResults.length > 0) {
                        console.log('‚úÖ Ê∏≤ÊüìÊú¨Âú∞ÊêúÁ¥¢ÁªìÊûú');
                        window.renderSearchResults(localResults, query, true);
                        dropdown.classList.remove('hidden');
                        updateSearchStatus('ready');
                    } else {
                        // Âç≥‰ΩøÊ≤°ÊúâÊú¨Âú∞ÁªìÊûúÔºå‰πüÊòæÁ§∫‰∏Ä‰∏™"Ê≤°ÊúâÊú¨Âú∞ÁªìÊûú"ÁöÑÊèêÁ§∫
                        dropdown.innerHTML = `<div class="p-3 text-xs font-mono text-gray-400 bg-black">Ê≤°ÊúâÊâæÂà∞ÂåπÈÖç "${query}" ÁöÑÊú¨Âú∞ÁªìÊûú</div>`;
                        console.log('‚ö†Ô∏è Ê≤°ÊúâÊú¨Âú∞ÁªìÊûú');
                    }
                    
                    console.log('üîç ÂºÄÂßãAPIÊêúÁ¥¢:', query);
                    searchTimeout = setTimeout(() => {
                        window.searchStocks(query, 0);
                    }, query.length === 1 ? 500 : 300);
                    
                    if (localResults.length === 0) {
                        dropdown.classList.add('hidden');
                    }
                };
                
                window.stockKeyupHandler = function(e) {
                    console.log('üîç ÈîÆÁõò‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    const query = e.target.value.trim().toLowerCase();
                    if (query.length >= 2) {
                        window.searchStocks(query);
                    }
                };
                
                // È™åËØÅÂáΩÊï∞ÊòØÂê¶Ê≠£Á°ÆÂÆö‰πâ
                console.log('üîç È™åËØÅÂáΩÊï∞ÂÆö‰πâÁä∂ÊÄÅ:');
                console.log('stockSearchHandler exists:', typeof window.stockSearchHandler);
                console.log('stockKeyupHandler exists:', typeof window.stockKeyupHandler);
                
                // Ê∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                console.log('üîó ÁªëÂÆöÊêúÁ¥¢‰∫ã‰ª∂ÁõëÂê¨Âô®');
                if (window.stockSearchHandler) {
                    searchInput.addEventListener('input', window.stockSearchHandler);
                    console.log('‚úÖ input‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÊàêÂäü');
                } else {
                    console.error('‚ùå stockSearchHandlerÊú™ÂÆö‰πâÔºåÊó†Ê≥ïÁªëÂÆöinput‰∫ã‰ª∂');
                }
                
                if (window.stockKeyupHandler) {
                    searchInput.addEventListener('keyup', window.stockKeyupHandler);
                    console.log('‚úÖ keyup‰∫ã‰ª∂ÁõëÂê¨Âô®ÁªëÂÆöÊàêÂäü');
                } else {
                    console.error('‚ùå stockKeyupHandlerÊú™ÂÆö‰πâÔºåÊó†Ê≥ïÁªëÂÆökeyup‰∫ã‰ª∂');
                }
                
                // Ê∑ªÂä†focus‰∫ã‰ª∂Êù•ÊµãËØï
                searchInput.addEventListener('focus', function() {
                    console.log('üéØ ÊêúÁ¥¢Ê°ÜËé∑ÂæóÁÑ¶ÁÇπ');
                });
                
                // Ê∑ªÂä†Âº∫ÂåñÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                console.log('üéØ ÂºÄÂßãÊ∑ªÂä†Âº∫Âåñ‰∫ã‰ª∂ÁõëÂê¨Âô®');
                
                // Ê∏ÖÈô§‰ªª‰ΩïÁé∞ÊúâÁöÑ‰∫ã‰ª∂ÁõëÂê¨Âô®
                const newSearchInput = searchInput.cloneNode(true);
                searchInput.parentNode.replaceChild(newSearchInput, searchInput);
                
                // ÈáçÊñ∞Ëé∑ÂèñÂÖÉÁ¥†ÂºïÁî®
                const cleanSearchInput = document.getElementById('stock-search');
                
                // ÊñπÊ≥ï1: Ê†áÂáÜinput‰∫ã‰ª∂ (ÊúÄÈáçË¶Å)
                cleanSearchInput.addEventListener('input', function(e) {
                    const value = e.target.value;
                    console.log('üìù [INPUT] ‰∫ã‰ª∂Ëß¶ÂèëÔºåÂÄº:', JSON.stringify(value));
                    if (value !== undefined && value !== null) {
                        window.handleSearch(value, 'input');
                    }
                });
                
                // ÊñπÊ≥ï2: keyup‰∫ã‰ª∂ (Á°Æ‰øùÊâÄÊúâÊåâÈîÆÈÉΩË¢´ÊçïËé∑)
                cleanSearchInput.addEventListener('keyup', function(e) {
                    const value = e.target.value;
                    console.log('‚å®Ô∏è [KEYUP] ‰∫ã‰ª∂Ëß¶ÂèëÔºåÈîÆ:', e.key, 'ÂÄº:', JSON.stringify(value));
                    if (value !== undefined && value !== null) {
                        window.handleSearch(value, 'keyup');
                    }
                });
                
                // ÊñπÊ≥ï3: propertychange‰∫ã‰ª∂ (IEÂÖºÂÆπÊÄß)
                cleanSearchInput.addEventListener('propertychange', function(e) {
                    if (e.propertyName === 'value') {
                        const value = e.target.value;
                        console.log('üîÑ [PROP] ÂÄºÂ±ûÊÄßÂèòÂåñ:', JSON.stringify(value));
                        if (value !== undefined && value !== null) {
                            window.handleSearch(value, 'propertychange');
                        }
                    }
                });
                
                // ÊñπÊ≥ï4: ËΩÆËØ¢Ê£ÄÊµã (ÊúÄÁªà‰øùÈô©)
                let lastValue = '';
                const pollInterval = setInterval(() => {
                    const currentValue = cleanSearchInput.value;
                    if (currentValue !== lastValue) {
                        console.log('üëÄ [POLL] ÂÄºÂèòÂåñÊ£ÄÊµã:', JSON.stringify(currentValue), '(‰πãÂâç:', JSON.stringify(lastValue), ')');
                        lastValue = currentValue;
                        window.handleSearch(currentValue, 'polling');
                    }
                }, 150); // 150msËΩÆËØ¢
                
                console.log('‚úÖ ÊâÄÊúâ‰∫ã‰ª∂ÁõëÂê¨Âô®ÈáçÊñ∞ÁªëÂÆöÂÆåÊàê');
                
                // ÊµãËØïÁªëÂÆö
                setTimeout(() => {
                    console.log('üß™ ÊµãËØï‰∫ã‰ª∂ÁªëÂÆö...');
                    cleanSearchInput.value = 'test';
                    cleanSearchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    setTimeout(() => {
                        cleanSearchInput.value = '';
                    }, 500);
                }, 1000);
                
                console.log('‚úÖ Âº∫Âåñ‰∫ã‰ª∂ÁõëÂê¨Âô®Ê∑ªÂä†ÂÆåÊàê');
                
                // Ê†áËÆ∞ÂàùÂßãÂåñÂÆåÊàê
                window.searchInitialized = true;
                console.log('üéâ [INIT] ËÇ°Á•®ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÂÖ®ÊàêÂäüÔºÅ');
                
                // Ê∑ªÂä†ËßÜËßâÂèçÈ¶à - ÊêúÁ¥¢Ê°ÜÂáÜÂ§áÂ∞±Áª™
                searchInput.style.borderColor = '#22c55e'; // ÁªøËâ≤ËæπÊ°ÜË°®Á§∫Â∞±Áª™
                searchInput.setAttribute('title', 'ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Â∞±Áª™ - Ready to search');
                
                // 3ÁßíÂêéÊÅ¢Â§çÊ≠£Â∏∏ËæπÊ°Ü
                setTimeout(() => {
                    searchInput.style.borderColor = '';
                }, 3000);
                
                // Ê∑ªÂä†keyup‰∫ã‰ª∂ÁõëÂê¨Âô®‰Ωú‰∏∫È¢ùÂ§ñ‰øùÈöú
                searchInput.addEventListener('keyup', function(e) {
                    console.log('‚å®Ô∏è Áõ¥Êé•keyup‰∫ã‰ª∂Ëß¶Âèë:', e.target.value);
                    window.handleSearch(e.target.value, 'keyup');
                });
                
                // Ê∑ªÂä†focus‰∫ã‰ª∂ÁõëÂê¨Âô® - Á°Æ‰øùËé∑ÂæóÁÑ¶ÁÇπÊó∂ÊêúÁ¥¢ÂäüËÉΩÂáÜÂ§áÂ∞±Áª™
                searchInput.addEventListener('focus', function(e) {
                    console.log('üëÅÔ∏è ÊêúÁ¥¢ËæìÂÖ•Ê°ÜËé∑ÂæóÁÑ¶ÁÇπ:', e.target.value);
                    if (e.target.value && e.target.value.length >= 1) {
                        window.handleSearch(e.target.value, 'focus');
                    }
                });
                
                // È™åËØÅÊúÄÁªàÁªëÂÆöÁä∂ÊÄÅ
                console.log('üîç ÊúÄÁªà‰∫ã‰ª∂ÁªëÂÆöÈ™åËØÅ:');
                const events = ['input', 'keyup', 'focus'];
                events.forEach(eventType => {
                    const hasListener = searchInput.getAttribute('data-' + eventType + '-bound') || 'unknown';
                    console.log(`${eventType} ‰∫ã‰ª∂ÁªëÂÆöÁä∂ÊÄÅ: ${hasListener}`);
                });
                
                // Ê∑ªÂä†Á≠õÈÄâÂô®‰∫ã‰ª∂ÁõëÂê¨Âô®
                const marketFilter = document.getElementById('market-filter');
                const capFilter = document.getElementById('cap-filter');
                
                if (marketFilter) {
                    marketFilter.addEventListener('change', window.onMarketFilterChange);
                }
                
                if (capFilter) {
                    capFilter.addEventListener('change', function() {
                        // Êõ¥Êñ∞ÊêúÁ¥¢ÁªìÊûúÔºàÂ¶ÇÊûúÊúâÊ≠£Âú®ËøõË°åÁöÑÊêúÁ¥¢Ôºâ
                        const searchInput = document.getElementById('stock-search');
                        if (searchInput && searchInput.value.length >= 2) {
                            window.searchStocks(searchInput.value, 0);
                        }
                    });
                }
                
                // ÁÇπÂáªÂ§ñÈÉ®ÂÖ≥Èó≠‰∏ãÊãâÊ°Ü
                document.addEventListener('click', function(e) {
                    if (!e.target.closest('#stock-search') && !e.target.closest('#search-dropdown')) {
                        dropdown.classList.add('hidden');
                    }
                });
                
                // ÊµãËØïÊêúÁ¥¢ÂäüËÉΩ
                console.log('üîç ÊµãËØïÊêúÁ¥¢Êï∞ÊçÆÂ∫ì:', Object.keys(window.stockDatabase).slice(0, 10));
                console.log('‚úÖ ËÇ°Á•®ÊêúÁ¥¢ÂàùÂßãÂåñÂÆåÊàê');
                
                // ÊµãËØïÊêúÁ¥¢ÂäüËÉΩ
                console.log('üß™ ÊµãËØïÂçïÂ≠óÁ¨¶ÊêúÁ¥¢ "a"');
                const testResultsA = window.searchLocalDatabase('a');
                console.log('üß™ "a"ÊêúÁ¥¢ÁªìÊûú:', testResultsA.length, '‰∏™ÁªìÊûú');
                
                console.log('üß™ ÊµãËØïÊêúÁ¥¢ "apple"');
                const testResults = window.searchLocalDatabase('apple');
                console.log('üß™ "apple"ÊêúÁ¥¢ÁªìÊûú:', testResults);
                
                console.log('üß™ ÊµãËØïÊêúÁ¥¢ "AAPL"');
                const testResultsAAPL = window.searchLocalDatabase('AAPL');
                console.log('üß™ "AAPL"ÊêúÁ¥¢ÁªìÊûú:', testResultsAAPL);
                
                updateSearchStatus('ready');
                
                return true; // ÂàùÂßãÂåñÊàêÂäü
            }, 500);
            
            return true; // ËøîÂõûÊàêÂäüÁä∂ÊÄÅ
        }
        
        // ÂÖ®Â±ÄÊêúÁ¥¢Áä∂ÊÄÅ
        let currentSearchOffset = 0;
        let currentSearchQuery = '';
        let hasMoreResults = true;
        
        window.searchStocks = async function(query, offset = 0) {
            console.log('üîç searchStocks Ë¢´Ë∞ÉÁî®:', query, 'offset:', offset);
            
            const dropdown = document.getElementById('search-dropdown');
            if (!dropdown) {
                console.error('‚ùå search-dropdown ÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                return;
            }
            
            // Êñ∞ÊêúÁ¥¢Êó∂ÈáçÁΩÆÁä∂ÊÄÅ
            if (offset === 0) {
                currentSearchQuery = query;
                currentSearchOffset = 0;
                hasMoreResults = true;
                dropdown.innerHTML = `<div class="p-2 text-xs font-mono text-white bg-black">${window.t('search-loading')}</div>`;
                dropdown.classList.remove('hidden');
            }
            updateSearchStatus('searching');
            
            try {
                // ÂÖà‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆÂ∫ì‰Ωú‰∏∫ÂêéÂ§á
                if (offset === 0) {
                    const localResults = window.searchLocalDatabase(query);
                    if (localResults.length > 0) {
                        window.renderSearchResults(localResults, query, true);
                    }
                }
                
                // Ëé∑ÂèñÁ≠õÈÄâÊù°‰ª∂
                const marketFilter = document.getElementById('market-filter')?.value || '';
                const capFilter = document.getElementById('cap-filter')?.value || '';
                let effectiveRegion = marketFilter;
                if (!effectiveRegion) {
                    const targetMarket = document.getElementById('market-select')?.value || '';
                    const marketUpper = targetMarket ? targetMarket.toUpperCase() : '';
                    if (marketUpper === 'US') {
                        effectiveRegion = 'US';
                    } else if (marketUpper === 'CN') {
                        effectiveRegion = 'CN';
                    }
                }

                // ÊûÑÂª∫Êü•ËØ¢ÂèÇÊï∞
                let queryParams = `query=${encodeURIComponent(query)}&limit=10&offset=${offset}`;
                if (effectiveRegion) queryParams += `&region=${effectiveRegion}`;
                if (capFilter) queryParams += `&market_cap=${capFilter}`;
                
                // Ë∞ÉÁî®Êú¨Âú∞API
                const response = await fetch(`/market-data/search/${encodeURIComponent(query)}?market=${effectiveRegion || 'ALL'}`);
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('ÊêúÁ¥¢Ëøá‰∫éÈ¢ëÁπÅÔºåËØ∑Á®çÂêéÈáçËØï');
                    } else if (response.status === 503) {
                        throw new Error('ÊêúÁ¥¢ÊúçÂä°ÊöÇ‰∏çÂèØÁî®');
                    }
                    throw new Error('ÊêúÁ¥¢Â§±Ë¥•');
                }

                const data = await response.json();
                console.log('üîç APIÊêúÁ¥¢ÁªìÊûú:', data);
                
                hasMoreResults = data.total > (offset + data.count);
                currentSearchOffset = offset + data.count;
                
                if (data.results && data.results.length > 0) {
                    const enrichedResults = data.results.map(stock => ({
                        ...stock,
                        // Ê∑ªÂä†ÊòæÁ§∫‰ø°ÊÅØ
                        displayName: stock.longName || stock.shortName || stock.name || stock.symbol,
                        exchange: stock.exchange || stock.market || 'N/A',
                        currency: stock.currency || 'USD',
                        price: stock.regularMarketPrice || stock.price || 0,
                        change: stock.regularMarketChangePercent || stock.changePercent || 0,
                        volume: stock.regularMarketVolume || stock.volume || 0
                    }));
                    
                    window.renderSearchResults(enrichedResults, query, false, offset > 0);
                    updateSearchStatus('ready');
                } else if (offset === 0) {
                    // Êó†APIÁªìÊûúÊó∂‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆ
                    const localResults = window.searchLocalDatabase(query);
                    window.renderSearchResults(localResults, query, true);
                    updateSearchStatus('ready');
                }

            } catch (error) {
                console.error('ÊêúÁ¥¢ÈîôËØØ:', error);
                updateSearchStatus('offline', error.message);

                if (offset === 0) {
                    // ÈîôËØØÊó∂‰ΩøÁî®Êú¨Âú∞Êï∞ÊçÆÂ∫ì
                    const localResults = window.searchLocalDatabase(query);
                    if (localResults.length > 0) {
                        window.renderSearchResults(localResults, query, true);
                        dropdown.innerHTML += `<div class="p-1 text-xs font-mono text-yellow-400 bg-black border-t border-gray-600">${window.t('search-offline-mode')}: ${error.message}</div>`;
                    } else {
                        dropdown.innerHTML = `<div class="p-2 text-xs font-mono text-red-400 bg-black">${error.message}</div>`;
                    }
                }
            }
        };
        
        // Ê®°Á≥äÂåπÈÖçÁÆóÊ≥ï
        window.fuzzyMatch = function(text, query) {
            if (query.length < 2) return false;
            
            let queryIndex = 0;
            for (let i = 0; i < text.length && queryIndex < query.length; i++) {
                if (text[i] === query[queryIndex]) {
                    queryIndex++;
                }
            }
            return queryIndex === query.length;
        };
        
        // ËÆ°ÁÆóÁõ∏ÂÖ≥ÊÄßÂàÜÊï∞
        window.calculateRelevanceScore = function(query, symbol, data) {
            let score = 0;
            const queryLower = query.toLowerCase();
            const symbolLower = symbol.toLowerCase();
            const nameLower = data.name.toLowerCase();
            
            // Á≤æÁ°ÆÂåπÈÖçÂæóÂàÜÊúÄÈ´ò
            if (symbolLower === queryLower) score += 100;
            if (nameLower === queryLower) score += 90;
            
            // ÂºÄÂ§¥ÂåπÈÖç
            if (symbolLower.startsWith(queryLower)) score += 80;
            if (nameLower.startsWith(queryLower)) score += 75;
            
            // ËØçÊ±áÂºÄÂ§¥ÂåπÈÖç
            const nameWords = nameLower.split(/\s+/);
            const wordStartMatch = nameWords.some(word => word.startsWith(queryLower));
            if (wordStartMatch) score += 70;
            
            // ÂåÖÂê´ÂåπÈÖç
            if (symbolLower.includes(queryLower) && score === 0) score += 60;
            if (nameLower.includes(queryLower) && score === 0) score += 55;
            
            return score;
        };
        
        // Ëé∑ÂèñÂ∏ÇÂú∫‰ø°ÊÅØ
        window.getMarketFromSymbol = function(symbol) {
            if (!symbol) return 'N/A';
            
            if (symbol.endsWith('.SS') || symbol.endsWith('.SH')) {
                return 'SSE';
            } else if (symbol.endsWith('.SZ')) {
                return 'SZSE';
            } else if (symbol.endsWith('.T')) {
                return 'TSE';
            } else if (symbol.endsWith('.HK')) {
                return 'HKEX';
            } else {
                return 'NASDAQ/NYSE';
            }
        };
        
        // Ê∑ªÂä†ËÇ°Á•®Âà∞ÊäïËµÑÊ±†ÂáΩÊï∞
        window.addStockToPool = function(symbol) {
            console.log('üìà Ê∑ªÂä†ËÇ°Á•®Âà∞ÊäïËµÑÊ±†:', symbol);
            
            // Ê£ÄÊü•ËÇ°Á•®ÊòØÂê¶Â∑≤Âú®Ê±†‰∏≠
            const targetSymbolsInput = document.getElementById('target-symbols');
            if (targetSymbolsInput) {
                const currentSymbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                
                if (currentSymbols.includes(symbol)) {
                    console.log('‚ö†Ô∏è ËÇ°Á•®Â∑≤Âú®ÊäïËµÑÊ±†‰∏≠:', symbol);
                    showToast(`${symbol} Â∑≤Âú®ËÇ°Á•®Ê±†‰∏≠`, 'warning');
                    return;
                }
                
                // Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†
                currentSymbols.push(symbol);
                targetSymbolsInput.value = currentSymbols.join(', ');
                
                console.log('‚úÖ ËÇ°Á•®Â∑≤Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†:', symbol);
                showToast(`‚úÖ ${symbol} Â∑≤Ê∑ªÂä†Âà∞ÊäïËµÑÊ±†`, 'success');
                
                // Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫
                if (window.updateStockChips) {
                    window.updateStockChips();
                }
                
                // ÈöêËóèÊêúÁ¥¢‰∏ãÊãâÊ°ÜÂπ∂Ê∏ÖÁ©∫ÊêúÁ¥¢Ê°Ü
                const dropdown = document.getElementById('search-dropdown');
                const searchInput = document.getElementById('stock-search');
                
                if (dropdown) dropdown.classList.add('hidden');
                if (searchInput) searchInput.value = '';
                
            } else {
                console.error('‚ùå Êâæ‰∏çÂà∞ÁõÆÊ†áËÇ°Á•®ËæìÂÖ•Ê°Ü');
                showToast('‚ùå Êó†Ê≥ïÊ∑ªÂä†Âà∞ÊäïËµÑÊ±†', 'error');
            }
        };
        
        // ÊòæÁ§∫ÊèêÁ§∫Ê∂àÊÅØÂáΩÊï∞ (Â¶ÇÊûú‰∏çÂ≠òÂú®)
        if (!window.showToast) {
            window.showToast = function(message, type = 'info') {
                console.log(`Toast [${type}]:`, message);
                
                // ÂàõÂª∫ÁÆÄÂçïÁöÑÊèêÁ§∫Ê°Ü
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 12px 16px;
                    border-radius: 4px;
                    color: white;
                    font-size: 14px;
                    font-family: monospace;
                    z-index: 10000;
                    max-width: 300px;
                    word-wrap: break-word;
                `;
                
                // ËÆæÁΩÆÈ¢úËâ≤
                switch(type) {
                    case 'success':
                        toast.style.backgroundColor = '#10b981';
                        break;
                    case 'warning':
                        toast.style.backgroundColor = '#f59e0b';
                        break;
                    case 'error':
                        toast.style.backgroundColor = '#ef4444';
                        break;
                    default:
                        toast.style.backgroundColor = '#3b82f6';
                }
                
                toast.textContent = message;
                document.body.appendChild(toast);
                
                // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
                setTimeout(() => {
                    try {
                        if (toast && toast.parentNode) {
                            toast.remove();
                        }
                    } catch (e) {
                        console.warn('ToastÂ∑≤Ë¢´ÁßªÈô§:', e);
                    }
                }, 3000);
            };
        }
        
        // Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫ÂáΩÊï∞
        window.updateStockChips = function() {
            console.log('üîÑ Êõ¥Êñ∞ËÇ°Á•®ËäØÁâáÊòæÁ§∫...');
            
            const targetSymbolsInput = document.getElementById('target-symbols');
            const stockListContainer = document.querySelector('.selected-stocks-list, #selected-stocks-display');
            
            if (!targetSymbolsInput) {
                console.log('‚ö†Ô∏è Êú™ÊâæÂà∞ÁõÆÊ†áËÇ°Á•®ËæìÂÖ•Ê°Ü');
                return;
            }
            
            const symbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
            console.log('üìä ÂΩìÂâçËÇ°Á•®Ê±†:', symbols);
            
            // Â¶ÇÊûúÊúâËÇ°Á•®ËäØÁâáÂÆπÂô®ÔºåÊõ¥Êñ∞ÊòæÁ§∫
            if (stockListContainer) {
                const chipsHtml = symbols.map(symbol => {
                    const stockData = window.stockDatabase && window.stockDatabase[symbol];
                    const displayName = stockData ? stockData.name : symbol;
                    
                    return `
                        <div class="inline-flex items-center gap-1 bg-blue-600 text-white px-2 py-1 rounded text-xs font-mono">
                            <span>${symbol}</span>
                            <span class="text-blue-200 text-xs max-w-24 truncate" title="${displayName}">${displayName}</span>
                            <button onclick="removeStockFromPool('${symbol}')" class="text-blue-300 hover:text-white ml-1">√ó</button>
                        </div>
                    `;
                }).join('');
                
                stockListContainer.innerHTML = chipsHtml || '<div class="text-gray-400 text-xs font-mono">ÊöÇÊó†ÈÄâÊã©ËÇ°Á•®</div>';
            }
            
            console.log('‚úÖ ËÇ°Á•®ËäØÁâáÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
        };
        
        // ‰ªéÊäïËµÑÊ±†ÁßªÈô§ËÇ°Á•®ÂáΩÊï∞
        window.removeStockFromPool = function(symbol) {
            console.log('üóëÔ∏è ‰ªéÊäïËµÑÊ±†ÁßªÈô§ËÇ°Á•®:', symbol);
            
            const targetSymbolsInput = document.getElementById('target-symbols');
            if (targetSymbolsInput) {
                const currentSymbols = targetSymbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                const updatedSymbols = currentSymbols.filter(s => s !== symbol);
                
                targetSymbolsInput.value = updatedSymbols.join(', ');
                
                console.log('‚úÖ ËÇ°Á•®Â∑≤‰ªéÊäïËµÑÊ±†ÁßªÈô§:', symbol);
                showToast(`${symbol} Â∑≤ÁßªÈô§`, 'info');
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                window.updateStockChips();
            }
        };
        
        // ÈÄâÊã©ËÇ°Á•®ÂáΩÊï∞ - Áî®‰∫éË°å‰∏öÁ≠õÈÄâÂô®
        window.selectStock = function(symbol, name = symbol) {
            console.log('üéØ ÈÄâÊã©ËÇ°Á•®:', symbol, name);
            
            // Áõ¥Êé•Ë∞ÉÁî®Ê∑ªÂä†ËÇ°Á•®Âà∞ÊäïËµÑÊ±†ÂáΩÊï∞
            if (window.addStockToPool) {
                window.addStockToPool(symbol);
            } else {
                console.error('‚ùå addStockToPool ÂáΩÊï∞Êú™ÊâæÂà∞');
            }
        };
        
        // Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂáΩÊï∞
        window.loadMarketIndices = async function() {
            console.log('üìà Âä†ËΩΩÂ∏ÇÂú∫Êï∞ÊçÆ...');
            try {
                const response = await fetch(`${API_BASE_URL}/market-data/indices`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('‚úÖ Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', data.indices);
                
                // Êõ¥Êñ∞‰ª™Ë°®ÊùøÊòæÁ§∫
                window.updateMarketIndicesDisplay(data.indices || {});
                
                return data.indices;
            } catch (error) {
                console.error('‚ùå Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Â∏ÇÂú∫Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'error');
                }
                // ËøîÂõûÁ©∫ÂØπË±°‰ª•ÈÅøÂÖçÈîôËØØ
                return {};
            }
        };
        
        // Á≠ñÁï•Âä†ËΩΩÂáΩÊï∞
        window.loadStrategies = async function() {
            console.log('‚ö° Âä†ËΩΩÁ≠ñÁï•Êï∞ÊçÆ...');
            try {
                const response = await fetch(`${API_BASE_URL}/strategies/list`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                console.log('‚úÖ Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê:', data.strategies.length, '‰∏™Á≠ñÁï•');
                
                // Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫
                window.updateStrategiesDisplay(data);
                
                return data.strategies;
            } catch (error) {
                console.error('‚ùå Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Á≠ñÁï•Êï∞ÊçÆÂä†ËΩΩÂ§±Ë¥•', 'error');
                }
                // ËøîÂõûÁ©∫Êï∞ÁªÑ‰ª•ÈÅøÂÖçÈîôËØØ
                return [];
            }
        };

        async function loadRecentSignals(limit = 6) {
            console.log('üì° Âä†ËΩΩÊúÄÊñ∞‰∫§Êòì‰ø°Âè∑...');
            try {
                const query = buildQueryString(getDashboardQueryParams({ limit }));
                const response = await fetch(`${API_BASE_URL}/signals/recent${query}`);
                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }
                const payload = await response.json();
                const signals = Array.isArray(payload)
                    ? payload
                    : (payload.signals || payload.results || payload.data || []);
                if (!Array.isArray(signals)) {
                    throw new Error('Unknown signal payload format');
                }
                updateSignalsDisplay(signals);
                updateSignalsChart(signals);
                updateSignalStats(signals);
                displaySignalsInPanel(signals);
                return signals;
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩÊúÄÊñ∞‰ø°Âè∑Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÊúÄÊñ∞‰ø°Âè∑', 'warning');
                }
                return [];
            }
        }

        async function loadRecentOrders(limit = 8) {
            console.log('üì° Âä†ËΩΩËÆ¢ÂçïÂéÜÂè≤...');
            try {
                const response = await fetch(`${API_BASE_URL}/orders/history?limit=${limit}`);
                if (!response.ok) {
                    throw new Error(`HTTP error ${response.status}`);
                }
                const payload = await response.json();
                const orders = Array.isArray(payload)
                    ? payload
                    : (payload.orders || payload.results || payload.data || []);
                if (!Array.isArray(orders)) {
                    throw new Error('Unknown order payload format');
                }
                renderOrdersPanel(orders);
                return orders;
            } catch (error) {
                console.error('‚ùå ËÆ¢ÂçïÂéÜÂè≤Êõ¥Êñ∞Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩËÆ¢ÂçïÂéÜÂè≤', 'warning');
                }
                return [];
            }
        }

        function renderOrdersPanel(orders) {
            const ordersContainer = document.getElementById('orders-container');
            if (!ordersContainer) {
                console.warn('Êú™ÊâæÂà∞ËÆ¢ÂçïÂÆπÂô®');
                return;
            }

            const orderCountElement = document.querySelector('[data-i18n="zero-orders"]');
            if (orderCountElement) {
                const suffix = window.currentLanguage === 'zh' ? '‰∏™ËÆ¢Âçï' : ' ORDERS';
                orderCountElement.textContent = `${orders.length}${suffix}`;
                orderCountElement.className = orders.length > 0 ? 'text-xs font-mono text-blue-400' : 'text-xs font-mono text-gray-400';
            }

            if (!orders.length) {
                ordersContainer.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-center">
                        <div class="text-xs font-mono text-white opacity-70" data-i18n="click-execute-orders">
                            ÁÇπÂáª"ÊâßË°åÊ®°ÊãüËÆ¢Âçï"ÂºÄÂßã‰∫§Êòì...
                        </div>
                    </div>
                `;
                return;
            }

            ordersContainer.innerHTML = '';
            orders.forEach(order => {
                const symbol = order.symbol || order.ticker || order.asset || '‚Äî';
                const sideValue = order.side || order.action || 'HOLD';
                const side = sideValue ? sideValue.toUpperCase() : 'HOLD';
                const quantity = order.quantity || order.qty || order.size || 0;
                const priceValue = order.fill_price || order.price || order.avg_price || order.executed_price;
                const currency = order.currency || (symbol.endsWith('.SS') || symbol.endsWith('.SZ') ? '¬•' : '$');
                const formattedPrice = typeof priceValue === 'number'
                    ? `${currency}${priceValue.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`
                    : (priceValue || '--');
                const timestampValue = order.filled_at || order.executed_at || order.updated_at || order.created_at || order.timestamp;
                const formattedTime = timestampValue ? new Date(timestampValue).toLocaleString() : '';

                const orderElement = document.createElement('div');
                orderElement.className = 'border border-gray-600 p-2 mb-1 bg-gray-900 rounded text-xs';
                orderElement.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="font-mono text-white text-xs">${symbol}</span>
                        <span class="${side === 'BUY' ? 'text-green-400' : side === 'SELL' ? 'text-red-400' : 'text-gray-400'} font-bold text-xs">${side}</span>
                    </div>
                    <div class="flex justify-between items-center mt-1">
                        <span class="text-gray-400 text-xs">${window.currentLanguage === 'zh' ? 'Êï∞Èáè' : 'Qty'}: ${quantity}</span>
                        <span class="text-gray-400 text-xs">${formattedPrice}</span>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">
                        ${formattedTime}
                    </div>
                `;
                ordersContainer.appendChild(orderElement);
            });
        }

        // ËÆæÁΩÆÂØπË±°
        window.settings = {
            autoRefresh: true,
            refreshInterval: 30000,
            theme: 'dark',
            language: 'zh'
        };
        
        // Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆÂáΩÊï∞
        window.refreshAllData = function() {
            console.log('üîÑ Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆ...');
            try {
                // Âà∑Êñ∞ÂêÑÁßçÊï∞ÊçÆ
                if (window.loadMarketIndices) window.loadMarketIndices();
                if (window.loadStrategies) window.loadStrategies();
                if (typeof loadRecentSignals === 'function') loadRecentSignals();
                if (typeof loadRecentOrders === 'function') loadRecentOrders();
                if (typeof loadAnalyticsPanels === 'function') loadAnalyticsPanels();
                if (window.updateCharts) window.updateCharts();
                
                console.log('‚úÖ Êï∞ÊçÆÂà∑Êñ∞ÂÆåÊàê');
                if (window.showToast) {
                    window.showToast('‚úÖ Êï∞ÊçÆÂ∑≤Âà∑Êñ∞', 'success');
                }
            } catch (error) {
                console.error('‚ùå Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•', 'error');
                }
            }
        };
        
        // ÁîüÊàê‰ø°Âè∑ÂáΩÊï∞
        window.generateSignals = async function() {
            console.log('üöÄ ÁîüÊàê‰∫§Êòì‰ø°Âè∑...');
            
            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            const signalBtn = document.getElementById('signal-btn-text');
            const signalLoading = document.getElementById('signal-loading');
            
            if (signalBtn) signalBtn.textContent = window.t('generating-signals');
            if (signalLoading) signalLoading.classList.remove('hidden');
            
            try {
                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†
                const symbolsInput = document.getElementById('target-symbols');
                let symbols = ['AAPL', 'TSLA', 'MSFT', 'NVDA', 'GOOGL']; // ÈªòËÆ§ËÇ°Á•®Ê±†
                
                if (symbolsInput && symbolsInput.value) {
                    symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                }
                
                const requestData = {
                    symbols: symbols,
                    timeframe: '1D',
                    strategy_config: {
                        risk_level: 'moderate',
                        max_positions: 10,
                        confidence_threshold: 0.6
                    }
                };

                console.log('üì¶ ‰ø°Âè∑ÁîüÊàêËØ∑Ê±Ç:', requestData);

                const response = await fetch(`${API_BASE_URL}/signals/generate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData),
                    signal: AbortSignal.timeout(120000) // 120 second timeout - Â¢ûÂä†Âà∞120Áßí‰ª•ÊîØÊåÅÂ§öËÇ°Á•®ÊäÄÊúØÂàÜÊûê
                });
                
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP ${response.status}: ${errorText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ‰ø°Âè∑ÁîüÊàêÂÆåÊàê:', data.signals?.length || 0, '‰∏™‰ø°Âè∑');
                console.log('üìä ‰ø°Âè∑ËØ¶ÊÉÖ:', data.signals);

                // Ê£ÄÊü•ÊòØÂê¶Êúâ‰ø°Âè∑ÁîüÊàê
                if (data.signals && data.signals.length > 0) {
                    // Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫ÂíåÂõæË°®
                    updateSignalsDisplay(data.signals);
                    updateSignalsChart(data.signals);
                    updateSignalStats(data.signals);
                    displaySignalsInPanel(data.signals);

                    if (window.showToast) {
                        window.showToast(`üöÄ ÁîüÊàê ${data.signals.length} ‰∏™‰∫§Êòì‰ø°Âè∑`, 'success');
                    }

                    return data.signals;
                } else {
                    // ‰º†Áªü‰ø°Âè∑ÁîüÊàêËøîÂõûÁ©∫ÁªìÊûúÔºåÂ∞ùËØï‰ΩøÁî®AIÊâπÈáèÁîüÊàê
                    console.log('‚ö†Ô∏è ‰º†Áªü‰ø°Âè∑ÁîüÊàêËøîÂõûÁ©∫ÁªìÊûúÔºåÂ∞ùËØï‰ΩøÁî®AIÊâπÈáèÁîüÊàê...');

                    // Ëé∑ÂèñËÇ°Á•®ÂàóË°®
                    const symbolsInput = document.getElementById('target-symbols');
                    let symbols = ['AAPL', 'TSLA', 'MSFT', 'NVDA', 'GOOGL'];
                    if (symbolsInput && symbolsInput.value) {
                        symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }

                    // ‰ΩøÁî®AIÊâπÈáèÁîüÊàê
                    const aiSignals = await generateAISignals(symbols);

                    if (aiSignals && aiSignals.length > 0) {
                        if (window.showToast) {
                            window.showToast(`ü§ñ AIÁîüÊàê ${aiSignals.length} ‰∏™‰∫§Êòì‰ø°Âè∑`, 'success');
                        }
                        return aiSignals;
                    } else {
                        if (window.showToast) {
                            window.showToast('‚ö†Ô∏è Êú™ÁîüÊàê‰ªª‰Ωï‰ø°Âè∑ÔºåËØ∑Á®çÂêéÈáçËØï', 'warning');
                        }
                        return [];
                    }
                }
            } catch (error) {
                console.error('‚ùå ‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•:', error);

                // Âá∫ÈîôÊó∂‰πüÂ∞ùËØï‰ΩøÁî®AIÊâπÈáèÁîüÊàê‰Ωú‰∏∫Â§áÈÄâ
                console.log('‚ö†Ô∏è ‰ø°Âè∑ÁîüÊàêÂá∫ÈîôÔºåÂ∞ùËØï‰ΩøÁî®AIÊâπÈáèÁîüÊàê‰Ωú‰∏∫Â§áÈÄâ...');
                try {
                    const symbolsInput = document.getElementById('target-symbols');
                    let symbols = ['AAPL', 'TSLA', 'MSFT', 'NVDA', 'GOOGL'];
                    if (symbolsInput && symbolsInput.value) {
                        symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                    }

                    const aiSignals = await generateAISignals(symbols);
                    if (aiSignals && aiSignals.length > 0) {
                        if (window.showToast) {
                            window.showToast(`ü§ñ AIÂ§áÈÄâÁîüÊàê ${aiSignals.length} ‰∏™‰ø°Âè∑`, 'success');
                        }
                        return aiSignals;
                    }
                } catch (aiError) {
                    console.error('‚ùå AIÂ§áÈÄâÁîüÊàê‰πüÂ§±Ë¥•:', aiError);
                }

                if (window.showToast) {
                    window.showToast(`‚ùå ‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•: ${error.message}`, 'error');
                }
                return [];
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                if (signalBtn) signalBtn.textContent = window.t('generate-ai-signals');
                if (signalLoading) signalLoading.classList.add('hidden');
            }
        };
        
        // Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫
        function updateSignalsDisplay(signals) {
            try {
                console.log('üìä Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫:', signals.length, '‰∏™‰ø°Âè∑');
                
                // Êõ¥Êñ∞‰ªäÊó•‰ø°Âè∑Êï∞Èáè
                const signalsTodayElement = document.getElementById('signals-today');
                if (signalsTodayElement) {
                    signalsTodayElement.textContent = signals.length;
                }
                
                // Êõ¥Êñ∞‰ø°Âè∑Âº∫Â∫¶
                const signalStrengthElement = document.getElementById('signal-strength');
                if (signalStrengthElement && signals.length > 0) {
                    const avgConfidence = signals.reduce((sum, s) => sum + (s.confidence || 50), 0) / signals.length;
                    signalStrengthElement.textContent = `${avgConfidence.toFixed(1)}%`;
                }
                
                console.log('‚úÖ ‰ø°Âè∑ÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰ø°Âè∑ÊòæÁ§∫Â§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®
        function updateSignalsChart(signals) {
            try {
                // Ê£ÄÊü•‰ø°Âè∑Êï∞ÁªÑ
                if (!signals || !Array.isArray(signals)) {
                    console.warn('‚ö†Ô∏è ‰ø°Âè∑Êï∞ÊçÆÊó†ÊïàÔºå‰ΩøÁî®Á©∫Êï∞ÁªÑ');
                    signals = [];
                }

                if (signals.length === 0) {
                    console.log('‚ÑπÔ∏è ÂΩìÂâçÊó†‰∫§Êòì‰ø°Âè∑Êï∞ÊçÆÔºåÁ≠âÂæÖ‰ø°Âè∑ÁîüÊàê...');
                    return;
                }

                // ÁîüÊàê‰ø°Âè∑Âº∫Â∫¶Êï∞ÊçÆÁî®‰∫éÂõæË°®ÊòæÁ§∫
                const signalData = signals.map(signal => ({
                    x: signal.symbol,
                    y: (signal.confidence || 0.5) * 100,
                    action: signal.action,
                    color: signal.action === 'BUY' ? 'rgba(16, 185, 129, 0.8)' :
                           signal.action === 'SELL' ? 'rgba(239, 68, 68, 0.8)' : 'rgba(156, 163, 175, 0.8)'
                }));

                // Êõ¥Êñ∞Áé∞ÊúâÂõæË°®ÊàñÂàõÂª∫Êñ∞ÁöÑ‰ø°Âè∑ÂõæË°®
                if (window.updateSignalChart) {
                    window.updateSignalChart(signalData);
                }

                console.log(`‚úÖ ‰ø°Âè∑ÂõæË°®Â∑≤Êõ¥Êñ∞ (${signals.length}‰∏™‰ø°Âè∑)`);
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®Â§±Ë¥•:', error);
            }
        }

        // ‰ªéÂêéÁ´ØËé∑ÂèñÊúÄËøëÁöÑ‰ø°Âè∑
        async function fetchRecentSignals(limit = 50) {
            try {
                console.log('üîÑ Ê≠£Âú®Ëé∑ÂèñÊúÄËøëÁöÑ‰ø°Âè∑Êï∞ÊçÆ...');

                const response = await fetch(`${API_BASE_URL}/signals/recent?limit=${limit}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ Ëé∑ÂèñÂà∞‰ø°Âè∑Êï∞ÊçÆ:', data.count, '‰∏™‰ø°Âè∑');

                if (data.signals && data.signals.length > 0) {
                    // Êõ¥Êñ∞ÊâÄÊúâ‰ø°Âè∑ÊòæÁ§∫
                    updateSignalsDisplay(data.signals);
                    updateSignalsChart(data.signals);
                    updateSignalStats(data.signals);
                    displaySignalsInPanel(data.signals);

                    return data.signals;
                } else {
                    console.log('‚ÑπÔ∏è ÂêéÁ´ØÊöÇÊó†‰ø°Âè∑Êï∞ÊçÆ');
                    return [];
                }
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñÊúÄËøë‰ø°Âè∑Â§±Ë¥•:', error);
                return [];
            }
        }

        // ÂêØÂä®‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞Êú∫Âà∂
        let signalRefreshInterval = null;
        let initialSignalFetchDone = false;
        function startSignalAutoRefresh(intervalSeconds = 30) {
            // Ê∏ÖÈô§Â∑≤Â≠òÂú®ÁöÑÂÆöÊó∂Âô®
            if (signalRefreshInterval) {
                clearInterval(signalRefreshInterval);
            }

            console.log(`üîÑ ÂêØÂä®‰ø°Âè∑Êô∫ËÉΩÂà∑Êñ∞ÔºåÈó¥Èöî: ${intervalSeconds}Áßí`);

            // Á´ãÂç≥ÊâßË°å‰∏ÄÊ¨°Êô∫ËÉΩËé∑ÂèñÔºà‰ªÖÂú®È¶ñÊ¨°Ôºâ
            if (!initialSignalFetchDone) {
                smartFetchSignals().then(() => {
                    initialSignalFetchDone = true;
                });
            }

            // ËÆæÁΩÆÂÆöÊó∂Âà∑Êñ∞Ôºà‰ΩøÁî®Êô∫ËÉΩËé∑ÂèñÔºâ
            signalRefreshInterval = setInterval(() => {
                smartFetchSignals();
            }, intervalSeconds * 1000);
        }

        // ÂÅúÊ≠¢‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞
        function stopSignalAutoRefresh() {
            if (signalRefreshInterval) {
                clearInterval(signalRefreshInterval);
                signalRefreshInterval = null;
                console.log('‚èπÔ∏è Â∑≤ÂÅúÊ≠¢‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞');
            }
        }

        // ‰ΩøÁî®AIÊâπÈáèÁîüÊàê‰∫§Êòì‰ø°Âè∑
        async function generateAISignals(symbols = null) {
            try {
                console.log('ü§ñ Ê≠£Âú®‰ΩøÁî®AIÊâπÈáèÁîüÊàê‰∫§Êòì‰ø°Âè∑...');

                // Â¶ÇÊûúÊ≤°ÊúâÊèê‰æõËÇ°Á•®ÂàóË°®Ôºå‰ΩøÁî®ÈªòËÆ§ËÇ°Á•®Ê±†
                if (!symbols) {
                    const stockPool = JSON.parse(localStorage.getItem('stockPool') || '[]');
                    if (stockPool.length > 0) {
                        symbols = stockPool.map(s => s.symbol);
                    } else {
                        symbols = ['AAPL', 'TSLA', 'NVDA', 'MSFT', 'GOOGL'];
                    }
                }

                // ÈôêÂà∂ÊúÄÂ§ö10‰∏™ËÇ°Á•®
                if (symbols.length > 10) {
                    symbols = symbols.slice(0, 10);
                }

                console.log(`üìä ÁõÆÊ†áËÇ°Á•®: ${symbols.join(', ')}`);

                // ÊòæÁ§∫Âä†ËΩΩÊèêÁ§∫
                if (window.showToast) {
                    window.showToast(`ü§ñ Ê≠£Âú®‰∏∫ ${symbols.length} Âè™ËÇ°Á•®ÁîüÊàêAI‰ø°Âè∑...`, 'info');
                }

                // Ë∞ÉÁî®ÊâπÈáèAI‰ø°Âè∑ÁîüÊàêAPI
                const response = await fetch(`${API_BASE_URL}/api/ai/batch-generate-signals`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        symbols: symbols,
                        market: 'US',
                        strategy: 'momentum',
                        provider: 'deepseek'  // ‰ΩøÁî®DeepSeek‰Ωú‰∏∫AI provider
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('‚úÖ AI‰ø°Âè∑ÁîüÊàêÂÆåÊàê:', data);

                if (data.success && data.signals && data.signals.length > 0) {
                    // Êõ¥Êñ∞ÊâÄÊúâ‰ø°Âè∑ÊòæÁ§∫
                    updateSignalsDisplay(data.signals);
                    updateSignalsChart(data.signals);
                    updateSignalStats(data.signals);
                    displaySignalsInPanel(data.signals);

                    // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                    if (window.showToast) {
                        const successMsg = `‚úÖ ÊàêÂäüÁîüÊàê ${data.success_count} ‰∏™AI‰ø°Âè∑`;
                        const failMsg = data.failed_count > 0 ? `Ôºå${data.failed_count} ‰∏™Â§±Ë¥•` : '';
                        window.showToast(successMsg + failMsg, 'success');
                    }

                    return data.signals;
                } else {
                    console.warn('‚ö†Ô∏è AI‰ø°Âè∑ÁîüÊàêËøîÂõûÁ©∫ÁªìÊûú');
                    if (window.showToast) {
                        window.showToast('‚ö†Ô∏è AI‰ø°Âè∑ÁîüÊàêËøîÂõûÁ©∫ÁªìÊûúÔºåËØ∑Á®çÂêéÈáçËØï', 'warning');
                    }
                    return [];
                }
            } catch (error) {
                console.error('‚ùå AI‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast(`‚ùå AI‰ø°Âè∑ÁîüÊàêÂ§±Ë¥•: ${error.message}`, 'error');
                }
                return [];
            }
        }

        // Êô∫ËÉΩ‰ø°Âè∑Ëé∑ÂèñÔºö‰ºòÂÖà‰ΩøÁî®AIÁîüÊàêÔºåÂÖ∂Ê¨°‰ΩøÁî®ÊúÄËøë‰ø°Âè∑
        async function smartFetchSignals() {
            try {
                console.log('üß† Êô∫ËÉΩËé∑Âèñ‰ø°Âè∑...');

                // È¶ñÂÖàÊ£ÄÊü•AIÊòØÂê¶Â∑≤ÈÖçÁΩÆ
                const aiStatusResponse = await fetch(`${API_BASE_URL}/api/ai/status`);
                if (aiStatusResponse.ok) {
                    const aiStatus = await aiStatusResponse.json();

                    if (aiStatus.configured) {
                        console.log('‚úÖ AIÂ∑≤ÈÖçÁΩÆÔºå‰ΩøÁî®AIÁîüÊàê‰ø°Âè∑');
                        // AIÂ∑≤ÈÖçÁΩÆÔºå‰ΩøÁî®AIÊâπÈáèÁîüÊàê‰ø°Âè∑
                        const aiSignals = await generateAISignals();
                        if (aiSignals && aiSignals.length > 0) {
                            return aiSignals;
                        }
                    } else {
                        console.log('‚ö†Ô∏è AIÊú™ÈÖçÁΩÆÔºåÂ∞ùËØïËé∑ÂèñÊúÄËøë‰ø°Âè∑');
                    }
                }

                // AIÊú™ÈÖçÁΩÆÊàñÁîüÊàêÂ§±Ë¥•ÔºåÂ∞ùËØïËé∑ÂèñÊúÄËøëÁöÑ‰ø°Âè∑
                const recentSignals = await fetchRecentSignals();
                if (recentSignals && recentSignals.length > 0) {
                    return recentSignals;
                }

                console.log('‚ÑπÔ∏è ÊöÇÊó†ÂèØÁî®‰ø°Âè∑');
                return [];
            } catch (error) {
                console.error('‚ùå Êô∫ËÉΩ‰ø°Âè∑Ëé∑ÂèñÂ§±Ë¥•:', error);
                return [];
            }
        }

        // Êõ¥Êñ∞‰ø°Âè∑ÁªüËÆ°
        function updateSignalStats(signals) {
            try {
                const buySignals = signals.filter(s => s.action === 'BUY').length;
                const sellSignals = signals.filter(s => s.action === 'SELL').length;
                const holdSignals = signals.filter(s => s.action === 'HOLD').length;
                
                // Êõ¥Êñ∞‰ø°Âè∑ÂàÜÂ∏ÉÊòæÁ§∫
                const signalDistribution = document.querySelector('.signal-distribution');
                if (signalDistribution) {
                    signalDistribution.innerHTML = `
                        <div class="text-xs text-gray-400">‰ø°Âè∑ÂàÜÂ∏É:</div>
                        <div class="flex gap-2 text-xs mt-1">
                            <span class="text-green-400">‰π∞ÂÖ•:${buySignals}</span>
                            <span class="text-red-400">ÂçñÂá∫:${sellSignals}</span>
                            <span class="text-gray-400">ÊåÅÊúâ:${holdSignals}</span>
                        </div>
                    `;
                }
                
                console.log('‚úÖ ‰ø°Âè∑ÁªüËÆ°Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰ø°Âè∑ÁªüËÆ°Â§±Ë¥•:', error);
            }
        }
        
        // Âú®Èù¢Êùø‰∏≠ÊòæÁ§∫‰ø°Âè∑ËØ¶ÊÉÖ
        function displaySignalsInPanel(signals) {
            try {
                const signalsContainer = document.getElementById('signals-container');
                if (!signalsContainer) {
                    console.error('‚ùå Êâæ‰∏çÂà∞signals-containerÂÖÉÁ¥†');
                    return;
                }
                
                console.log('üìä Âú®Èù¢Êùø‰∏≠ÊòæÁ§∫‰ø°Âè∑:', signals.length, '‰∏™');
                
                // Êõ¥Êñ∞‰ø°Âè∑ËÆ°Êï∞ÊòæÁ§∫
                const signalCountElement = document.querySelector('[data-i18n="zero-signals"]');
                if (signalCountElement) {
                    signalCountElement.textContent = `${signals.length}‰∏™‰ø°Âè∑`;
                    signalCountElement.className = 'text-xs font-mono text-green-400';
                }
                
                if (signals.length === 0) {
                    signalsContainer.innerHTML = `
                        <div class="flex flex-col items-center justify-center h-full text-center">
                            <div class="text-xs font-mono text-white opacity-70" data-i18n="click-generate-signals">
                                ÁÇπÂáª"ÁîüÊàêAI‰∫§Êòì‰ø°Âè∑"ÂºÄÂßãÂàÜÊûê...
                            </div>
                        </div>
                    `;
                    return;
                }
                
                // Ê∏ÖÁ©∫Áé∞Êúâ‰ø°Âè∑
                signalsContainer.innerHTML = '';
                
                signals.forEach((signal, index) => {
                    const signalElement = document.createElement('div');
                    signalElement.className = 'border border-gray-600 p-2 mb-1 bg-gray-900 rounded text-xs';
                    
                    const confidenceColor = signal.confidence > 0.8 ? 'text-green-400' :
                                          signal.confidence > 0.6 ? 'text-yellow-400' : 'text-red-400';
                    
                    const actionColor = signal.action === 'BUY' ? 'text-green-400' :
                                       signal.action === 'SELL' ? 'text-red-400' : 'text-gray-400';
                    
                    signalElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="font-mono text-white text-xs">${signal.symbol}</span>
                            <span class="${actionColor} font-bold text-xs">${signal.action}</span>
                        </div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-gray-400 text-xs">${translations[currentLanguage]['confidence']}: <span class="${confidenceColor}">${((signal.confidence || 0.5) * 100).toFixed(0)}%</span></span>
                            <span class="text-gray-400 text-xs">Ôø•${signal.current_price || 'N/A'}</span>
                        </div>
                        <div class="mt-1">
                            <button data-symbol="${signal.symbol}" data-action="${signal.action}" data-quantity="100"
                                    class="execute-signal-btn w-full bg-blue-600 text-white text-xs py-1 px-2 rounded hover:bg-blue-700 transition">
                                ${translations[currentLanguage]['execute']}
                            </button>
                        </div>
                    `;
                    
                    signalsContainer.appendChild(signalElement);
                    
                    // ‰∏∫Êñ∞ÂàõÂª∫ÁöÑÊåâÈíÆÊ∑ªÂä†‰∫ã‰ª∂ÁõëÂê¨Âô®
                    const executeBtn = signalElement.querySelector('.execute-signal-btn');
                    if (executeBtn) {
                        executeBtn.addEventListener('click', async function() {
                            const symbol = this.getAttribute('data-symbol');
                            const action = this.getAttribute('data-action');
                            const quantity = this.getAttribute('data-quantity');
                            
                            console.log(`üéØ ${translations[currentLanguage]['execute']} ${translations[currentLanguage]['signal']}: ${symbol} ${action} ${quantity}${translations[currentLanguage]['shares-unit']}`);
                            
                            // ÊòæÁ§∫ÊåâÈíÆÁÇπÂáªÂèçÈ¶à
                            this.style.backgroundColor = '#1d4ed8';
                            this.textContent = translations[currentLanguage]['executing'];
                            this.disabled = true;
                            
                            try {
                                await window.executeOrder(symbol, action, parseInt(quantity));
                                this.textContent = translations[currentLanguage]['executed'];
                                this.style.backgroundColor = '#059669';
                                
                                // 3ÁßíÂêéÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                                setTimeout(() => {
                                    this.textContent = translations[currentLanguage]['execute'];
                                    this.style.backgroundColor = '#2563eb';
                                    this.disabled = false;
                                }, 3000);
                            } catch (error) {
                                console.error('ÊâßË°åËÆ¢ÂçïÂ§±Ë¥•:', error);
                                this.textContent = translations[currentLanguage]['execution-failed'];
                                this.style.backgroundColor = '#dc2626';
                                
                                // 2ÁßíÂêéÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                                setTimeout(() => {
                                    this.textContent = translations[currentLanguage]['execute'];
                                    this.style.backgroundColor = '#2563eb';
                                    this.disabled = false;
                                }, 2000);
                            }
                        });
                    }
                });
                
                console.log('‚úÖ ‰ø°Âè∑Èù¢ÊùøÊòæÁ§∫ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰ø°Âè∑Èù¢ÊùøÂ§±Ë¥•:', error);
            }
        }

        async function runBacktest() {
            console.log('üß™ ÂºÄÂßãÂõûÊµã...');
            const button = document.querySelector('button[onclick="runBacktest()"]');
            if (button) {
                button.disabled = true;
                button.textContent = 'RUNNING...';
            }

            const strategy = document.getElementById('backtest-strategy')?.value || 'momentum';
            const capital = parseFloat(document.getElementById('backtest-capital')?.value || tradingState.totalCapital || 100000);
            const symbols = (document.getElementById('backtest-symbols')?.value || 'AAPL,MSFT').split(/[,Ôºå\s]+/).filter(Boolean);
            const period = document.getElementById('backtest-period')?.value || '6m';
            const market = document.getElementById('backtest-market')?.value || '';

            const query = new URLSearchParams({
                capital: capital || '',
                period,
                symbols: symbols.join(',')
            });
            if (market) {
                query.set('market', market);
            }

            try {
                const response = await fetch(`${API_BASE_URL}/strategies/backtest/${encodeURIComponent(strategy)}?${query.toString()}`);
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || data.message || 'ÂõûÊµãËØ∑Ê±ÇÂ§±Ë¥•');
                }
                renderBacktestResults(data);
                showToast('‚úÖ ÂõûÊµãÂÆåÊàê', 'success');
            } catch (error) {
                console.error('ÂõûÊµãÂ§±Ë¥•:', error);
                showToast('‚ùå ÂõûÊµãÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                if (button) {
                    button.disabled = false;
                    button.textContent = 'RUN BACKTEST';
                }
            }
        }

        function renderBacktestResults(result) {
            const container = document.getElementById('backtest-results');
            const output = document.getElementById('backtest-output');
            if (!container || !output) return;
            container.classList.remove('hidden');

            const metrics = result.metrics || result;
            const rows = [];
            const mapping = [
                ['total_return', 'TOTAL RETURN', value => `${(value * 100).toFixed(2)}%`],
                ['annual_return', 'ANNUAL RETURN', value => `${(value * 100).toFixed(2)}%`],
                ['max_drawdown', 'MAX DRAWDOWN', value => `${(value * 100).toFixed(2)}%`],
                ['sharpe_ratio', 'SHARPE', value => value.toFixed(2)],
                ['win_rate', 'WIN RATE', value => `${(value * 100).toFixed(2)}%`],
                ['trades', 'TRADES', value => value]
            ];

            mapping.forEach(([key, label, formatter]) => {
                if (typeof metrics[key] === 'number') {
                    rows.push(`<div class="flex justify-between"><span>${label}</span><span>${formatter(metrics[key])}</span></div>`);
                }
            });

            if (!rows.length) {
                output.innerHTML = `<pre class="whitespace-pre-wrap">${JSON.stringify(result, null, 2)}</pre>`;
            } else {
                output.innerHTML = rows.join('');
            }
        }

        async function calculateIndicators() {
            console.log('üìê ËÆ°ÁÆóÊäÄÊúØÊåáÊ†á...');
            const button = document.querySelector('button[onclick="calculateIndicators()"]');
            if (button) {
                button.disabled = true;
                button.textContent = 'CALCULATING...';
            }

            const indicator = document.getElementById('indicator-type')?.value || 'sma';
            const symbol = document.getElementById('indicator-symbol')?.value || 'AAPL';
            const period = parseInt(document.getElementById('indicator-period')?.value || '20', 10);
            const points = parseInt(document.getElementById('indicator-points')?.value || '100', 10);
            const market = document.getElementById('indicator-market')?.value || '';

            try {
                const query = new URLSearchParams({ indicator, period, points });
                if (market) {
                    query.set('market', market);
                }
                const response = await fetch(`${API_BASE_URL}/analysis/indicators/${encodeURIComponent(symbol)}?${query.toString()}`);
                const data = await response.json();
                if (!response.ok) {
                    throw new Error(data.detail || data.message || 'ÊåáÊ†áËØ∑Ê±ÇÂ§±Ë¥•');
                }
                renderIndicatorResults(data);
                showToast('‚úÖ ÊåáÊ†áËÆ°ÁÆóÂÆåÊàê', 'success');
            } catch (error) {
                console.error('ÊåáÊ†áËÆ°ÁÆóÂ§±Ë¥•:', error);
                showToast('‚ùå ÊåáÊ†áËÆ°ÁÆóÂ§±Ë¥•: ' + error.message, 'error');
            } finally {
                if (button) {
                    button.disabled = false;
                    button.textContent = 'CALCULATE';
                }
            }
        }

        function renderIndicatorResults(result) {
            const container = document.getElementById('indicator-results');
            const output = document.getElementById('indicator-output');
            if (!container || !output) return;
            container.classList.remove('hidden');

            // ÂÆâÂÖ®Âú∞Â§ÑÁêÜÂèØËÉΩÊú™ÂÆö‰πâÁöÑÂ±ûÊÄß
            const symbol = result.symbol || 'N/A';
            const indicator = result.indicator ? result.indicator.toUpperCase() : (result.model_used ? 'AI_MODEL' : 'TECHNICAL');
            const period = result.period || result.points || 20;

            let content = `<div>Symbol: <span class="text-green-400">${symbol}</span></div>`;
            content += `<div>Indicator: <span class="text-green-400">${indicator}</span></div>`;
            content += `<div>Period: <span class="text-green-400">${period}</span></div>`;
            
            // Â¶ÇÊûúÊúâÊ®°Âûã‰ø°ÊÅØÔºåÊòæÁ§∫È¢ùÂ§ñÁöÑAIÁõ∏ÂÖ≥‰ø°ÊÅØ
            if (result.model_used) {
                content += `<div>Model: <span class="text-blue-400">${result.model_used}</span></div>`;
                if (result.prediction_confidence) {
                    content += `<div>Confidence: <span class="text-yellow-400">${(result.prediction_confidence * 100).toFixed(1)}%</span></div>`;
                }
                if (result.signal_strength) {
                    content += `<div>Signal: <span class="text-purple-400">${result.signal_strength}</span></div>`;
                }
            }

            // Â§ÑÁêÜÊäÄÊúØÊåáÊ†áÊï∞ÊçÆ
            const indicators = result.indicators || result.result || {};
            Object.keys(indicators).forEach(key => {
                const value = indicators[key];
                if (Array.isArray(value)) {
                    // Â¶ÇÊûúÊòØÊï∞ÁªÑÔºåÊòæÁ§∫ÊúÄËøëÁöÑÂÄº
                    const latestValue = value[value.length - 1];
                    const displayValue = typeof latestValue === 'number' ? latestValue.toFixed(4) : latestValue;
                    content += `<div>${key.replace(/_/g, ' ').toUpperCase()}: <span class="text-green-400">${displayValue}</span></div>`;
                } else if (typeof value === 'number') {
                    content += `<div>${key.replace(/_/g, ' ').toUpperCase()}: <span class="text-green-400">${value.toFixed(4)}</span></div>`;
                } else if (value !== null && value !== undefined) {
                    content += `<div>${key.replace(/_/g, ' ').toUpperCase()}: <span class="text-green-400">${value}</span></div>`;
                }
            });

            // Ê∑ªÂä†Êï∞ÊçÆÊ∫ê‰ø°ÊÅØ
            if (result.data_source) {
                content += `<div>Data Source: <span class="text-cyan-400">${result.data_source}</span></div>`;
            }

            if (result.latest_price) {
                content += `<div>Latest Close: <span class="text-green-400">${result.latest_price.toFixed(2)}</span></div>`;
            }

            output.innerHTML = content;
        }
        
        // ÊâßË°åËÆ¢ÂçïÂáΩÊï∞
        // ÊâßË°åÊ®°ÊãüËÆ¢ÂçïÂáΩÊï∞ÔºàÊó†ÂèÇÊï∞ÁâàÊú¨Ôºâ
        window.executeSimulationOrder = async function() {
            console.log('üéØ ÊâßË°åÊ®°ÊãüËÆ¢Âçï...');
            
            // ÊòæÁ§∫ÊåâÈíÆÁÇπÂáªÂèçÈ¶à
            if (window.showToast) {
                window.showToast('üéØ ÂºÄÂßãÊâßË°åÊ®°ÊãüËÆ¢Âçï...', 'info');
            }
            
            try {
                // Ëé∑ÂèñËÇ°Á•®Ê±†‰∏≠ÁöÑËÇ°Á•®ÔºåÊàñ‰ΩøÁî®ÈªòËÆ§ËÇ°Á•®
                const symbolsInput = document.getElementById('target-symbols');
                let symbol = 'AAPL'; // ÈªòËÆ§ËÇ°Á•®
                
                if (symbolsInput && symbolsInput.value) {
                    const symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                    if (symbols.length > 0) {
                        // ÈöèÊú∫ÈÄâÊã©‰∏Ä‰∏™ËÇ°Á•®
                        symbol = symbols[Math.floor(Math.random() * symbols.length)];
                    }
                }
                
                // ÈöèÊú∫ÈÄâÊã©‰π∞ÂÖ•ÊàñÂçñÂá∫
                const action = Math.random() > 0.5 ? 'BUY' : 'SELL';
                
                // ÈöèÊú∫Êï∞Èáè (50-200ËÇ°)
                const quantity = Math.floor(Math.random() * 151) + 50;
                
                console.log(`üéØ ${translations[currentLanguage]['execute-simulation-order']}: ${symbol} ${action} ${quantity}${translations[currentLanguage]['shares-unit']}`);
                
                // Ë∞ÉÁî®ÂÆûÈôÖÁöÑÊâßË°åËÆ¢ÂçïÂáΩÊï∞
                const result = await window.executeOrder(symbol, action, quantity);
                
                if (result) {
                    if (window.showToast) {
                        window.showToast(`üéØ Ê®°ÊãüËÆ¢ÂçïÊâßË°åÊàêÂäü: ${action} ${symbol}`, 'success');
                    }
                } else {
                    if (window.showToast) {
                        window.showToast('‚ùå Ê®°ÊãüËÆ¢ÂçïÊâßË°åÂ§±Ë¥•', 'error');
                    }
                }
                
                return result;
            } catch (error) {
                console.error('‚ùå ÊâßË°åÊ®°ÊãüËÆ¢ÂçïÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Ê®°ÊãüËÆ¢ÂçïÊâßË°åÂ§±Ë¥•', 'error');
                }
                return null;
            }
        };

        window.executeOrder = async function(symbol, action, quantity) {
            console.log('‚ö° ÊâßË°åËÆ¢Âçï:', { symbol, action, quantity });
            
            // È™åËØÅÂèÇÊï∞
            if (!symbol) {
                const symbolsInput = document.getElementById('target-symbols');
                if (symbolsInput && symbolsInput.value) {
                    const symbols = symbolsInput.value.split(',').map(s => s.trim()).filter(s => s);
                    symbol = symbols[0]; // ‰ΩøÁî®Á¨¨‰∏Ä‰∏™ËÇ°Á•®
                } else {
                    symbol = 'AAPL'; // ÈªòËÆ§ËÇ°Á•®
                }
            }
            
            action = action || 'BUY';
            quantity = quantity || 100;
            
            try {
                const orderData = {
                    symbol: symbol,
                    side: action ? action.toUpperCase() : 'BUY',
                    quantity: parseFloat(quantity),
                    order_type: 'MARKET'
                };
                
                console.log('üì¶ ÂèëÈÄÅËÆ¢ÂçïÊï∞ÊçÆ:', orderData);
                
                const response = await fetch(`${API_BASE_URL}/orders/submit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(orderData)
                });
                
                console.log('üì° ÊúçÂä°Âô®ÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.statusText);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('‚ùå ÊúçÂä°Âô®ÈîôËØØÂìçÂ∫î:', errorText);
                    throw new Error(`HTTP ${response.status}: ${response.statusText} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ËÆ¢ÂçïÊâßË°åÂÆåÊàê:', data);
                
                // Êõ¥Êñ∞ÂõæË°®ÂíåÊòæÁ§∫
                if (data.fill_price && data.quantity) {
                    updateTradeExecution({
                        symbol: data.symbol,
                        action: data.side,
                        price: data.fill_price,
                        quantity: data.fill_quantity,
                        amount: data.fill_price * data.fill_quantity,
                        timestamp: new Date().toISOString()
                    });
                }
                
                // Êõ¥Êñ∞ËÆ¢ÂçïÂéÜÂè≤ÊòæÁ§∫
                if (window.updateOrderHistory) {
                    window.updateOrderHistory();
                }
                
                // Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®
                if (window.updateVolumeChart) {
                    window.updateVolumeChart(data.fill_price * data.fill_quantity);
                }
                
                // Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®
                if (window.updatePerformanceChart) {
                    window.updatePerformanceChart({
                        timestamp: new Date(),
                        pnl: (data.side === 'BUY' ? -1 : 1) * data.fill_price * data.fill_quantity,
                        volume: data.fill_price * data.fill_quantity
                    });
                }
                
                if (window.showToast) {
                    window.showToast(`‚úÖ ${data.side} ${data.symbol} ${data.fill_quantity}${translations[currentLanguage]['shares-unit']}Ôºå${translations[currentLanguage]['filled-price']}Ôø•${data.fill_price}`, 'success');
                }
                
                return data;
            } catch (error) {
                console.error('‚ùå ËÆ¢ÂçïÊâßË°åÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast(`‚ùå ${action} ${symbol} ËÆ¢ÂçïÊâßË°åÂ§±Ë¥•: ${error.message}`, 'error');
                }
                return null;
            }
        };
        
        // Êõ¥Êñ∞‰∫§ÊòìÊâßË°åÊòæÁ§∫
        function updateTradeExecution(trade) {
            try {
                console.log('üìä Êõ¥Êñ∞‰∫§ÊòìÊâßË°åÊòæÁ§∫:', trade);
                
                // Êõ¥Êñ∞ËÆ¢ÂçïÊòæÁ§∫Èù¢Êùø
                const ordersContainer = document.getElementById('orders-container');
                if (ordersContainer) {
                    // Êõ¥Êñ∞ËÆ¢ÂçïËÆ°Êï∞ÊòæÁ§∫
                    const orderCountElement = document.querySelector('[data-i18n="zero-orders"]');
                    if (orderCountElement) {
                        const currentCount = parseInt(orderCountElement.textContent.match(/\d+/)?.[0] || '0');
                        orderCountElement.textContent = `${currentCount + 1}‰∏™ËÆ¢Âçï`;
                        orderCountElement.className = 'text-xs font-mono text-blue-400';
                    }
                    
                    // Â¶ÇÊûúÊòØÁ©∫ÂÆπÂô®ÔºåÂÖàÊ∏ÖÈô§ÊèêÁ§∫‰ø°ÊÅØ
                    const emptyPrompt = ordersContainer.querySelector('.flex.flex-col.items-center.justify-center');
                    if (emptyPrompt) {
                        ordersContainer.innerHTML = '';
                    }
                    
                    const orderElement = document.createElement('div');
                    orderElement.className = 'border border-gray-600 p-2 mb-1 bg-gray-900 rounded text-xs';
                    orderElement.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="font-mono text-white text-xs">${trade.symbol}</span>
                            <span class="${trade.action === 'BUY' ? 'text-green-400' : 'text-red-400'} font-bold text-xs">${trade.action}</span>
                        </div>
                        <div class="flex justify-between items-center mt-1">
                            <span class="text-gray-400 text-xs">Êï∞Èáè: ${trade.quantity}</span>
                            <span class="text-gray-400 text-xs">Ôø•${trade.price}</span>
                        </div>
                        <div class="text-xs text-gray-500 mt-1">
                            ${new Date(trade.timestamp).toLocaleString()}
                        </div>
                    `;
                    
                    // ÊèíÂÖ•Âà∞È°∂ÈÉ®
                    ordersContainer.insertBefore(orderElement, ordersContainer.firstChild);
                    
                    // ‰øùÊåÅÊúÄÂ§ö8‰∏™ËÆ¢ÂçïÊòæÁ§∫
                    const orders = Array.from(ordersContainer.children);
                    if (orders.length > 8) {
                        try {
                            const elementToRemove = orders[orders.length - 1];
                            if (elementToRemove && elementToRemove.parentNode) {
                                elementToRemove.remove();
                            }
                        } catch (e) {
                            console.warn('Êó†Ê≥ïÁßªÈô§ËÆ¢ÂçïÂÖÉÁ¥†:', e);
                        }
                    }
                }
                
                // Êõ¥Êñ∞ÁªüËÆ°Êï∞ÊçÆ
                updateTradingStats(trade);
                
                console.log('‚úÖ ‰∫§ÊòìÊâßË°åÊòæÁ§∫Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰∫§ÊòìÊâßË°åÊòæÁ§∫Â§±Ë¥•:', error);
            }
        }
        
        // Êõ¥Êñ∞‰∫§ÊòìÁªüËÆ°
        function updateTradingStats(trade) {
            try {
                // Êõ¥Êñ∞Êàê‰∫§Èáè (‰øÆÂ§çNaNÈóÆÈ¢ò)
                const volumeElement = document.getElementById('total-volume');
                if (volumeElement) {
                    const currentText = volumeElement.textContent || '$0';
                    const currentVolume = parseFloat(currentText.replace(/[,$Ôø•]/g, '')) || 0;
                    const tradeAmount = parseFloat(trade.amount) || 0;
                    const newVolume = currentVolume + tradeAmount;
                    
                    if (!isNaN(newVolume) && newVolume >= 0) {
                        volumeElement.textContent = `$${newVolume.toLocaleString()}`;
                    } else {
                        volumeElement.textContent = '$0';
                    }
                }
                
                console.log('‚úÖ ‰∫§ÊòìÁªüËÆ°Â∑≤Êõ¥Êñ∞');
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰∫§ÊòìÁªüËÆ°Â§±Ë¥•:', error);
            }
        }
        
        // ÂõæË°®Êõ¥Êñ∞ÂáΩÊï∞ÈõÜÂêà
        window.updateVolumeChart = function(volume) {
            try {
                console.log('üìä Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®:', volume);
                
                // Ëé∑ÂèñÊàê‰∫§ÈáèÂõæË°®
                const volumeChart = window.volumeChart;
                if (volumeChart && volumeChart.data && volumeChart.data.datasets) {
                    const now = new Date();
                    const dataset = volumeChart.data.datasets[0];
                    
                    // Ê∑ªÂä†Êñ∞Êï∞ÊçÆÁÇπ
                    dataset.data.push({
                        x: now,
                        y: volume
                    });
                    
                    // ‰øùÊåÅÊúÄËøë50‰∏™Êï∞ÊçÆÁÇπ
                    if (dataset.data.length > 50) {
                        dataset.data.shift();
                    }
                    
                    volumeChart.update('none');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞Êàê‰∫§ÈáèÂõæË°®Â§±Ë¥•:', error);
            }
        };
        
        window.updatePerformanceChart = function(performanceData) {
            try {
                console.log('üìà Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®:', performanceData);
                
                // Ëé∑ÂèñÊÄßËÉΩÂõæË°®
                const perfChart = window.performanceChart;
                if (perfChart && perfChart.data && perfChart.data.datasets) {
                    const dataset = perfChart.data.datasets[0];
                    
                    // ËÆ°ÁÆóÁ¥ØÁßØÁõà‰∫è
                    const lastValue = dataset.data.length > 0 ? dataset.data[dataset.data.length - 1].y : 0;
                    const newValue = lastValue + performanceData.pnl;
                    
                    // Ê∑ªÂä†Êñ∞Êï∞ÊçÆÁÇπ
                    dataset.data.push({
                        x: performanceData.timestamp,
                        y: newValue
                    });
                    
                    // ‰øùÊåÅÊúÄËøë100‰∏™Êï∞ÊçÆÁÇπ
                    if (dataset.data.length > 100) {
                        dataset.data.shift();
                    }
                    
                    perfChart.update('none');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®Â§±Ë¥•:', error);
            }
        };
        
        window.updateSignalChart = function(signalData) {
            try {
                console.log('üöÄ Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®:', signalData);
                
                // Â¶ÇÊûúÊ≤°Êúâ‰∏ìÈó®ÁöÑ‰ø°Âè∑ÂõæË°®ÔºåÂú®Áé∞ÊúâÂõæË°®‰∏äÊ∑ªÂä†‰ø°Âè∑Ê†áËÆ∞
                const mainChart = window.volumeChart || window.performanceChart;
                if (mainChart && mainChart.options && mainChart.options.plugins) {
                    // Ê∑ªÂä†‰ø°Âè∑Ê≥®Èáä
                    if (!mainChart.options.plugins.annotation) {
                        mainChart.options.plugins.annotation = { annotations: {} };
                    }
                    
                    // Ê∏ÖÈô§‰πãÂâçÁöÑ‰ø°Âè∑Ê≥®Èáä
                    mainChart.options.plugins.annotation.annotations = {};
                    
                    // Ê∑ªÂä†Êñ∞ÁöÑ‰ø°Âè∑Ê≥®Èáä
                    signalData.forEach((signal, index) => {
                        mainChart.options.plugins.annotation.annotations[`signal_${index}`] = {
                            type: 'point',
                            xValue: new Date(),
                            yValue: signal.y,
                            backgroundColor: signal.color,
                            radius: 8,
                            borderWidth: 2,
                            borderColor: '#ffffff',
                            label: {
                                content: `${signal.action} ${signal.x}`,
                                enabled: true,
                                position: 'top'
                            }
                        };
                    });
                    
                    mainChart.update('none');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞‰ø°Âè∑ÂõæË°®Â§±Ë¥•:', error);
            }
        };
        
        window.startAutoUpdate = startAutoUpdate;
        
        // Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆ
        window.refreshAllData = async function() {
            try {
                console.log('üîÑ Âà∑Êñ∞ÊâÄÊúâÊï∞ÊçÆ...');

                await loadInitialData();

                if (typeof loadAnalyticsPanels === 'function') {
                    await loadAnalyticsPanels();
                }

                if (window.updateChartData) {
                    window.updateChartData();
                }

                await Promise.all([
                    loadRecentSignals(),
                    loadRecentOrders()
                ]);

                if (window.updatePoolStats) {
                    window.updatePoolStats();
                }

                updateTime();

                if (window.showToast) {
                    window.showToast('‚úÖ Êï∞ÊçÆÂà∑Êñ∞ÂÆåÊàê', 'success');
                }

                console.log('‚úÖ ÊâÄÊúâÊï∞ÊçÆÂà∑Êñ∞ÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå Âà∑Êñ∞Êï∞ÊçÆÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå Êï∞ÊçÆÂà∑Êñ∞Â§±Ë¥•', 'error');
                }
            }
        };

        // Êõ¥Êñ∞Â∏ÇÂú∫ÊåáÊï∞ÊòæÁ§∫
        window.updateMarketIndicesDisplay = function(indices) {
            console.log('üìä Êõ¥Êñ∞Â∏ÇÂú∫ÊåáÊï∞ÊòæÁ§∫:', indices);
            const sanitizeNumber = (value, fallback = null) => {
                if (typeof value === 'number') return value;
                if (typeof value === 'string' && value.trim() !== '') {
                    const parsed = parseFloat(value);
                    return Number.isNaN(parsed) ? fallback : parsed;
                }
                return fallback;
            };
            // Êõ¥Êñ∞‰∏ªË¶ÅÊåáÊï∞ÊòæÁ§∫
            for (const [symbol, data] of Object.entries(indices)) {
                const element = document.querySelector(`[data-index="${symbol}"]`);
                if (element) {
                    const priceElement = element.querySelector('.index-price');
                    const changeElement = element.querySelector('.index-change');
                    if (priceElement) {
                        const priceVal = sanitizeNumber(data.price, sanitizeNumber(data.last_price));
                        priceElement.textContent = (priceVal !== null) ? priceVal.toFixed(2) : '--';
                    }
                    if (changeElement) {
                        const changePct = sanitizeNumber(data.change_percent, sanitizeNumber(data.change));
                        if (changePct !== null) {
                            changeElement.textContent = `${changePct >= 0 ? '+' : ''}${changePct.toFixed(2)}%`;
                            changeElement.className = `index-change ${changePct >= 0 ? 'text-green-400' : 'text-red-400'}`;
                        } else {
                            changeElement.textContent = '--';
                            changeElement.className = 'index-change text-gray-400';
                        }
                    }
                }
            }
        };

        // Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫
        window.updateStrategiesDisplay = function(data) {
            console.log('‚ö° Êõ¥Êñ∞Á≠ñÁï•ÊòæÁ§∫:', data);
            // Êõ¥Êñ∞Ê¥ªË∑ÉÁ≠ñÁï•Êï∞Èáè
            const activeStrategiesElement = document.getElementById('active-strategies');
            if (activeStrategiesElement) {
                activeStrategiesElement.textContent = data.total_active || data.strategies.length;
            }
            
            // Êõ¥Êñ∞Á≠ñÁï•ÁªüËÆ°
            const avgSharpeElement = document.querySelector('.avg-sharpe');
            if (avgSharpeElement) {
                avgSharpeElement.textContent = data.avg_sharpe || 'N/A';
            }
        };

        window.updateSignalsDisplay = updateSignalsDisplay;
        window.updateOrderHistory = () => loadRecentOrders(8);
        window.loadInitialChartData = loadInitialChartData;
        window.loadRecentSignals = loadRecentSignals;
        window.loadRecentOrders = loadRecentOrders;
        window.runBacktest = runBacktest;
        window.calculateIndicators = calculateIndicators;
        
        // ÊâìÂºÄËÆæÁΩÆÂáΩÊï∞
        window.openSettings = function() {
            console.log('‚öôÔ∏è ÊâìÂºÄËÆæÁΩÆ...');
            const modal = document.getElementById('settings-modal');
            if (modal) {
                modal.classList.remove('hidden');
                console.log('‚úÖ ËÆæÁΩÆÈù¢ÊùøÂ∑≤ÊâìÂºÄ');
                
                // Âä†ËΩΩÂΩìÂâçÈÖçÁΩÆÁä∂ÊÄÅ
                window.loadCurrentSettings();
            } else {
                console.error('‚ùå ËÆæÁΩÆÈù¢ÊùøÂÖÉÁ¥†‰∏çÂ≠òÂú®');
                if (window.showToast) {
                    window.showToast('‚ùå ËÆæÁΩÆÈù¢ÊùøÊú™ÊâæÂà∞', 'error');
                }
            }
        };
        
        // Âä†ËΩΩÂΩìÂâçËÆæÁΩÆ
        window.loadCurrentSettings = async function() {
            console.log('üìÇ Âä†ËΩΩÂΩìÂâçËÆæÁΩÆ...');
            try {
                // Âä†ËΩΩÊï∞ÊçÆÊ∫êÈÖçÁΩÆÁä∂ÊÄÅ
                const response = await fetch(`${API_BASE_URL}/config/data-source`);
                if (response.ok) {
                    const config = await response.json();
                    console.log('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆÂä†ËΩΩÊàêÂäü:', config);
                    
                    // Êõ¥Êñ∞UIÁä∂ÊÄÅ
                    const tushareStatus = document.getElementById('tushare-status');
                    if (tushareStatus) {
                        if (config.tushare_enabled) {
                            tushareStatus.textContent = window.t('configured');
                            tushareStatus.className = 'text-green-400';
                        } else {
                            tushareStatus.textContent = window.t('not-configured');
                            tushareStatus.className = 'text-gray-400';
                        }
                    }
                } else {
                    console.warn('‚ö†Ô∏è Êó†Ê≥ïÂä†ËΩΩÊï∞ÊçÆÊ∫êÈÖçÁΩÆ');
                }

                // Âä†ËΩΩ‰∫§ÊòìÂπ≥Âè∞ÈÖçÁΩÆÁä∂ÊÄÅ
                await loadTradingPlatformStatus();
                
                console.log('‚úÖ ÈÖçÁΩÆÁïåÈù¢Êï∞ÊçÆÂä†ËΩΩÂÆåÊàê');
                
            } catch (error) {
                console.error('‚ùå Âä†ËΩΩËÆæÁΩÆÂ§±Ë¥•:', error);
            }
        };
        
        // ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆ
        window.saveDataSourceConfig = async function() {
            console.log('üíæ ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆ...');
            const tokenInput = document.getElementById('tushare-token-input');
            if (!tokenInput) {
                if (window.showToast) {
                    window.showToast('‚ùå Êâæ‰∏çÂà∞ÈÖçÁΩÆËæìÂÖ•Ê°Ü', 'error');
                }
                return;
            }
            
            const token = tokenInput.value.trim();
            try {
                const response = await fetch(`${API_BASE_URL}/config/data-source`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        tushare_token: token || null
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆ‰øùÂ≠òÊàêÂäü:', result);
                    
                    if (window.showToast) {
                        window.showToast('‚úÖ Êï∞ÊçÆÊ∫êÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    }
                    
                    // ÈáçÊñ∞Âä†ËΩΩËÆæÁΩÆÁä∂ÊÄÅ
                    window.loadCurrentSettings();
                } else {
                    throw new Error(`ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${response.status}`);
                }
            } catch (error) {
                console.error('‚ùå ‰øùÂ≠òÊï∞ÊçÆÊ∫êÈÖçÁΩÆÂ§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå ÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•', 'error');
                }
            }
        };
        
        // Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫ÂáΩÊï∞
        window.updateCapitalDisplay = function() {
            console.log('üí∞ Êõ¥Êñ∞ËµÑÈáëÊòæÁ§∫...');
            const capitalInput = document.getElementById('initial-capital');
            if (capitalInput) {
                const capital = parseFloat(capitalInput.value) || 100000;
                console.log('üí∞ ÂΩìÂâçËµÑÈáë:', capital);
                
                // Êõ¥Êñ∞‰ªª‰ΩïÁõ∏ÂÖ≥ÁöÑÊòæÁ§∫ÂÖÉÁ¥†
                const capitalDisplays = document.querySelectorAll('.capital-display, .current-capital');
                capitalDisplays.forEach(display => {
                    display.textContent = `$${capital.toLocaleString()}`;
                });
            }
        };
        
        // Êõ¥Êñ∞‰ª™Ë°®ÊùøÂáΩÊï∞
        window.updateDashboard = function() {
            console.log('üìä Êõ¥Êñ∞‰ª™Ë°®Êùø...');
            // Ê®°Êãü‰ª™Ë°®ÊùøÊõ¥Êñ∞
            try {
                // Êõ¥Êñ∞ÂêÑÁßçÊåáÊ†á
                updateTime();
                if (window.updateCharts) window.updateCharts();
            } catch (error) {
                console.error('‰ª™Ë°®ÊùøÊõ¥Êñ∞Â§±Ë¥•:', error);
            }
        };
        
        // Êõ¥Êñ∞Êó∂Èó¥ÂáΩÊï∞
        window.updateTime = function() {
            const timeElements = document.querySelectorAll('#current-time, .current-time');
            const now = new Date().toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit', 
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            
            timeElements.forEach(element => {
                if (element) element.textContent = now;
            });
        };
        
        // Êõ¥Êñ∞ÂõæË°®ÂáΩÊï∞
        window.updateCharts = async function() {
            console.log('üìà Êõ¥Êñ∞ÂõæË°®Êï∞ÊçÆ...');
            try {
                // Ëé∑ÂèñÁÉ≠Èó®ËÇ°Á•®Êï∞ÊçÆÁî®‰∫éÂõæË°®ÊòæÁ§∫
                const response = await fetch(`${API_BASE_URL}/market-data/popular`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ ÂõæË°®Êï∞ÊçÆÂ∑≤Êõ¥Êñ∞:', data.popular_stocks);
                
                // Êõ¥Êñ∞ÂêÑÁ±ªÂõæË°®
                window.updatePerformanceChart(data.popular_stocks);
                window.updateRiskChart(data.popular_stocks);
                
                return data.popular_stocks;
            } catch (error) {
                console.error('‚ùå ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•:', error);
                if (window.showToast) {
                    window.showToast('‚ùå ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•', 'error');
                }
            }
        };
        
        // Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®
        window.updatePerformanceChart = function(stockData) {
            console.log('üìä Êõ¥Êñ∞ÊÄßËÉΩÂõæË°®:', stockData);
            // ËøôÈáåÂèØ‰ª•ÂÆûÁé∞ÂÖ∑‰ΩìÁöÑÂõæË°®Êõ¥Êñ∞ÈÄªËæë
            // ‰æãÂ¶Ç‰ΩøÁî®Chart.jsÊõ¥Êñ∞Áé∞ÊúâÂõæË°®
        };
        
        // Êõ¥Êñ∞È£éÈô©ÂõæË°®
        window.updateRiskChart = async function(stockData) {
            // Â¶ÇÊûúÊúâstockDataÂèÇÊï∞ÔºåËÆ∞ÂΩïÊó•ÂøóÔºõÂê¶ÂàôË∞ÉÁî®ÂéüÊúâÁöÑÈ£éÈô©ÂõæË°®Êõ¥Êñ∞ÈÄªËæë
            if (stockData) {
                console.log('üìä Êõ¥Êñ∞È£éÈô©ÂõæË°®ÔºàÂü∫‰∫éËÇ°Á•®Êï∞ÊçÆÔºâ:', stockData.length ? `${stockData.length}Âè™ËÇ°Á•®` : 'Êï∞ÊçÆ‰∏∫Á©∫');
            }

            // Ë∞ÉÁî®ÂéüÊúâÁöÑÈ£éÈô©ÂõæË°®Êõ¥Êñ∞ÂáΩÊï∞Ôºà‰ªéÁ¨¨8534Ë°åÔºâ
            if (!charts || !charts.risk) {
                console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®ÂØπË±°Êú™ÂàùÂßãÂåñÔºåË∑≥ËøáÊõ¥Êñ∞');
                return;
            }

            try {
                // Ê£ÄÊü•ÂõæË°®Êï∞ÊçÆÁªìÊûÑ
                if (!charts.risk.data || !charts.risk.data.datasets || !charts.risk.data.datasets[0]) {
                    console.warn('‚ö†Ô∏è È£éÈô©ÂõæË°®Êï∞ÊçÆÁªìÊûÑÊú™Â∞±Áª™ÔºåÂàùÂßãÂåñÈªòËÆ§Êï∞ÊçÆ');
                    if (charts.risk.data) {
                        charts.risk.data.datasets = [{
                            label: 'È£éÈô©ÊåáÊ†á',
                            data: [50, 40, 60],
                            borderColor: 'rgba(239, 68, 68, 1)',
                            backgroundColor: 'rgba(239, 68, 68, 0.2)'
                        }];
                        charts.risk.update();
                    }
                    return;
                }

                // Ëé∑ÂèñÂΩìÂâçËÇ°Á•®Ê±†ÂíåËµÑÈáëËÆæÁΩÆ
                const symbolsInput = document.getElementById('target-symbols');
                const capitalInput = document.getElementById('capital');

                let symbols = 'AAPL,TSLA,NVDA,MSFT,GOOGL';
                let capital = 100000;

                if (symbolsInput && symbolsInput.value) {
                    symbols = symbolsInput.value;
                }
                if (capitalInput && capitalInput.value) {
                    capital = parseFloat(capitalInput.value) || 100000;
                }

                console.log(`üìä Êõ¥Êñ∞È£éÈô©Èõ∑ËææÂõæË°®: ËµÑÈáë=${capital}, ËÇ°Á•®=${symbols}`);

                // Ë∞ÉÁî®È£éÈô©Êä•ÂëäÊé•Âè£
                const response = await fetch(`${API_BASE_URL}/dashboard/risk-report?capital=${capital}&market=mixed&risk_level=moderate&symbols=${symbols}`);
                if (!response.ok) {
                    console.warn(`‚ö†Ô∏è È£éÈô©Êä•ÂëäÊé•Âè£ËøîÂõû ${response.status}Ôºå‰ΩøÁî®ÈªòËÆ§Êï∞ÊçÆ`);
                    return;
                }

                const data = await response.json();
                console.log('‚úÖ È£éÈô©Êä•ÂëäÊï∞ÊçÆÂ∑≤Ëé∑Âèñ');

                // Êõ¥Êñ∞ÂõæË°®
                if (data && data.risk_metrics && charts.risk.data.datasets[0]) {
                    const metrics = data.risk_metrics;
                    charts.risk.data.datasets[0].data = [
                        Math.min((metrics.volatility || 0.15) * 100, 100),
                        Math.min((metrics.max_drawdown || 0.10) * 100, 100),
                        Math.min((metrics.var_95 || 0.05) * 100, 100)
                    ];
                    charts.risk.update();
                    console.log('‚úÖ È£éÈô©ÂõæË°®Â∑≤Êõ¥Êñ∞');
                }
            } catch (error) {
                console.error('‚ùå Êõ¥Êñ∞È£éÈô©ÂõæË°®Â§±Ë¥•:', error);
            }
        };
        
        // È™åËØÅÊ†∏ÂøÉÂáΩÊï∞
        window.validateCoreFunctions = function() {
            console.log('üîç È™åËØÅÊ†∏ÂøÉÂáΩÊï∞...');
            const requiredFunctions = [
                'showToast', 'addStockToPool', 'refreshAllData', 
                'generateSignals', 'executeOrder', 'loadMarketIndices'
            ];
            
            const missing = [];
            requiredFunctions.forEach(funcName => {
                if (typeof window[funcName] !== 'function') {
                    missing.push(funcName);
                }
            });
            
            if (missing.length > 0) {
                console.warn('‚ö†Ô∏è Áº∫Â§±ÁöÑÊ†∏ÂøÉÂáΩÊï∞:', missing);
            } else {
                console.log('‚úÖ ÊâÄÊúâÊ†∏ÂøÉÂáΩÊï∞È™åËØÅÈÄöËøá');
            }
        };
        
        // ÂÖ®Â±ÄÊõ¥Êñ∞Èó¥ÈöîÂØπË±°
        window.updateIntervals = {
            main: null,
            charts: null
        };
        
        // ================ ÂÖ®Â±ÄÂ∑•ÂÖ∑ÂáΩÊï∞Âå∫ÂüüÁªìÊùü ================
        console.log('‚úÖ ÊâÄÊúâÂÖ®Â±ÄÊêúÁ¥¢ÂáΩÊï∞Â∑≤ÂÆö‰πâ');
        
        // ================ È°µÈù¢ÂàùÂßãÂåñÂíåDOMContentLoaded‰∫ã‰ª∂Â§ÑÁêÜ ================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ DOMÂÜÖÂÆπÂä†ËΩΩÂÆåÊàêÔºåÂºÄÂßãÂàùÂßãÂåñ...');
            
            // ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩ
            try {
                window.initStockSearch();
                console.log('‚úÖ ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂÆåÊàê');
            } catch (error) {
                console.error('‚ùå ÊêúÁ¥¢ÂäüËÉΩÂàùÂßãÂåñÂ§±Ë¥•:', error);
            }
            
            // ÂàùÂßãÂåñËÇ°Á•®Ê±†ÁªüËÆ°
            setTimeout(() => {
                try {
                    if (window.updatePoolStats) {
                        window.updatePoolStats();
                        console.log('‚úÖ ËÇ°Á•®Ê±†ÁªüËÆ°ÂàùÂßãÂåñÂÆåÊàê');
                    } else {
                        console.warn('‚ö†Ô∏è updatePoolStatsÂáΩÊï∞‰∏çÂ≠òÂú®ÔºåÂª∂ËøüÈáçËØï');
                        setTimeout(() => {
                            if (window.updatePoolStats) {
                                window.updatePoolStats();
                                console.log('‚úÖ ËÇ°Á•®Ê±†ÁªüËÆ°Âª∂ËøüÂàùÂßãÂåñÂÆåÊàê');
                            }
                        }, 1000);
                    }
                } catch (error) {
                    console.error('‚ùå ËÇ°Á•®Ê±†ÁªüËÆ°ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                }
            }, 500);
            
            // ÂàùÂßãÂåñËµÑÈáëÊòæÁ§∫ÔºåÈò≤Ê≠¢NaN
            setTimeout(() => {
                try {
                    const totalVolumeElement = document.getElementById('total-volume');
                    if (totalVolumeElement) {
                        const currentText = totalVolumeElement.textContent;
                        if (!currentText || currentText.includes('NaN') || currentText === '$') {
                            totalVolumeElement.textContent = '$0';
                        }
                    }
                    
                    // ÂàùÂßãÂåñÂÖ∂‰ªñÂèØËÉΩÁöÑNaNÊòæÁ§∫
                    const elementsToCheck = [
                        'total-capital', 'available-funds', 'current-capital',
                        'portfolio-value', 'unrealized-pnl'
                    ];
                    
                    elementsToCheck.forEach(id => {
                        const element = document.getElementById(id);
                        if (element && (element.textContent.includes('NaN') || element.textContent === '$' || element.textContent === 'Ôø•')) {
                            element.textContent = '$100,000';
                        }
                    });
                    
                    console.log('‚úÖ ËµÑÈáëÊòæÁ§∫ÂàùÂßãÂåñÂÆåÊàê');
                } catch (error) {
                    console.error('‚ùå ËµÑÈáëÊòæÁ§∫ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                }
            }, 800);
            
            console.log('‚úÖ È°µÈù¢ÂàùÂßãÂåñÂÆåÊàê');
            
            // ÂêØÂä®ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞Êú∫Âà∂
            setTimeout(() => {
                try {
                    startRealTimeUpdates();
                    console.log('‚úÖ ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞Â∑≤ÂêØÂä®');
                } catch (error) {
                    console.error('‚ùå ÂêØÂä®ÂÆûÊó∂Êõ¥Êñ∞Â§±Ë¥•:', error);
                }
            }, 2000);
            
            // ÂàùÂßãÂåñAIÁä∂ÊÄÅÊ£ÄÊü•
            setTimeout(() => {
                try {
                    updateAIStatus();
                    console.log('‚úÖ AIÁä∂ÊÄÅÊ£ÄÊü•ÂÆåÊàê');
                } catch (error) {
                    console.error('‚ùå AIÁä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:', error);
                }
            }, 3000);

            // ÂêØÂä®‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞Êú∫Âà∂
            setTimeout(() => {
                try {
                    startSignalAutoRefresh(30); // ÊØè30ÁßíËá™Âä®Âà∑Êñ∞‰∏ÄÊ¨°‰ø°Âè∑
                    console.log('‚úÖ ‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞Â∑≤ÂêØÂä®');
                } catch (error) {
                    console.error('‚ùå ÂêØÂä®‰ø°Âè∑Ëá™Âä®Âà∑Êñ∞Â§±Ë¥•:', error);
                }
            }, 3500);

            // Âº∫Âà∂ÈáçÊñ∞ÂàùÂßãÂåñÈ£éÈô©ÂõæË°®
            setTimeout(() => {
                try {
                    console.log('üîÑ Âª∂ËøüÈáçÊñ∞ÂàùÂßãÂåñÈ£éÈô©ÂõæË°®...');
                    forceReinitRiskChart();
                } catch (error) {
                    console.error('‚ùå Âª∂ËøüÂàùÂßãÂåñÈ£éÈô©ÂõæË°®Â§±Ë¥•:', error);
                }
            }, 3000);
        });
        
        // Âº∫Âà∂ÈáçÊñ∞ÂàùÂßãÂåñÈ£éÈô©ÂõæË°®
        function forceReinitRiskChart() {
            try {
                console.log('üîÑ Âº∫Âà∂ÈáçÊñ∞ÂàùÂßãÂåñÈ£éÈô©ÂõæË°®...');
                
                // ÈîÄÊØÅÁé∞ÊúâÂõæË°®
                if (charts.risk) {
                    try {
                        charts.risk.destroy();
                    } catch (destroyError) {
                        console.warn('‚ö†Ô∏è ÈîÄÊØÅÈ£éÈô©ÂõæË°®Êó∂Âá∫Èîô:', destroyError);
                    }
                    charts.risk = null;
                }
                
                // ÈáçÊñ∞ÂàõÂª∫È£éÈô©ÂõæË°®
                charts.risk = initRiskChart();
                
                if (charts.risk) {
                    console.log('‚úÖ È£éÈô©ÂõæË°®ÈáçÊñ∞ÂàùÂßãÂåñÂÆåÊàê');
                    
                    // Á´ãÂç≥Êõ¥Êñ∞Êï∞ÊçÆ
                    setTimeout(() => {
                        try {
                            updateRiskChart();
                        } catch (updateError) {
                            console.error('‚ùå È£éÈô©ÂõæË°®Êï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•:', updateError);
                        }
                    }, 500);
                } else {
                    console.error('‚ùå È£éÈô©ÂõæË°®ÈáçÊñ∞ÂàõÂª∫Â§±Ë¥•');
                }
                
            } catch (error) {
                console.error('‚ùå ÈáçÊñ∞ÂàùÂßãÂåñÈ£éÈô©ÂõæË°®Â§±Ë¥•:', error);
            }
        }
        
        // Êö¥Èú≤Âà∞ÂÖ®Â±Ä‰æõË∞ÉËØï‰ΩøÁî®
        window.forceReinitRiskChart = forceReinitRiskChart;
        
        // ÂÖ®Â±ÄÂõæË°®ÈîôËØØÂ§ÑÁêÜ
        window.handleChartError = function(chartName, error) {
            console.error(`‚ùå ÂõæË°®ÈîôËØØ [${chartName}]:`, error);
            
            // Â∞ùËØïÊÅ¢Â§çÂõæË°®
            setTimeout(() => {
                try {
                    if (chartName === 'risk' && typeof forceReinitRiskChart === 'function') {
                        forceReinitRiskChart();
                    } else {
                        console.log(`üîÑ Â∞ùËØïÊÅ¢Â§ç ${chartName} ÂõæË°®...`);
                        // ÂèØ‰ª•Ê∑ªÂä†ÂÖ∂‰ªñÂõæË°®ÁöÑÊÅ¢Â§çÈÄªËæë
                    }
                } catch (recoveryError) {
                    console.error(`‚ùå ÂõæË°®ÊÅ¢Â§çÂ§±Ë¥• [${chartName}]:`, recoveryError);
                }
            }, 1000);
        };
        
        // ÂåÖË£ÖÊâÄÊúâÂõæË°®Êìç‰ΩúÁöÑÂÆâÂÖ®ÊâßË°åÂáΩÊï∞
        window.safeChartOperation = function(chartType, operation, operationName = 'operation') {
            try {
                if (!charts[chartType]) {
                    console.warn(`‚ö†Ô∏è ${chartType} ÂõæË°®‰∏çÂ≠òÂú®ÔºåË∑≥Ëøá ${operationName}`);
                    return false;
                }
                
                return operation(charts[chartType]);
            } catch (error) {
                console.error(`‚ùå ${chartType} ÂõæË°® ${operationName} Â§±Ë¥•:`, error);
                window.handleChartError(chartType, error);
                return false;
            }
        };
        
        // ÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞Êú∫Âà∂
        function startRealTimeUpdates() {
            // ÊØè30ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°ÂõæË°®Êï∞ÊçÆ
            setInterval(async () => {
                try {
                    console.log('üîÑ ÊâßË°åÂÆöÊó∂ÂõæË°®Êï∞ÊçÆÊõ¥Êñ∞...');
                    
                    // Ëé∑ÂèñÂΩìÂâçÂ∏ÇÂú∫ÈÄâÊã©
                    const marketSelect = document.getElementById('market-select');
                    const market = marketSelect ? marketSelect.value : 'mixed';
                    
                    // Êõ¥Êñ∞ÊâÄÊúâÂõæË°®ÂíåÈáèÂåñÊåáÊ†á
                    await Promise.allSettled([
                        updateCorrelationChart(market),
                        updateRiskChart(),
                        updateTechnicalChart(market),
                        updateQuantitativeMetrics(),  // ÈõÜÊàêÈáèÂåñÊåáÊ†áÂÆûÊó∂Êõ¥Êñ∞
                        updateStrategyStatusDisplay()  // ÈõÜÊàêÁ≠ñÁï•Áä∂ÊÄÅÂÆûÊó∂Êõ¥Êñ∞
                    ]);
                    
                    console.log('‚úÖ ÂÆöÊó∂ÂõæË°®Êõ¥Êñ∞ÂÆåÊàê');
                } catch (error) {
                    console.error('‚ùå ÂÆöÊó∂ÂõæË°®Êõ¥Êñ∞Â§±Ë¥•:', error);
                }
            }, 30000); // 30ÁßíÈó¥Èöî
            
            // ÊØè10ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°Âü∫Á°ÄÊï∞ÊçÆ
            setInterval(async () => {
                try {
                    // Êõ¥Êñ∞ËÇ°Á•®Ê±†ÁªüËÆ°
                    if (window.updatePoolStats) {
                        window.updatePoolStats();
                    }
                    
                    // Ê£ÄÊü•Âπ∂‰øÆÂ§çNaNÊòæÁ§∫
                    fixNaNDisplays();
                    
                } catch (error) {
                    console.error('‚ùå ÂÆöÊó∂Âü∫Á°ÄÊï∞ÊçÆÊõ¥Êñ∞Â§±Ë¥•:', error);
                }
            }, 10000); // 10ÁßíÈó¥Èöî
        }
        
        // ‰øÆÂ§çNaNÊòæÁ§∫ÁöÑÂáΩÊï∞
        function fixNaNDisplays() {
            try {
                const elementsToCheck = [
                    'total-volume', 'total-capital', 'available-funds', 
                    'current-capital', 'portfolio-value', 'unrealized-pnl'
                ];
                
                elementsToCheck.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        const text = element.textContent;
                        if (text && (text.includes('NaN') || text === '$' || text === 'Ôø•')) {
                            if (id === 'total-volume') {
                                element.textContent = '$0';
                            } else {
                                element.textContent = '$100,000';
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('‚ùå ‰øÆÂ§çNaNÊòæÁ§∫Â§±Ë¥•:', error);
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÂÆåÊàê‰∫ã‰ª∂
        window.addEventListener('load', function() {
            console.log('üéØ È°µÈù¢ÂÆåÂÖ®Âä†ËΩΩÂÆåÊàê');
            
            // Á°Æ‰øùÊêúÁ¥¢ÂäüËÉΩÊ≠£Â∏∏Â∑•‰Ωú
            setTimeout(() => {
                if (!window.searchInitialized) {
                    console.log('‚ö†Ô∏è ÊêúÁ¥¢ÂäüËÉΩÊú™ÂàùÂßãÂåñÔºåÂ∞ùËØïÈáçÊñ∞ÂàùÂßãÂåñ...');
                    try {
                        window.initStockSearch();
                    } catch (error) {
                        console.error('ÈáçÊñ∞ÂàùÂßãÂåñÊêúÁ¥¢ÂäüËÉΩÂ§±Ë¥•:', error);
                    }
                }
            }, 1000);
        });
        
        // ==================== AkShare AËÇ°ÊêúÁ¥¢ÂäüËÉΩ ====================
        
        // AËÇ°ÂÖ≥ÈîÆËØçÊêúÁ¥¢
        // ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÊêúÁ¥¢
        window.searchASharesByKeyword = async function(keyword) {
            console.log('üîÑ AËÇ°ÂÖ≥ÈîÆËØçÊêúÁ¥¢ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÊêúÁ¥¢:', keyword);
            
            // Êò†Â∞ÑÂÖ≥ÈîÆËØçÂà∞Ë°å‰∏ö
            const keywordToSector = {
                'Èì∂Ë°å': 'finance',
                'ÁßëÊäÄ': 'tech', 
                'ÂåªËçØ': 'healthcare',
                'Âú∞‰∫ß': 'energy'  // ‰∏¥Êó∂Êò†Â∞ÑÂà∞ËÉΩÊ∫êÔºåÂèØ‰ª•ÂêéÁª≠Ë∞ÉÊï¥
            };
            
            const sector = keywordToSector[keyword];
            if (sector) {
                await unifiedSectorSearch(sector);
            } else {
                // Â¶ÇÊûú‰∏çÊòØÈ¢ÑÂÆö‰πâÂÖ≥ÈîÆËØçÔºåÊâßË°åÊôÆÈÄöÊêúÁ¥¢
                console.log('üá®üá≥ AËÇ°ÂÖ≥ÈîÆËØçÊêúÁ¥¢:', keyword);
                updateAkShareStatus('searching', `ÊêúÁ¥¢${keyword}Áõ∏ÂÖ≥ËÇ°Á•®...`);
                
                try {
                    // ËÆæÁΩÆÂ∏ÇÂú∫Á≠õÈÄâ‰∏∫AËÇ°
                    const marketFilter = document.getElementById('market-filter');
                    if (marketFilter) {
                        marketFilter.value = 'CN';
                    }
                    
                    // Âú®ÊêúÁ¥¢Ê°Ü‰∏≠ËæìÂÖ•ÂÖ≥ÈîÆËØçÂπ∂Ëß¶ÂèëÊêúÁ¥¢
                    const searchInput = document.getElementById('stock-search');
                    if (searchInput) {
                        searchInput.value = keyword;
                        // Ëß¶ÂèëÊêúÁ¥¢
                        if (window.searchStocks) {
                            window.searchStocks(keyword, 0);
                        }
                    }
                    
                    updateAkShareStatus('ready', 'AkShare Ready');
                    showToast(`‚úÖ ÊêúÁ¥¢"${keyword}"ÂÆåÊàê`, 'success');
                    
                } catch (error) {
                    console.error('AËÇ°ÂÖ≥ÈîÆËØçÊêúÁ¥¢Â§±Ë¥•:', error);
                    updateAkShareStatus('error', 'Search Failed');
                    showToast(`‚ùå ÊêúÁ¥¢"${keyword}"Â§±Ë¥•: ${error.message}`, 'error');
                }
            }
        };
        
        // Ëé∑ÂèñÈöèÊú∫AËÇ°Êï∞ÊçÆ
        // ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÈöèÊú∫ÈÄâËÇ°
        window.getRandomAShares = async function(count = 200) {
            console.log('üîÑ AËÇ°ÈöèÊú∫ÈÄâËÇ°ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÂäüËÉΩ:', count);
            await getRandomStocks(count);
        };
        
        // Êõ¥Êñ∞AkShareÁä∂ÊÄÅÊòæÁ§∫
        window.updateAkShareStatus = function(status, message) {
            const statusElement = document.getElementById('akshare-status');
            if (!statusElement) return;
            
            statusElement.textContent = message || status;
            
            // ÁßªÈô§ÊâÄÊúâÁä∂ÊÄÅÁ±ª
            statusElement.classList.remove('text-green-400', 'text-blue-400', 'text-red-400', 'text-yellow-400');
            
            switch(status) {
                case 'ready':
                    statusElement.classList.add('text-green-400');
                    break;
                case 'searching':
                case 'loading':
                    statusElement.classList.add('text-blue-400');
                    break;
                case 'error':
                    statusElement.classList.add('text-red-400');
                    break;
                default:
                    statusElement.classList.add('text-yellow-400');
            }
        };
        
        // Â¢ûÂº∫ËÇ°Á•®ÈÄâÊã©ÂáΩÊï∞‰ª•ÊîØÊåÅAkShareÊï∞ÊçÆ
        window.selectStock = function(symbol, name, market, additionalData = {}) {
            console.log('üìà ÈÄâÊã©ËÇ°Á•®:', symbol, name, market);
            
            try {
                // Ëé∑ÂèñÂ∑≤ÈÄâËÇ°Á•®ÂàóË°®
                const targetSymbolsInput = document.getElementById('target-symbols');
                const stockChipsContainer = document.getElementById('stock-chips');
                
                if (!targetSymbolsInput || !stockChipsContainer) {
                    console.error('‚ùå Êú™ÊâæÂà∞ËÇ°Á•®ÈÄâÊã©Áõ∏ÂÖ≥ÂÖÉÁ¥†');
                    return;
                }
                
                // Ê£ÄÊü•ÊòØÂê¶Â∑≤ÁªèÊ∑ªÂä†
                const currentSymbols = targetSymbolsInput.value ? targetSymbolsInput.value.split(',').map(s => s.trim()) : [];
                if (currentSymbols.includes(symbol)) {
                    showToast(`‚ö†Ô∏è ${symbol} Â∑≤Âú®ÂàóË°®‰∏≠`, 'warning');
                    return;
                }
                
                // Ê∑ªÂä†Âà∞ÂàóË°®
                currentSymbols.push(symbol);
                targetSymbolsInput.value = currentSymbols.join(', ');
                
                // ÂàõÂª∫ËÇ°Á•®ËäØÁâá
                const chip = document.createElement('div');
                chip.className = 'inline-flex items-center gap-1 bg-blue-600 text-white px-2 py-1 rounded text-xs font-mono';
                
                const marketBadge = market === 'CN' ? 'üá®üá≥' : market === 'US' ? 'üá∫üá∏' : 'üåê';
                
                chip.innerHTML = `
                    <span>${marketBadge} ${symbol}</span>
                    <button onclick="removeStock('${symbol}')" class="text-white hover:text-red-300">√ó</button>
                `;
                
                stockChipsContainer.appendChild(chip);
                
                // ÈöêËóèÊêúÁ¥¢‰∏ãÊãâÊ°Ü
                const dropdown = document.getElementById('search-dropdown');
                if (dropdown) {
                    dropdown.classList.add('hidden');
                }
                
                // Ê∏ÖÁ©∫ÊêúÁ¥¢Ê°Ü
                const searchInput = document.getElementById('stock-search');
                if (searchInput) {
                    searchInput.value = '';
                }
                
                showToast(`‚úÖ Ê∑ªÂä† ${name} (${symbol})`, 'success');
                
                // Ëß¶ÂèëÊï∞ÊçÆÊõ¥Êñ∞
                if (window.updateDashboard) {
                    window.updateDashboard();
                }
                
            } catch (error) {
                console.error('ÈÄâÊã©ËÇ°Á•®Â§±Ë¥•:', error);
                showToast(`‚ùå ÈÄâÊã©ËÇ°Á•®Â§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        // ÁßªÈô§ËÇ°Á•®ÂáΩÊï∞
        window.removeStock = function(symbol) {
            try {
                const targetSymbolsInput = document.getElementById('target-symbols');
                const stockChipsContainer = document.getElementById('stock-chips');
                
                if (!targetSymbolsInput) return;
                
                // ‰ªéÂàóË°®‰∏≠ÁßªÈô§
                const currentSymbols = targetSymbolsInput.value ? targetSymbolsInput.value.split(',').map(s => s.trim()) : [];
                const updatedSymbols = currentSymbols.filter(s => s !== symbol);
                targetSymbolsInput.value = updatedSymbols.join(', ');
                
                // ÈáçÊñ∞Ê∏≤ÊüìËäØÁâá
                if (stockChipsContainer) {
                    stockChipsContainer.innerHTML = '';
                    updatedSymbols.forEach(sym => {
                        // ËøôÈáåÂèØ‰ª•Ê∑ªÂä†ÈáçÊñ∞Ê∏≤ÊüìÈÄªËæëÔºåÊöÇÊó∂ÁÆÄÂåñ
                        const chip = document.createElement('div');
                        chip.className = 'inline-flex items-center gap-1 bg-blue-600 text-white px-2 py-1 rounded text-xs font-mono';
                        chip.innerHTML = `
                            <span>${sym}</span>
                            <button onclick="removeStock('${sym}')" class="text-white hover:text-red-300">√ó</button>
                        `;
                        stockChipsContainer.appendChild(chip);
                    });
                }
                
                showToast(`‚úÖ ÁßªÈô§ ${symbol}`, 'success');
                
                // Ëß¶ÂèëÊï∞ÊçÆÊõ¥Êñ∞
                if (window.updateDashboard) {
                    window.updateDashboard();
                }
                
            } catch (error) {
                console.error('ÁßªÈô§ËÇ°Á•®Â§±Ë¥•:', error);
            }
        };
        
        // Ê£ÄÊü•Êï∞ÊçÆÊ∫êÁä∂ÊÄÅ
        // ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÊï∞ÊçÆÊ∫êÊ£ÄÊü•
        window.checkDataSourceStatus = async function() {
            console.log('üîÑ Êï∞ÊçÆÊ∫êÁä∂ÊÄÅÊ£ÄÊü•ÈáçÂÆöÂêëÂà∞Áªü‰∏ÄÂäüËÉΩ');
            await checkAllDataSources();
        };
        
        // ÊòæÁ§∫Â§öÊï∞ÊçÆÊ∫êÂØπÊØî
        // ÈáçÂÆöÂêëÂà∞ÁºìÂ≠òÂà∑Êñ∞ÂäüËÉΩ
        window.showMultiSourceComparison = async function() {
            console.log('üîÑ Â§öÊ∫êÂØπÊØîÂäüËÉΩÈáçÂÆöÂêëÂà∞ÁºìÂ≠òÂà∑Êñ∞');
            refreshSearchCache();
            // ÂèØ‰ª•Ê∑ªÂä†ÂÖ∑‰ΩìÁöÑÂ§öÊ∫êÂØπÊØîÈÄªËæë
            setTimeout(() => {
                showToast('üìä Â§öÊ∫êÂØπÊØîÂäüËÉΩÂ∑≤ÂêØÁî®ÔºåÊï∞ÊçÆÂ∑≤Âà∑Êñ∞', 'info');
            }, 1000);
        };
        
        // Â§öÊï∞ÊçÆÊ∫êÂØπÊØîÊ†∏ÂøÉÂáΩÊï∞
        window.compareMultipleDataSources = async function(symbol) {
            console.log(`üîç Â§öÊï∞ÊçÆÊ∫êÂØπÊØî: ${symbol}`);
            updateAkShareStatus('loading', `ÂØπÊØî${symbol}Êï∞ÊçÆÊ∫ê...`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/market-data/multi-source/${encodeURIComponent(symbol)}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('üìä Â§öÊï∞ÊçÆÊ∫êÂØπÊØîÁªìÊûú:', data);
                
                // ÊòæÁ§∫ÁªìÊûúÂú®‰∏ãÊãâÊ°Ü‰∏≠
                const dropdown = document.getElementById('search-dropdown');
                if (dropdown && data.data_sources) {
                    let html = `
                        <div class="p-2 text-xs font-mono text-orange-400 bg-black border-b border-gray-600">
                            üîÑ ${symbol} Â§öÊï∞ÊçÆÊ∫êÂØπÊØî | Ë¥®Èáè: ${data.data_sources.data_quality?.consistency || 'N/A'}
                        </div>
                    `;
                    
                    // ÊòæÁ§∫Êï∞ÊçÆË¥®Èáè‰ø°ÊÅØ
                    if (data.data_sources.data_quality) {
                        const quality = data.data_sources.data_quality;
                        html += `
                            <div class="p-1 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">
                                üìà Âπ≥Âùá‰ª∑Ê†º: ¬•${quality.average_price?.toFixed(2)} | ÊúÄÂ§ßÂÅèÂ∑Æ: ${quality.max_deviation_percent?.toFixed(2)}% | Êï∞ÊçÆÊ∫ê: ${quality.sources_count}‰∏™
                            </div>
                        `;
                    }
                    
                    // ÊòæÁ§∫ÂêÑÊï∞ÊçÆÊ∫êÁöÑÊï∞ÊçÆ
                    Object.entries(data.data_sources).forEach(([source, sourceData]) => {
                        if (source === 'data_quality') return;
                        
                        if (sourceData && sourceData.price) {
                            const changeClass = sourceData.change_percent > 0 ? 'text-green-400' : 
                                              sourceData.change_percent < 0 ? 'text-red-400' : 'text-gray-400';
                            
                            html += `
                                <div class="p-2 border-b border-gray-600 last:border-b-0">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs font-mono text-white">${source.toUpperCase()}</span>
                                            <span class="text-xs bg-green-600 px-1 rounded">‚úì</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="font-mono text-xs text-white">¬•${sourceData.price}</div>
                                            <div class="font-mono text-xs ${changeClass}">
                                                ${sourceData.change_percent > 0 ? '+' : ''}${sourceData.change_percent?.toFixed(2)}%
                                            </div>
                                            <div class="text-xs text-gray-400">
                                                Vol: ${(sourceData.volume || 0).toLocaleString()}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        } else {
                            html += `
                                <div class="p-2 border-b border-gray-600 last:border-b-0">
                                    <div class="flex justify-between items-center">
                                        <div class="flex items-center gap-2">
                                            <span class="text-xs font-mono text-white">${source.toUpperCase()}</span>
                                            <span class="text-xs bg-red-600 px-1 rounded">‚úó</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-xs text-red-400">
                                                ${sourceData?.error || 'Êó†Êï∞ÊçÆ'}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                    
                    dropdown.innerHTML = html;
                    dropdown.classList.remove('hidden');
                }
                
                updateAkShareStatus('ready', 'AkShare Ready');
                showToast(`‚úÖ ${symbol} Â§öÊï∞ÊçÆÊ∫êÂØπÊØîÂÆåÊàê`, 'success');
                
            } catch (error) {
                console.error('Â§öÊï∞ÊçÆÊ∫êÂØπÊØîÂ§±Ë¥•:', error);
                updateAkShareStatus('error', 'Comparison Failed');
                showToast(`‚ùå Â§öÊï∞ÊçÆÊ∫êÂØπÊØîÂ§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        // ================ ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜ ================
        
        // ÂÖ®Â±ÄPromiseÈîôËØØÂ§ÑÁêÜÂ∑≤Âú®ÂâçÈù¢ÂÆö‰πâÔºåÊ≠§Â§ÑÁßªÈô§ÈáçÂ§ç
        
        // ÂÖ®Â±ÄJavaScriptÈîôËØØÂ§ÑÁêÜÂ∑≤Âú®ÂâçÈù¢ÂÆö‰πâÔºåÊ≠§Â§ÑÁßªÈô§ÈáçÂ§ç
        
        // ================ Êñ∞Â¢ûÂπ≥Âè∞ÈÖçÁΩÆÂäüËÉΩ ================
        
        // Interactive Brokers ÈÖçÁΩÆÂáΩÊï∞
        async function saveIBConfig() {
            try {
                const host = document.getElementById('ib-host')?.value || '127.0.0.1';
                const port = document.getElementById('ib-port')?.value || '7497';
                const clientId = document.getElementById('ib-client-id')?.value || '1';
                
                if (!host || !port || !clientId) {
                    showToast('‚ùå Please fill all IB connection fields', 'error');
                    return;
                }
                
                const config = {
                    host: host,
                    port: parseInt(port),
                    client_id: parseInt(clientId)
                };
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/configure/ib`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('ib-status').textContent = window.t('configured');
                    document.getElementById('ib-status').className = 'text-green-400';
                    showToast('‚úÖ Interactive BrokersÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    localStorage.setItem('ib-config', JSON.stringify(config));
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('IBÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•:', error);
                showToast(`‚ùå IBÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        async function testIBConnection() {
            try {
                const host = document.getElementById('ib-host')?.value || '127.0.0.1';
                const port = document.getElementById('ib-port')?.value || '7497';
                
                showToast('üîÑ Testing IB connection...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/test/ib`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ host, port: parseInt(port) })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('ib-status').textContent = 'CONNECTED';
                        document.getElementById('ib-status').className = 'text-green-400';
                        showToast('‚úÖ IBËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                    } else {
                        throw new Error(data.message || 'Connection failed');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('IBËøûÊé•ÊµãËØïÂ§±Ë¥•:', error);
                document.getElementById('ib-status').textContent = 'FAILED';
                document.getElementById('ib-status').className = 'text-red-400';
                showToast(`‚ùå IBËøûÊé•ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Coinbase Pro ÈÖçÁΩÆÂáΩÊï∞
        async function saveCoinbaseConfig() {
            try {
                const apiKey = document.getElementById('coinbase-api-key')?.value;
                const secretKey = document.getElementById('coinbase-secret-key')?.value;
                const passphrase = document.getElementById('coinbase-passphrase')?.value;
                const environment = document.getElementById('coinbase-environment')?.value || 'sandbox';
                
                if (!apiKey || !secretKey || !passphrase) {
                    showToast('‚ùå Please fill all Coinbase Pro fields', 'error');
                    return;
                }
                
                const config = {
                    api_key: apiKey,
                    secret_key: secretKey,
                    passphrase: passphrase,
                    environment: environment
                };
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/configure/coinbase`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('coinbase-status').textContent = window.t('configured');
                    document.getElementById('coinbase-status').className = 'text-green-400';
                    showToast('‚úÖ Coinbase ProÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    
                    // Ê∏ÖÈô§Ë°®Âçï‰∏≠ÁöÑÊïèÊÑü‰ø°ÊÅØ
                    document.getElementById('coinbase-api-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    document.getElementById('coinbase-secret-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    document.getElementById('coinbase-passphrase').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('CoinbaseÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•:', error);
                showToast(`‚ùå CoinbaseÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        async function testCoinbaseConnection() {
            try {
                showToast('üîÑ Testing Coinbase Pro connection...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/test/coinbase`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('coinbase-status').textContent = 'CONNECTED';
                        document.getElementById('coinbase-status').className = 'text-green-400';
                        showToast('‚úÖ Coinbase ProËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                    } else {
                        throw new Error(data.message || 'Connection failed');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('CoinbaseËøûÊé•ÊµãËØïÂ§±Ë¥•:', error);
                document.getElementById('coinbase-status').textContent = 'FAILED';
                document.getElementById('coinbase-status').className = 'text-red-400';
                showToast(`‚ùå CoinbaseËøûÊé•ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // Kraken ÈÖçÁΩÆÂáΩÊï∞
        async function saveKrakenConfig() {
            try {
                const apiKey = document.getElementById('kraken-api-key')?.value;
                const secretKey = document.getElementById('kraken-secret-key')?.value;
                
                if (!apiKey || !secretKey) {
                    showToast('‚ùå Please fill all Kraken fields', 'error');
                    return;
                }
                
                const config = {
                    api_key: apiKey,
                    secret_key: secretKey
                };
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/configure/kraken`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('kraken-status').textContent = window.t('configured');
                    document.getElementById('kraken-status').className = 'text-green-400';
                    showToast('‚úÖ KrakenÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    
                    // Ê∏ÖÈô§Ë°®Âçï‰∏≠ÁöÑÊïèÊÑü‰ø°ÊÅØ
                    document.getElementById('kraken-api-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                    document.getElementById('kraken-secret-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('KrakenÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•:', error);
                showToast(`‚ùå KrakenÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        async function testKrakenConnection() {
            try {
                showToast('üîÑ Testing Kraken connection...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/test/kraken`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('kraken-status').textContent = 'CONNECTED';
                        document.getElementById('kraken-status').className = 'text-green-400';
                        showToast('‚úÖ KrakenËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                    } else {
                        throw new Error(data.message || 'Connection failed');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('KrakenËøûÊé•ÊµãËØïÂ§±Ë¥•:', error);
                document.getElementById('kraken-status').textContent = 'FAILED';
                document.getElementById('kraken-status').className = 'text-red-400';
                showToast(`‚ùå KrakenËøûÊé•ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // CoinMarketCap ÈÖçÁΩÆÂáΩÊï∞
        async function saveCMCConfig() {
            try {
                const apiKey = document.getElementById('cmc-api-key')?.value;
                
                if (!apiKey) {
                    showToast('‚ùå Please enter CoinMarketCap API Key', 'error');
                    return;
                }
                
                const config = {
                    api_key: apiKey
                };
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/configure/cmc`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('cmc-status').textContent = window.t('configured');
                    document.getElementById('cmc-status').className = 'text-green-400';
                    showToast('‚úÖ CoinMarketCapÈÖçÁΩÆÂ∑≤‰øùÂ≠ò', 'success');
                    
                    // Ê∏ÖÈô§Ë°®Âçï‰∏≠ÁöÑÊïèÊÑü‰ø°ÊÅØ
                    document.getElementById('cmc-api-key').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('CMCÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•:', error);
                showToast(`‚ùå CMCÈÖçÁΩÆ‰øùÂ≠òÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        async function testCMCConnection() {
            try {
                showToast('üîÑ Testing CoinMarketCap connection...', 'info');
                
                const response = await fetch(`${API_BASE_URL}/trading-platforms/test/cmc`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        document.getElementById('cmc-status').textContent = 'CONNECTED';
                        document.getElementById('cmc-status').className = 'text-green-400';
                        showToast('‚úÖ CoinMarketCapËøûÊé•ÊµãËØïÊàêÂäü', 'success');
                    } else {
                        throw new Error(data.message || 'Connection failed');
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
                
            } catch (error) {
                console.error('CMCËøûÊé•ÊµãËØïÂ§±Ë¥•:', error);
                document.getElementById('cmc-status').textContent = 'FAILED';
                document.getElementById('cmc-status').className = 'text-red-400';
                showToast(`‚ùå CMCËøûÊé•ÊµãËØïÂ§±Ë¥•: ${error.message}`, 'error');
            }
        }

        // ÊâπÈáèÂπ≥Âè∞Áä∂ÊÄÅÊ£ÄÊü•ÂáΩÊï∞
        async function checkAllPlatformStatus() {
            const platforms = ['ib', 'coinbase', 'kraken', 'cmc'];
            
            for (const platform of platforms) {
                try {
                    const response = await fetch(`${API_BASE_URL}/trading-platforms/status/${platform}`);
                    if (response.ok) {
                        const data = await response.json();
                        const statusElement = document.getElementById(`${platform === 'cmc' ? 'cmc' : platform}-status`);
                        if (statusElement) {
                            statusElement.textContent = data.configured ? 'CONFIGURED' : 'NOT CONFIGURED';
                            statusElement.className = data.configured ? 'text-green-400' : 'text-gray-400';
                        }
                    }
                } catch (error) {
                    console.error(`Âπ≥Âè∞ ${platform} Áä∂ÊÄÅÊ£ÄÊü•Â§±Ë¥•:`, error);
                }
            }
        }
        
        // È°µÈù¢Âä†ËΩΩÊó∂Ê£ÄÊü•Âπ≥Âè∞Áä∂ÊÄÅ
        document.addEventListener('DOMContentLoaded', () => {
            checkAllPlatformStatus();
        });

        console.log('‚úÖ ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜÂ∑≤ËÆæÁΩÆ');
        console.log('‚úÖ AkShare AËÇ°ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Âä†ËΩΩ');
        // ================ Â¢ûÂº∫ÊêúÁ¥¢ÂäüËÉΩ ================
        
        // È´òÁ∫ßÊêúÁ¥¢ÂáΩÊï∞
        window.advancedSearch = async function(options = {}) {
            const query = options.query || document.getElementById('stock-search')?.value || '';
            const market = options.market || document.getElementById('market-filter')?.value || 'ALL';
            const sector = options.sector || '';
            const minPrice = options.minPrice || 0;
            const maxPrice = options.maxPrice || null;
            const minVolume = options.minVolume || 0;
            
            if (!query.trim()) {
                showToast('‚ö†Ô∏è ËØ∑ËæìÂÖ•ÊêúÁ¥¢ÂÖ≥ÈîÆËØç', 'warning');
                return;
            }
            
            try {
                console.log('üîç ÊâßË°åÈ´òÁ∫ßÊêúÁ¥¢:', { query, market, sector });
                
                const searchData = {
                    query: query.trim(),
                    market: market,
                    sector: sector,
                    min_price: minPrice,
                    max_price: maxPrice,
                    min_volume: minVolume,
                    max_results: 30,
                    include_platforms: true
                };
                
                const response = await fetch(`${API_BASE_URL}/market-data/advanced-search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(searchData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ È´òÁ∫ßÊêúÁ¥¢ÁªìÊûú:', data);
                
                // ÊòæÁ§∫ÊêúÁ¥¢ÁªìÊûú
                displayAdvancedSearchResults(data);
                
                showToast(`‚úÖ ÊâæÂà∞ ${data.stats.total_found} ‰∏™ÁªìÊûú`, 'success');
                
            } catch (error) {
                console.error('‚ùå È´òÁ∫ßÊêúÁ¥¢Â§±Ë¥•:', error);
                showToast(`‚ùå ÊêúÁ¥¢Â§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        // ÊòæÁ§∫È´òÁ∫ßÊêúÁ¥¢ÁªìÊûú
        window.displayAdvancedSearchResults = function(data) {
            const dropdown = document.getElementById('search-dropdown');
            if (!dropdown) return;
            
            let html = `
                <div class="p-2 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">
                    üîç "${data.query}" ÊêúÁ¥¢ÁªìÊûú (${data.stats.returned}/${data.stats.total_found})
                </div>
                <div class="p-1 text-xs font-mono text-green-400 bg-black border-b border-gray-600">
                    üìä Â∏ÇÂú∫ÂàÜÂ∏É: ${Object.entries(data.stats.market_distribution).map(([market, count]) => `${market}: ${count}`).join(' | ')}
                </div>
            `;
            
            if (data.results && data.results.length > 0) {
                data.results.forEach(stock => {
                    const changeClass = stock.change_percent > 0 ? 'text-green-400' : 
                                      stock.change_percent < 0 ? 'text-red-400' : 'text-gray-400';
                    
                    const marketBadge = stock.market === 'CN' ? 'üá®üá≥' : 
                                       stock.market === 'US' ? 'üá∫üá∏' :
                                       stock.market === 'HK' ? 'üá≠üá∞' :
                                       stock.market === 'CRYPTO' ? '‚Çø' : 'üåê';
                    
                    const exchangeBadge = stock.exchange || 'Unknown';
                    const sourceBadge = stock.source || '';
                    
                    html += `
                        <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600 last:border-b-0" 
                             onclick="selectStock('${stock.symbol}', '${stock.name || stock.symbol}', '${stock.market}')">
                            <div class="flex justify-between items-center p-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-mono text-xs text-white">${stock.symbol}</span>
                                        <span class="text-xs bg-blue-600 px-1 rounded">${marketBadge}</span>
                                        <span class="text-xs bg-gray-600 px-1 rounded text-white">${exchangeBadge}</span>
                                        ${stock.platform_source ? '<span class="text-xs bg-green-600 px-1 rounded text-white">API</span>' : ''}
                                    </div>
                                    <div class="text-xs text-gray-400">${stock.name || stock.symbol}</div>
                                    <div class="text-xs text-gray-400">
                                        ${stock.sector || 'Unknown'} | ${sourceBadge}
                                    </div>
                                </div>
                                <div class="text-right">
                                    ${stock.price ? `<div class="font-mono text-xs text-white">$${parseFloat(stock.price).toFixed(2)}</div>` : ''}
                                    ${stock.change_percent ? `<div class="font-mono text-xs ${changeClass}">${stock.change_percent > 0 ? '+' : ''}${parseFloat(stock.change_percent).toFixed(2)}%</div>` : ''}
                                    ${stock.volume ? `<div class="text-xs text-gray-400">Vol: ${stock.volume.toLocaleString()}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
            } else {
                html += `
                    <div class="p-4 text-xs font-mono text-yellow-400 text-center">
                        Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÁªìÊûú
                    </div>
                `;
            }
            
            dropdown.innerHTML = html;
            dropdown.classList.remove('hidden');
        };
        
        // ÊåâË°å‰∏öÊêúÁ¥¢
        window.searchBySector = async function(sector, market = 'ALL') {
            console.log('üè¢ ÊåâË°å‰∏öÊêúÁ¥¢:', sector, market);
            
            try {
                const response = await fetch(`${API_BASE_URL}/market-data/sectors/${market}`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                const sectorStocks = data.sectors[sector] || [];
                
                if (sectorStocks.length === 0) {
                    showToast(`‚ö†Ô∏è ${sector} Ë°å‰∏öÊöÇÊó†Êï∞ÊçÆ`, 'warning');
                    return;
                }
                
                // ÊâπÈáèÊêúÁ¥¢ËØ•Ë°å‰∏öÁöÑËÇ°Á•®
                const searchData = {
                    keywords: sectorStocks,
                    market: market,
                    max_results: 50
                };
                
                const searchResponse = await fetch(`${API_BASE_URL}/market-data/batch-search`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(searchData)
                });
                
                if (!searchResponse.ok) {
                    throw new Error(`HTTP ${searchResponse.status}`);
                }
                
                const searchResults = await searchResponse.json();
                
                // ÊòæÁ§∫ÁªìÊûú
                const dropdown = document.getElementById('search-dropdown');
                if (!dropdown) return;
                
                let html = `
                    <div class="p-2 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">
                        üè¢ ${sector} Ë°å‰∏öËÇ°Á•® (${searchResults.stats.unique_results})
                    </div>
                `;
                
                searchResults.results.forEach(stock => {
                    const changeClass = stock.change_percent > 0 ? 'text-green-400' : 
                                      stock.change_percent < 0 ? 'text-red-400' : 'text-gray-400';
                    
                    const marketBadge = stock.market === 'CN' ? 'üá®üá≥' : 
                                       stock.market === 'US' ? 'üá∫üá∏' : 'üåê';
                    
                    html += `
                        <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600 last:border-b-0" 
                             onclick="selectStock('${stock.symbol}', '${stock.name}', '${stock.market}')">
                            <div class="flex justify-between items-center p-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="font-mono text-xs text-white">${stock.symbol}</span>
                                        <span class="text-xs bg-blue-600 px-1 rounded">${marketBadge}</span>
                                    </div>
                                    <div class="text-xs text-gray-400">${stock.name}</div>
                                </div>
                                <div class="text-right">
                                    ${stock.price ? `<div class="font-mono text-xs text-white">$${parseFloat(stock.price).toFixed(2)}</div>` : ''}
                                    ${stock.change_percent ? `<div class="font-mono text-xs ${changeClass}">${stock.change_percent > 0 ? '+' : ''}${parseFloat(stock.change_percent).toFixed(2)}%</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                dropdown.innerHTML = html;
                dropdown.classList.remove('hidden');
                
                showToast(`‚úÖ ÊâæÂà∞ ${searchResults.stats.unique_results} Âè™ ${sector} ËÇ°Á•®`, 'success');
                
            } catch (error) {
                console.error('‚ùå Ë°å‰∏öÊêúÁ¥¢Â§±Ë¥•:', error);
                showToast(`‚ùå Ë°å‰∏öÊêúÁ¥¢Â§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        // Ëé∑ÂèñË∂ãÂäøËÇ°Á•®
        window.getTrendingStocks = async function(market = 'ALL') {
            console.log('üìà Ëé∑ÂèñË∂ãÂäøËÇ°Á•®:', market);
            
            try {
                const response = await fetch(`${API_BASE_URL}/market-data/trending/${market}?limit=20`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('üìä Ë∂ãÂäøËÇ°Á•®Êï∞ÊçÆ:', data);
                
                const dropdown = document.getElementById('search-dropdown');
                if (!dropdown) return;
                
                let html = `
                    <div class="p-2 text-xs font-mono text-blue-400 bg-black border-b border-gray-600">
                        üìà ${market === 'ALL' ? 'ÂÖ®Â∏ÇÂú∫' : market} Ë∂ãÂäøËÇ°Á•® (${data.trending_stocks.length})
                    </div>
                `;
                
                data.trending_stocks.forEach((stock, index) => {
                    const changeClass = stock.change_percent > 0 ? 'text-green-400' : 
                                      stock.change_percent < 0 ? 'text-red-400' : 'text-gray-400';
                    
                    const marketBadge = stock.market === 'CN' ? 'üá®üá≥' : 
                                       stock.market === 'US' ? 'üá∫üá∏' :
                                       stock.market === 'HK' ? 'üá≠üá∞' :
                                       stock.market === 'CRYPTO' ? '‚Çø' : 'üåê';
                    
                    const rankEmoji = index < 3 ? ['ü•á', 'ü•à', 'ü•â'][index] : `${index + 1}`;
                    
                    html += `
                        <div class="stock-search-result hover:bg-white hover:text-black cursor-pointer border-b border-gray-600 last:border-b-0" 
                             onclick="selectStock('${stock.symbol}', '${stock.name}', '${stock.market}')">
                            <div class="flex justify-between items-center p-2">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-1">
                                        <span class="text-xs">${rankEmoji}</span>
                                        <span class="font-mono text-xs text-white">${stock.symbol}</span>
                                        <span class="text-xs bg-blue-600 px-1 rounded">${marketBadge}</span>
                                    </div>
                                    <div class="text-xs text-gray-400">${stock.name}</div>
                                </div>
                                <div class="text-right">
                                    <div class="font-mono text-xs text-white">$${parseFloat(stock.price).toFixed(2)}</div>
                                    <div class="font-mono text-xs ${changeClass}">
                                        ${stock.change_percent > 0 ? '+' : ''}${parseFloat(stock.change_percent).toFixed(2)}%
                                    </div>
                                    ${stock.volume ? `<div class="text-xs text-gray-400">Vol: ${stock.volume.toLocaleString()}</div>` : ''}
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                dropdown.innerHTML = html;
                dropdown.classList.remove('hidden');
                
                showToast(`‚úÖ Ëé∑Âèñ ${data.trending_stocks.length} Âè™Ë∂ãÂäøËÇ°Á•®`, 'success');
                
            } catch (error) {
                console.error('‚ùå Ëé∑ÂèñË∂ãÂäøËÇ°Á•®Â§±Ë¥•:', error);
                showToast(`‚ùå Ëé∑ÂèñË∂ãÂäøËÇ°Á•®Â§±Ë¥•: ${error.message}`, 'error');
            }
        };
        
        // Â¢ûÂº∫ÂéüÊúâÊêúÁ¥¢ÂäüËÉΩ
        const originalSearchStocks = window.searchStocks || function() {};
        window.searchStocks = async function(query) {
            // Â¶ÇÊûúÊü•ËØ¢ÂåÖÂê´ÁâπÊÆäÂÖ≥ÈîÆËØçÔºå‰ΩøÁî®Áõ∏Â∫îÁöÑ‰∏ìÈó®ÂäüËÉΩ
            if (query.toLowerCase().includes('Ë∂ãÂäø') || query.toLowerCase().includes('ÁÉ≠Èó®')) {
                return await getTrendingStocks();
            }
            
            if (query.toLowerCase().includes('ÁßëÊäÄ')) {
                return await searchBySector('Technology');
            }
            
            if (query.toLowerCase().includes('ÈáëËûç')) {
                return await searchBySector('Financial Services');
            }
            
            if (query.toLowerCase().includes('ÂåªÁñó')) {
                return await searchBySector('Healthcare');
            }
            
            // Âê¶Âàô‰ΩøÁî®È´òÁ∫ßÊêúÁ¥¢
            return await advancedSearch({ query });
        };
        
        // ‰∏∫Âø´ÈÄüÁ≠õÈÄâÊåâÈíÆÊ∑ªÂä†Â¢ûÂº∫ÂäüËÉΩ
        window.quickSectorFilter = function(sector) {
            console.log('üè¢ Âø´ÈÄüË°å‰∏öÁ≠õÈÄâ:', sector);
            
            const sectorMap = {
                'tech': 'Technology',
                'finance': 'Financial Services', 
                'healthcare': 'Healthcare',
                'energy': 'Energy'
            };
            
            const fullSectorName = sectorMap[sector] || sector;
            searchBySector(fullSectorName);
        };

        console.log('‚úÖ ÂÖ®Â±ÄÈîôËØØÂ§ÑÁêÜÂ∑≤ËÆæÁΩÆ');
        console.log('‚úÖ AkShare AËÇ°ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Âä†ËΩΩ');
        console.log('‚úÖ Êñ∞Â¢û‰∫§ÊòìÂπ≥Âè∞ÈÖçÁΩÆÂäüËÉΩÂ∑≤Âä†ËΩΩ');
        console.log('‚úÖ Â¢ûÂº∫Â§öÂπ≥Âè∞ÊêúÁ¥¢ÂäüËÉΩÂ∑≤Âä†ËΩΩ');
    </script>

    <!-- AIË¥¢Âä°ÂàÜÊûêËÅäÂ§©ÁªÑ‰ª∂ - Áõ¥Êé•ÂµåÂÖ• -->
    <script>
        console.log('ü§ñ ÂºÄÂßãÂä†ËΩΩAIË¥¢Âä°ÂàÜÊûêËÅäÂ§©ÁªÑ‰ª∂...');

        // Âä†ËΩΩAIËÅäÂ§©ÁªÑ‰ª∂HTML
        fetch('/static/ai-chat-widget.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.text();
            })
            .then(html => {
                // ÂàõÂª∫ÂÆπÂô®div
                const container = document.createElement('div');
                container.id = 'ai-chat-container';

                // ‰ΩøÁî®DOMParserËß£ÊûêHTML
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                // ÊèêÂèñÂπ∂Ê∑ªÂä†Ê†∑Âºè
                const styles = doc.querySelectorAll('style');
                styles.forEach(style => {
                    container.appendChild(style.cloneNode(true));
                });

                // ÊèêÂèñÂπ∂Ê∑ªÂä†HTMLÂÜÖÂÆπÔºà‰∏çÂåÖÊã¨scriptÔºâ
                const body = doc.body;
                Array.from(body.children).forEach(child => {
                    if (child.tagName !== 'SCRIPT') {
                        container.appendChild(child.cloneNode(true));
                    }
                });

                // Ê∑ªÂä†Âà∞È°µÈù¢
                document.body.appendChild(container);

                console.log('‚úÖ AIË¥¢Âä°ÂàÜÊûêËÅäÂ§©ÁªÑ‰ª∂HTMLÂ∑≤Âä†ËΩΩ');

                // ÊèêÂèñÂπ∂ÊâßË°åscriptÊ†áÁ≠æ
                const scripts = doc.querySelectorAll('script');
                scripts.forEach(script => {
                    const newScript = document.createElement('script');
                    if (script.src) {
                        newScript.src = script.src;
                    } else {
                        newScript.textContent = script.textContent;
                    }
                    document.body.appendChild(newScript);
                });

                console.log('‚úÖ AIËÅäÂ§©ËÑöÊú¨Â∑≤ÊâßË°å');

                // Á≠âÂæÖËÑöÊú¨ÊâßË°åÂêéÂàùÂßãÂåñ
                setTimeout(() => {
                    if (window.aiChat && typeof window.aiChat.init === 'function') {
                        window.aiChat.init();
                        console.log('‚úÖ AIËÅäÂ§©ÂäüËÉΩÂ∑≤ÂàùÂßãÂåñ');
                    } else {
                        console.error('‚ùå window.aiChat Êú™ÂÆö‰πâÊàñÊ≤°ÊúâinitÊñπÊ≥ï');
                    }
                }, 300);

                // Ëß¶ÂèëËá™ÂÆö‰πâ‰∫ã‰ª∂
                window.dispatchEvent(new CustomEvent('ai-chat-loaded'));
            })
            .catch(error => {
                console.error('‚ùå AIËÅäÂ§©ÁªÑ‰ª∂Âä†ËΩΩÂ§±Ë¥•:', error);
            });

        // ÈÖçÁΩÆAIÊúçÂä°Á´ØÁÇπ
        window.AI_CHAT_CONFIG = {
            apiBaseUrl: window.location.hostname === 'localhost'
                ? 'http://localhost:8009'
                : `http://${window.location.hostname}:8009`,
            wsBaseUrl: window.location.hostname === 'localhost'
                ? 'ws://localhost:8009'
                : `ws://${window.location.hostname}:8009`,
            enableWebSocket: true,
            enableFileUpload: true,
            maxHistoryLength: 50,
            timeout: 30000
        };

        console.log('üì° AIÊúçÂä°ÈÖçÁΩÆÂ∑≤ËÆæÁΩÆ');
    </script>
</body>
</html>
